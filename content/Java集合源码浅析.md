+++
title = "Javaé›†åˆæºç æµ…æ"
slug = "java-é›†åˆæºç æµ…æ"
date = 2023-06-15
+++

### æ›´æ–°æ—¥å¿—ğŸ‰

2023-01-29 æ˜ŸæœŸå…­
> - ä¿®æ­£ä¸€äº›å·²çŸ¥é”™è¯¯
> - è°ƒæ•´æ–‡ç« å¸ƒå±€ç»“æ„
> - ä¿®æ­£é”™åˆ«å­—è¯

2022-05-26 10:20:23 æ˜ŸæœŸå››

> - ä¿®æ­£è¯­è¨€è¡¨è¾¾é€»è¾‘
> - åˆ é™¤/ä¿®æ”¹äº†é”™åˆ«å­—è¯
> - æ›´æ–°äº†éƒ¨åˆ†é…å›¾

2022-08-02

> - ä¿®æ­£é”™åˆ«å­—
> - ä¿®æ­£è¯­è¨€è¡¨è¾¾é€»è¾‘

2022-08-22

> - è¿˜æ˜¯ä¿®å·²çŸ¥çš„æ­£é”™åˆ«è¯è¯­

---

---

Javaé›†åˆè§£è¯»

## IDEAå¿«æ·é”®

> æŸ¥çœ‹æºç :F4
>
> è¿›å…¥å®ç°:Ctrl+Alt+B(é¼ æ ‡ç‚¹å‡»)
>
> æ·»åŠ å®ç°ç±»:ç©ºæ ¼
>
> æ˜¾ç¤ºå›¾:Ctrl+Alt+Shift+U

## æ¦‚è§ˆ

**è¯´æ˜ï¼š**ä»¥ä¸‹å†…å®¹çš„æºç åˆ†æï¼Œå¦‚æ²¡æœ‰ç‰¹åˆ«è¯´æ˜ï¼Œå‡æ¥è‡ªJDK8.

> 1. é›†åˆä¸»è¦åˆ†ä¸ºä¸¤ç»„ï¼šå•åˆ—é›†åˆå’ŒåŒåˆ—é›†åˆ
>
>    > ä½†åˆ—é›†åˆä¸€èˆ¬æ˜¯æŒ‡å­˜æ”¾å•ä¸ªå¯¹è±¡çš„é›†åˆï¼Œè€ŒåŒåˆ—é›†åˆä¸€èˆ¬æ˜¯ä»¥<k,v>é”®å€¼å¯¹å½¢å¼å­˜æ”¾æ•°æ®çš„é›†åˆã€‚
>
> 2. `Collection`æ¥å£ä¸‹æœ‰ä¸¤ä¸ªé‡è¦çš„å­æ¥å£`List`,`Set`ï¼Œä»–ä»¬çš„å®ç°å­ç±»éƒ½æ˜¯å•åˆ—é›†åˆã€‚
>
> 3. `Map`æ¥å£çš„å®ç°å­ç±»æœ‰`HashTable`ã€`HashMap`ã€`TreeMap`,ä¹Ÿéƒ½æ˜¯åŒåˆ—é›†åˆã€‚
>
> 4. ä»¥ä¸‹æ˜¯é›†åˆç±»ä¸‹ä¸¤å¤§ä¸»æ¥å£çš„ç±»å›¾å…³ç³»ã€‚

### **Collectionç³»**

![](https://images.waer.ltd/img/20220525092920.png)

> åœ¨Conllectionæ¥å£ä¸‹ï¼Œæ´¾ç”Ÿå‡ºäº†ä¸‰ä¸ªä¸»è¦çš„å­æ¥å£ï¼Œåˆ†åˆ«ä¸ºæ— åºé›†åˆ`Set`,é˜Ÿåˆ—`Queue`å’Œæœ‰åºé›†åˆ`List`ã€‚åœ¨ä¸‰å¤§å­æ¥å£ä¹‹ä¸‹ï¼Œè¿˜æœ‰ç€ä¼—å¤šçš„å®ç°å­ç±»æˆ–è€…æ´¾ç”Ÿçš„å­æ¥å£ï¼Œå…¶ä¸­æœ€å¸¸ç”¨çš„æœ‰ï¼š

- TreeSet
- LinkedHashSet
- HashSet
- LinkedList
- ArrayList
- Stack

****

### **Mapç³»**

![](https://images.waer.ltd/img/20220525092947.png)

> `Map`é›†åˆä¸ºåŒåˆ—é›†åˆã€‚`Map`**æ²¡æœ‰ç›´æ¥ç»§æ‰¿çš„å­æ¥å£,**ä¸»è¦æœ‰ä¸‰ä¸ªå®ç°ç±»ï¼Œåˆ†åˆ«æ˜¯`HashMap`ã€`HashTable`ã€`SortedMap`ã€‚åœ¨ä¸‰ä¸ªä¸»è¦å®ç°ä¹‹ä¸‹ï¼Œæ¯”è¾ƒå¸¸ç”¨çš„å®ç°åŠå…¶å®ç°å­ç±»æœ‰ï¼š
>
> - `HashMap`(æ€§èƒ½é«˜ï¼Œéçº¿ç¨‹å®‰å…¨)
> - `Hashtable`(æ€§èƒ½è¾ƒä½ï¼Œçº¿ç¨‹å®‰å…¨ï¼Œä½†å±äºè€æ—§çš„APIï¼Œä¸€èˆ¬ä¸æ¨èä½¿ç”¨)
> - `TreeMap`(æœ‰åº`map`)

****

## ç»†è¯´

### `Collection`

ç”±äº`Collection`æ¥å£ç›´æ¥ç»§æ‰¿äº†`Iterable`ï¼Œå®ƒæ˜¯æ²¡æœ‰å®ç°çš„ï¼Œå®ƒçš„æ‰€æœ‰æ–¹æ³•éƒ½æ˜¯ç”±å®ƒçš„**å­æ¥å£**çš„å®ç°ç±»è¿›è¡Œå®ç°ï¼Œæ‰€ä»¥è¿™é‡Œå°±ä»¥`Collection`ä¸‹å­æ¥å£`List`çš„å®ç°ç±»`ArrayList`æ¥è®²è§£ã€‚æ³¨æ„`List`æ˜¯**æœ‰åºé›†åˆä¸”å…ƒç´ å¯ä»¥é‡å¤**ï¼Œè€Œ`Set`åˆ™æ˜¯**æ— åºé›†åˆï¼Œå…ƒç´ ä¸å¯é‡å¤**ã€‚

**è®²è§£çš„æ–¹æ³•åˆ—è¡¨**

> - add:æ·»åŠ å•ä¸ªå…ƒç´ 
> - removeï¼šè¾“å‡ºæŒ‡å®šå…ƒç´ 
> - contains:æŸ¥æ‰¾å…ƒç´ æ˜¯å¦å­˜åœ¨
> - size:è·å–å…ƒç´ ä¸ªæ•°
> - isEmpty:åˆ¤æ–­æ˜¯å¦ä¸ºç©º
> - clear:æ¸…ç©º
> - addAll:æ·»åŠ å¤šä¸ªå…ƒç´ 
> - containsAll:æŸ¥æ‰¾å¤šä¸ªå…ƒç´ æ˜¯å¦éƒ½å­˜åœ¨
> - removeAll:è¾“å‡ºå¤šä¸ªå…ƒç´ 

**åŸºæœ¬ç”¨æ³•æ¼”ç¤º**

```java
List list = new ArrayList();
/*æ·»åŠ å•ä¸ªå…ƒç´ */
list.add("Jack");
//è¿™é‡Œå…¶å®æ˜¯ä¸€ä¸ªè‡ªåŠ¨è£…ç®±çš„æ“ä½œ:list.add(new Integer(10))
list.add(10);
list.add(true);
System.out.println("list:"+list);

/*è¾“å‡ºå…ƒç´ */
//è¾“å‡º"Jack"
//list.remove(0);
//æŒ‡å®šè¾“å‡ºæŸä¸ªå…ƒç´ 
list.remove(true);
System.out.println("è¾“å‡ºåçš„[list]:"+list);

/*æŸ¥æ‰¾æŸä¸ªå…ƒç´ æ˜¯å¦å­˜åœ¨*/
//true
System.out.println(list.contains("Jack"));

/*è·å–å…ƒç´ ä¸ªæ•°*/
//2
System.out.println(list.size());

/*åˆ¤æ–­é›†åˆæ˜¯å¦ä¸ºç©º*/
//false
System.out.println(list.isEmpty());

/*æ¸…ç©ºé›†åˆ*/
list.clear();
//æ¸…ç©ºåçš„[list]ï¼š[]
System.out.println("æ¸…ç©ºåçš„[list]ï¼š"+list);

/*æ·»åŠ å¤šä¸ªå…ƒç´ */
ArrayList list2 = new ArrayList();
list2.add("è¥¿æ¸¸è®°");
list2.add("è¥¿å¢è®°");
list.addAll(list2);
//æ·»åŠ å¤šä¸ªå…ƒç´ åçš„[list]:[è¥¿æ¸¸è®°, è¥¿å¢è®°]
System.out.println("æ·»åŠ å¤šä¸ªå…ƒç´ åçš„[list]:"+list);

/*åˆ¤æ–­å¤šä¸ªå…ƒç´ æ˜¯å¦éƒ½å­˜åœ¨*/
//true
System.out.println(list.containsAll(list2));

/*è¾“å‡ºå¤šä¸ªå…ƒç´ */
list.add("åå¼ºåŒ—");
//true
System.out.println(list.removeAll(list2));
//åå¼ºåŒ—
System.out.println(list);
```

**éå†ç”¨æ³•**

> ä¸Šé¢çš„ç±»å›¾å·²ç»çŸ¥é“ï¼Œ`Collection`æ¥å£è¿˜æœ‰ä¸€ä¸ª`Iterable`çˆ¶æ¥å£ã€‚å®ƒçš„éƒ¨åˆ†å®ç°æºç ä¸­ç¬¬ä¸€ä¸ªæ–¹æ³•å¦‚ä¸‹:
>
> ![](https://images.waer.ltd/img/20220320114101.png)
>
> å¯ä»¥çœ‹åˆ°ï¼Œè¯¥æ–¹æ³•å¯ä»¥è¿”å›å…ƒç´ çš„`iterator`å¯¹è±¡ã€‚åªè¦æ˜¯å®ç°äº†æ¥å£çš„æ‰€æœ‰å­ç±»ï¼Œéƒ½æœ‰ä¸€ä¸ª`iterator()`æ–¹æ³•ã€‚åœ¨å¯¹å…ƒç´ çš„éå†ä¸Šï¼Œéƒ½å¯ä»¥é‡‡ç”¨è¿­ä»£å™¨çš„æ–¹å¼è¿›è¡Œéå†ã€‚æ‰€ä»¥`Collection`**åŠå…¶æ‰€æœ‰å­ç±»å®ç°**ï¼Œæˆ‘ä»¬éƒ½å¯ä»¥è·å–åˆ°æ¯ä¸ªå…ƒç´ çš„è¿­ä»£å™¨å¹¶ç”¨åœ¨å¯¹å…ƒç´ çš„éå†æ“ä½œä¸Šã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ`iterator`**ä»…ç”¨æ¥éå†é›†åˆï¼Œæœ¬èº«å¹¶ä¸å­˜æ”¾ä»»ä½•å¯¹è±¡ã€‚**

**è¿­ä»£å™¨çš„æ‰§è¡ŒåŸç†**

> ä½œä¸º`Collection`çš„çˆ¶æ¥å£ï¼Œ`Iterator`çš„æ–¹æ³•å¦‚ä¸‹ï¼š
>
> ![](https://images.waer.ltd/img/20220320141211.png)
>
>

> æˆ‘ä»¬ä¸€èˆ¬åœ¨ä½¿ç”¨è¿­ä»£å™¨è¿›è¡Œéå†çš„æ—¶å€™ï¼Œéƒ½ä¼šç”¨åˆ°ä¸€ä¸ª`while`å¾ªç¯ï¼Œå¾ªç¯çš„æ¡ä»¶æ˜¯`iterator.hasNext()`ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨æ¯æ¬¡å¾—åˆ°éå†å…ƒç´ ä¹‹å‰ï¼Œ`iterator`å¯¹è±¡ä¼šè°ƒç”¨è‡ªèº«çš„`hasNext()`æ–¹æ³•ï¼Œå¯¹é›†åˆé‡Œçš„å…ƒç´ è¿›è¡Œåˆ¤æ–­ï¼Œ**åªæœ‰å½“å­˜åœ¨ä¸‹ä¸€ä¸ªå…ƒç´ æ—¶ï¼Œè¿­ä»£å™¨æ‰ä¼šç»§ç»­å¾€ä¸‹æ‰§è¡Œ**ï¼Œå¦åˆ™ï¼Œè¿­ä»£ç»“æŸã€‚
>
> ![](https://images.waer.ltd/img/20220320140135.png)
>
> å¯ä»¥çœ‹åˆ°ï¼Œ`Iterator`çš„`hasNext()`æ–¹æ³•è¿”å›ä¸€ä¸ª**å¸ƒå°”å€¼**ï¼Œå¦‚æœè¯¥è¿­ä»£å¯¹è±¡è¿˜å­˜åœ¨å…ƒç´ çš„æƒ…å†µä¸‹ã€‚è¿™ä¸ªæ–¹æ³•å°±ç›¸å½“äºä¸€ä¸ªæŒ‡å‘é›†åˆå…ƒç´ çš„æŒ‡é’ˆï¼Œæ¯ä¸€æ¬¡è°ƒç”¨éƒ½ä¼šå‘ä¸‹ç§»åŠ¨ä»¥æ£€æŸ¥**æ˜¯å¦åˆ°è¾¾é›†åˆå°¾éƒ¨**ï¼Œåœ¨ç§»åŠ¨çš„åŒæ—¶ï¼Œå®ƒè¿˜ä¼šè°ƒç”¨`next()`æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¼šå°†ç§»åŠ¨åè¯¥æŒ‡é’ˆæŒ‡å‘ä½ç½®ä¸Šçš„å…ƒç´ è¿›è¡Œè¿”å›ã€‚ä¸ºäº†æœ‰æ•ˆçš„é˜²æ­¢ç©ºæŒ‡é’ˆï¼Œæ¯æ¬¡åœ¨è°ƒç”¨`Next()`ä¹‹å‰ï¼Œä¼šå…ˆè°ƒç”¨`hasNext()`,è¿™æ˜¯æœ‰å¿…è¦çš„ã€‚å¦‚æœè¯´ä¸å­˜åœ¨ä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œåˆ™ä¼šæŠ›å‡ºä¸€ä¸ª`NoSuchElementException`å¼‚å¸¸ã€‚

**Iteratorä½¿ç”¨ç¤ºä¾‹**

```java
package collection;

import java.util.ArrayList;
import java.util.Collection;
import java.util.Iterator;

/**
 * @author: å…«å°ºå¦–å‰‘
 * @date: 2022/3/20 14:17
 * @description: æ¼”ç¤ºè¿­ä»£å™¨[Iterator]çš„ä½¿ç”¨
 * @blog:www.waer.ltd
 */
@SuppressWarnings({"all"})
public class CollectionIterator {
    public static void main(String[] args) {
        Collection col = new ArrayList();
        col.add(new Book("C++ Primer Plus","Stephen Prata",57.4));
        col.add(new Book("ç¨‹åºå‘˜çš„æ•°å­¦","ç»“åŸæµ©",20.5));
        col.add(new Book("Javaç–¯ç‹‚è®²ä¹‰","æåˆš",80.7));

        System.out.println("é›†åˆ[col]:"+col);
        /*éå†é›†åˆ*/
        //1.è·å–é›†åˆçš„è¿­ä»£å¯¹è±¡
        Iterator iterator = col.iterator();
        //2.whileå¾ªç¯éå†æ•°æ®
        while(iterator.hasNext()){
            //3.æ³¨æ„ï¼šiteratorè¿”å›é»˜è®¤æ—¶ä¸€ä¸ªObjectç±»å‹(é™¤éæŒ‡å®šæ³›å‹)
            Object o = iterator.next();
            System.out.println("[col]è¿­ä»£è¿”å›:"+o);
        }
        //4.å½“é€€å‡ºwhileå¾ªç¯ä¹‹åï¼Œæ­¤æ—¶çš„iteratoræŒ‡å‘æœ€åä¸€ä¸ªå…ƒç´ ï¼Œåœ¨è°ƒç”¨next()æ–¹æ³•ä¼šæŠ¥NoSuchElementExceptionå¼‚å¸¸ã€‚
        //å¦‚æœéœ€è¦å†æ¬¡éå†ï¼Œéœ€è¦é‡ç½®è¿­ä»£å™¨ã€‚æ–¹æ³•å¦‚ä¸‹ï¼š
        //IDEAæ”¯æŒå¿«é€Ÿç”Ÿæˆè¿­ä»£æ–¹æ³•ï¼Œä½¿ç”¨[Ctrl+j]å¿«æ·é”®è¿›è¡ŒæŸ¥çœ‹
        iterator = col.iterator();
        while (iterator.hasNext()) {
            Object o1 =  iterator.next();
            System.out.println("[col]å†æ¬¡è¿­ä»£ï¼š"+o1);
        }
    }
}

/**
 * å†…éƒ¨ç±»
 */
class  Book{
    private String name;
    private String author;
    private double price;

    public Book(String name, String author, double price) {
        this.name = name;
        this.author = author;
        this.price = price;
    }

    @Override
    public String toString() {
        return "Book{" +
                "name='" + name + '\'' +
                ", author='" + author + '\'' +
                ", price=" + price +
                '}';
    }

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }

    public String getAuthor() {
        return author;
    }

    public void setAuthor(String author) {
        this.author = author;
    }

    public double getPrice() {
        return price;
    }

    public void setPrice(double price) {
        this.price = price;
    }
}
```

> ä¸€äº›éœ€è¦æ³¨æ„çš„ç‚¹ï¼Œå·²ç»å†™åœ¨äº†æ³¨é‡Šå½“ä¸­ã€‚

**å¢å¼ºfor**

> æ‰€è°“å¢å¼ºforï¼Œä¹Ÿå°±æ˜¯é’ˆå¯¹æ™®é€šforå¾ªç¯çš„å¢å¼ºã€‚å®ƒå¯ä»¥æ›¿ä»£`iterator`è¿­ä»£å™¨ï¼Œç›¸å½“äºä¸€ä¸ªç®€åŒ–ç‰ˆçš„`iterator`,ä¹Ÿæ­£å› ä¸ºå¦‚æ­¤ï¼Œ**å¢å¼ºforåªèƒ½ç”¨äºéå†é›†åˆæˆ–è€…æ•°ç»„**ã€‚

åŸºæœ¬è¯­æ³•ï¼š

```java
for(å…ƒç´ ç±»å‹ å…ƒç´ å:é›†åˆæˆ–è€…æ•°ç»„å){
    è®¿é—®å…ƒç´ ;
}
```

```java
package collection;

import java.util.ArrayList;
import java.util.Collection;

/**
 * @author: å…«å°ºå¦–å‰‘
 * @date: 2022/3/20 14:56
 * @description: æ¼”ç¤ºå¢å¼ºforçš„ä½¿ç”¨
 * @blog:www.waer.ltd
 */
public class CollectionFor {
    @SuppressWarnings({"all"})
    public static void  main(String[] args) {
        Collection col = new ArrayList();
        col.add(new Book("C++ Primer Plus","Stephen Prata",57.4));
        col.add(new Book("ç¨‹åºå‘˜çš„æ•°å­¦","ç»“åŸæµ©",20.5));
        col.add(new Book("Javaç–¯ç‹‚è®²ä¹‰","æåˆš",80.7));

        /*ä½¿ç”¨å¢å¼ºforè¿›è¡Œé›†åˆçš„éå†*/
        for(Object book:col){
            System.out.println("book="+book);
        }
    }
}
```

#### `List`æ¥å£

**å¸¸ç”¨å®ç°åŠå…¶æ–¹æ³•ä¸€è§ˆ**

![](https://images.waer.ltd/img/Lists.png)

> `List`æ¥å£æ˜¯`Collection`çš„å­æ¥å£ï¼Œä¸Šé¢è®²è§£çš„`ArrayList`çš„æ–¹æ³•æ˜¯æ¥è‡ª`Collection`æ¥å£æ–¹æ³•ã€‚è€Œè¿™äº›æ–¹åœ¨`Set`å­æ¥å£ä¸­ä¹Ÿå¯ä»¥ä½¿ç”¨ã€‚ä¸‹é¢è®²ä¸€ä¸‹å­æ¥å£`List`ä¸­çš„å®ç°ç±»ï¼Œä¹Ÿæ˜¯ä»¥`ArrayList`å®ç°ä¸ºä¾‹ã€‚

> - `List`é›†åˆç±»ä¸­çš„å…ƒç´ æ˜¯æœ‰åº(æ·»åŠ å’Œå–å‡ºé¡ºåºä¸€è‡´)çš„ï¼Œä¸”æ˜¯å¯é‡å¤çš„ã€‚
> - `List`é›†åˆä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ éƒ½æœ‰å…¶å¯¹åº”çš„é¡ºåºç´¢å¼•ï¼Œå³ä»–æ˜¯æ”¯æŒ**ç´¢å¼•**çš„ä¸€ç±»é›†åˆã€‚
> - `List`ä¸­çš„å…ƒç´ éƒ½å¯¹åº”ä¸€ä¸ªæ•´æ•°å‹çš„åºå·è®°è½½å…¶åœ¨å®¹å™¨ä¸­çš„ä½ç½®ï¼Œå¯ä»¥æ ¹æ®åºå·å­˜å–å®¹å™¨ä¸­çš„å…ƒç´ ã€‚
> - `List`å­æ¥å£çš„ä¸»è¦å¸¸ç”¨å®ç°ç±»æœ‰`ArrayList`ã€`LinkedList`ã€`Vector`ã€‚

**Listçš„ä¸€äº›æ–¹æ³•**

```java
package List;

import java.util.ArrayList;
import java.util.List;

/**
 * @author: å…«å°ºå¦–å‰‘
 * @date: 2022/3/20 16:57
 * @description: Listçš„æ–¹æ³•æ¼”ç¤º
 * @blog:www.waer.ltd
 */
public class ListMethod {
    @SuppressWarnings({"all"})
    public static void main(String[] args) {
        List list =new ArrayList();
        list.add("å¼ æ— å¿Œ");
        list.add("å¼ å¤©å¿—");
        /*åœ¨indexä½ç½®æ’å…¥å…ƒç´ e*/
        /*æ³¨æ„ï¼šè¿™é‡Œå¦‚æœä¸æŒ‡å®šä¸‹æ ‡çš„è¯ï¼Œé»˜è®¤æ˜¯ä»¥å°¾éƒ¨è¿½åŠ çš„æ–¹å¼è¿›è¡Œå…ƒç´ æ’å…¥çš„*/
        list.add(1,"Tisox");
        //list=[å¼ æ— å¿Œ, Tisox, å¼ å¤©å¿—]
        System.out.println("list="+list);

        /*addAll(inr index,Collection e)ï¼šä»indexä½ç½®å¼€å§‹å°†å…ƒç´ eä¸­çš„æ‰€æœ‰å…ƒç´ æ·»åŠ è¿›æ¥*/
        List list2 =new ArrayList();
        list2.add("èœ˜è››ä¾ ");
        list2.add("é’¢é“ä¾ ");
        list.addAll(1,list2);
        //list=[å¼ æ— å¿Œ, èœ˜è››ä¾ , é’¢é“ä¾ , Tisox, å¼ å¤©å¿—]
        System.out.println("list="+list);
        /*int intdexOf(Object obj):è¿”å›objåœ¨å½“å‰é›†åˆä¸­é¦–æ¬¡å‡ºç°çš„ä½ç½®*/
        System.out.println(list.indexOf("èœ˜è››ä¾ "));

        /*int lastIndexOf(Object obj):è¿”å›objåœ¨å½“å‰é›†åˆä¸­æœ€åä¸€æ¬¡å‡ºç°çš„ä½ç½®*/
        list.add("å‡‹æ®‹");
        System.out.println(list.lastIndexOf("å‡‹æ®‹"));

        /*remove(int index):ç§»é™¤æŒ‡å®šindexä½ç½®çš„å…ƒç´ ï¼Œå¹¶è¿”å›æ­¤å…ƒç´ */
        list.remove(0);
        System.out.println("list="+list);

        /*set(int index,Object ele):è®¾ç½®æŒ‡å®šindexä½ç½®å‡ºçš„å…ƒç´ ä¸ºeleï¼Œç›¸å½“äºæ˜¯æ›¿æ¢å…ƒç´ */
        list.set(1,"æ–°çš„åå­—");
        System.out.println("list="+list);

        /*subList(int fromIndex,int toIndex):è¿”å›ä»fromIndexåˆ°toIndexä½ç½®çš„å­é›†åˆ*/
        //è¿”å›ä¸€ä¸ªå·¦é—­å³å¼€çš„åŒºé—´
        List reslist = list.subList(0, 2);
        System.out.println("relist="+reslist);
    }
}
```

**Listçš„ä¸‰ç§éå†æ–¹å¼**

> ç”±äº`ArrayList`ã€`LinkedList`å’Œ`Vector`éƒ½æ˜¯`List`çš„å®ç°å­ç±»ï¼Œä»¥ä¸‹æ–¹æ³•å¯ä»¥**æ— ç¼åˆ‡æ¢**ï¼Œæ•ˆæœæ˜¯ä¸€æ ·çš„ã€‚

```java
package List;

import java.util.*;

/**
 * @author: Tisox
 * @date: 2022/3/20 19:18
 * @description: Listçš„ä¸‰ç§éå†æ–¹å¼
 * @blog:www.waer.ltd
 */
public class ListFor {
    @SuppressWarnings({"all"})
    public static void main(String[] args) {
        //List list =new Vector();
        List list = new LinkedList();
        //List list = new ArrayList();
        list.add("jack");
        list.add("tom");
        list.add("å›é”…è‚‰");
        list.add("é±¼é¦™è‚‰ä¸");
        list.add("ç ‚é”…ç²‰");

        /*1.è¿­ä»£å™¨éå†*/
        Iterator iterator = list.iterator();
        while (iterator.hasNext()) {
            Object next = iterator.next();
            System.out.println("[list]çš„[è¿­ä»£å™¨iterator]éå†="+list);
        }
        System.out.println("====================================");
        /*2.å¢å¼ºforéå†*/
        for (Object o : list) {
            System.out.println("[list]çš„[å¢å¼ºfor]éå†="+list);
        }
        System.out.println("====================================");
        /*3.æ™®é€šforå¾ªç¯éå†*/
        for(int i=0;i<list.size();i++){
            System.out.println("[list]çš„[æ™®é€šforå¾ªç¯]éå†="+list.get(i));
        }
    }
}
```

####  `ArrayList`

- `ArrayList`**å…è®¸å­˜å…¥`null`å€¼ã€‚**

```java
ArrayList arrayList = new ArrayList();
arrayList.add(null);
arrayList.add("");
arrayList.add("Java");
System.out.println(arrayList);
```

- åº•å±‚é‡‡ç”¨æ•°ç»„å®ç°ã€‚

- `ArrayList`çº¿ç¨‹ä¸å®‰å…¨

![](https://images.waer.ltd/img/20220320204436.png)

> é€šè¿‡å®ƒçš„æºç å¯ä»¥çœ‹åˆ°ï¼Œä»–æ˜¯æ²¡æœ‰`synchronized`å…³é”®å­—ä¿®é¥°çš„ã€‚ä¹Ÿæ­£æ˜¯å› ä¸ºå¦‚æ­¤ï¼Œå®ƒçš„æ•ˆç‡æ˜¯æ¯”è¾ƒé«˜çš„ï¼Œæ‰€ä»¥å¦‚æœéœ€è¦ä¿è¯çº¿ç¨‹å®‰å…¨çš„åœºæ™¯ä¸‹ï¼Œä¸å»ºè®®ä½¿ç”¨`ArrayList`ã€‚

##### æºç åˆ†æ

**`ArrayList`ä¸­ç»´æŠ¤äº†ä¸€ä¸ª`Object`ç±»å‹çš„æ•°ç»„`elementData[]`ã€‚**æºç å¦‚ä¸‹:

```java
transient Object[] elementData;
```

è¿™é‡Œçš„`elementData[]`æ•°ç»„çš„ç±»å‹æ˜¯`Object`ç±»å‹ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒå¯ä»¥å­˜æ”¾ä»»æ„ç±»å‹çš„æ•°æ®ï¼Œå› ä¸º`Object`ç±»æ˜¯**æ‰€æœ‰ç±»çš„çˆ¶ç±»**ï¼Œä¹Ÿå°±æ˜¯é¡¶çº§çˆ¶ç±»ã€‚ å…³é”®å­—`transient`çš„ä½œç”¨æ˜¯å»é™¤åºåˆ—åŒ–ï¼Œå½“æŸä¸ªå±æ€§è¢«åŠ ä¸Šè¯¥å…³é”®å­—å³è¡¨ç¤ºå®ƒåœ¨è¿›è¡Œåºåˆ—åŒ–æ—¶ä¼šè¢«å¿½ç•¥ï¼Œä¸å‚ä¸åºåˆ—åŒ–æ“ä½œã€‚

##### åº•å±‚æ‰©å®¹åŸç†

> `ArrayList`åº•å±‚é‡‡ç”¨æ•°ç»„è¿™ç§æ•°æ®ç»“æ„æ¥å®ç°ï¼Œå¿…ç„¶ä¼šæœ‰å®¹é‡çš„é™åˆ¶ï¼Œé‚£ä¹ˆåœ¨å®ƒçš„åº•å±‚æ˜¯å¦‚ä½•å®ç°è‡ªåŠ¨æ‰©å®¹çš„å‘¢ï¼Ÿè¿™é‡Œä»¥å…¶ä¸­çš„`add()`æ–¹æ³•è¿›è¡Œæµ…æã€‚

`ArrayList`æœ‰ä¸¤ä¸ªæ„é€ æ–¹æ³•ï¼Œåˆ†åˆ«æ˜¯**æ— å‚æ•°æ„é€ å’Œæœ‰å‚æ„é€ **ã€‚ä¸‹é¢æ˜¯æºç 

```java
//æ— å‚æ„é€ 
public ArrayList() {
    this.elementData = DEFAULTCAPACITY_EMPTY_ELEMENTDATA;
}
//æœ‰å‚æ„é€ 
public ArrayList(int initialCapacity) {
    if (initialCapacity > 0) {
        this.elementData = new Object[initialCapacity];
    } else if (initialCapacity == 0) {
        this.elementData = EMPTY_ELEMENTDATA;
    } else {
        throw new IllegalArgumentException("Illegal Capacity: "+
                                           initialCapacity);
    }
}
```

ä¸¤ä¸ªæ„é€ æ–¹æ³•ä¸ä»…åœ¨å‚æ•°ä¸Šæœ‰æ‰€åŒºåˆ«ï¼Œä»–ä»¬çš„åº•å±‚æ‰©å®¹åŸç†ä¹Ÿæ˜¯ä¸ä¸€æ ·çš„ï¼Œå…ˆçœ‹ä¸€ä¸‹æ— å‚æ•°çš„` ArrayList()`æ„é€ ã€‚

å¯ä»¥çœ‹åˆ°ï¼Œåœ¨**æ— å‚æ„é€ çš„æ–¹æ³•**ä¸­ï¼Œå®ƒå°†æ•°ç»„çš„åˆå§‹å®¹é‡è®¾ä¸º`DEFAULTCAPACITY_EMPTY_ELEMENTDATA`ã€‚ä¹Ÿå°±æ˜¯ä¸€ä¸ªç©ºå¯¹è±¡æ•°ç»„ã€‚è¿™ä¸€ç‚¹å¯ä»¥ä»ä¸‹é¢çš„æºç å¾—çŸ¥ã€‚

![](https://images.waer.ltd/img/20220321195749.png)

ä¸‹é¢å°è¯•åœ¨é›†åˆä¸­æ·»åŠ å…ƒç´ ï¼Œæ¥åˆ†æaddæ–¹æ³•çš„æ‰§è¡Œè¿‡ç¨‹ã€‚

```java
//ä½¿ç”¨æ— å‚æ„é€ å¯¹é›†åˆè¿›è¡Œåˆå§‹åŒ–
ArrayList list = new ArrayList();
//å‘å…¶ä¸­æ·»åŠ 10ä¸ªå…ƒç´ 
for (int i = 1; i <= 10; i++) {
    list.add(i);
}
```

**æ‰§è¡Œè¿‡ç¨‹å’Œæ‰©å®¹åŸç†**

- åœ¨åˆå§‹åŒ–å®Œæˆåï¼Œå½“æˆ‘ä»¬è§¦å‘add()æ—¶ï¼Œå®ƒä¼šå…ˆè°ƒç”¨`valueOf()`æ–¹æ³•å¯¹æ·»åŠ çš„å…ƒç´ è¿›è¡Œä¸€ä¸ª**è£…ç®±**æ“ä½œï¼Œè¿™ä¸æ˜¯æœ¬æ¬¡åˆ†æçš„é‡ç‚¹ï¼Œä¸å†èµ˜è¿°ã€‚æ³¨æ„ä¸‹é¢è¿™ä¸ªè‡ªåŠ¨è£…ç®±çš„æºç æ¥è‡ª**JDK11**

![](https://images.waer.ltd/img/20220321200829.png)

- è£…ç®±ç»“æŸåï¼Œè¿›å…¥`add(E e)`è¿™ä¸ªæ–¹æ³•ï¼Œè¯¥æ–¹æ³•æ˜¯é›†åˆä¸­çš„ä¸€ä¸ª**é‡è½½æ–¹æ³•ï¼Œæ¥æ”¶ä¸€ä¸ªæ³›å‹å‚æ•°**ï¼Œæºç å¦‚ä¸‹:

  ```java
  public boolean add(E e) {
      ensureCapacityInternal(size + 1);  // Increments modCount!!
      elementData[size++] = e;
      return true;
  }
  ```

é¦–å…ˆï¼Œåœ¨æ‰§è¡Œæ­£å¼çš„æ·»åŠ æ“ä½œä¹‹å‰ï¼Œä¼šå…ˆæ‰§è¡Œ`ensureCapacityInternal()`æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¸»è¦æ˜¯ç”¨æ¥**ç¡®è®¤é›†åˆçš„å®¹é‡æƒ…å†µ**ï¼Œå†³å®šæ˜¯å¦éœ€è¦æ‰©å®¹ã€‚å†è°ƒç”¨æ·»åŠ æ–¹æ³•è¿›è¡Œå…ƒç´ çš„æ·»åŠ ã€‚æ˜¾ç„¶ï¼Œè¿™é‡Œå‡ºç°çš„`ensureCapacityInternal()`æ–¹æ³•æ˜¯é‡ç‚¹ï¼Œæºç å¦‚ä¸‹ï¼š

```java
private void ensureCapacityInternal(int minCapacity) {
    if (elementData == DEFAULTCAPACITY_EMPTY_ELEMENTDATA) {
        minCapacity = Math.max(DEFAULT_CAPACITY, minCapacity);
    }
    ensureExplicitCapacity(minCapacity);
}
```

æ–¹æ³•ä¼ å…¥ä¸€ä¸ªåä¸º`minCapacity`çš„`int`ç±»å‹å˜é‡ï¼Œè¡¨ç¤ºæ•°ç»„æœ€å°å®¹é‡ã€‚æ¥ç€åˆ¤æ–­`elementData`æ˜¯å¦æ˜¯`DEFAULTCAPACITY_EMPTY_ELEMENTDATA`é»˜è®¤å€¼ï¼Œç”±äºæˆ‘ä»¬é€‰æ‹©çš„æ˜¯æ— å‚æ„é€ ï¼Œæ‰€ä»¥`if`è¯­å¥ä¸­çš„æ¡ä»¶æ˜¯æˆç«‹çš„ã€‚æ¥ä¸‹æ¥`Math.max(DEFAULT_CAPACITY, minCapacity)`åœ¨**é»˜è®¤å®¹é‡**å’Œ**æœ€å°å®¹é‡**ä¹‹é—´å–ä¸€ä¸ªæœ€å¤§å€¼å¹¶èµ‹ç»™`minCapacity`ï¼Œä¹Ÿå°±æ˜¯æ›´æ–°`minCapacity`çš„å€¼ã€‚å…³äºé»˜è®¤å®¹é‡`DEFAULT_CAPACITY`ï¼Œä¸‹é¢æ˜¯å®ƒçš„å£°æ˜ï¼š

```java
private static final int DEFAULT_CAPACITY = 10;
```

æ‰§è¡Œä¹‹åï¼Œ`minCapacity`çš„å€¼å°†æ›´æ–°ä¸º10;ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™ä¸ªæ–¹æ³•ç›®çš„æ˜¯ä¸ºäº†ç¡®è®¤`minCapacity`çš„å€¼ï¼Œè€Œåœ¨`if`ä¹‹åï¼Œåˆå‡ºç°äº†ä¸€ä¸ª`ensureExplicitCapacity(minCapacity)`æ–¹æ³•ï¼Œåœ¨`if`åˆ¤æ–­æ¡ä»¶ä¸æ»¡è¶³çš„æƒ…å†µä¸‹æ‰§è¡Œï¼Œå‚æ•°å°±æ˜¯ä¸Šé¢æ›´æ–°åçš„`minCapacity`ï¼Œå¯ä»¥çŒœæµ‹ï¼Œè¿™ä¸ªæ–¹æ³•åº”è¯¥ä¹Ÿæ˜¯å¯¹æ˜¯å¦éœ€è¦æ‰©å®¹è¿›è¡Œä¸€ä¸ªåˆ¤æ–­çš„ç®—æ³•ã€‚

```java
private void ensureExplicitCapacity(int minCapacity) {
    modCount++;
    // overflow-conscious code
    if (minCapacity - elementData.length > 0)
        grow(minCapacity);
}
```

æ³¨æ„,è¿™é‡Œæœ‰ä¸€æ¡ä¸º`modCount++;`çš„è¯­å¥ï¼Œä»–ä¸»è¦æ˜¯è®°å½•å½“å‰é›†åˆè¢«ä¿®æ”¹çš„æ¬¡æ•°ï¼Œä¸ºäº†é˜²æ­¢è¢«å¤šä¸ªçº¿ç¨‹æ“ä½œï¼Œå¦åˆ™ä¼šæŠ›å¼‚å¸¸ã€‚ç¬¬4è¡Œä¸­ifçš„æ¡ä»¶`minCapacity - elementData.length > 0`è¡¨ç¤ºæœ€å°å®¹é‡ä¸å½“å‰æ•°ç»„å…ƒç´ å®¹é‡çš„ä¸€ä¸ª**å·®å€¼å¤§äº0æ˜¯å¦æˆç«‹**ï¼Œå°†ä¼šç›´æ¥è°ƒç”¨ä¸‹ä¸€ä¸ªæ–¹æ³•è¿›è¡Œæ‰©å®¹ï¼Œä¹Ÿå°±æ˜¯`grow()`æ–¹æ³•ã€‚

> æ¯”æ–¹è¯´ï¼Œæ­¤æ—¶çš„`minCapacity=10`ï¼Œ`elementData=0`,æ˜¾ç„¶`10-0>0`,ä¹Ÿå³æ˜¯è¯´ï¼Œæ•°ç»„éœ€è¦ä¸€ä¸ªæœ€å°å®¹é‡ä¸º10ç©ºé—´ï¼Œè€Œæ­¤æ—¶çš„å®¹é‡ä¸º0ï¼Œæ˜¾ç„¶éœ€è¦è¿›è¡Œæ‰©å®¹æ“ä½œã€‚

ä¸‹é¢æ˜¯`grow()`æ–¹æ³•ï¼Œä¹Ÿæ˜¯æ‰©å®¹çš„æ ¸å¿ƒå®ç°ã€‚

```java
private void grow(int minCapacity) {
    // overflow-conscious code
    int oldCapacity = elementData.length;
    int newCapacity = oldCapacity + (oldCapacity >> 1);
    if (newCapacity - minCapacity < 0)
        newCapacity = minCapacity;
    if (newCapacity - MAX_ARRAY_SIZE > 0)
        newCapacity = hugeCapacity(minCapacity);
    // minCapacity is usually close to size, so this is a win:
    elementData = Arrays.copyOf(elementData, newCapacity);
}
```

å¯ä»¥çœ‹åˆ°ï¼Œæ–¹æ³•å¼€å§‹ä¼šå…ˆå°†æ•°ç»„å®¹é‡`elementData.length`èµ‹å€¼ç»™ä¸€ä¸ªä¸­é—´å˜é‡`oldCapacity`ã€‚æ¥ç€ä¸ºå˜é‡`newCapacity`è¿›è¡Œèµ‹å€¼ï¼Œç®—æ³•æ˜¯å°†`oldCapacity`æ—§**çš„å®¹é‡+æ—§å®¹é‡çš„äºŒåˆ†ä¹‹ä¸€**èµ‹å€¼ç»™è¯¥å˜é‡ã€‚æ³¨æ„è¿™é‡Œ`(oldCapacity >> 1)`è¡¨å°†`oldCapacity`å³ç§»ä¸€ä½ï¼Œ**ç­‰åŒäºé™¤ä»¥2**ï¼Œç”¨ä½è¿ç®—å¯ä»¥æé«˜æ‰§è¡Œæ•ˆç‡ã€‚åè¿‡æ¥ï¼Œå¦‚æœæ˜¯å·¦ç§»çš„è¯ï¼Œä»£è¡¨ä¹˜ä»¥`2`ã€‚

åˆç”±äºå‰é¢å·²ç»çŸ¥é“`elemenatData`å…¶å®æ˜¯ç­‰äº`0`çš„ï¼Œé‚£ä¹ˆç›´æ¥å¯¼è‡´è¿™æ¡èµ‹å€¼è¯­å¥ç»“æœä¸º`0`ï¼Œä¹Ÿå°±æ˜¯`newCapacity==0`ï¼Œæ‰€ä»¥å®ƒåé¢ç´§æ¥ç€å‡ºç°äº†ä¸¤ä¸ªåˆ¤æ–­ã€‚

> 1. å¦‚æœæ–°çš„å®¹é‡å°äºæœ€å°å®¹é‡ï¼Œé‚£ä¹ˆå°†æœ€å°å®¹é‡èµ‹ç»™è¿™ä¸ªæ–°å®¹é‡ï¼Œ**å®Œæˆä¸€æ¬¡æ‰©å®¹ï¼Œæ­¤æ—¶æ•°ç»„çš„å®¹é‡ç”±0å˜ä¸º10.**
> 2. å¦‚æœ`newCapacity > MAX_ARRAY_SIZE `,é‚£ä¹ˆ`newCpapcity`çš„å€¼ç”±æ–¹æ³•`hugeCapacity()`å†³å®šã€‚è¿™ä¸ªåé¢å†è¯´ï¼Œæˆ‘ä»¬ç»§ç»­å½“å‰çš„åˆ†æï¼Œåœ¨æ‰§è¡Œå®Œä¸Šé¢çš„åˆ¤æ–­è¯­å¥ä¹‹åï¼Œæœ€åå¯¹`elemantData`è¿›è¡Œé‡æ–°èµ‹å€¼ï¼Œæ ¸å¿ƒæ–¹æ³•`Arrays.copyOf(elementData, newCapacity)`,è¯¥æ–¹æ³•çš„ä½œç”¨æ˜¯å°†`newCapacity`çš„å€¼å¤åˆ¶ç»™`elementData`ã€‚ä¹‹å`elementData`é‡Œé¢å°†ä¼šå­˜åœ¨**10ä¸ªnull**å€¼.

å°±æ˜¯è¯´ï¼Œå½“æˆ‘ä»¬**é¦–æ¬¡**ä½¿ç”¨è¯¥é›†åˆçš„**æ— å‚æ„é€ **åˆå§‹åŒ–é›†åˆæ—¶ï¼Œå…¶å®å¹¶ä¸ä¼šè§¦å‘**1.5å€çš„åº•å±‚æ‰©å®¹æœºåˆ¶**ã€‚æ³¨æ„ï¼Œè¿™é‡Œä½¿ç”¨`copyOf()`æ–¹æ³•çš„ä½œç”¨ä¹Ÿæ˜¯ä¸ºäº†**ä¿ç•™æ‰©å®¹ä¹‹å‰å·²ç»å­˜åœ¨é›†åˆä¸­çš„å…ƒç´ **ï¼Œæ¢å¥è¯è¯´ï¼Œæ¯æ¬¡æ‰©å®¹å¹¶ä¸ä¼šå¯¼è‡´å·²å­˜åœ¨çš„å…ƒç´ ä¸¢å¤±ï¼Œè€Œæ˜¯åœ¨è¿™äº›å…ƒç´ ä¹‹åæ·»åŠ `N`ä¸ªå€¼ä¸º`null`çš„å…ƒç´ ç©ºé—´ã€‚æ¯”å¦‚è¿™æ ·:

```java
//nullå€¼å¾—ä½ç½®å°±æ˜¯æ‰©å®¹çš„å®¹é‡
{1,2,3,4,5,6,7,8,9,10,null,null,null,null,null}
```

å½“ä»¥ä¸Šæ‰©å®¹æ“ä½œå®Œæˆä¹‹åï¼Œæ‰§è¡Œä¼šè¿”å›åˆ°ä¹‹å‰çš„`add()`æ–¹æ³•ï¼š

```java
public boolean add(E e) {
    ensureCapacityInternal(size + 1);  // Increments modCount!!
    elementData[size++] = e;
    return true;
}
```

æ­¤æ—¶çš„`elementData`å·²ç»ç”±æœ€åˆçš„ç©ºæ•°ç»„æ‰©å®¹ä¸ºå¤§å°ä¸º10çš„å®¹é‡ï¼Œå½“æ‰§è¡Œå®Œ`elementData[size++] = e;`ä¹‹åï¼Œæ–°çš„å®¹é‡ä¸­ç¬¬ä¸€ä¸ªä½ç½®ä¼šè¢«æ›¿æ¢ä¸ºå…ƒç´ `1`:

```java
[1,null,null,null,null,null,null,null,null,null]
```

> æ³¨æ„ç†è§£**minCapacity**å’Œ**elementData**çš„å«ä¹‰ã€‚å‰è€…çš„æ„æ€æ—¶æˆ‘ä»¬ç”¨è¿™ä¸ªé›†åˆå­˜æ”¾æŸäº›å…ƒç´ **æœ€å°‘éœ€è¦çš„ç©ºé—´**ï¼Œè€Œåè€…è¡¨ç¤ºæ­¤æ—¶è¿™ä¸ªé›†åˆ**æœ¬èº«æ‹¥æœ‰çš„ç©ºé—´**ï¼Œæ‰€ä»¥ï¼Œæ‰©å®¹çš„ç›®çš„åœ¨äºæ‰©å¼ **elementData**çš„å¤§å°ï¼Œä»¥æ»¡è¶³å­˜æ”¾**minCapacity**æ‰€éœ€ã€‚

ç°åœ¨æ¥çœ‹ä¸€ä¸‹ä¸Šé¢ç•™ä¸‹çš„**hugeCapacity(minCapacity)**æ–¹æ³•ï¼Œæºç å¦‚ä¸‹ï¼š

```java
private static int hugeCapacity(int minCapacity) {
 if (minCapacity < 0) // overflow
     throw new OutOfMemoryError();
 return (minCapacity > MAX_ARRAY_SIZE) ? Integer.MAX_VALUE : MAX_ARRAY_SIZE;
}
//æ³¨æ„ï¼šä»¥ä¸‹æ˜¯MAX_ARRAY_SIZEçš„å¸¸é‡å®šä¹‰ã€‚
private static final int MAX_ARRAY_SIZE = Integer.MAX_VALUE - 8;
//2147483647æ˜¯Integer.MAX_VALUE
```

è¿™ä¸ªæ–¹æ³•å…¶å®å°±æ˜¯å¯¹æ•°ç»„**å¤§å°è¾¹ç•Œè¿›è¡Œä¸€ä¸ªåˆ¤æ–­å’Œé™åˆ¶**ï¼Œè¦æ±‚æ•°ç»„å¤§å°åœ¨`0`åˆ°`MAX_VALUE`ä¹‹é—´ã€‚å¦‚æœ`<0`ç›´æ¥æŠ›å‡ºä¸€ä¸ª`OutOfMemoryError`å¼‚å¸¸ï¼Œå¦åˆ™è¿”å›ä¸€ä¸ªå€¼ä½œä¸ºæ•°ç»„å®¹é‡çš„ä¸Šé™ï¼Œè¿™é‡Œç”¨äº†ä¸€ä¸ªä¸‰å…ƒè¡¨è¾¾å¼ä½œä¸ºè¿”å›è¯­å¥ã€‚

å¦‚æœ`æœ€å°å®¹é‡å¤§äºMAX_ARRAY_SIZEï¼Œ`åˆ™å°†`Integer.MAX_VALUE`çš„å€¼èµ‹ç»™å®ƒï¼Œå¦åˆ™è¿˜æ˜¯ç”¨`MAX_ARRAY_SIZEã€‚`

å†çœ‹ä¸€ä¸‹**ä¸ºä»€ä¹ˆè¿™é‡Œ****MAX_ARRAY_SIZE**æ˜¯**Integer.MAX_VALUE-8**ï¼Œä¹Ÿå³æ˜¯**2147483647-8=2,147,483,639****è€Œä¸æ˜¯å‡å…¶ä»–æ•°å€¼ï¼Ÿ**å…³äºè¿™ä¸ªé—®é¢˜ï¼Œå…¶å®å†æºç çš„æ³¨é‡Šä¸­å°±å·²ç»å†™æ¸…æ¥šäº†ã€‚

![](https://images.waer.ltd/img/20220322112254.png)

å¤§è‡´æ„æ€å°±æ˜¯å¦‚æœç›´æ¥ä½¿ç”¨**Integer.MAX_VALUE**çš„è¯ï¼Œåœ¨æŸäº›è™šæ‹Ÿæœºä¸­ï¼Œå¯èƒ½ä¼šå‡ºç°æº¢å‡ºçš„é—®é¢˜ã€‚ä¸è¿‡ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬è¿˜æ˜¯è®¤ä¸ºå®ƒçš„å€¼å¯ä»¥ç›´æ¥çœ‹ä½œæ˜¯ä¸**Integer.MAX_VALUE**ç›¸åŒã€‚ä»¥ä¸‹æ˜¯æ¥è‡ª`stackoverflow`çš„ä¸€ä¸ªè§£ç­”ï¼Œå¯ä»¥å‚è€ƒä¸€ä¸‹ã€‚

[Why the maximum array size of ArrayList is Integer.MAX_VALUE - 8?](https://stackoverflow.com/questions/35756277/why-the-maximum-array-size-of-arraylist-is-integer-max-value-8)

**æœ‰å‚æ„é€ çš„æ‰©å®¹åŸç†**

ä¸Šé¢åˆ†æäº†è°ƒç”¨**æ— å‚æ„é€ å™¨**åˆ›å»ºé›†åˆåï¼Œå®ƒåº•å±‚çš„æ‰©å®¹åŸç†ï¼Œå…¶å®åªè¦ç†è§£äº†ä¹‹åã€‚é‚£ä¹ˆå…³äº**æœ‰å‚æ„é€ **çš„æ‰©å®¹ï¼Œå°±å¾ˆå®¹æ˜“ç†è§£äº†ã€‚

ä¸‹é¢æ˜¯å®ƒçš„æœ‰å‚æ„é€ å™¨æºç ï¼Œå‰é¢ä¹Ÿæåˆ°è¿‡ã€‚

```java
/**
     * Constructs an empty list with the specified initial capacity.
     *
     * @param  initialCapacity  the initial capacity of the list
     * @throws IllegalArgumentException if the specified initial capacity
     *         is negative
     */
public ArrayList(int initialCapacity) {
    if (initialCapacity > 0) {
        this.elementData = new Object[initialCapacity];
    } else if (initialCapacity == 0) {
        this.elementData = EMPTY_ELEMENTDATA;
    } else {
        throw new IllegalArgumentException("Illegal Capacity: "+initialCapacity);
    }
}
```

è¿™æ®µä»£ç å¾ˆå®¹æ˜“ç†è§£ï¼Œæˆ‘ä»¬åœ¨è°ƒç”¨è¯¥æ„é€ å™¨è¿›è¡Œåˆå§‹åŒ–æ—¶ä¼ å…¥ä¸€ä¸ªåˆå§‹å¤§å°`initialCapacity`ä½œä¸ºæ•°ç»„çš„**åˆå§‹å®¹é‡**ã€‚å¦‚æœè¯¥å®¹é‡**å¤§äº0ï¼Œ**æ­¤æ—¶`elementData`æ•°ç»„ä¼šç›´æ¥**ç”¨è¯¥å€¼ä½œä¸ºæ•°ç»„çš„é•¿åº¦åˆ›å»ºä¸€ä¸ªæ–°çš„`Object`æ•°ç»„ï¼Œä»¥å®Œæˆåˆå§‹åŒ–**ã€‚å¦åˆ™å¦‚æœä¼ å…¥çš„åˆå§‹å€¼ä¸º`0`ï¼Œä¼šå¯¹`elementData`è¿›è¡Œä¸€ä¸ªå¸¸é‡èµ‹å€¼æ“ä½œï¼Œå°†æ•°ç»„åˆå§‹åŒ–ä¸º`EMPTY_ELEMENTDATA`å¤§å°çš„æ•°ç»„ï¼Œè¯¥å¸¸é‡å®šä¹‰å¦‚ä¸‹ï¼š

```java
private static final Object[] EMPTY_ELEMENTDATA = {};
```

ä¹Ÿå°±æ˜¯åˆ›å»ºä¸€ä¸ªç©ºæ•°ç»„ã€‚å¦‚æœä¸åœ¨ä»¥ä¸Šä¸¤ç§æƒ…å†µä¹‹å¤–çš„ï¼Œç›´æ¥æŠ›ä¸€ä¸ª**IllegalArgumentException**å¼‚å¸¸ç»“æŸã€‚ä½†æ˜¯ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæ—¢ç„¶æˆ‘ä»¬å†³å®šè°ƒç”¨äº†è¯¥æ„é€ å™¨ï¼Œä¸€èˆ¬ä¸ä¼šç›´æ¥ç”©ä¸ª`0`è¿›å»ï¼Œè¿™æ ·åšçš„æ„ä¹‰ä¸å¤§ã€‚

åœ¨åˆå§‹åŒ–å®Œæˆåï¼Œè¿›å…¥æ·»åŠ æ–¹æ³•ï¼Œæ–¹æ³•ä¼šå…ˆå¯¹ç°æœ‰çš„æ•°ç»„å®¹é‡è¿›è¡Œæ£€æŸ¥ï¼Œå¦‚æœå‘ç°æ‰€**éœ€æœ€å°å®¹é‡å¤§äºå½“å‰åˆå§‹åŒ–ä¼ å…¥çš„å®¹é‡**ï¼Œåˆ™ä¼šå…ˆè¿›å…¥`grow()`æ–¹æ³•å®Œæˆæ‰©å®¹ï¼Œè¿™é‡Œæ‰©å®¹ä¸ä¼šè¿›å…¥ç¬¬ä¸€ä¸ª`if`åˆ¤æ–­ï¼Œå› ä¸ºåˆå§‹åŒ–ä¼ å…¥çš„`elementData`**å¿…ç„¶æ˜¯å¤§äº0çš„**ï¼Œç¨‹åºä¼šç›´æ¥æ‰§è¡Œæºç ä¸­çš„**int newCapacity = oldCapacity + (oldCapacity >> 1);**è¿™è¡Œé€»è¾‘ï¼Œ**ç›´æ¥é‡‡å–1.5å€æ‰©å®¹çš„æœºåˆ¶**å¯¹æ•°ç»„è¿›è¡Œæ‰©å®¹åï¼Œå°†æ‰©å®¹åçš„æ•´ä¸ªæ•°ç»„ç©ºé—´ç›´æ¥å¤åˆ¶ä¸€ä»½ï¼Œè¯¥æ“ä½œä¼šåœ¨åŸæœ‰å…ƒç´ çš„åŸºç¡€ä¸Šè¿½åŠ æ‰©å®¹éƒ¨åˆ†çš„ç©ºé—´ï¼Œ**è¯¥éƒ¨åˆ†çš„å€¼é»˜è®¤ä½¿ç”¨nullæ¥å¡«å……**ï¼Œè¿™äº›å’Œå‰é¢åˆ†æ**æ— å‚æ„é€ æ‰©å®¹**æ—¶å€™æ˜¯ä¸€æ ·çš„ã€‚æ­¤æ—¶å†è¿”å›æ·»åŠ æ–¹æ³•å†…éƒ¨æ‰§è¡Œæ·»åŠ ï¼Œæ·»åŠ æˆåŠŸä¹‹åä¹‹å‰æ‰©å®¹çš„`null`éƒ¨åˆ†ä¼šè¢«åˆšæ·»åŠ çš„å…ƒç´ å–ä»£ï¼Œä»¥æ­¤ç±»æ¨ï¼Œç›´åˆ°ä¸‹ä¸€æ¬¡å®¹é‡ä¸å¤Ÿæ—¶ï¼Œåˆå†ä¸€æ¬¡è§¦å‘`1.5`bå€çš„æ‰©å®¹æœºåˆ¶ã€‚

```java
private void grow(int minCapacity) {
 // overflow-conscious code
 int oldCapacity = elementData.length;
 int newCapacity = oldCapacity + (oldCapacity >> 1);
 if (newCapacity - minCapacity < 0)
     newCapacity = minCapacity;
 if (newCapacity - MAX_ARRAY_SIZE > 0)
     newCapacity = hugeCapacity(minCapacity);
 // minCapacity is usually close to size, so this is a win:
 elementData = Arrays.copyOf(elementData, newCapacity);
}
```

**å®ä¾‹æ¼”ç¤º**

é€šè¿‡ä¸€ä¸ªå…·ä½“çš„ä¾‹å­ï¼Œæ¥è§£é‡Šå¸®åŠ©ç†è§£ä¸Šé¢æ‰€è¯´çš„æ‰©å®¹åŸç†(æ— å‚æ„é€ )ã€‚

- **æ— å‚æ„é€ å™¨**

> å‡è®¾æˆ‘ä»¬è°ƒç”¨ äº†`ArrayList()`å¯¹é›†åˆ`list`è¿›è¡Œäº†åˆå§‹åŒ–å¹¶å°è¯•å‘å…¶ä¸­æ·»åŠ å…ƒç´ ï¼Œä¸‹é¢æ¨¡æ‹Ÿè¿™ä¸ªå¤§è‡´è¿‡ç¨‹ï¼š
>
> 1. åˆå§‹åŒ–å®Œæˆï¼Œåˆ›å»ºä¸€ä¸ªç©ºçš„å¯¹è±¡æ•°ç»„`elementData[] = {}`ã€‚
> 2. è¿›å…¥`add()`æ–¹æ³•ï¼Œæ ¹æ®å½“å‰æ·»åŠ å…ƒç´ æ‰€éœ€ç©ºé—´å¯¹å·²æœ‰ç©ºé—´è¿›è¡Œåˆ¤æ–­ï¼Œæ˜¾ç„¶æˆ‘ä»¬æ·»åŠ ç¬¬ä¸€ä¸ªå…ƒç´ æ—¶ï¼Œ`minCapacity=1,`è€Œ`elementData=0ã€‚`
> 3. æ­¤æ—¶ä¸å¿™ç€æ‰§è¡Œæ·»åŠ ï¼Œè€Œæ˜¯è°ƒç”¨`ensureCapacityInternal()`æ–¹æ³•ï¼š
>    1. è¯¥æ–¹æ³•å‘ç°ï¼Œåˆå§‹åŒ–çš„`elementData=DEFAULTCAPACITY_EMPTY_ELEMENTDATA`ï¼Œåˆ™æ‰§è¡Œä¸€ä¸ª`Math.max()`æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ç›´æ¥å°†`minCapacity`çš„å€¼æ”¹ä¸º`10`ã€‚æ­¤æ—¶æˆ‘ä»¬çš„`minCapacity=10`,è€Œ`elementData`è¿˜æ˜¯`0`ï¼›
>    2. è¿›å…¥**`ensureExplicitCapacity()`**æ–¹æ³•ï¼Œæ»¡è¶³åˆ¤æ–­æ¡ä»¶å‘ç°ï¼Œ**æ‰€éœ€æœ€å°å®¹é‡>å½“å‰å®¹é‡**ï¼Œéœ€è¦æ‰©å®¹ï¼Œè§¦å‘`grow()`æ–¹æ³•ã€‚
>       1. æ£€æŸ¥å¹¶è®°å½•`elementData`çš„é•¿åº¦ï¼Œå‘ç°æ­¤æ—¶è¯¥å€¼ä¸º`0`ï¼Œ**ç”±äº0çš„1.5å€è¿˜æ˜¯0ï¼Œæ­¤æ—¶æ‰©å®¹ç®—æ³•æ— æ„ä¹‰ä¸æ‰§è¡Œã€‚**
>       2. è¿›å…¥ç¬¬ä¸€ä¸ª`if`åˆ¤æ–­ï¼Œå‘ç°æ¡ä»¶æ»¡è¶³ï¼Œç›´æ¥å°†`minCapacity`çš„å€¼èµ‹ç»™ä¸€ä¸ªæ–°çš„å˜é‡`newCapacity=10`
>       3. æ‰§è¡Œæ•°ç»„çš„`copyOf()`æ–¹æ³•ï¼Œå°†ä¼šå¼€è¾Ÿä¸€ä¸ªå®¹é‡ä¸º`10`çš„æ•°ç»„ã€‚
>       4. ç¨‹åºè·³å›`add()`æ–¹æ³•ï¼Œæ‰§è¡Œå…ƒç´ çš„æ·»åŠ ã€‚
>       5. `add()`æ–¹æ³•æ‰§è¡Œç»“æŸã€‚

**ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœæˆ‘ä»¬è°ƒç”¨æ— å‚æ„é€ å™¨åˆå§‹åŒ–é›†åˆï¼Œé¦–æ¬¡æ‰©å®¹å¹¶ä¸ä¼šæŒ‰ç…§`1.5`å€çš„æœºåˆ¶æ¥ï¼Œè€Œæ˜¯ç›´æ¥ç»™ä½ å¼€ä¸€ä¸ªå¤§å°ä¸º`10`çš„æ•°ç»„ï¼Œåªæœ‰å½“è¿™`10`ä¸ªç©ºé—´å…¨éƒ¨ç”¨å®Œä¹‹åï¼Œä¹‹åçš„æ¯ä¸€æ¬¡æ‰©å®¹ï¼Œå°±éƒ½ä¼šé‡‡ç”¨`1.5`å€çš„æœºåˆ¶è¿›è¡Œæ‰©å®¹ï¼Œå› æ­¤é¦–æ¬¡è°ƒç”¨çš„æ–¹æ³•æ ˆæ˜¯æ¯”è¾ƒç»•çš„ï¼Œä½†æ˜¯ä»ç¬¬äºŒæ¬¡å¼€å§‹ï¼Œæˆ–è€…ä½¿ç”¨æœ‰å‚æ„é€ å™¨åˆå§‹åŒ–çš„æ—¶å€™å°±ä¼šå°‘ä¸€äº›åˆ¤æ–­ï¼Œç©ºé—´ä¸å¤Ÿï¼Œç›´æ¥å¼€å§‹`1.5`å€æ‰©å®¹æœºåˆ¶èµ°èµ·ã€‚**

##### 1.5å€æ‰©å®¹æ€ä¹ˆç®—ï¼Ÿ

> å‡è®¾å½“å‰å®¹é‡å€¼ä¸º`8`ï¼Œä¸‹ä¸€æ¬¡æ‰©å®¹çš„å€¼å°±æ˜¯`12`ï¼Œç®—æ³•è¿‡ç¨‹å¾ˆç®€å•ï¼š
>
> 12 = 8+8/2
>
>    = 8+4
>
>    =12
>
> åªä¸è¿‡ï¼Œåœ¨æºä»£ç ä¸­ï¼Œç®—æ³•ä½¿ç”¨å³ç§»`>>`ä»£æ›¿é™¤æ³•ï¼Œè¦çŸ¥é“ï¼Œ**ä½è¿ç®—çš„é€Ÿåº¦æ˜¯è¿œå¿«äºå››åˆ™è¿ç®—çš„**ã€‚ç”±æ­¤ï¼Œå¦‚æœéœ€è¦å†æ¬¡æ‰©å®¹çš„è¯ï¼Œ`12`çš„å®¹é‡ä¼šæ‰©å®¹ä¸º`12+6 = 18`ã€‚

****

#### `Vector`

##### åŸºæœ¬ç»“æ„

`Vector`ç±»çš„å®šä¹‰ï¼Œå®ƒå®ç°è‡ª`List`æ¥å£ã€‚

```java
public class Vector<E>
    extends AbstractList<E>
    implements List<E>, RandomAccess, Cloneable, java.io.Serializable
```

å®ƒçš„åº•å±‚å®ç°ä¹Ÿæ˜¯åŸºäºå¯¹è±¡æ•°ç»„ï¼Œå®ƒç”±`protected`ä¿®é¥°ç¬¦ä¿®é¥°ï¼š

```java
protected Object[] elementData;
```

`Vector`æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå®ƒçš„æ“ä½œæ–¹æ³•éƒ½æœ‰`synchronized`ä¿®é¥°ï¼Œè¯¥å…³é”®å­—å¯ä»¥å®ç°çº¿ç¨‹åŒæ­¥å’Œäº’æ–¥ï¼Œæ‰€ä»¥ä»–æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚æ¯”å¦‚å…¶æºç ä¸­çš„`indexOf()`æ–¹æ³•ï¼Œå› æ­¤ï¼Œä¸€èˆ¬åœ¨å¼€å‘ä¸­ï¼Œå¦‚æœæœ‰çº¿ç¨‹å®‰å…¨çš„éœ€è¦ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨`Vector`ã€‚å½“ç„¶ï¼Œè¿™ä¹Ÿå¹¶éæ˜¯å¿…é¡»çš„ï¼Œå…³äºçº¿ç¨‹å®‰å…¨çš„é›†åˆæˆ–è€…è¯´å®ç°ï¼Œè¿˜æœ‰ä¸“é—¨çš„ç±»å»ç®¡ç†ï¼Œ`Vector`åœ¨`JDK1.0`ç‰ˆæœ¬ä¸­å°±æœ‰çš„ï¼Œç®—æ˜¯ä¸€ä¸ªè€å‰è¾ˆäº†ï¼Œå°½ç®¡å®ƒçº¿ç¨‹å®‰å…¨ï¼Œä½†ä¹Ÿä¸ä¸€å®šå°±æ˜¯æœ€ä½³çš„é€‰æ‹©ã€‚

```java
public synchronized int indexOf(Object o, int index) {
    if (o == null) {
        for (int i = index ; i < elementCount ; i++)
            if (elementData[i]==null)
                return i;
    } else {
        for (int i = index ; i < elementCount ; i++)
            if (o.equals(elementData[i]))
                return i;
    }
    return -1;
}
```

##### æºç åˆ†æ

######  **æ‰©å®¹æœºåˆ¶**

**é»˜è®¤10æ»¡åï¼ŒæŒ‰ç…§2å€æ‰©å®¹ã€‚å¦‚æœæŒ‡å®šå¤§å°ï¼Œåˆ™æ¯æ¬¡æŒ‰2å€æ‰©å®¹ã€‚**

**åˆ›å»ºä¸€ä¸ªæ— å‚çš„vectorä¹‹åï¼Œå®ƒä¼šé»˜è®¤ç›´æ¥ç»™ä½ ä¸€ä¸ªå¤§å°ä¸º10çš„ç©ºé—´ã€‚ç›´æˆªäº†å½“ã€‚**

```java
public Vector() {
    this(10);
}
```

æ¥ç€æ‰§è¡Œæ·»åŠ æ“ä½œï¼Œè·³è½¬åˆ°`add()`æ–¹æ³•(è¿™é‡Œå°±ä¸å†æè‡ªåŠ¨è£…ç®±çš„æ“ä½œäº†)ï¼Œæºç å¦‚ä¸‹,å’‹ä¸€çœ‹æ˜¯ä¸æ˜¯å’Œå‰é¢åˆ†æçš„`ArrayList`çš„æºç å¦‚å‡ºä¸€è¾™ï¼Ÿé™¤äº†ä¸€ä¸ª`modCount++`ä¹‹å¤–ï¼Œè¿˜æ˜¯ä¼šåœ¨æ·»åŠ å…ƒç´ ä¹‹å‰å…ˆæ‰§è¡Œä¸€ä¸ªåä¸º`ensureCapacityHelper`çš„æ–¹æ³•ï¼ŒåŸºäºå‰é¢`ArrayList`æºç çš„é˜…è¯»ç†è§£ï¼Œè¿™é‡Œä¸ç”¨å¤šæƒ³ä¹Ÿèƒ½çŒœåˆ°ï¼Œè¿™ä¸ªæ–¹æ³•çš„ä½œç”¨ï¼Œæ— éå°±æ˜¯å¯¹ç›®å‰çš„æ•°ç»„å®¹é‡è¿›è¡Œåˆ¤æ–­ï¼Œçœ‹çœ‹æ˜¯ä¸æ˜¯éœ€è¦æ‰©å®¹ã€‚

```java
public synchronized boolean add(E e) {
    modCount++;
    ensureCapacityHelper(elementCount + 1);
    elementData[elementCount++] = e;
    return true;
}
```

è¿›å…¥`ensureCapacityHelper`çš„æºç çœ‹çœ‹,å¯ä»¥çœ‹åˆ°è¿™å®ç°å’Œ`ArrayList`ä¸­çš„å®ç°å‡ ä¹ä¸€æ ·ï¼Œè¿˜æ˜¯åˆ¤æ–­æœ€å°æ‰€éœ€ç©ºé—´å’Œå½“å‰æ•°ç»„çš„å®¹é‡å…³ç³»ï¼Œæ˜¾ç„¶ï¼Œè¿™é‡Œ`elementData=10,`è€Œ`minCapacity=1`ï¼Œ**ä¸æ»¡è¶³æ‰©å®¹çš„æ¡ä»¶**ï¼Œå› æ­¤è¿™é‡Œä¸ä¼šè¿›å…¥`grow()`æ–¹æ³•ã€‚ç›´æ¥è¿”å›`add()`æ‰§è¡Œå…ƒç´ çš„æ·»åŠ ï¼Œä¸€æ¬¡æ·»åŠ æ‰§è¡Œç»“æŸã€‚

```java
private void ensureCapacityHelper(int minCapacity) {
    // overflow-conscious code
    if (minCapacity - elementData.length > 0)
        grow(minCapacity);
}
```

ä¸‹é¢æˆ‘ä»¬å‡è®¾ï¼Œè¦æ·»åŠ ç¬¬`11`ä¸ªå…ƒç´ ï¼Œæ­¤æ—¶åŸæ¥çš„10ä¸ªç©ºé—´å·²ç»ä¸å¤Ÿï¼Œè‡ªç„¶ä¼šè§¦å‘æ‰©å®¹æœºåˆ¶ï¼Œä¸‹é¢æ˜¯è¯¥æ‰©å®¹æ–¹æ³•çš„å®ç°æºç ï¼š

```java
// æ‰©å®¹æ–¹æ³•
private void grow(int minCapacity) {
    // overflow-conscious code
    int oldCapacity = elementData.length;
    int newCapacity = oldCapacity + ((capacityIncrement > 0) ? capacityIncrement : oldCapacity);
    if (newCapacity - minCapacity < 0)
        newCapacity = minCapacity;
    if (newCapacity - MAX_ARRAY_SIZE > 0)
        newCapacity = hugeCapacity(minCapacity);
    elementData = Arrays.copyOf(elementData, newCapacity);
}
// å…³äºcapacityIncrementçš„å®šä¹‰ï¼š
   /**
     * The amount by which the capacity of the vector is automatically
     * incremented when its size becomes greater than its capacity.  If
     * the capacity increment is less than or equal to zero, the capacity
     * of the vector is doubled each time it needs to grow.
     *
     * @serial
     */
    protected int capacityIncrement;
```

æ ¹æ®æºç äº†è§£åˆ°ï¼Œå®ƒä¼šå…ˆå°†`elementData`çš„é•¿åº¦æ”¾åˆ°ä¸€ä¸ªåä¸º`oldCapacity`çš„å˜é‡ä¸­å¹¶åˆ›å»ºä¸€ä¸ªæ–°çš„å®¹é‡`newCapacity`,è¯¥å˜é‡çš„å€¼å°±æ˜¯æ‰©å®¹çš„æ ¸å¿ƒåŸç†ï¼Œå…¶ä¸­` int newCapacity = oldCapacity + ((capacityIncrement > 0) ? capacityIncrement : oldCapacity)`è¿™æ®µä¸‰å…ƒè¡¨è¾¾å¼ä¼šå…ˆåˆ¤æ–­`capacityIncrement`çš„å€¼æ˜¯å¦`>0`,å¦‚æœæˆç«‹ï¼Œé‚£ä¹ˆ`capacityIncrement`çš„å€¼ä¿æŒä¸å˜ï¼Œé‚£ä¹ˆæ•´ä¸ªè¡¨è¾¾å¼å°±æ˜¯`newCapacity = oldCapacity+capacityIncrement`ã€‚

å¦åˆ™å°†ä¼šæ˜¯`newCapacity =oldCapacity+oldCapactity`,ä¹Ÿå°±`newCapacity `ä¼š**å˜ä¸ºåŸæ¥ä¸¤å€çš„å®¹é‡ï¼Œ**æœ€åä¾æ—§æ˜¯é‡‡ç”¨`copyOf()`æ–¹æ³•å°†æ‰©å®¹åçš„ç©ºé—´å¤åˆ¶åˆ°åŸç©ºé—´ï¼Œå®Œæˆæ‰©å®¹ã€‚å…³äºå…¶ä¸­ä¸¤ä¸ª`if`åˆ¤æ–­çš„é€»è¾‘å’Œä¹‹å‰å¯¹`ArrayList`çš„åˆ†ææ˜¯ç±»ä¼¼çš„ï¼Œä¸å†èµ˜è¿°ã€‚é€šè¿‡è¿™ä¸ªæºç ä¹Ÿå‘ç°äº†ï¼Œè¿™ä¸ª`2`å€æ‰©å®¹çš„ç®—æ³•ä¸­ï¼Œæœ‰ä¸€ä¸ªåä¸º`capacityIncrement`çš„**å®¹é‡å¢é‡**ï¼Œå…·ä½“ä½œç”¨é¢ä¼šåœ¨ä¸‹é¢æœ‰å‚æ„é€ å™¨ä¸­è¿›è¡Œåˆ†æã€‚

**æœ‰å‚æ„é€ å™¨æºç åˆ†æ**

è¯¥æ„é€ å™¨çš„æºç å¦‚ä¸‹ï¼Œæ„é€ å™¨æ˜¯æœ‰ä¸¤ä¸ªå‚æ•°çš„ï¼Œå…¶ä¸­ä¸€ä¸ªä¾¿æ˜¯ä¸Šé¢æåˆ°çš„å®¹é‡å¢é‡å‚æ•°`capacityIncrement`ã€‚

```java
public Vector(int initialCapacity, int capacityIncrement) {
    super();
    if (initialCapacity < 0)
        throw new IllegalArgumentException("Illegal Capacity: "+
                                           initialCapacity);
    this.elementData = new Object[initialCapacity];
    this.capacityIncrement = capacityIncrement;
}
```

æ–¹æ³•ä½“é¦–å…ˆä¼šå…ˆè°ƒç”¨çˆ¶ç±»çš„æ— å‚æ„é€ ã€‚å¦‚æœæˆ‘ä»¬ä¸æŒ‡å®š`capacityIncrement`çš„å€¼ï¼Œå®ƒé»˜è®¤æ˜¯`0`ï¼Œä¹Ÿå°±æ˜¯**æ— å¢é‡**ï¼Œä¸€èˆ¬åœ¨è°ƒç”¨æ— å‚æ„é€ å™¨æ—¶å°±æ˜¯å±äºè¿™ç§æƒ…å†µï¼Œ**åœ¨æ²¡æœ‰æ˜ç¡®å®¹é‡å¢é‡æ—¶ï¼Œæ‰©å®¹ä¼šæŒ‰ç…§åŸå®¹é‡çš„2ä¸¤å€è¿›è¡Œï¼Œ**å¦‚æœæŒ‡å®šå…·ä½“çš„å€¼ï¼Œæˆ‘ä»¬åœ¨``grow()``æ–¹æ³•ä¸­çœ‹åˆ°ï¼Œ`  int newCapacity = oldCapacity + ((capacityIncrement > 0) ? capacityIncrement : oldCapacity);`è¿™ä¸ªè¡¨è¾¾å¼å°†äº§ç”Ÿä¸€ä¸ªæ–°çš„å®¹é‡å€¼ï¼Œ**è¯¥å€¼çš„å¤§å°ç”±åŸæ¥çš„å®¹é‡+æŒ‡å®šçš„å®¹é‡å¢é‡å†³å®š**ã€‚é‚£ä¹ˆå¯èƒ½ä¼šå¼€å§‹ç–‘æƒ‘ï¼Œ æ—¢ç„¶è¯´äº†æ˜¯`2`å€æ‰©å®¹ï¼Œé‚£ä¹ˆåŠ ä¸€ä¸ªå®¹é‡å¢é‡ç®—æ€ä¹ˆå›äº‹ï¼Ÿ

å¦‚æœæŒ‡å®šäº†è¯¥å¢é‡çš„å€¼ï¼Œä¸å°±æ”¹å˜äº†2å€æ‰©å®¹çš„æœºåˆ¶äº†å—ï¼Ÿå…¶å®ä¸å®Œå…¨æ˜¯ï¼Œåœ¨`vector`æºç ä¸­ï¼Œå…¶å®å­˜åœ¨ä¸‰ä¸ªæ„é€ å™¨ï¼Œä¸Šé¢è¿™ä¸ªä¾¿æ˜¯å¯ä»¥æŒ‡å®šæ‰©å®¹å¢é‡çš„æ„é€ å™¨ï¼Œå¦‚æœä½ ä¸éœ€è¦æŒ‡å®šç¬¬äºŒä¸ªå‚æ•°ï¼Œé‚£ä¹ˆè¿˜å¯ä»¥çœ‹åˆ°ï¼Œå®ƒè¿˜æœ‰ä¸€ä¸ªæ™®é€šçš„å¸¦ä¸€ä¸ªå‚æ•°çš„æ„é€ ï¼Œæºç å¦‚ä¸‹ï¼š

```java
public Vector(int initialCapacity) {
    this(initialCapacity, 0);
}
```

è¯¥æ„é€ å™¨å°½ç®¡åªéœ€è¦ä¸€ä¸ªå‚æ•°ï¼Œä½†å®ƒåœ¨åˆ›å»ºä¹‹åä¼šé»˜è®¤ç»™`capacityIncrement`èµ‹å€¼ä¸º0ï¼Œè¿™ä¹Ÿå°±æ˜¯ä¸ç®¡ä½ æ˜¯ç©ºå‚æ„é€ è¿˜æ˜¯å¸¦å‚æ„é€ å¯¹`Vector`è¿›è¡Œåˆå§‹åŒ–ï¼Œåœ¨æ‰©å®¹æ—¶éƒ½ä¼šç”¨åˆ°`capacityIncrement`è¿™æ ·ä¸€ä¸ªå‚æ•°ï¼Œè¿™ä¹Ÿæ˜¯æ‰©å®¹ç®—æ³•ä¸­ä¸‰å…ƒè¡¨è¾¾å¼çš„æ„ä¹‰ï¼Œ**ä½ å¯ä»¥ä¸å†™ï¼Œä½†æˆ‘å¿…é¡»å¾—ç”¨**ï¼Œæ‰€ä»¥æ‰ä¼šæœ‰é»˜è®¤çš„`0`,è¿™æ˜¯ä¸å†²çªçš„ã€‚

```java
/*æ— å‚æ„é€ */
Vector vector = new Vector();
/*æŒ‡å®šä¸€ä¸ªå‚æ•°ï¼šé»˜è®¤ä¸ºé›†åˆçš„åˆå§‹å¤§å°*/
Vector vector2 = new Vector(6);
/*æŒ‡å®šä¸¤ä¸ªå‚æ•°ï¼šä¾æ¬¡æ—¶é›†åˆå¤§å°å’Œæ‰©å®¹æ—¶çš„å®¹é‡å¢é‡*/
Vector vector3= new Vector(6,3);
```

****

#### `LinkedList`

##### åŸºæœ¬ç»“æ„

- `LinkedList`åº•å±‚å®ç°é‡‡ç”¨äº†**åŒå‘é“¾è¡¨**å’Œ**åŒç«¯é˜Ÿåˆ—**ã€‚
- å¯ä»¥æ·»åŠ ä»»æ„å…ƒç´ ä¸”å…ƒç´ å¯ä»¥é‡å¤(å› ä¸ºå®ç°è‡ªListæ¥å£)ï¼ŒåŒæ—¶åŒ…æ‹¬`null`ã€‚
- éçº¿ç¨‹å®‰å…¨çš„é›†åˆï¼Œæ²¡æœ‰å®ç°åŒæ­¥ã€‚
- åœ¨å…¶ä¸­ç»´æŠ¤çš„ä¸¤ä¸ªå±æ€§`first`å’Œ`last`åˆ†åˆ«æŒ‡å‘é¦–å°¾èŠ‚ç‚¹ï¼Œ`prev`æŒ‡å‘å‰é©±èŠ‚ç‚¹ï¼Œ`next`æŒ‡å‘åç»§èŠ‚ç‚¹ã€‚
- å› æ­¤`LinkedList`çš„å…ƒç´ **åˆ é™¤å’Œæ·»åŠ çš„æ“ä½œæ•ˆç‡ç›¸å¯¹è¾ƒé«˜**ã€‚

##### æºç åˆ†æ

[å¾…æ›´æ–°â€¦â€¦]

#### å¦‚ä½•é€‰æ‹©

> å¦‚ä½•é€‰æ‹©ä½¿ç”¨`ArrayList`å’Œ`LinkedList`?æ ¹æ®æˆ‘ä»¬å®é™…çš„ä½¿ç”¨åœºæ™¯æˆ–è€…éœ€æ±‚

- å¦‚æœæ¶‰åŠæ”¹æŸ¥æ“ä½œæ¯”è¾ƒå¤šï¼Œå»ºè®®`ArrayList`ã€‚
- å¦‚æœå¢åˆ æ“ä½œæ¯”è¾ƒå¤šï¼Œå»ºè®®`LinkedList`ã€‚
- ä¸€èˆ¬æ¥è¯´ï¼Œåœ¨ç¨‹åºä¸­`80%~90%`éƒ½æ˜¯æŸ¥è¯¢æ“ä½œï¼Œå› æ­¤å¤§éƒ¨åˆ†æƒ…å†µä¸‹ä¼šé€‰æ‹©ä½¿ç”¨`ArrayList`ã€‚
- å½“ç„¶ï¼Œé€‰æ‹©å“ªä¸€ä¸ªå¹¶éä¸€æˆä¸å˜ï¼Œåœ¨å®é™…çš„é¡¹ç›®ä¸­ï¼Œç”šè‡³å¯èƒ½å‡ºç°`ArrayList`å’Œ`LinkedList`åŒæ—¶ä½¿ç”¨çš„æƒ…å†µï¼Œä¹Ÿæ˜¯æ­£å¸¸çš„ï¼Œæ‰€ä»¥è¦æ±‚æœ€å¥½éƒ½ä¼šä½¿ç”¨ã€‚

****

#### `Set`æ¥å£

ä¸‹é¢ä¸»è¦è®²è§£`Set`å­æ¥å£ä¸‹çš„ä¸»è¦å®ç°ç±»ã€‚

**å¸¸ç”¨æ–¹æ³•å’Œå®ç°**

![](https://images.waer.ltd/img/Set.png)

**Setçš„åŸºæœ¬ä»‹ç»**

- æ— åº(å…ƒç´ çš„æ·»åŠ ä¸å–å‡ºçš„é¡ºåºä¸ä¸€è‡´)ï¼Œæ— ç´¢å¼•ã€‚

  > æ³¨æ„ç†è§£è¿™é‡Œçš„æ— åºçš„å«ä¹‰ï¼Œå¹¶ä¸æ˜¯è¯´ï¼Œæ¯ä¸€æ¬¡å–å‡ºçš„é¡ºåºéƒ½æ˜¯éšæœºçš„ï¼Œè€Œæ˜¯æŒ‡å½“æ‰§è¡Œäº†ä¸€æ¬¡å–å‡ºä¹‹åï¼Œä»Šåçš„æ¯ä¸€æ¬¡ç›¸åŒçš„æ“ä½œï¼Œå®ƒå–å‡ºçš„å…ƒç´ é¡ºåºéƒ½ä¸ç¬¬ä¸€æ¬¡ç›¸åŒï¼Œä½†**è¿™ä¸ªé¡ºåºåˆå’Œæ·»åŠ è¿›å»çš„é¡ºåºä¸ä¿æŒä¸€è‡´**ã€‚

- ä¸å…è®¸é‡å¤å…ƒç´ ã€‚

- è¿˜æœ‰ä¸€ç‚¹ï¼Œç”±äºå®ƒæ˜¯`Collection`çš„å­æ¥å£ï¼Œè‡ªç„¶ä¹Ÿæ”¯æŒå…¶çˆ¶æ¥å£ä¸­çš„ç‰¹æ€§ï¼Œæ¯”å¦‚è¿­ä»£å¯¹è±¡ï¼Œå¢å¼ºforç­‰ç­‰ã€‚

#### `HashSet`

##### åŸºæœ¬ç»“æ„

> `HashSet`ä½œä¸º`Set`å…¸å‹çš„å®ç°ç±»ä¹‹ä¸€ï¼Œæ‹¥æœ‰`Set`çš„å…¨éƒ¨å±æ€§ï¼Œè¿™é‡Œä¸å†èµ˜è¿°ã€‚

##### æºç è§£è¯»

###### åˆå§‹åŒ–ä¸åŸºæœ¬åŸç†

æˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹`HashSet`çš„åŸºæœ¬ç”¨æ³•ï¼Œå…¶å®ï¼Œ`HashSet`åœ¨å®ç°ä¸Šï¼Œå°±æ˜¯ä¸€ä¸ª`HashMap`,è¿™ä¸€ç‚¹å¯ä»¥ä»å®ƒçš„æ„é€ å™¨è¯´èµ·ã€‚

```java
 Set hashSet = new HashSet();
```

ä»¥ä¸‹æ˜¯`HashSet`çš„æ— å‚æ„é€ å™¨æºç ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œå½“æˆ‘ä»¬åˆ›å»ºä¸€ä¸ª`HashSet`å¯¹è±¡æ—¶ï¼Œå®ƒåœ¨åº•å±‚ç›´æ¥`new`äº†ä¸€ä¸ª`HashMap`ï¼Œè¿™åˆä¸å¾—ä¸è¯´ä¸€ä¸‹`HashMap`çš„åº•å±‚ï¼Œå®ƒæ˜¯ç”±**æ•°ç»„+é“¾è¡¨+çº¢é»‘æ ‘**æ„æˆï¼Œæ‰€ä»¥ç›¸å¯¹æ¥è¯´æ˜¯æ¯”è¾ƒå¤æ‚çš„ã€‚

![](https://images.waer.ltd/img/20220323200228.png)

```java
public HashSet() {
    map = new HashMap<>();
}
```

æ¢å¥è¯è¯´ï¼Œè¦åˆ†æ`HashSet`çš„æºç ï¼Œå…¶å®å°±æ˜¯åˆ†æ`HashMap`çš„åŸç†ã€‚`HashSet`ä¸€ä¸ªæ˜æ˜¾çš„ç‰¹ç‚¹å°±æ˜¯ä¸èƒ½æ·»åŠ é‡å¤çš„å…ƒç´ ï¼Œä½†è¿™é‡Œçš„**é‡å¤**ä¹Ÿè®¸ä¸æ˜¯ä½ æƒ³è±¡ä¸­çš„é‚£ä¹ˆç®€å•ã€‚

ä¸‹é¢å¼€å§‹åˆ†æä¸€ä¸‹å…¶ä¸­çš„æ·»åŠ å…ƒç´ çš„`add()`æ–¹æ³•åœ¨åº•å±‚æ˜¯å¦‚ä½•å®ç°çš„ã€‚

> - **æ·»åŠ ä¸€ä¸ªå…ƒç´ æ—¶ï¼Œä¼šå…ˆå¾—åˆ°ä¸€ä¸ª`hash`å€¼ï¼Œæ ¹æ®è¯¥å€¼è½¬æˆä¸€ä¸ªç´¢å¼•å€¼ã€‚**
> - **æ‰¾åˆ°å­˜å‚¨æ•°æ®è¡¨`table`ï¼Œæ£€æŸ¥è¯¥ç´¢å¼•æ˜¯å¦å·²åœ¨`table`ä¸­å­˜åœ¨æœ‰å…ƒç´ **ï¼š
>   - **å¦‚æœæ²¡æœ‰ï¼Œç›´æ¥å°†è¯¥å…ƒç´ åŠ å…¥ã€‚**
>   - **å¦‚æœæœ‰ï¼Œä¼šè°ƒç”¨`equals`æ–¹æ³•è¿›è¡Œæ¯”è¾ƒæ“ä½œï¼Œå¦‚æœæ¯”è¾ƒç»“æœä¸º`true`,æ·»åŠ å¤±è´¥ï¼Œå¦åˆ™ï¼Œå°†ä¼šåœ¨æœ«å°¾æ·»åŠ å…ƒç´ ã€‚**
>   - **åœ¨`Java8`ä¸­ï¼Œå¦‚æœä¸€æ¡é“¾è¡¨çš„å…ƒç´ ä¸ªæ•°è¾¾åˆ°`TREEIFY_THRESHOLD`ä¸”`table`çš„å¤§å°`>=`MIN_TREEIFY_CAPACITY,å°±ä¼šè§¦å‘æ ‘åŒ–æœºåˆ¶ï¼Œå³ä¼šç”±å•é“¾è¡¨ç»“æ„è½¬æ¢ä¸ºä¸€æ£µçº¢é»‘æ ‘ã€‚**

ä¸ºä¾‹æ›´å¥½çš„ç†è§£å®ƒçš„æ‰§è¡Œè¿‡ç¨‹å’ŒåŸç†ï¼Œæˆ‘ä»¬æŒ‰ç…§ä¸‹é¢è¿™å‡ è¡Œä»£ç æ¥è®²è§£:

```java
HashSet hashSet = new HashSet();
hashSet.add("Java");
hashSet.add("C++");
hashSet.add("Java");
System.out.println("hashSet="+hashSet);
```

ä»£ç é€»è¾‘å¾ˆç®€å•ï¼Œå°±æ˜¯å‘`HashSet`ä¸­æ·»åŠ ä¸‰ä¸ªå…ƒç´ ï¼Œå…¶ä¸­æœ‰**ä¸¤ä¸ªå…ƒç´ æ˜¯é‡å¤**çš„ï¼Œè¿™æ˜¯ä¸ºäº†ç†è§£å®ƒåº•å±‚æ˜¯å¦‚ä½•åˆ¤æ–­å…ƒç´ é‡å¤çš„ã€‚

æ‰§è¡Œä»£ç ï¼Œé¦–å…ˆä¼šè¿›å…¥`HashSet`çš„æ„é€ å™¨ï¼Œç›´æ¥åˆ›å»ºä¸€ä¸ªå€¼ä¸ºç©ºçš„`HashMap`ï¼Œè¿™ç‚¹åœ¨ä¸Šé¢å·²ç»è¯´è¿‡ã€‚è¿›å…¥`add()`æ–¹æ³•ï¼Œå®ƒçš„å®ç°æºç å¦‚ä¸‹ï¼š

```java
//HashSetä¸­addæ–¹æ³•çš„æºç å®ç°
public boolean add(E e) {
    return map.put(e, PRESENT)==null;
}
```

æ–¹æ³•å¾ˆç®€å•ï¼Œç›´æ¥è°ƒç”¨äº†`map`çš„`put()`æ–¹æ³•,æ³¨æ„åˆ°ï¼Œè¿™ä¸ªæ–¹æ³•é™¤äº†æˆ‘ä»¬éœ€è¦æ·»åŠ çš„å…ƒç´ `e`ä¹‹å¤–ï¼Œå®ƒè¿˜æœ‰ä¸€ä¸ªåä¸º`PRESENT`çš„å¸¸é‡å‚æ•°ï¼Œå…³äºè¿™ä¸ªå‚æ•°çš„ç†è§£ï¼Œæºç ä¸­æ˜¯è¿™æ ·ä»‹ç»çš„ï¼š

```java
// Dummy value to associate with an Object in the backing Map
private static final Object PRESENT = new Object();
```

`PRESENT`å…¶å®æ˜¯ä¸€ä¸ª`static final`ä¿®é¥°çš„å¯¹è±¡ï¼Œåœ¨ä¸Šé¢çš„æ–¹æ³•ä¸­ä½œä¸º`put(k,v)`ä¸­`value`çš„å ä½ï¼Œå¹¶æ²¡æœ‰å…¶ä»–å®é™…çš„ä½œç”¨ã€‚è¿™é‡Œä¸å¿…æ·±ç©¶ã€‚ä¸çŸ¥é“æœ‰æ²¡æœ‰æ³¨æ„åˆ°ï¼Œ`add`æ–¹æ³•ä¸­å°†`map.put(e,PRESENT)==null`ä½œä¸ºè¿”å›å€¼ï¼Œä¸ºä»€ä¹ˆè¿™é‡Œä¼šæ˜¯`null`å‘¢ï¼Ÿè¿™å’Œ`HashMap`åº•å±‚å®ç°æœ‰å…³ç³»ï¼Œæˆ‘ä»¬å…ˆç»§ç»­å¾€ä¸‹ï¼Œåé¢è‡ªç„¶å°±ä¼šæ˜ç™½äº†ã€‚ä¸‹é¢è¿›å…¥`put`æ–¹æ³•å†…éƒ¨çœ‹çœ‹ã€‚

```java
//HashSetä¸­map.put(e,PERSENT)æ–¹æ³•æºç 
public V put(K key, V value) {
    return putVal(hash(key), key, value, false, true);
}
```

æ–¹æ³•ä¸­æœ‰ä¸€ä¸ª`putVal`çš„æ–¹æ³•ï¼Œå¯ä»¥çœ‹åˆ°å…¶ä¸­çš„ç¬¬ä¸€ä¸ªå‚æ•°`hash(key)`è¡¨ç¤ºé€šè¿‡è¿™ä¸ªæ–¹æ³•è·å–`key`çš„`hash`å€¼ã€‚è¿™é‡Œçš„`key`ä¹Ÿå°±æ˜¯æˆ‘ä»¬ä¼ å…¥çš„å¾…æ·»åŠ çš„å…ƒç´ ï¼Œè¿›å…¥è¯¥æ–¹æ³•ï¼šæœç„¶ï¼Œ`hash`æ–¹æ³•çš„ä½œç”¨å°±æ˜¯è®¡ç®—`key`çš„`hashå€¼`ï¼Œç®—æ³•éƒ½åœ¨è¿™æ¡ä¸‰å…ƒè¡¨è¾¾å¼å½“ä¸­äº†ï¼Œå¯ä»¥ç®€å•çœ‹ä¸€ä¸‹ã€‚

```java
//HashMapä¸­çš„hash()æ–¹æ³•å®ç°
static final int hash(Object key) {
    int h;
    return (key == null) ? 0 : (h = key.hashCode()) ^ (h >>> 16);
}
```

æ ¸å¿ƒç®—æ³•`(key == null) ? 0 : (h = key.hashCode()) ^ (h >>> 16)`ï¼Œæ„æ€å°±æ˜¯å¦‚æœä¼ å…¥çš„`key`ä¸º`null`,é‚£ä¹ˆç›´æ¥è¿”å›0ï¼Œä¹Ÿå°±æ˜¯ä¸æ‰§è¡Œä»»ä½•å®é™…æ“ä½œã€‚**å¦åˆ™ä¼šä½¿ç”¨`hashCode()`æ–¹æ³•è·å–`key`çš„å“ˆå¸Œç å’Œæ— ç¬¦å·å³ç§»16ä½ä¹‹åçš„å€¼è¿›è¡Œä¸€ä¸ªå¼‚æˆ–æ“ä½œ**ï¼Œå°†è¯¥å¼‚æˆ–çš„ç»“æœè¿”å›ä½œä¸º`key`æœ€ç»ˆçš„`hash`å€¼ã€‚è¿™æ ·ä½œä¸»è¦æ˜¯ä¸ºäº†ä¿è¯**é«˜16ä½å’Œä½16æœªçš„ç‰¹å¾ï¼Œå‡å°‘ç¢°æ’ï¼Œå‡ä½`hash`å†²çªçš„å‡ ç‡**ã€‚

æ³¨æ„ï¼Œ`hash`å’Œ`hashCode`å¹¶ä¸æ˜¯ä¸€å›äº‹ã€‚

> è¿™é‡Œçš„`hash`ä»…ä»…æ˜¯ç”¨æ¥åœ¨`HashMap`ä¸­è®¡ç®—`key`å¯¹åº”çš„æ•£åˆ—ç ã€‚å®ƒçš„ç®—æ³•ä¸­ç”¨åˆ°äº†`hashCode()`è¿™ä¸ªæ–¹æ³•ï¼Œ`hashCode`æ˜¯åœ¨`Objct`ä¸­å®šä¹‰çš„ï¼Œç”¨æ¥è·å–æ¯ä¸ªå…ƒç´ å¯¹åº”çš„æ•£åˆ—å€¼ï¼Œ**åº•å±‚ä½¿ç”¨çš„Cè¯­è¨€ä½œä¸ºå®ç°**,å±äº`native`æ–¹æ³•ã€‚æ¢å¥è¯è¯´ï¼Œä½¿ç”¨`hashCode()`æ–¹æ³•å¯ä»¥è®¡ç®—`Java`ä¸­æ¯ä¸€ä¸ªå…ƒç´ çš„ä¸€ä¸ªå“ˆå¸Œå€¼ã€‚è€Œ`hash()`æ–¹æ³•åœ¨è¿™é‡Œçš„ä½œå°±ç›¸å¯¹å±€é™ï¼Œä½¿ç”¨çš„ç®—æ³•ä¹Ÿç›¸å¯¹ç®€å•å¾ˆå¤šï¼Œå…·ä½“çš„å…³äº`hashå’ŒhashCode()`çš„å†…å®¹ï¼Œå¯ä»¥è‡ªå·±ç ”ç©¶ï¼Œè¿™é‡Œä¸ä½œå±•å¼€ã€‚

ç†è§£äº†`hash`çš„è®¡ç®—æ–¹å¼ä¹‹åï¼Œç»§ç»­å¾€åçœ‹ï¼Œåœ¨è·å–åˆ°`key`çš„`hash`ï¼Œæ–¹æ³•ä¼šè¿”å›è¿›å…¥åˆ°`putVal()`æ–¹æ³•ä¸­ï¼Œè¿™æ˜¯æ•´ä¸ªæ·»åŠ æ“ä½œçš„åº•å±‚å®ç°çš„æ ¸å¿ƒæºç ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªéš¾ç‚¹ã€‚

```java
final V putVal(int hash, K key, V value, boolean onlyIfAbsent,
               boolean evict) {
    Node<K,V>[] tab; Node<K,V> p; int n, i;
    if ((tab = table) == null || (n = tab.length) == 0)
        n = (tab = resize()).length;
    if ((p = tab[i = (n - 1) & hash]) == null)
        tab[i] = newNode(hash, key, value, null);
    else {
        Node<K,V> e; K k;
        if (p.hash == hash &&((k = p.key) == key || (key != null && key.equals(k))))
            e = p;
        else if (p instanceof TreeNode)
            e = ((TreeNode<K,V>)p).putTreeVal(this, tab, hash, key, value);
        else {
            for (int binCount = 0; ; ++binCount) {
                if ((e = p.next) == null) {
                    p.next = newNode(hash, key, value, null);
                    if (binCount >= TREEIFY_THRESHOLD - 1) // -1 for 1st
                        treeifyBin(tab, hash);
                    break;
                }
                if (e.hash == hash &&((k = e.key) == key || (key != null && key.equals(k))))
                    break;
                p = e;
            }
        }
        if (e != null) { // existing mapping for key
            V oldValue = e.value;
            if (!onlyIfAbsent || oldValue == null)
                e.value = value;
            afterNodeAccess(e);
            return oldValue;
        }
    }
    ++modCount;
    if (++size > threshold)
        resize();
    afterNodeInsertion(evict);
    return null;
}
```

åœ¨æ–¹æ³•ä½“çš„å¼€å§‹ï¼Œå®šä¹‰äº†å‡ ä¸ªå±€éƒ¨å˜é‡ï¼Œä»¥å¤‡åé¢ä½¿ç”¨(åºŸè¯)ã€‚ç»§ç»­çœ‹ä¸‹é¢çš„ä»£ç ï¼Œè¿™æ˜¯æ–¹æ³•ä½“çš„ç¬¬ä¸€ä¸ªifåˆ¤æ–­ï¼Œä¸»è¦çš„ä½œç”¨æ˜¯åˆ¤æ–­å¹¶åˆ›å»ºä¸€ä¸ª`table`ï¼Œæ³¨æ„ï¼Œè¿™é‡Œçš„`table`æ˜¯ä¸€ä¸ªæ•°ç»„+é“¾è¡¨å½¢å¼çš„ç»“æ„ï¼Œä¹Ÿå°±æ˜¯æ•°ç»„æ¯ä¸€ä¸ªç´¢å¼•å‡ºçš„å…ƒç´ éƒ½æ˜¯ä¸€æ¡å•é“¾è¡¨çš„å½¢å¼ã€‚è¿™ä¸€ç‚¹å‰é¢æœ‰æåˆ°ã€‚å…·ä½“çš„é€»è¾‘æ˜¯ï¼Œ

```java
if ((tab = table) == null || (n = tab.length) == 0){
     n = (tab = resize()).length;
}
```

é¦–å…ˆï¼Œå¯¹äº`if`ä¸­çš„`(tab = table) == null `æ¡ä»¶ï¼Œç¨‹åºå…ˆå°†`table`èµ‹å€¼ç»™`tab`å˜é‡ï¼Œåˆ¤æ–­é›†åˆä¸­æ˜¯å¦å·²ç»å­˜åœ¨`table`æ•°æ®ï¼Œæˆ–è€…è¯´è¯¥æ•°ç»„çš„é•¿åº¦æ˜¯å¦ä¸º`0`ã€‚å¦‚æœä¸Šè¿°æ¡ä»¶æœ‰ä¸€ä¸ªæˆç«‹ï¼Œåˆ™è¡¨ç¤º**è¿™æ˜¯ç¬¬ä¸€æ¬¡å‘é›†åˆä¸­æ·»åŠ å…ƒç´ **ï¼Œ`hashMap`ä¼šè‡ªåŠ¨è°ƒç”¨`resize()`æ–¹æ³•å¯¹`table[]`è¿›è¡Œé¦–æ¬¡æ‰©å®¹ï¼Œä»¥ç”¨æ¥å­˜æ”¾æ¥ä¸‹æ¥çš„å…ƒç´ ï¼Œæ‰€ä»¥ï¼Œæ˜ç™½äº†è¿™ä¸ªåˆ¤æ–­çš„ä½œç”¨ï¼Œä¹Ÿå°±ä¸éš¾æ¨æµ‹ï¼Œä¸ºä»€ä¹ˆè¿™æ¡`if`åˆ¤æ–­è¯­å¥ä¼šæ”¾åœ¨æ–¹æ³•çš„å¼€å§‹äº†ï¼Œä¹Ÿå¯ä»¥æ¨æµ‹ï¼Œåªè¦ä¸æ˜¯é¦–æ¬¡æ·»åŠ å…ƒç´ ï¼Œå°±ä¸å†ä¼šè¿›å…¥è¯¥åˆ¤æ–­ï¼Œç›´æ¥èµ°åé¢çš„é€»è¾‘ã€‚é‚£ä¹ˆç°åœ¨çš„å…³æ³¨ç‚¹å°±è¯¥è½¬ç§»åˆ°è¿™ä¸ª`resize()`æ–¹æ³•ä¸­ï¼Œçœ‹ä¸€ä¸‹å®ƒçš„æºç ï¼š

```java
final Node<K,V>[] resize() {
    Node<K,V>[] oldTab = table;
    int oldCap = (oldTab == null) ? 0 : oldTab.length;
    int oldThr = threshold;
    int newCap, newThr = 0;
    if (oldCap > 0) {
        if (oldCap >= MAXIMUM_CAPACITY) {
            threshold = Integer.MAX_VALUE;
            return oldTab;
        }
        else if ((newCap = oldCap << 1) < MAXIMUM_CAPACITY &&
                 oldCap >= DEFAULT_INITIAL_CAPACITY)
            newThr = oldThr << 1; // double threshold
    }
    else if (oldThr > 0) // initial capacity was placed in threshold
        newCap = oldThr;
    else {               // zero initial threshold signifies using defaults
        newCap = DEFAULT_INITIAL_CAPACITY;
        newThr = (int)(DEFAULT_LOAD_FACTOR * DEFAULT_INITIAL_CAPACITY);
    }
    if (newThr == 0) {
        float ft = (float)newCap * loadFactor;
        newThr = (newCap < MAXIMUM_CAPACITY && ft < (float)MAXIMUM_CAPACITY ?
                  (int)ft : Integer.MAX_VALUE);
    }
    threshold = newThr;
    @SuppressWarnings({"rawtypes","unchecked"})
    Node<K,V>[] newTab = (Node<K,V>[])new Node[newCap];
    table = newTab;
    if (oldTab != null) {
        for (int j = 0; j < oldCap; ++j) {
            Node<K,V> e;
            if ((e = oldTab[j]) != null) {
                oldTab[j] = null;
                if (e.next == null)
                    newTab[e.hash & (newCap - 1)] = e;
                else if (e instanceof TreeNode)
                    ((TreeNode<K,V>)e).split(this, newTab, j, oldCap);
                else { // preserve order
                    Node<K,V> loHead = null, loTail = null;
                    Node<K,V> hiHead = null, hiTail = null;
                    Node<K,V> next;
                    do {
                        next = e.next;
                        if ((e.hash & oldCap) == 0) {
                            if (loTail == null)
                                loHead = e;
                            else
                                loTail.next = e;
                            loTail = e;
                        }
                        else {
                            if (hiTail == null)
                                hiHead = e;
                            else
                                hiTail.next = e;
                            hiTail = e;
                        }
                    } while ((e = next) != null);
                    if (loTail != null) {
                        loTail.next = null;
                        newTab[j] = loHead;
                    }
                    if (hiTail != null) {
                        hiTail.next = null;
                        newTab[j + oldCap] = hiHead;
                    }
                }
            }
        }
    }
    return newTab;
}
```

é‚£å°±çœ‹ä¸‹å®ƒçš„æ‰©å®¹åŸç†å§ã€‚é¦–å…ˆå‘¢ï¼Œå¦‚å‰é¢è¯´æ‰€ï¼Œå®ƒå¼€å§‹å°±åˆ›å»ºäº†ä¸€ä¸ª`table[]`ã€‚å°†è¯¥æ•°ç»„çš„å¼•ç”¨èµ‹ç»™`oldTab`,

```java
 Node<K,V>[] oldTab = table;
```

æ³¨æ„è¿™é‡Œè¿™ä¸ªæ•°ç»„é¦–æ¬¡å®šä¹‰å¹¶éåœ¨è¿™ä¸ªæ–¹æ³•ä¸­ï¼Œè€Œæ˜¯åœ¨`HashMap`æºç ä¸­æœ‰åšçš„ä¸€ä¸ªå®šä¹‰ï¼Œ**å®ƒä¹Ÿæ˜¯ä¸å¯è¢«åºåˆ—åŒ–çš„**ã€‚æ¥ç€ä¼šå…ˆåˆ¤æ–­è¯¥`table`æ˜¯å¦æ˜¯é¦–æ¬¡åˆ›å»ºï¼Œå¦‚æœæ˜¯ï¼Œç›´æ¥åˆå§‹åŒ–ä¸º0ï¼Œå¦åˆ™å°±æ˜¯`oldTab`çš„å¤§å°ï¼Œä¸ºä»€ä¹ˆä¼šè¿™ä¹ˆè¯´å‘¢ï¼Œå› ä¸ºè¿™ä¸ª`resize()`æ–¹æ³•å¯ä¸åªæ˜¯æ‰§è¡Œè¿™ä¸€æ¬¡ï¼Œåœ¨`putVal()`æ–¹æ³•çš„åç»­çš„é€»è¾‘ä¸­è¿˜ä¼šç”¨åˆ°ï¼Œä¹Ÿå°±æ˜¯ä¼šå‡ºç°å†æ¬¡æ‰©å®¹çš„æƒ…å†µï¼Œé‚£ä¹ˆå­˜åœ¨ä¸€ä¸ª`oldTab`çš„å€¼ä¹Ÿå°±ä¸éš¾ç†è§£äº†å§ã€‚

å¦‚æœ`oldCap>0`ï¼Œè¿›ä¸€æ­¥åˆ¤æ–­å®ƒæ˜¯å¦`>=`æœ€å¤§å®¹é‡`MAXNUM_CAPACITY`,å…³äº`MAXNUM_CAPACITY`çš„å®šä¹‰å¦‚ä¸‹

```java
//MAXIMUM_CAPACITYå®šä¹‰
static final int MAXIMUM_CAPACITY = 1 << 30;
```

å¦‚æœè¯¥æ¡ä»¶æˆç«‹ï¼Œä¼šç»™`threshod`é‡æ–°èµ‹ä¸€ä¸ªæ–°çš„å®¹é‡å€¼ï¼Œå³`Integer`çš„ä¸Šé™ï¼Œåä¹‹è¿›å…¥ä¸‹ä¸€ä¸ªåˆ¤æ–­` ((newCap = oldCap << 1) < MAXIMUM_CAPACITY &&oldCap >= DEFAULT_INITIAL_CAPACITY)`,å°†`oldCap`å·¦ç§»1ä½,ä¹Ÿå°±æ˜¯ä¸¤å€çš„`oldCap`èµ‹ç»™ä¸€ä¸ªæ–°çš„å˜é‡`newCap`,å¦‚æœè¯¥å€¼å°äº`MAXNUM_CAPACITY`å¹¶ä¸”åŸæ¥çš„å®¹é‡`oldCap`å¤§äºç­‰äºåˆå§‹é»˜è®¤å®¹é‡å€¼`DEFAULT_INITIAL_CAPACITY`çš„è¯ï¼Œå°±å°†æ–°çš„`newThr`æ‰©ä¸ºåŸæ¥(`oldThr`)çš„ä¸¤å€å¤§å°ã€‚

```java
//DEFAULT_INITIAL_CAPACITYå®šä¹‰
static final int DEFAULT_INITIAL_CAPACITY = 1 << 4; // aka 16
//1<<4ç­‰ä»·äº1X2^4=2x2x2x2=16
```

> **è¿™é‡Œå…ˆå¯¹ä¸Šé¢æºç ä¸­æ¶‰åŠåˆ°çš„å‡ ä¸ªå˜é‡ç®€å•è¯´æ˜ä¸€ä¸‹**ï¼Œ**ä¸ç„¶é¢‘ç¹çš„`=`èµ‹å€¼æ“ä½œä¸€æ³¢åˆä¸€æ³¢ï¼Œå¯èƒ½ä¼šç»™æ•´æ‡µåœˆã€‚**
>
> 1. `oldCap`:æ•°ç»„åŸå…ˆ(å‡†å¤‡æ‰©å®¹ä¹‹å‰)çš„å®¹é‡ã€‚
> 2. `oldThr`ï¼šå…¶å®å°±æ˜¯`threshold`çš„ä¸€ä¸ªæš‚å­˜å±€éƒ¨å˜é‡ï¼Œç”¨æ¥æš‚å­˜`threshold`çš„å€¼ã€‚
> 3. `threshold`ï¼šè¿™æ˜¯ä¸€ä¸ªå®šä¹‰åœ¨`HashMap`çš„çš„å…¨å±€å˜é‡(**å¯ä»¥è¿™ä¹ˆè¯´ï¼Œå®é™…ä¸Š`Java`ä¸­æ²¡æœ‰å…¨å±€å˜é‡è¿™ç§æ¦‚å¿µ**),å®ƒç”¨æ¥å­˜æ”¾`table[]`çš„ä¸€ä¸ªå®¹é‡å€¼ï¼Œæˆ–è€…è¯´**é˜ˆå€¼**ã€‚æ‰€ä»¥æœ€ç»ˆå†³å®šæ˜¯å¦éœ€è¦æ‰©å®¹å–å†³äºè¿™ä¸ªå…¨å±€å˜é‡æ¥åˆ¤æ–­ã€‚
> 4. `newCap`:åŒç†äº`oldCap`ã€‚

ç»§ç»­å›åˆ°æœ€å¤–å±‚`if`åˆ¤æ–­çš„`else if`é€»è¾‘ä¸­ï¼Œè¿™é‡Œå…ˆæ˜¯å¯¹`newThr`æ˜¯å¦å¤§äº0ä½œäº†åˆ¤æ–­ï¼Œå¦‚æœ`>0`æˆç«‹ï¼Œé‚£ä¹ˆæ–°çš„å®¹é‡`newCap`çš„å€¼æ²¿ç”¨`oldThr`,å¦åˆ™å°†ä¼šæ‰§è¡Œä¸‹é¢è¿™æ®µä»£ç ,`newCap`çš„å€¼é»˜è®¤è®¾ç½®ä¸º`DEFAULT_INITIAL_CAPACITY`ä¹Ÿå°±æ˜¯`16`,å¹¶ä¸”`newThr`çš„å€¼æ›´æ–°ä¸º`(int)(DEFAULT_LOAD_FACTOR * DEFAULT_INITIAL_CAPACITY);`ã€‚è¿™é‡Œå‚ä¸`*`è¿ç®—çš„é™¤äº†åˆå§‹é»˜è®¤å®¹é‡`DEFAULT_INITIAL_CAPACITY`å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªé‡è¦çš„å¸¸é‡å‚æ•°`DEFAULT_LOAD_FACTOR`ï¼Œæˆ‘ä»¬ç§°ä¸º**è´Ÿè½½å› å­**ï¼Œæ¢å¥è¯è¯´ï¼Œè¿™ä¸ªå› å­çš„å€¼å†³å®šäº†ä½ æ¯æ¬¡æ‰©å®¹çš„å…·ä½“å¤§å°ã€‚å®ƒæ˜¯é»˜è®¤å€¼ä¸º`0.75`,ä¹Ÿå°±æ˜¯è¯´å½“æˆ‘ä»¬æ•°ç»„å ç”¨é‡è¾¾åˆ°æœ¬èº«å®¹é‡çš„75%æ—¶ï¼Œå°±ä¼šè§¦å‘é¦–æ¬¡æ‰©å®¹(`resize`)æ“ä½œã€‚å½“ç„¶ï¼Œæœ€åè¿˜è¿›è¡Œäº†å¼ºåˆ¶ç±»å‹è½¬æ¢ä¸º`int`ã€‚

æ‰€ä»¥ä¸éš¾ç†è§£ï¼Œå¦‚æœæˆ‘ä»¬æ˜¯é¦–æ¬¡ä½¿ç”¨`HashMap`è¿›è¡Œ`put`æ“ä½œï¼Œæ–¹æ³•ä¼šç›´æ¥è¿›å…¥è¿™ä¸€æ­¥è¿›è¡Œåˆå§‹åŒ–ã€‚

```java
else {// zero initial threshold signifies using defaults
    newCap = DEFAULT_INITIAL_CAPACITY;
    newThr = (int)(DEFAULT_LOAD_FACTOR * DEFAULT_INITIAL_CAPACITY);
}
```

> å…·ä½“ä¸€ç‚¹è¯´ï¼Œå½“é˜ˆå€¼è¾¾åˆ°`16*0.75`æ—¶ï¼Œä¹Ÿå³æ˜¯16å¤§å°çš„å®¹é‡ç”¨æ‰äº†12ä¸ªå¤§å°æ—¶å°±ä¼šè§¦å‘é¦–æ¬¡`resize`ã€‚

è¿™ä¸ª**è´Ÿè½½å› å­**ä¸æ˜¯å›ºå®šä¸å˜çš„ï¼Œè€Œä¸”æœ‰ä¸€ç‚¹éœ€è¦è¯´æ˜çš„æ˜¯ï¼Œè¿™ä¸ª`resize()`æ–¹æ³•ä¸­ï¼Œ**è´Ÿè½½å› å­æ˜¯å¯ä»¥æ‰‹åŠ¨ä¼ å…¥çš„**ï¼Œè¿™ä¸€ç‚¹åœ¨`HashMap`çš„å¦ä¸€ä¸ªæ„é€ æ–¹æ³•ä¸­æœ‰ä½“ç°ï¼Œå½“ç„¶ï¼Œè¿™ä¸ªåé¢å†è¯´ã€‚è¿™é‡Œä¸»è¦è®²çš„è¿˜æ˜¯æ— å‚æ„é€ å™¨çš„æ‰§è¡ŒåŸç†ï¼Œä½ éœ€è¦ç†è§£`resize()`æ–¹æ³•çš„ä¸¤ä¸ªä¸»è¦ä½œç”¨ï¼Œç¬¬ä¸€ä¸ªå°±æ˜¯ä¸Šé¢å·´æ‹‰å·´æ‹‰è¿™ä¸€å †ï¼Œ**ä¸»è¦æ˜¯ç”¨æ¥å¯¹æ•°ç»„è¿›è¡Œåˆå§‹åŒ–å·¥ä½œ**(å½“ç„¶ï¼Œä½ ä¹Ÿå¯ä»¥ç†è§£ä¸ºé¦–æ¬¡æ‰©å®¹ï¼Œè¿™åªæ˜¯ä¸€ç§è¯´æ³•è€Œå·²ï¼Œä¸€èˆ¬æˆ‘ä»¬ä¼šå°†é¦–æ¬¡æ‰©å®¹ç§°ä¸ºåˆå§‹åŒ–ï¼Œå› ä¸ºå…¶å®**æ‰©å®¹çš„æ¦‚å¿µæ˜¯å»ºç«‹åœ¨å·²æœ‰å®¹é‡çš„åŸºç¡€ä¸Šçš„**)ï¼Œè€Œæ­¤åå†è°ƒç”¨`resize()`å°±æ‰§è¡Œçš„æ˜¯æ‰©å®¹å·¥ä½œäº†ï¼Œä½†å®ƒçš„æ‰©å®¹å·¥ä½œå¯æ²¡æœ‰åˆå§‹åŒ–è¿™ä¹ˆç®€å•ã€‚

ä½†ä¸ºäº†èƒ½æ›´æ¸…æ™°çš„ç†è§£ï¼Œæˆ‘ä»¬è¿˜æ˜¯ç»§ç»­é¦–æ¬¡`put`æ“ä½œçš„ä¸»çº¿è¿›è¡Œåˆ†æã€‚æ¥ç€ä¸Šé¢è¯´ï¼Œåˆå§‹åŒ–ç»“æŸä¹‹åï¼Œä¼šå¾—åˆ°ä¸€ä¸ªåˆå§‹çš„é˜ˆå€¼`newThr=16`,å¹¶å°†è¯¥é˜ˆå€¼é‡æ–°èµ‹ç»™å…¨å±€`threshold`ä¿å­˜ã€‚è®¡ç®—å‡º`table[]`çš„ä¸€ä¸ªåˆå§‹å¤§å°ä¹‹åï¼Œåˆ©ç”¨è¯¥å€¼ç›´æ¥åˆ›å»ºä¸€ä¸ªå¤§å°ä¸º`newCap`çš„æ–°çš„`newTab`ç»™`table`è¿”å›ï¼Œæœ‰äº†è¿™ä¸ª`table`ï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨é‡Œé¢å­˜æ”¾å…ƒç´ äº†ï¼Œæ¯”å¦‚å­˜æ”¾ä¸€ä¸ªå­—ç¬¦ä¸²`Java`ã€‚

```java
threshold = newThr;
@SuppressWarnings({"rawtypes","unchecked"})
Node<K,V>[] newTab = (Node<K,V>[])new Node[newCap];
table = newTab;
```

ä½†å…‰æ˜¯åˆå§‹åŒ–ä¸€ä¸ª16å¤§å°çš„`table`æ˜¯è¿œè¿œä¸å¤Ÿçš„ã€‚æˆ‘ä»¬çŸ¥é“ï¼Œæ—¢ç„¶æ˜¯æ•°ç»„é‡Œé¢å­˜æ”¾å…ƒç´ ï¼Œæ˜¯éœ€è¦ä¸€ä¸ªç´¢å¼•çš„ï¼Œæ ¹æ®è¿™ä¸ªç´¢å¼•å»æ‰¾åˆ°ä¸€ä¸ªå¯¹åº”çš„ä½ç½®ï¼Œå†å°†è¯¥å…ƒç´ è¦†ç›–ä¸Šå»ï¼Œå®Œæˆå…ƒç´ çš„æ·»åŠ ã€‚

æ‰€ä»¥æˆ‘ä»¬å…ˆå›åˆ°ä¸Šä¸€ä¸ªæ–¹æ³•`putVal()`æ–¹æ³•ï¼šæ¥ç€ä¸Šé¢åˆ‡å…¥è¿›æ¥çš„`resize()`æ–¹æ³•ä¹‹åè®²è§£ã€‚

```java
if ((tab = table) == null || (n = tab.length) == 0)
    n = (tab = resize()).length;
```

> ä¸Šé¢è¿™ä¸¤è¡Œä»£ç ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬ä¸Šé¢åˆšåˆšè®²å®Œçš„åˆå§‹åŒ–æ“ä½œçš„éƒ¨åˆ†ã€‚

çœ‹ä¸€ä¸‹ï¼Œåœ¨å¯¹`table`è¿›è¡Œäº†åˆå§‹åŒ–ï¼Œå¹¶è®¡ç®—å¾—åˆ°`key`çš„`hash`ä¹‹åï¼Œåç»­çš„ä»£ç é€»è¾‘åˆ†è§£ï¼š

```java
if ((p = tab[i = (n - 1) & hash]) == null)
    tab[i] = newNode(hash, key, value, null);
```

è¿™é‡Œå°±æ˜¯æ ¹æ®`hash`å€¼è®¡ç®—ä¸€ä¸ªç´¢å¼•`i`ã€‚æ–¹æ³•æ˜¯`(n-1) & hash`,åœ¨è·å¾—ç´¢å¼•ä¹‹åï¼Œæ£€æŸ¥è¯¥ç´¢å¼•ä½ç½®çš„å€¼`tab[i]`èµ‹ç»™å˜é‡`p`å¹¶åˆ¤æ–­æ˜¯å¦ä¸º`null`ï¼Œå¦‚æœä¸º`null`è¡¨ç¤ºæ²¡æœ‰è¢«ä½¿ç”¨ï¼Œåé¢ä¸€å¥`tab[i] = newNode(hash, key, value, null);`ç›´æ¥å°†å…ƒç´ `key`å­˜è¿›å»,å½“ç„¶ï¼Œå­˜å…¥çš„å…ƒç´ é™¤äº†æˆ‘ä»¬è‡ªå·±ä¼ å…¥çš„æ•°æ®ä¹‹å¤–ï¼Œè¿˜æœ‰è®¡ç®—å‡ºæ¥çš„`hash`å’Œä¸€ä¸ª`value`ï¼Œä¼ å…¥`hash`ä¸»è¦æ˜¯ä¸ºäº†**ä¸‹ä¸€æ¬¡è®¡ç®—ï¼Œç”¨æ¥ç¡®å®šä¸‹æ¬¡ä¼ å…¥çš„å€¼æ˜¯å¦ä¸ºé‡å¤å…ƒç´ ã€‚**è‡³äºå…¶ä¸­è¿˜æœ‰ä¸€ä¸ªå€¼ä¸º`null`çš„å€¼ï¼Œè¡¨ç¤º**é“¾è¡¨çš„ä¸‹ä¸€ä¸ªç»“ç‚¹æŒ‡å‘**ï¼Œå½“ç„¶ï¼Œè¿™é‡Œæ˜¯é¦–æ¬¡`put`ï¼Œæ‰€ä»¥`next`æ˜¯ä¸å­˜åœ¨çš„ï¼Œä¹Ÿå°±æ˜¯`null`ã€‚å½“ä¸Šé¢è¿™æ®µä»£ç æ‰§è¡Œå®Œæ¯•ä¹‹åï¼Œå…ƒç´ å°±è¢«æˆåŠŸæ·»åŠ åˆ°`table`ä¸­äº†ã€‚

![image-20220325162444469](C:/Users/22170/AppData/Roaming/Typora/typora-user-images/image-20220325162444469.png)

> é€šè¿‡`debug`å¯ä»¥çœ‹åˆ°,`key`è®¡ç®—å‡ºçš„`hash=2301537`.é‚£ä¹ˆè¿™ä¸ªç´¢å¼•å°±å¯ä»¥æ ¹æ®`(16-1)&2301537`è®¡ç®—å‡ºæ¥ï¼Œå®ƒçš„å€¼æ˜¯ä¸º`1`çš„ï¼Œä¹Ÿå°±æ˜¯æ•°ç»„ä¸­ç¬¬äºŒä¸ªä½ç½®çš„ç´¢å¼•ã€‚

![image-20220325162819682](C:/Users/22170/AppData/Roaming/Typora/typora-user-images/image-20220325162819682.png)

 å…ƒç´ æ·»åŠ ä¹‹åï¼Œç¨‹åºé€»è¾‘ä¼šç›´æ¥æ‰§è¡Œåˆ°ä¸‹é¢çš„ä»£ç 

```java
++modCount;
if (++size > threshold)
    resize();
afterNodeInsertion(evict);
return null;
```

å…¶ä¸­çš„`++modCount`æˆ‘åœ¨`ArrayList`æºç åˆ†æçš„æ–‡ç« ä¸­å·²ç»æè¿‡ï¼Œä»–ä»¬çš„ä½œç”¨æ˜¯ä¸€æ ·çš„ã€‚åˆ¤æ–­`if (++size > threshold)`ï¼Œå¦‚æœæ·»åŠ å…ƒç´ ä¹‹åçš„æ•°ç»„å®¹é‡`>`ç›®å‰çš„é˜ˆå€¼`threshold`ï¼Œä¼šè§¦å‘`resize()`ã€‚å…³äº`afterNodeInsertion(evict);`æ–¹æ³•ï¼Œæ˜¯`HashMap`ç•™ç»™å®ƒçš„å­ç±»å»å®ç°çš„ä¸€ä¸ªæ–¹æ³•ï¼Œæ‰€ä»¥å®ƒæ˜¯ä¸ªç©ºçš„æ–¹æ³•ã€‚ç±»ä¼¼çš„æ–¹æ³•è¿˜æœ‰ï¼š

```java
// Callbacks to allow LinkedHashMap post-actions
void afterNodeAccess(Node<K,V> p) { }
void afterNodeInsertion(boolean evict) { }
void afterNodeRemoval(Node<K,V> p) { }
```

æ¥ç€`putVal()`æ–¹æ³•æœ€åè¿”å›ä¸€ä¸ª`null`ä½œä¸ºæ–¹æ³•çš„ç»“æŸã€‚**æ‰€ä»¥è¿˜è®°å¾—å‰é¢ç•™çš„ä¸€ä¸ªé—®é¢˜å—**ï¼Ÿåœ¨`HashSet`æºç ä¸­çš„`add()`æ–¹æ³•çš„æ–¹æ³•ä½“é‡Œé¢ï¼Œå®ƒçš„è¿”å›å€¼æ˜¯åˆ¤æ–­æ˜¯å¦ä¸º`null`,å†çœ‹ä¸€ä¸‹å§è¿˜æ˜¯ã€‚

```java
public boolean add(E e) {
    return map.put(e, PRESENT)==null;
}
```

è¡¨ç¤ºæ‰§è¡Œ`HashSet`ä¸­çš„`add()`æ–¹æ³•æ·»åŠ ä¸€ä¸ªå…ƒç´ ï¼Œå®ƒåº•å±‚å®é™…ä¸Šè°ƒç”¨äº†`HashMap`ä¸­çš„`put()`æ–¹æ³•å»å®ç°ï¼Œèƒ½å¦æ·»åŠ æˆåŠŸçš„ä¾æ®å°±æ˜¯è¯¥`put()`æ–¹æ³•æ˜¯å¦è¿”å›`null`,å¦‚æœæ˜¯ï¼Œ`HashSet`çš„`add()`æ–¹æ³•å°±è¿”å›ä¸€ä¸ª`true`,æœ€ç»ˆè¡¨ç¤ºç€æˆ‘ä»¬åˆ©ç”¨`HashSet`æˆåŠŸçš„æ·»åŠ äº†ä¸€ä¸ªå…ƒç´ ã€‚å¦åˆ™ï¼Œæ·»åŠ å¤±è´¥ï¼ï¼

****

###### å»é‡åŸç†

> åœ¨ç†è§£äº†`HashMap`åº•å±‚`table[]`çš„åˆå§‹åŒ–é€»è¾‘ä¹‹åï¼Œå½“æˆ‘ä»¬å‘å…¶ä¸­`put()`ç¬¬äºŒä¸ªå…ƒç´ æ—¶ï¼Œå®ƒçš„åº•å±‚æ˜¯å¦‚ä½•åˆ¤æ–­å…ƒç´ æ˜¯å¦é‡å¤çš„å‘¢ï¼Ÿä¸‹é¢å°±ä»¥è¿™ä¸ªé—®é¢˜ä¸ºä¸»çº¿å¼€å§‹åˆ†æã€‚

ç”±äºåŒæ ·æ˜¯æ·»åŠ çš„æ“ä½œï¼Œå‰é¢çš„çš„å‡ ä¸ªæ­¥éª¤å°±ä¸å†èµ˜è¿°ï¼Œæ¯”å¦‚åº•å±‚è°ƒç”¨`map.put()`ï¼Œç„¶åæ˜¯`hash`çš„è®¡ç®—ã€‚ç›´æ¥è¿›å…¥`putVal()`æ–¹æ³•å¼€å§‹çœ‹ã€‚è¿™é‡Œå†è´´ä¸€éå®ƒçš„æºç ï¼š

```java
final V putVal(int hash, K key, V value, boolean onlyIfAbsent,boolean evict) {
    Node<K,V>[] tab; Node<K,V> p; int n, i;
    if ((tab = table) == null || (n = tab.length) == 0)
        n = (tab = resize()).length;
    if ((p = tab[i = (n - 1) & hash]) == null)
        tab[i] = newNode(hash, key, value, null);
    else {
        Node<K,V> e; K k;
        if (p.hash == hash &&
            ((k = p.key) == key || (key != null && key.equals(k))))
            e = p;
        else if (p instanceof TreeNode)
            e = ((TreeNode<K,V>)p).putTreeVal(this, tab, hash, key, value);
        else {
            for (int binCount = 0; ; ++binCount) {
                if ((e = p.next) == null) {
                    p.next = newNode(hash, key, value, null);
                    if (binCount >= TREEIFY_THRESHOLD - 1) // -1 for 1st
                        treeifyBin(tab, hash);
                    break;
                }
                if (e.hash == hash &&
                    ((k = e.key) == key || (key != null && key.equals(k))))
                    break;
                p = e;
            }
        }
        if (e != null) { // existing mapping for key
            V oldValue = e.value;
            if (!onlyIfAbsent || oldValue == null)
                e.value = value;
            afterNodeAccess(e);
            return oldValue;
        }
    }
    ++modCount;
    if (++size > threshold)
        resize();
    afterNodeInsertion(evict);
    return null;
}
```

é‰´äºå‰é¢æˆ‘ä»¬åœ¨æ·»åŠ ç¬¬ä¸€ä¸ªå…ƒç´ `Java`çš„æ—¶å€™ï¼Œå·²ç»å®Œæˆäº†`table[]`çš„åˆå§‹åŒ–å·¥ä½œï¼Œæ‰€ä»¥ä¸‹é¢è¿™æ®µä»£ç ä¸ä¼šå†æ‰§è¡Œ;

```java
if ((tab = table) == null || (n = tab.length) == 0) n = (tab = resize()).length;
```

è€Œæ˜¯ç›´æ¥å¸¦ç€å‰é¢è®¡ç®—å¾—æ¥å¾—`Hash`é€šè¿‡ä¸ä¹‹å‰åŒæ ·ç®—æ³•è®¡ç®—å‡ºå…ƒç´ `C++`(å‡è®¾è¿™æ˜¯æˆ‘ä»¬ç¬¬äºŒä¸ªæ·»åŠ çš„å…ƒç´ )åœ¨æ•°ç»„ä¸­çš„ç´¢å¼•ï¼Œä»£ç å¦‚ä¸‹ï¼š

```java
if ((p = tab[i = (n - 1) & hash]) == null) tab[i] = newNode(hash, key, value, null);
```

>æ³¨æ„å“ˆï¼Œè¿™é‡Œçš„`n`åœ¨åˆå§‹åŒ–çš„æ—¶å€™å·²ç»è®¡ç®—å‡ºæ¥ï¼Œè¿˜æ˜¯ç­‰äº16çš„ï¼Œæ”¹å˜çš„æ˜¯`hash`å€¼ï¼Œå‡è®¾ä¸º`65762`ã€‚é‚£ä¹ˆæ ¹æ®ä¸Šè¿°ç®—æ³•è®¡ç®—å¾—åˆ°å®ƒçš„ç´¢å¼•ä¸º`15&65762=2`ã€‚

å¥½äº†ï¼Œæ—¢ç„¶ç´¢å¼•ä¹Ÿæœ‰äº†ï¼Œå¹¶ä¸”æˆ‘ä»¬æ·»åŠ çš„è¿™ä¸ªå…ƒç´ å’Œç¬¬ä¸€ä¸ªå…ƒç´ `Java`æ˜æ˜¾æ˜¯ä¸ç›¸ç­‰çš„ï¼Œæ‰€ä»¥ä¸ä¼šè¿›å…¥åˆ°`else if`åˆ¤æ–­ä¸­ï¼Œå› ä¸º`if`å·²ç»æˆç«‹ï¼Œåé¢çš„é€»è¾‘å°±æ˜¯å°†è¯¥å…ƒç´ å€¼ç›´æ¥æ·»åŠ åˆ°æ•°ç»„ä¸­ç´¢å¼•ä¸º`2`çš„ä½ç½®ï¼Œå½“ç„¶ï¼Œå…ƒç´ ä¹Ÿæ˜¯ä¸€ä¸ª`Node<k,v>`ç±»å‹ã€‚æ³¨æ„ï¼Œè¿™é‡Œå­˜å…¥å‚æ•°ä¸­çš„æœ€åä¸€ä¸ªå€¼ä¾æ—§è¿˜æ˜¯`null`ï¼Œå› ä¸ºå‰åä¸¤ä¸ªå…ƒç´ å¹¶æ²¡æœ‰å­˜æ”¾åœ¨åŒä¸€æ¡é“¾è¡¨ä¸Šï¼Œè‡ªç„¶ä¸ä¼šå‡ºç°åœ¨å°¾éƒ¨æŒ‚è½½çš„æƒ…å†µã€‚

> ä¸‹é¢å°†ä¼šè¿›è¡Œç¬¬ä¸‰ä¸ªå…ƒç´ çš„æ·»åŠ ï¼Œå‡è®¾æˆ‘ä»¬æ·»åŠ çš„å…ƒç´ æ˜¯`Java`,æ˜¯çš„ï¼Œå’Œ**é¦–æ¬¡æ·»åŠ çš„å…ƒç´ æ˜¯ç›¸åŒçš„**ï¼Œçœ‹ä¸€ä¸‹åº•å±‚å°†ä¼šå¦‚ä½•å¤„ç†ã€‚

åŒæ ·æˆ‘ä»¬ç›´æ¥è·³åˆ°`putVal()`æ–¹æ³•ä¸­ã€‚ç¨‹åºé¦–å…ˆä¼šè¿›å…¥åˆ°ç¬¬äºŒä¸ª`if`åˆ¤æ–­é‡Œï¼Œå¼€å§‹è®¡ç®—ç´¢å¼•å¹¶ä½œåˆ¤æ–­ï¼Œä¹Ÿå°±æ˜¯ä¸‹é¢è¿™æ®µä»£ç ï¼š

```java
if ((p = tab[i = (n - 1) & hash]) == null)
    tab[i] = newNode(hash, key, value, null);
```

æ³¨æ„äº†ï¼Œç”±äºé¦–æ¬¡è®¡ç®—å¾—å‡º`Java`å¯¹åº”çš„ç´¢å¼•ä¸º`2`,é‚£ä¹ˆè¿™æ¬¡çš„ç»“æœä¹Ÿæ˜¯ç›¸åŒçš„å€¼ï¼Œæ‰€ä»¥`if`ä¸­çš„æ¡ä»¶æ˜¾ç„¶ä¸å¯èƒ½æˆç«‹ï¼Œå› ä¸ºç´¢å¼•ä¸º`2`çš„ä½ç½®å·²ç»è¢«å ç”¨ï¼Œè‡ªç„¶ä¸ä¼šä¸º`null`ã€‚æ‰€ä»¥ç¨‹åºå°†ä¼šè¿›å…¥ä¸‹é¢çš„é€»è¾‘ä¸­ï¼š

```java
else {
    Node<K,V> e; K k;
    if (p.hash == hash &&
        ((k = p.key) == key || (key != null && key.equals(k))))
        e = p;
    else if (p instanceof TreeNode)
        e = ((TreeNode<K,V>)p).putTreeVal(this, tab, hash, key, value);
    else {
        for (int binCount = 0; ; ++binCount) {
            if ((e = p.next) == null) {
                p.next = newNode(hash, key, value, null);
                if (binCount >= TREEIFY_THRESHOLD - 1) // -1 for 1st
                    treeifyBin(tab, hash);
                break;
            }
            if (e.hash == hash &&
                ((k = e.key) == key || (key != null && key.equals(k))))
                break;
            p = e;
        }
    }
    if (e != null) { // existing mapping for key
        V oldValue = e.value;
        if (!onlyIfAbsent || oldValue == null)
            e.value = value;
        afterNodeAccess(e);
        return oldValue;
    }
}
```

åˆæ˜¯ä¸€å †`if else if`å¥—å¨ƒæ“ä½œã€‚æŒ‰ç…§å®ƒçš„é¡ºåºï¼Œæˆ‘ä»¬å…ˆåˆ†æç¬¬ä¸€ä¸ª`if`çš„é€»è¾‘ï¼š

```java
if (p.hash == hash &&((k = p.key) == key || (key != null && key.equals(k))))
    e = p;
```

é‰´äº`()`ä¸­æ¶‰åŠåˆ°äº†ä¸‰å¤„é€»è¾‘è¿ç®—ï¼Œæ–¹ä¾¿ç†è§£ï¼Œæˆ‘ä»¬å°†å®ƒé€å±‚è¿›è¡Œæ‹†åˆ†è®²è§£ã€‚

```java
(k = p.key) == key || (key != null && key.equals(k))
```

é¦–å…ˆçœ‹`||`çš„å·¦è¾¹`(k=p.key)==key`:æ„æ€æ˜¯å…ˆå°†`p`ä¸­çš„`key`å€¼èµ‹ç»™å˜é‡`k`,å†ä¸`key`è¿›è¡Œä¸€ä¸ªæ¯”è¾ƒï¼Œåˆ¤æ–­æ˜¯å¦ä¸ºåŒä¸€ä¸ª`key`å€¼(å¯¹è±¡)ï¼Œæ³¨æ„äº†ï¼Œè¿™é‡Œçš„ä¸¤ä¸ª`key`çš„æ„æ€ï¼Œå‰ä¸€ä¸ª`key`(ä¹Ÿå°±æ˜¯`k`)**ä»£è¡¨çš„æ˜¯æ•°ç»„ä¹‹å‰å·²ç»å­˜åœ¨æ•°ç»„ä¸­çš„å…ƒç´ ï¼Œ**è€Œåä¸€ä¸ª`key`**å°±æ˜¯å½“å‰ä¼ å…¥çš„å…ƒç´ **ï¼Œå…·ä½“çš„ä¹Ÿå°±æ˜¯æŒ‡æˆ‘ä»¬ç¬¬ä¸€æ¬¡å­˜å…¥çš„`Java`å’Œæœ¬æ¬¡å­˜å…¥çš„`Java`ã€‚

å†çœ‹`||`å³è¾¹`(key != null && key.equals(k)`,è¿™æ˜¯ä¸€ä¸ª`&&`æ“ä½œ,éœ€è¦æ“ä½œç¬¦ä¸¤è¾¹çš„æ¡ä»¶åŒæ—¶æˆç«‹ï¼Œæ•´ä¸ªæ¡ä»¶æ‰ä¼šæˆç«‹ã€‚é¦–å…ˆåˆ¤æ–­å­˜å…¥çš„`key`æ˜¯å¦ä¸º`null`ï¼Œå†åˆ¤æ–­`key`å’Œ`k`æ˜¯å¦ä¸ºç›¸åŒï¼ˆæ³¨æ„è¿™é‡Œç”¨äº†`equals()`æ–¹æ³•,è¯¥æ–¹æ³•å¯è¢«é‡å†™ï¼‰ï¼Œåˆ¤æ–­æ˜¯å¦ä¸ºç›¸åŒçš„å†…å®¹ã€‚å›åˆ°å¤–å±‚çš„`p.hash==hash`è¿™ä¸ªåˆ¤æ–­ï¼Œå°±æ˜¯å°†å·²æœ‰ç´¢å¼•å¤„å¯¹åº”çš„å…ƒç´ (å…ƒç´ æ˜¯å­˜åœ¨`Node`ä¸Šçš„)çš„`hash`å€¼å–å‡ºä¸å½“å‰å…ƒç´ çš„`Hash`è¿›è¡Œæ¯”è¾ƒã€‚

æ‰€ä»¥å½’çº³èµ·æ¥ä¹Ÿå°±æ˜¯å½“äºŒè€…`hash`ç›¸åŒå¹¶ä¸”`key`ä¹Ÿç›¸åŒ(åŒä¸€ä¸ªå¯¹è±¡)çš„æƒ…å†µä¸‹ï¼Œæ‰§è¡Œ`e=p`èµ‹å€¼æ“ä½œï¼Œå°†åŸä½ç½®çš„å€¼è¿›è¡Œè¦†ç›–ã€‚

å¦‚æœä¸Šé¢çš„æ¡ä»¶ä¸æˆç«‹ï¼Œä¼šåˆ¤æ–­`p`æ˜¯å¦æ˜¯çº¢é»‘æ ‘ï¼Œå¦‚æœæ˜¯ï¼Œå°±è°ƒç”¨å¯¹åº”çš„æ·»åŠ æ–¹æ³•`putTreeVal()`è¿›è¡Œæ·»åŠ ï¼Œä¹Ÿå°±æ˜¯ä¸‹é¢çš„ä»£ç ã€‚è¿™é‡Œçš„ `instanceof`å…³é”®å­—ç”¨æ¥åˆ¤æ–­ä¸€ä¸ªå¯¹è±¡æ˜¯å¦ä¸ºä¸€ä¸ªç±»çš„å®ä¾‹ã€‚å¦å¤–ï¼Œ`putTreeVal()`æ–¹æ³•å†…éƒ¨æ¶‰åŠåˆ°å¤§é‡çº¢é»‘æ ‘çš„ä»£ç ï¼Œç›¸å¯¹å¤æ‚å¾ˆå¤šï¼Œå¦‚æœè·³è¿›å»çš„è¯ï¼Œä¼°è®¡ä¸€æ—¶åŠä¼šå‡ºä¸æ¥ï¼Œæ‰€ä»¥è¿™é‡Œæš‚æ—¶ä¸ä½œæ¢ç©¶ï¼Œä¼šå¦å¤–åˆ†å¼€æ¥å­¦ä¹ ï¼Œè¿˜æ˜¯å›´ç»•ç€ä¸»çº¿ç»§ç»­åˆ†æã€‚

```java
else if (p instanceof TreeNode)
    e = ((TreeNode<K,V>)p).putTreeVal(this, tab, hash, key, value);
```

å¦åˆ™ï¼Œè¿›å…¥`else`é€»è¾‘ä¸­ï¼š

```java
else {
    for (int binCount = 0; ; ++binCount) {
        if ((e = p.next) == null) {
            p.next = newNode(hash, key, value, null);
            if (binCount >= TREEIFY_THRESHOLD - 1) // -1 for 1st
                treeifyBin(tab, hash);
            break;
        }
        if (e.hash == hash &&
            ((k = e.key) == key || (key != null && key.equals(k))))
            break;
        p = e;
    }
}
```

å¼€å±€ä¸€ä¸ª`for`ï¼Œç›®çš„æ˜ç¡®ï¼Œ**æ—¢ç„¶ä¸Šé¢ä¸¤ç§æƒ…å†µéƒ½ä¸æˆç«‹ï¼Œé‚£ä¹ˆè¯´æ˜è¯¥å…ƒç´ å¯èƒ½ä¼šåœ¨æŸä¸€æ¡é“¾è¡¨èŠ‚ç‚¹ä¸Šå‡ºç°**ï¼Œæ¯”å¦‚ä¸‹é¢è¿™æ ·ï¼š

```java
Java->C++->Javascript->Java
```

æ‰€ä»¥æˆ‘ä»¬éœ€è¦ä»¥éå†çš„æ–¹å¼å»æ£€æŸ¥é“¾è¡¨ä¸Šçš„æ¯ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå¾ªç¯å†…éƒ¨ï¼Œé€šè¿‡`p`å’Œ`e`ä¸¤ä¸ªæŒ‡é’ˆä¸åœçš„å¾ªç¯æ¯”è¾ƒã€‚

å¦‚æœè¿‡ç¨‹ä¸­å‘ç°æœ‰ä¸€ä¸ªå’Œå½“å‰å…ƒç´ é‡å¤çš„å…ƒç´ ï¼Œå¾ªç¯ä¼šç«‹å³ç»“æŸï¼Œå…ƒç´ æ·»åŠ å¤±è´¥ï¼Œå¦åˆ™å°±å°†å½“å‰å…ƒç´ ç›´æ¥æŒ‚åˆ°èŠ‚ç‚¹åé¢ï¼Œå®Œæˆæ·»åŠ ã€‚æ³¨æ„å…¶ä¸­è¿™æ®µä»£ç :

```java
if (binCount >= TREEIFY_THRESHOLD - 1) // -1 for 1st
    treeifyBin(tab, hash);
//TREEIFY_THRESHOLDçš„å®šä¹‰
static final int TREEIFY_THRESHOLD = 8;
```

è¿™æ˜¯åœ¨è¿›è¡Œ**æ·»åŠ ä¹‹åå¯¹å½“å‰è¿™æ¡é“¾è¡¨è¿›è¡Œä¸€ä¸ªåˆ¤æ–­**ï¼Œå¦‚æœé•¿åº¦`>=(TREEIFY_THRESHOLD=8)-1`çš„è¯ï¼Œä¼šè°ƒç”¨`treeifBin()`æ–¹æ³•å¯¹å½“å‰é“¾è¡¨è¿›è¡Œæ ‘åŒ–(è½¬çº¢é»‘æ ‘)ï¼Œä½†æ˜¯æ³¨æ„ï¼Œå…‰æ˜¯è¿™ä¸ªæ¡ä»¶æ»¡è¶³è¿˜ä¸è¶³ä»¥å¼€å§‹æ ‘åŒ–ï¼Œåœ¨è¿™ä¸ªæ–¹æ³•çš„å®ç°ä¸­ï¼Œè¿˜æ·»åŠ äº†å…¶ä»–çš„æ·»åŠ ç”¨æ¥åˆ¤æ–­ï¼Œ`treeifBin()`æºç ï¼š

```java
final void treeifyBin(Node<K,V>[] tab, int hash) {
    int n, index; Node<K,V> e;
    if (tab == null || (n = tab.length) < MIN_TREEIFY_CAPACITY)
        resize();
    else if ((e = tab[index = (n - 1) & hash]) != null) {
        TreeNode<K,V> hd = null, tl = null;
        do {
            TreeNode<K,V> p = replacementTreeNode(e, null);
            if (tl == null)
                hd = p;
            else {
                p.prev = tl;
                tl.next = p;
            }
            tl = p;
        } while ((e = e.next) != null);
        if ((tab[index] = hd) != null)
            hd.treeify(tab);
    }
}
```

å°±æ˜¯è¯´ï¼Œå°±ç®—å‰é¢çš„æ¡ä»¶(`>=8`)å·²ç»æˆç«‹ï¼Œè¿™é‡Œè¿˜ä¼šè¿›è¡Œä¸€ä¸ªåˆ¤æ–­ï¼Œå…·ä½“é€»è¾‘å¦‚ä¸‹ï¼š

```java
if (tab == null || (n = tab.length) < MIN_TREEIFY_CAPACITY)
    resize();
```

å®ƒè¿˜ä¼šåˆ¤æ–­å½“å‰è¿™ä¸ª`table`çš„å¤§å°æ˜¯å¦`<MIN_TREEIFY_CAPACITY`ä¹Ÿå°±æ˜¯æ˜¯å¦`<64`ã€‚å¦‚æœè¿™ä¸ªæ¡ä»¶æˆç«‹ï¼Œé‚£ä¹ˆä¼šå…ˆå¯¹æ•°ç»„è¿›è¡Œä¸€ä¸ª`resize()`æ‰©å®¹æ“ä½œï¼Œè€Œä¸æ˜¯ç›´æ¥è½¬çº¢é»‘æ ‘ã€‚æœ€åå¦‚æœæ·»åŠ å¤±è´¥ï¼Œä¼šè¿”å›ä¸€ä¸ªä¹‹å‰å…ƒç´ çš„`value`å€¼ã€‚

```java
if (e != null) { // existing mapping for key
    V oldValue = e.value;
    if (!onlyIfAbsent || oldValue == null)
        e.value = value;
    afterNodeAccess(e);
    return oldValue;
	}
}
```

###### æ‰©å®¹åŸç†

å‰é¢å¯¹æ•´ä¸ªæµç¨‹æœ‰äº†å¤§è‡´çš„äº†è§£ä¹‹åï¼Œä¸‹é¢ä¸»è¦é’ˆå¯¹å®ƒçš„**æ‰©å®¹åŸç†**è¿›è¡Œä¸€ä¸ªç®€å•çš„æ€»ç»“ã€‚

å…³äºæ‰©å®¹çš„åŸç†ï¼Œå…ˆè¯´ç»“è®ºï¼š

- `HashSet`åº•å±‚æ˜¯`HashMap`ï¼Œé¦–æ¬¡æ·»åŠ æ—¶ï¼Œ`table`æ•°ç»„çš„å®¹é‡æ‰©ä¸º16ï¼Œåˆå§‹ä¸´ç•Œå€¼ä¸º12:

  > threshold(é˜ˆå€¼) = table.size()(tableæ•°ç»„å¤§å°) * loadFactor(åŠ è½½å› å­)
  >
  > =16*0.75
  >
  > =12

- å¦‚æœ`table`æ•°ç»„ä½¿ç”¨çš„éƒ¨åˆ†è¾¾åˆ°äº†é˜ˆå€¼ï¼Œå°±ä¼šè§¦å‘æ‰©å®¹ï¼Œå…·ä½“çš„æ‰©å®¹ä¸º`16*2=32`,ä¹Ÿå°±æ˜¯**ä¼šæŒ‰ç…§ä¸¤å€çš„æ‰©å®¹**æ–¹å¼è¿›è¡Œï¼ŒåŸºäºè¿™ä¸ªå®¹é‡å†æ¬¡è®¡ç®—æ–°çš„æ‰©å®¹é˜ˆå€¼:`32*0.75=24`,ä¹Ÿå°±æ˜¯å¦‚æœæœ¬æ¬¡æ‰©å®¹åçš„å®¹é‡(32)ä½¿ç”¨è¾¾åˆ°24ä¹‹åï¼Œå°±ä¼šå†æ¬¡è§¦å‘ä¸‹ä¸€æ¬¡çš„2å€æ‰©å®¹æœºåˆ¶ï¼Œä»¥æ­¤ç±»æ¨ã€‚

**ç®€å•æ¥è¯´ï¼Œä»¥ä¸Šå°±æ˜¯`HashSet(æœ¬è´¨HashMap)`çš„æ‰©å®¹åŸç†ï¼Œå…·ä½“çš„ï¼Œçœ‹ä¸‹é¢æºç åˆ†æã€‚**

> åœ¨resize()æ–¹æ³•ä¸­æœ‰è¿™æ ·ä¸€æ®µä»£ç 

```java
else if ((newCap = oldCap << 1) < MAXIMUM_CAPACITY &&
         oldCap >= DEFAULT_INITIAL_CAPACITY)
    newThr = oldThr << 1; // double threshold
```

å¯ä»¥çœ‹åˆ°ï¼Œæ–°çš„å®¹é‡æ˜¯åœ¨åŸæœ‰å®¹é‡çš„åŸºç¡€ä½œäº†ä¸€ä¸ªå·¦ç§»çš„æ“ä½œï¼Œä¹Ÿå°±æ˜¯å’Œä¹˜2æ˜¯ç­‰æ•ˆçš„ï¼Œä½†ç”¨ä½è¿ç®—æ•ˆç‡ä¼šå¿«å¾ˆå¤šã€‚

> è¿™æ˜¯åœ¨pustVal()æºç çš„éƒ¨åˆ†ä»£ç ï¼š

```java
++modCount;
if (++size > threshold)
    resize();
afterNodeInsertion(evict);
return null;
```

> resize();å°±æ˜¯è§¦å‘æ‰©å®¹æ—¶è°ƒç”¨çš„æ‰©å®¹æ–¹æ³•ã€‚å…·ä½“çš„æºç å‰é¢æœ‰è®²è¿‡ï¼Œä¸å†èµ˜è¿°ã€‚

åœ¨Java8ä¸­ï¼Œå¦‚æœä¸€æ¡é“¾è¡¨çš„å…ƒç´ ä¸ªæ•°è¾¾åˆ°` TREEIFY_THRESHOLD`ä¸”æ­¤æ—¶`table`çš„å¤§å°>=`MIN_TREEIFY_CAPACITY`

æ—¶å°±ä¼šè§¦å‘é“¾è¡¨è½¬çº¢é»‘æ ‘çš„æ“ä½œã€‚æé«˜æ€§èƒ½ã€‚

> ä¸Šé¢æ¶‰åŠåˆ°çš„ä¸¤ä¸ªå¸¸é‡åœ¨æºä»£ç ä¸­çš„å®šä¹‰å¦‚ä¸‹ï¼š

```java
static final int TREEIFY_THRESHOLD = 8;
static final int MIN_TREEIFY_CAPACITY = 64;
```

è½¬çº¢é»‘æ ‘çš„æ–¹æ³•æºç å¦‚ä¸‹ï¼Œè¿™é‡Œåªéœ€è¦çœ‹çœ‹å¤§è‡´çš„æ‰§è¡Œé€»è¾‘å°±å¥½ï¼Œå…³äºçº¢é»‘æ ‘å…·ä½“çš„å®ç°ï¼Œä¸æ˜¯æœ¬ç« çš„ä¸»è¦å†…å®¹ã€‚

```java
final void treeifyBin(Node<K,V>[] tab, int hash) {
    int n, index; Node<K,V> e;
    if (tab == null || (n = tab.length) < MIN_TREEIFY_CAPACITY)
        resize();
    else if ((e = tab[index = (n - 1) & hash]) != null) {
        TreeNode<K,V> hd = null, tl = null;
        do {
            TreeNode<K,V> p = replacementTreeNode(e, null);
            if (tl == null)
                hd = p;
            else {
                p.prev = tl;
                tl.next = p;
            }
            tl = p;
        } while ((e = e.next) != null);
        if ((tab[index] = hd) != null)
            hd.treeify(tab);
    }
}
```

**æ³¨æ„å¦‚æœåªæ˜¯æ»¡è¶³é“¾è¡¨é•¿åº¦è¾¾åˆ°8çš„æ¡ä»¶æ—¶ï¼Œå®ƒè¿˜æ˜¯ä¼šé‡‡ç”¨`resize()`æ–¹æ³•å¯¹æ•°ç»„æ‰©å®¹ï¼Œè€Œä¸æ˜¯ç›´æ¥è½¬çº¢é»‘æ ‘ã€‚**

**æ³¨æ„äº†ï¼ï¼**

> ä¸Šé¢æåˆ°çš„è§¦å‘æ•°ç»„æ‰©å®¹çš„æ¡ä»¶ä¸­ï¼Œ`size`çš„å¤§å°å¤§äºè´Ÿè½½å› å­æ‰ä¼šè§¦å‘ï¼Œè¿™é‡Œçš„`size`æŒ‡`çš„æ˜¯æ•°ç»„å’Œé“¾è¡¨ä¸­å…ƒç´ çš„å’Œ`ï¼Œä¹Ÿå°±æ˜¯åªè¦æˆ‘ä»¬å‘å…¶ä¸­æ·»åŠ ä¸€ä¸ªå…ƒç´ ï¼Œä¸è®ºè¿™ä¸ªå…ƒç´ æ˜¯å­˜åœ¨æ•°ç»„ç¬¬ä¸€ä¸ªä½ç½®ï¼Œè¿˜æ˜¯å­˜åœ¨é“¾è¡¨ä¸­æŸä¸ªä½ç½®ï¼Œ`sizeéƒ½ä¼šè‡ªå¢1`ï¼Œè¿™æ˜¯ä¸€ä¸ªæ¯”è¾ƒå®¹æ˜“æé”™çš„åœ°æ–¹ï¼Œ**ä¸è¦è®¤ä¸ºsizeå°±æ˜¯æŒ‡æ•°ç»„çš„é•¿åº¦ï¼Œè¿™æ˜¯é”™è¯¯çš„ã€‚**



****

**ä¸ºä»€ä¹ˆä¸ç›´æ¥ä½¿ç”¨`hash`æ¥è®¡ç®—ç´¢å¼•ï¼Œè€Œæ˜¯è¦è¿›è¡Œå–æ¨¡è¿ç®—ï¼Ÿ**

> å¦‚æœå°†å“ˆå¸Œç æ˜ å°„åˆ°æ•°ç»„ä¸­çš„ä¸€ä¸ªç´¢å¼•ã€‚å¯èƒ½ä¼šå› ä¸º`hash`å€¼è¿‡å¤§è€Œå› æ­¤å¯¼è‡´ç´¢å¼•è¶…å‡ºèŒƒå›´ã€‚æ‰€ä»¥ä¸€ä¸ªæœ€ç®€å•çš„æ–¹æ³•æ˜¯å¯¹å“ˆå¸Œç å’Œæ•°ç»„çš„é•¿åº¦è¿›è¡Œæ¨¡è¿ç®—ï¼Œå¦‚`hash(key) % n`ã€‚å¦‚æ­¤å¯ä»¥**ç¡®ä¿ç´¢å¼•iæ€»æ˜¯åœ¨0å’Œnä¹‹é—´ã€‚**

ä½†æ˜¯Javaåœ¨å®ç°çš„æ—¶å€™ï¼Œç”¨çš„å¹¶ä¸æ˜¯ä¸Šé¢è¯´çš„ç®—æ³•ï¼Œè€Œæ˜¯å°†**æ•°ç»„çš„é•¿åº¦nå‡å»1ä¹‹åå†ä¸`hash`ä½œ`&`è¿ç®—å¾—åˆ°**ï¼Œå®ç°ä»£ç å¦‚ä¸‹:

```java
i = (n - 1) & hash;
```

****

#### LinkedHashSet

##### æ¦‚è¿°

- `LinkedHashSet`æ˜¯`Set`æ¥å£çš„ä¸€ä¸ªå®ç°å­ç±»ï¼Œä¹Ÿæ˜¯`HashSet`çš„å­ç±»ã€‚
- `LinkedHashSet`çš„åº•å±‚æ˜¯ä¸€ä¸ª`LinkedHashMap`ï¼Œåº•å±‚ç»´æŠ¤äº†ä¸€ä¸ª**æ•°ç»„+åŒå‘é“¾è¡¨**ã€‚
- `LinkedHashSet`æ ¹æ®å…ƒç´ çš„`hashCode`å€¼æ¥å†³å®šå…ƒç´ çš„å­˜å‚¨ä½ç½®ï¼ŒåŒæ—¶**ä½¿ç”¨é“¾è¡¨æ¥ç»´æŠ¤å…ƒç´ çš„æ¬¡åº**ï¼Œè¿™å°±ä½¿å¾—å…ƒç´ çœ‹èµ·æ¥æ˜¯ä»¥æ’å…¥çš„é¡ºåºä¿å­˜çš„ã€‚
- å…¶æ¬¡ï¼Œ`LinkedHashSet`ä¹Ÿ**ä¸å…è®¸æ·»åŠ é‡å¤å…ƒç´ **ã€‚

![](https://images.waer.ltd/img/LinkedHashSet.png)

åœ¨`LinkedHashSet`ä¸­ç»´æŠ¤äº†ä¸€ä¸ª`hash`è¡¨å’ŒåŒå‘é“¾è¡¨ï¼Œæ¯ä¸€ä¸ªèŠ‚ç‚¹æœ‰`pre`å’Œ`next`å±æ€§ï¼Œè¿™æ ·å¯ä»¥å½¢æˆåŒå‘é“¾è¡¨ã€‚åœ¨æ·»åŠ å…ƒç´ æ—¶ï¼Œå…ˆæ±‚`hash`å€¼ï¼Œå†æ±‚ç´¢å¼•ï¼Œç¡®å®šè¯¥å…ƒç´ åœ¨å“ˆå¸Œè¡¨ä¸­çš„ä½ç½®ï¼Œç„¶åå°†æ·»åŠ çš„å…ƒç´ åŠ å…¥åˆ°åŒå‘é“¾è¡¨ï¼ˆå¦‚æœå·²ç»å­˜åœ¨ï¼Œä¸æ·»åŠ (åŸç†å’Œ`hashsetç±»ä¼¼`)ï¼‰ã€‚

##### æºç è§£è¯»

- é€šè¿‡ä¸‹é¢çš„ç¤ºä¾‹æ¥é…åˆè®²è§£ï¼š

```java
Set set = new LinkedHashSet();
set.add("A");
set.add(120);
set.add(120);
set.add(new User("æ",1001));
set.add(123);
set.add(new String("hello"));
System.out.println(set);
```

å¦‚æœæ–­ç‚¹çš„æ–¹å¼ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œ`LinkedHashSet`çš„ä¸€ä¸ªåŸºæœ¬ç»“æ„å¦‚ä¸‹ï¼š

![](https://images.waer.ltd/img/20220426085807.png)

é€šè¿‡ä¸Šå›¾å¯ä»¥å‘ç°ï¼Œå…¶ä¸­å­˜åœ¨ä¸€ä¸ª`tail`å’Œ`head`çš„å±æ€§ï¼Œè¿™æ˜¯å…¸å‹çš„åŒå‘é“¾è¡¨ä¸­æ‰ä¼šç”¨åˆ°çš„ä¸¤ä¸ªå¼•ç”¨ï¼Œæˆ–è€…æŒ‡é’ˆ(c/c++)ï¼Œ**ä»£è¡¨åŒå‘é“¾è¡¨çš„å¤´å°¾æŒ‡é’ˆ**ã€‚å³è¿›ä¸€æ­¥éªŒè¯äº†å‰é¢æåˆ°çš„`LinkedHashSet`çš„æ˜¯ä¸€ä¸ª`HashTable`å’ŒåŒå‘é“¾è¡¨çš„ç»„åˆã€‚

å…¶ä¸­çš„`table`ç±»å‹å…¶å®æ˜¯ä¸€ä¸ª`HashMap$Node[]`ç±»å‹ï¼Œè€Œæ¯ä¸€ä¸ªèŠ‚ç‚¹åˆæ˜¯ç»´æŠ¤çš„`LinkedHashMap$Entry[]`ç±»å‹ã€‚

![](https://images.waer.ltd/img/20220426090925.png)

ä¸ºä»€ä¹ˆæ•°ç»„ä¸º`HashMap$Node[]æ•°ç»„ç±»å‹`è€Œå­˜æ”¾çš„å…ƒç´ å´æ˜¯`LinkedHashMap$Entry[]`ç±»å‹ï¼Ÿ

> è¯´æ˜`LinkedHashMap$Entry[]`è‚¯å®šç»§**æ‰¿æˆ–è€…å®ç°**äº†`HashMap$Node[]`çš„ï¼Œå³é€šè¿‡**æ•°ç»„å¤šæ€**çš„æ–¹å¼å®ç°ã€‚æ³¨æ„è¿™é‡Œçš„`$`ç¬¦å·æ ‡è¯†$ä¹‹åçš„ç±»ä½œä¸º`$`ä¹‹å‰çš„ä¸€ä¸ªé™æ€å†…éƒ¨ç±»ï¼Œä¹Ÿå³è¡¨ç¤ºåœ¨`LinkedHashMap$Entry`ä¸­ï¼Œ`Entry`æ˜¯`LinkedHashMap`çš„ä¸€ä¸ª**é™æ€å†…éƒ¨ç±»ã€‚**

åœ¨`LinkdeHashMap`ä¸­æˆ‘ä»¬å¯ä»¥æ‰¾åˆ°å¯¹åº”çš„æºç éªŒè¯ã€‚

```java
static class Entry<K,V> extends HashMap.Node<K,V> {
    Entry<K,V> before, after;
    Entry(int hash, K key, V value, Node<K,V> next) {
        super(hash, key, value, next);
    }
}
```

ä»ä¸Šè¿°çš„æºç ä¸­ä¸ä»…è¯´æ˜`Entry`æ˜¯`LinkedHashMap`çš„å†…éƒ¨ç±»ï¼Œä¹Ÿè¯´æ˜`LinkedHashMap$Entry[]`ç»§æ‰¿äº†`HashMap$Node[]`ã€‚

å…¶ä¸­æœ‰ä¸¤ä¸ª`Entry<K,V>`ç±»å‹çš„å±æ€§ï¼š`before`å’Œ`after`ï¼Œå¯ä»¥ç†è§£ä¸ºä¸¤ä¸ªå¼•ç”¨ï¼Œä¸»è¦ç”¨æ¥å®Œæˆå„èŠ‚ç‚¹ä¹‹é—´çš„è¿æ¥ã€‚

åŒæ ·ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡æŸ¥çœ‹`HashMap`çš„æºç ï¼ŒéªŒè¯ä¸Šé¢çš„è¯´æ³•ï¼š`Node`åŒæ ·ä½œä¸ºå…¶ä¸€ä¸ªé™æ€çš„å†…éƒ¨ç±»å®ç°ã€‚å¹¶ä¸”è¯¥ç±»è¿˜å®ç°äº†å…¶çˆ¶æ¥å£`Map`ä¸­çš„`Entry<K,V>`ã€‚

```java
static class Node<K,V> implements Map.Entry<K,V> {
    final int hash;
    final K key;
    V value;
    Node<K,V> next;

    Node(int hash, K key, V value, Node<K,V> next) {
        this.hash = hash;
        this.key = key;
        this.value = value;
        this.next = next;
    }
```

![](https://images.waer.ltd/img/20220426092722.png)

åœ¨å­˜å‚¨å…ƒç´ æ—¶ï¼Œæ¯ä¸€ä¸ªå…ƒç´ ä¸­ä¾ç„¶æ˜¯ä½¿ç”¨çš„`key`æ¥å­˜å‚¨ï¼Œè€Œ`value`åªæ˜¯ä¸€ä¸ª`object`ç±»å‹çš„å ä½ç¬¦ï¼Œè¿™é‡Œæ²¡æœ‰å®é™…çš„æ„ä¹‰ã€‚å› ä¸ºåœ¨`LinkedHashSet`ä¸­ï¼Œæˆ‘ä»¬**ä¸éœ€è¦æ˜¾å¼çš„å»åƒMapä¸­å­˜ä¸€ä¸ª`K,V`å½¢å¼çš„å€¼ã€‚**

- å½“æˆ‘ä»¬æ·»åŠ ä¸€ä¸ªé‡å¤å…ƒç´ æ—¶ï¼Œ`LinkedHashSet`ä¼šç›´æ¥è°ƒç”¨çˆ¶ç±»`HashSet`ä¸­çš„æ¯”è¾ƒæ–¹æ³•ï¼Œå¯¹é‡å¤å…ƒç´ è¿›è¡Œä¸€ä¸ªåˆ¤æ–­å¹¶å»é‡ï¼Œå…¶å®è¿™é‡Œçš„åŸç†å’Œä¹‹å‰è®²çš„`HashSet`åŸç†æ˜¯ä¸€æ ·çš„ï¼Œå½“æ·»åŠ å…ƒç´ æ˜¯ï¼Œ`LinkedHashSet`è¿˜æ˜¯ä¼šç›´æ¥è°ƒç”¨çˆ¶ç±»`HashSet`ä¸­çš„`add()`æ–¹æ³•(è¯¥æ–¹æ³•æœ¬è´¨è¿˜æ˜¯è°ƒç”¨`HashMap`ä¸­çš„`put()`æ–¹æ³•)ï¼Œæ¥ç€æ˜¯`putVal()`å…³äºè¿™ä¸¤ä¸ªæ–¹æ³•çš„æºç åœ¨å‰é¢è®²`HashSet`æºç çš„æ—¶å€™å°±å·²ç»è®²è¿‡ï¼Œè¿™é‡Œä¸å†èµ˜è¿°ã€‚æ‰€ä»¥è¯´ï¼Œç»ç®¡æ˜¯ä¸åŒçš„ç»“æ„å®ç°ï¼Œä½†åœ¨å…ƒç´ åˆ¤é‡çš„åŸç†ä¸Šå…¶å®ä½¿ç”¨çš„è¿˜æ˜¯åŒä¸€ä¸ªé€»è¾‘ã€‚

**è¯´ç™½äº†ï¼ŒLinkedHashSetæœ¬è´¨ä¸Šå¤§éƒ¨åˆ†è¿˜æ˜¯HashMap**

- `LinkedHashset`åº•å±‚ç»´æŠ¤äº†ä¸€ä¸ª`LinkedHashMap`ç»“æ„ï¼Œè¿™ä¸€ç‚¹å¯ä»¥ç±»æ¯”äº`HashSet`åº•å±‚ç»´æŠ¤ä¸€ä¸ª`HashMap`æ¥è¿›è¡Œå¯¹æ¯”è®°å¿†ã€‚è€Œå‰é¢æˆ‘ä»¬å·²ç»çŸ¥é“ï¼Œ`LinkedHashMap`å…¶å®å°±æ˜¯`HashMap`çš„ä¸€ä¸ªå­ç±»ã€‚

- å¯¹äº`LinkedHashSet`æˆ‘ä»¬åœ¨ç†è§£äº†å‰é¢`HashSet`æºç çš„åŸºç¡€ä¸Šï¼Œåªéœ€è¦ç†è§£å®ƒåº•å±‚çš„ä¸€ä¸ªå®ç°ç»“æ„å³å¯ï¼Œä¹Ÿå°±æ˜¯æ•°ç»„+åŒå‘é“¾è¡¨çš„ç»“æ„ï¼Œå›åˆ°ä¸€å¼€å§‹çš„å“ªä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å‘seté›†åˆä¸­æ·»åŠ äº†ï¼š

> â€œAâ€ï¼Œ120, User,123

ä¹‹åï¼Œé€šè¿‡æ–­ç‚¹çš„æ–¹å¼å¯ä»¥çœ‹åˆ°ä»–ä»¬ä¹‹é—´çš„ä¸€ä¸ªæŒ‡å‘å…³ç³»å¦‚ä¸‹

![](https://images.waer.ltd/img/20220426100922.png)

> ä¸Šå›¾å±•ç¤ºäº†å†…éƒ¨å…ƒç´ èŠ‚ç‚¹ä¸­`after`å’Œ`before`çš„å¼•ç”¨å…³ç³»ã€‚ä»”ç»†è§‚å¯Ÿæ¯ä¸€ä¸ª`LinkedHashMap$Entry`åéƒ½ä¼šè·Ÿä¸€ä¸ª`@number`çš„æ ‡è¯†ï¼Œ**è¿™æ˜¯ç”¨æ¥æ ‡è¯†è¯¥ä½ç½®å…ƒç´ çš„ä¸€ä¸ªå”¯ä¸€æ ‡è®°ï¼Œæˆ–è€…ä½ ä¹Ÿå¯ä»¥ç†è§£ä¸ºè¯¥å…ƒç´ åœ¨è¯¥ç»“æ„ä¸­çš„ä¸€ä¸ªåœ°å€ã€‚**å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨è¯¥æ ‡è¯†æ¥å”¯ä¸€æ€§çš„ä»£è¡¨ä¸€å…ƒç´ å€¼ï¼Œæ³¨æ„å…¶ä¸­æ¯ä¸€å„`after`æˆ–è€…`before`çš„æŒ‡å‘å…³ç³»ï¼Œå…·ä½“åœ¨åé¢æˆ‘å›ç”»ä¸ªå›¾å¸®åŠ©ç†è§£ã€‚

- å†è·³å‡ºå…ƒç´ å†…éƒ¨`Entry`ï¼Œæˆ‘ä»¬çœ‹åˆ°åœ¨`table`ä¸­æœ‰ä¸¤ä¸ªåä¸º`head`å’Œ`tail`çš„å¼•ç”¨å±æ€§ã€‚ç”¨æ¥æ ‡è¯†è¯¥åŒå‘é“¾è¡¨çš„å¤´å°¾èŠ‚ç‚¹ã€‚

![](https://images.waer.ltd/img/20220426101903.png)

å°†ä¸Šé¢çš„é€»è¾‘ä»¥å›¾ç‰‡çš„å½¢å¼å±•ç¤ºå‡ºæ¥å¤§æ¦‚å°±æ˜¯ä¸‹é¢è¿™æ ·ï¼š

![](https://images.waer.ltd/img/LinkedHashSet.jpg)

ç®€å•æ‹ä¸€ä¸‹ï¼š

> - æ¯å‘`LinkedHashSet`ä¸­æ·»åŠ ä¸€ä¸ªå…ƒç´ ï¼Œé¦–å…ˆä¼šæ ¹æ®è¯¥å…ƒç´ è®¡ç®—ä¸€ä¸ª`hash`å€¼ï¼Œç”¨æ¥ç¡®å®šå®ƒåœ¨ä¸Šé¢å›¾ä¸­`table`æ•°ç»„ä¸­çš„ç´¢å¼•ä½ç½®ã€‚
> - é€šè¿‡ä¸Šé¢çš„æ­¥éª¤æ·»åŠ å¤šä¸ªå…ƒç´ ä¹‹åï¼Œå…ƒç´ å†…éƒ¨æ˜¯ä¸€ä¸ª`Entry[]`ç±»å‹çš„ç»“æ„ï¼Œå…¶ä¸­æ¯ä¸€ä¸ªå…ƒç´ éƒ½æœ‰ä¸€ä¸ª`after`å’Œ`before`å±æ€§ï¼Œç”¨**æ¥æŒ‡å‘å®ƒçš„å‰ä¸€ä¸ªå…ƒç´ å’Œåä¸€ä¸ªå…ƒç´ çš„ä½ç½®ã€‚**
> - å†é€šè¿‡ä¸¤ä¸ªå±æ€§`head`å’Œ`tail`æ¥æŒ‡å‘æ•´ä¸ªé“¾è¡¨çš„å¤´å’Œå°¾ï¼Œä»è€Œæ„æˆä¸€ä¸ª**å®Œæ•´çš„å«æœ‰å¤´å°¾æŒ‡é’ˆ(å¼•ç”¨)çš„åŒå‘é“¾è¡¨ã€‚**
> - å°†è¯¥é“¾è¡¨å…·è±¡åŒ–å‡ºæ¥å¯ä»¥å¤§è‡´è¡¨ç¤ºä¸ºå›¾ä¸­å³è¾¹éƒ¨åˆ†ã€‚æ¢å¥è¯è¯´ï¼Œè¿™é‡Œçš„`after`å’Œ`before`å…¶å®å°±ç›¸å½“äºå¹³æ—¶å¸¸ç”¨çš„`pre`å’Œ`next`æŒ‡é’ˆï¼Œå³å‰é©±åç»§æŒ‡é’ˆï¼Œåªä¸è¿‡å‘½åä¸åŒè€Œå·²ï¼Œæ²¡ä»€ä¹ˆé«˜æ·±è«æµ‹çš„ã€‚
> - æ³¨æ„ï¼Œå’Œå‰é¢`HashSet`çš„æ•°ç»„+å•é“¾è¡¨çš„ç»“æ„ç±»ä¼¼ï¼Œæ¯ä¸€ä¸ªç´¢å¼•ä½éƒ½å¯ä»¥æ˜¯ä¸€æ¡å®Œæ•´çš„åŒå‘é“¾è¡¨ï¼Œå°±åƒå›¾ä¸­ç´¢å¼•ä¸º7çš„ä½ç½®ä¸€æ ·ï¼Œè€Œä¸æ˜¯æ¯ä¸ªç´¢å¼•ä¸ºåªèƒ½æœ‰ä¸€ä¸ªé“¾è¡¨èŠ‚ç‚¹ï¼Œè¿™å–å†³äºå…ƒç´ è®¡ç®—å‡ºæ¥çš„`hash`ã€‚
> - æ­£æ˜¯ç”±äºåŒå‘é“¾è¡¨çš„ç‰¹æ€§ï¼Œä½¿å¾—æˆ‘ä»¬æ·»åŠ çš„å…ƒç´ é¡ºåºæ˜¯ç›¸å¯¹æœ‰åºçš„ï¼Œ**ä¹Ÿå°±æ˜¯æ·»åŠ çš„é¡ºåºå’Œæ‰“å°å‡ºæ¥çš„é¡ºåºæ˜¯ä¸€æ ·çš„ã€‚**

**å…³äºæ‰©å®¹**

é¦–å…ˆï¼Œ`LinkedHashSet`å¦‚æœä½¿ç”¨æ— å‚æ•°æ„é€ å™¨åˆå§‹åŒ–ï¼Œé‚£ä¹ˆå®ƒé»˜è®¤ä¼šå¼€è¾Ÿä¸€ä¸ª`16`å¤§å°çš„ç©ºé—´ï¼Œè´Ÿè½½å› å­ä¾æ—§æ˜¯`0.74`ï¼Œé¦–æ¬¡æ‰©å®¹çš„é˜ˆå€¼ä¸º`12`ã€‚è¿™äº›æ•°å€¼æ˜¯ä¸æ˜¯å¾ˆçœ¼ç†Ÿï¼Ÿå¦‚æœä½ çœ‹äº†å‰é¢`HashSet`çš„æºç åˆ†æçš„è¯ã€‚

```java
public LinkedHashSet() {
    super(16, .75f, true);
}
```

è™½ç„¶è®²çš„æ˜¯`LinkdeHashSet`ï¼Œä½†æœ¬è´¨ä¸Šåˆ†æçš„è¿˜æ˜¯`HashSet`ï¼Œå†æœ¬è´¨å°±æ˜¯`LinkedHashMap`ï¼Œå†ç»§ç»­å¥—å¨ƒä½ ä¼šå‘ç°ï¼Œ**å°±æ˜¯è®²çš„`HashMap`ï¼Œå¯è§è¿™å®¶ä¼™æ‰æ˜¯ä¸»è§’ã€‚**

****



æœªå®Œå¾…ç»­â€¦â€¦
