+++
title = "C++æ¸¸æˆå¼€å‘åŸºç¡€-æ·±å…¥è§£æå¤åˆ¶æ„é€ å‡½æ•°"
date = 2024-12-15
tags = ["C++", "æ¸¸æˆå¼€å‘"]
description = "è¯¦ç»†ä»‹ç»C++é¢å‘å¯¹è±¡ç¼–ç¨‹ä¸­çš„å¤åˆ¶æ„é€ å‡½æ•°,åŒ…æ‹¬éšå¼å¤åˆ¶æ„é€ å‡½æ•°ã€æ˜¾å¼å¤åˆ¶æ„é€ å‡½æ•°ç­‰æœ€ä½³å®è·µã€‚"
+++



è€ƒè™‘ä¸‹é¢ç¨‹åº:

```cpp
#include <iostream>

class Fraction
{
private:
    int m_numerator{ 0 };
    int m_denominator{ 1 };

public:
    // Default constructor
    Fraction(int numerator=0, int denominator=1)
        : m_numerator{numerator}, m_denominator{denominator}
    {
    }

    void print() const
    {
        std::cout << "Fraction(" << m_numerator << ", " << m_denominator << ")\n";
    }
};

int main()
{
    Fraction f { 5, 3 };  // 1
    Fraction fCopy { f }; // 2

    f.print();
    fCopy.print();

    return 0;
}
```

åœ¨ä¸Šé¢çš„ä»£ç ä¸­,é™¤äº†ä¸€ç³»åˆ—ç†Ÿæ‚‰çš„é…æ–¹ä¹‹å¤–,æˆ‘ä»¬è¿˜å‘ç°åœ¨25è¡Œæœ‰ä¸€è¡Œä¹‹å‰æ²¡è§è¿‡çš„ä»£ç ,å°±æ˜¯ä½ æƒ³çš„é‚£æ ·,è¿™ä¸ªå°±æ˜¯æœ¬æ–‡çš„ä¸»è§’-å¤åˆ¶æ„é€ å‡½æ•°ã€‚ 

å¤åˆ¶æ„é€ å‡½æ•°ä¹Ÿæ˜¯ä¸€ç§æ„é€ å‡½æ•°(æœ‰ä¸€ç§å¬å›ä¸€å¸­è¯çš„æ„Ÿè§‰ğŸ˜Š)ã€‚ç”¨äºä½¿ç”¨ç›¸åŒç±»å‹çš„ç°æœ‰å¯¹è±¡åˆå§‹åŒ–å¯¹è±¡,åœ¨å¤åˆ¶æ„é€ å‡½æ•°æ‰§è¡Œä¹‹å,åœ¨å¤åˆ¶æ„é€ å‡½æ•°æ‰§è¡Œå®Œåï¼Œæ–°å¯¹è±¡åº”è¯¥æ˜¯ä¼ å…¥çš„å·²æœ‰å¯¹è±¡çš„å‰¯æœ¬ï¼ˆæ‹·è´ï¼‰ã€‚

---

## éšå¼å¤åˆ¶æ„é€ å‡½æ•°

å¦‚æœä½ æ²¡æœ‰ä¸ºä½ çš„ç±»æä¾›å¤åˆ¶æ„é€ å‡½æ•°ï¼ŒC++å°†ä¸ºä½ åˆ›å»ºä¸€ä¸ªå…¬å…±**éšå¼å¤åˆ¶æ„é€ å‡½æ•°** ã€‚åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œè¯­å¥ `Fraction fCopy { f };` è°ƒç”¨éšå¼å¤åˆ¶æ„é€ å‡½æ•°æ¥ç”¨ `f` åˆå§‹åŒ– `fCopy`ã€‚

é»˜è®¤æƒ…å†µä¸‹ï¼Œéšå¼å¤åˆ¶æ„é€ å‡½æ•°å°†è¿›è¡Œæˆå‘˜åˆå§‹åŒ–ã€‚è¿™æ„å‘³ç€æ¯ä¸ªæˆå‘˜éƒ½å°†ä½¿ç”¨ä¼ å…¥çš„ç±»çš„ç›¸åº”æˆå‘˜ä½œä¸ºåˆå§‹åŒ–å™¨è¿›è¡Œåˆå§‹åŒ–ã€‚åœ¨ä¸Šä¾‹ä¸­ï¼Œ`fCopy.m_numerator` ä½¿ç”¨ `f.m_numerator`ï¼ˆå€¼ä¸º `5`ï¼‰åˆå§‹åŒ–ï¼Œ`fCopy.m_denominator` ä½¿ç”¨ `f.m_denominator`ï¼ˆå€¼ä¸º `3`ï¼‰åˆå§‹åŒ–ã€‚

åœ¨æ‰§è¡Œå¤åˆ¶æ„é€ å‡½æ•°ä¹‹åï¼Œ`f` å’Œ `fCopy` çš„æˆå‘˜å…·æœ‰ç›¸åŒçš„å€¼ï¼Œå› æ­¤ `fCopy` æ˜¯ `f` çš„å‰¯æœ¬ã€‚å› æ­¤ï¼Œè°ƒç”¨ `printï¼ˆï¼‰åœ¨`ä»»ä½•ä¸€ä¸ªä¸Šéƒ½æœ‰ç›¸åŒçš„ç»“æœã€‚

---

## æ˜¾å¼å®šä¹‰è‡ªå·±çš„å¤åˆ¶æ„é€ å‡½æ•°

æˆ‘ä»¬ä¹Ÿå¯ä»¥æ˜¾å¼çš„å®šä¹‰è‡ªå·±çš„å¤åˆ¶æ„é€ å‡½æ•°ã€‚æ¯”å¦‚ä¸‹é¢çš„ç¤ºä¾‹ä¸­,æˆ‘ä»¬å°†åœ¨è‡ªå·±å®šä¹‰çš„å¤åˆ¶æ„é€ å‡½æ•°ä¸­æ‰“å°ä¸€æ¡æ¶ˆæ¯,ä»¥ä¾¿äºæç¤ºæˆ‘ä»¬,è‡ªå·±å®šä¹‰çš„å¤åˆ¶æ„é€ å‡½æ•°è¢«æˆåŠŸè°ƒç”¨ã€‚ 

```cpp
#include<iostream>

class Fraction
{
private:
    int m_numberator {0};
    int m_denominator {1};
public:
    Fraction(int numerator = 0, int denominator = 1)
    :m_numberator{numerator}
    ,m_denominator{denominator}
    {}

    // å¤åˆ¶æ„é€ å‡½æ•°
    Fraction(const Fraction& fraction)
    :m_numberator{fraction.m_numberator}
    ,m_denominator{fraction.m_denominator}
    {
        std::cout <<"Copy constructor called\n";
    }

    void print()
    {
        std::cout <<"Fraction(" << m_numberator << "," << m_denominator << ")\n";
    }
};

int main()
{
    Fraction f {5,3};
    Fraction fCopy{f}; // å¤åˆ¶æ„é€ å‡½æ•°

    f.print();
    fCopy.print();

    return 0;
}

```

![image-20250324165906674](https://images.waer.ltd/notes/202503241659794.png)

**æé†’â°**

> è®¿é—®æ§åˆ¶æ˜¯ **åŸºäºç±»**è€Œä¸æ˜¯ **åŸºäºå¯¹è±¡**çš„ã€‚è¿™æ„å‘³ç€,åŒä¸€ä¸ªç±»çš„æˆå‘˜å‡½æ•°å¯ä»¥è®¿é—®ä»»æ„è¯¥ç±»å¯¹è±¡çš„ç§æœ‰æˆå‘˜ï¼ˆä¸ä»…ä»…æ˜¯å½“å‰å¯¹è±¡ this çš„ç§æœ‰æˆå‘˜ï¼‰ã€‚
>
> åœ¨ä¸Šé¢çš„ Fraction å¤åˆ¶æ„é€ å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬åˆ©ç”¨äº†è¿™ä¸€ç‰¹æ€§ï¼Œç›´æ¥è®¿é—®äº† fraction å‚æ•°çš„ç§æœ‰æˆå‘˜ã€‚å¦åˆ™ï¼Œæˆ‘ä»¬å°†æ— æ³•ç›´æ¥è®¿é—®è¿™äº›æˆå‘˜ï¼ˆé™¤éæ·»åŠ è®¿é—®å‡½æ•°ï¼Œä½†è¿™é‡Œæ˜¾ç„¶æ²¡é‚£ä¸ªå¿…è¦ï¼‰ã€‚

**æœ€ä½³å®è·µ**

> - å¤åˆ¶æ„é€ å‡½æ•°ä¸åº”è¯¥åšé™¤äº†å¤åˆ¶ä»¥å¤–çš„å…¶ä»–å·¥ä½œã€‚
> - é™¤éä½ æœ‰ç‰¹å®šå¿…è¦çš„ç†ç”±åˆ›å»ºè‡ªå·±çš„å¤åˆ¶æ„é€ å‡½æ•°,å¦åˆ™è¯·é¦–é€‰ä½¿ç”¨éšå¼å¤åˆ¶æ„é€ å‡½æ•°ã€‚

---

## å¤åˆ¶æ„é€ å‡½æ•°çš„å‚æ•°å¿…é¡»æ˜¯å¼•ç”¨ç±»å‹

- å½“ä¸€ä¸ªå¯¹è±¡ **æŒ‰å€¼ä¼ é€’ï¼ˆpass by valueï¼‰** æ—¶ï¼Œå‡½æ•°å‚æ•°ä¼šæ¥æ”¶åˆ° **åŸå§‹å¯¹è±¡çš„å‰¯æœ¬**ï¼Œè€Œä¸æ˜¯ç›´æ¥æ“ä½œåŸå¯¹è±¡ã€‚å¦‚æœä¼ é€’çš„å¯¹è±¡ä¸å‚æ•°æ˜¯ **ç›¸åŒçš„ç±»ç±»å‹**ï¼Œé‚£ä¹ˆ**å¤åˆ¶è¿‡ç¨‹**æ˜¯é€šè¿‡ **éšå¼è°ƒç”¨æ‹·è´æ„é€ å‡½æ•°ï¼ˆcopy constructorï¼‰** æ¥å®Œæˆçš„ã€‚

çœ‹ä¸ªä¾‹å­:

```cpp
#include <iostream>

class Fraction
{
private:
    int m_numerator{ 0 };   // åˆ†å­ï¼Œé»˜è®¤ä¸º 0
    int m_denominator{ 1 }; // åˆ†æ¯ï¼Œé»˜è®¤ä¸º 1

public:
    // é»˜è®¤æ„é€ å‡½æ•°ï¼ˆå¸¦é»˜è®¤å‚æ•°ï¼‰
    Fraction(int numerator = 0, int denominator = 1)
        : m_numerator{ numerator }, m_denominator{ denominator }
    {
    }

    // æ‹·è´æ„é€ å‡½æ•°
    Fraction(const Fraction& fraction)
        : m_numerator{ fraction.m_numerator }  // å¤åˆ¶åˆ†å­
        , m_denominator{ fraction.m_denominator }  // å¤åˆ¶åˆ†æ¯
    {
        std::cout << "å¤åˆ¶æ„é€ å‡½æ•°è¢«è°ƒç”¨\n";  // è¾“å‡ºä¿¡æ¯ï¼Œç¡®è®¤æ‹·è´æ„é€ å‡½æ•°è¢«è°ƒç”¨
    }

    // æ‰“å°åˆ†æ•°
    void print() const
    {
        std::cout << "Fraction(" << m_numerator << ", " << m_denominator << ")\n";
    }
};

// æŒ‰å€¼ä¼ é€’ Fraction å¯¹è±¡ï¼ˆä¼šè°ƒç”¨æ‹·è´æ„é€ å‡½æ•°ï¼‰
void printFraction(Fraction f) // f æŒ‰å€¼ä¼ é€’ï¼Œä¼šåˆ›å»ºå‰¯æœ¬
{
    f.print(); // è°ƒç”¨ Fraction ç±»çš„ print() æ–¹æ³•
}

int main()
{
    Fraction f{ 5, 3 }; // åˆ›å»º Fraction å¯¹è±¡ fï¼Œè°ƒç”¨æ™®é€šæ„é€ å‡½æ•°

    printFraction(f); // ä¼ é€’ f åˆ° printFraction å‡½æ•°ï¼ŒæŒ‰å€¼ä¼ é€’ï¼Œä¼šè°ƒç”¨æ‹·è´æ„é€ å‡½æ•°

    return 0;
}

```

åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œå¯¹ `printFractionï¼ˆfï¼‰` çš„è°ƒç”¨æ˜¯é€šè¿‡å€¼ä¼ é€’ `f`ã€‚è°ƒç”¨å¤åˆ¶æ„é€ å‡½æ•°å°† `f` ä» `main` å¤åˆ¶åˆ°å‡½æ•° `printFractionï¼ˆï¼‰` çš„ `f` å‚æ•°ä¸­ã€‚

åœ¨ C++ ä¸­ï¼Œ**æ‹·è´æ„é€ å‡½æ•°ï¼ˆCopy Constructorï¼‰çš„å‚æ•°å¿…é¡»æ˜¯** const **å¼•ç”¨**ï¼Œä¸èƒ½æŒ‰å€¼ä¼ é€’ï¼Œå¦åˆ™ä¼šå¯¼è‡´ **æ— é™é€’å½’**ï¼Œæœ€ç»ˆå¯¼è‡´ **æ ˆæº¢å‡ºï¼ˆstack overflowï¼‰**ã€‚

```cpp
class MyClass
{
public:
    MyClass(MyClass obj) // âŒ é”™è¯¯ï¼šæŒ‰å€¼ä¼ é€’æ‹·è´æ„é€ å‡½æ•°
    {
        std::cout << "Copy Constructor Called\n";
    }
};
```

> å½“ä½ å°è¯•åˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡ï¼ˆä¾‹å¦‚ MyClass obj2 = obj1;ï¼‰ï¼Œç¼–è¯‘å™¨ä¼šè¿™æ ·åšï¼š
>
> 1. obj1 éœ€è¦è¢«**å¤åˆ¶**åˆ° obj è¿™ä¸ªå‚æ•°ä¸­ï¼ˆå› ä¸ºæŒ‰å€¼ä¼ é€’ï¼‰ã€‚
> 2. ä½† obj ä¹Ÿæ˜¯ä¸€ä¸ª MyClass ç±»å‹çš„å¯¹è±¡ï¼Œæ‰€ä»¥éœ€è¦è°ƒç”¨ **æ‹·è´æ„é€ å‡½æ•°** æ¥å¤åˆ¶ obj1ã€‚
> 3. **è°ƒç”¨æ‹·è´æ„é€ å‡½æ•°æ—¶ï¼Œåˆè¦ä¼ é€’ obj è¿™ä¸ªå‚æ•°ï¼ˆæŒ‰å€¼ä¼ é€’ï¼‰**ï¼Œå› æ­¤ï¼š
>    1. **åˆä¼šè°ƒç”¨æ‹·è´æ„é€ å‡½æ•°**
>    2. **æ‹·è´æ„é€ å‡½æ•°åˆéœ€è¦ä¼ é€’ obj**
>    3. **è¿›å…¥æ— é™é€’å½’çš„è°ƒç”¨é“¾**
> 4. æœ€ç»ˆ **æ ˆæº¢å‡ºï¼ˆStack Overflowï¼‰**ï¼Œç¨‹åºå´©æºƒã€‚

---

å¦‚æœä¸€ä¸ªç±»æ²¡æœ‰å¤åˆ¶æ„é€ å‡½æ•°ï¼Œç¼–è¯‘å™¨å°†éšå¼åœ°ä¸ºæˆ‘ä»¬ç”Ÿæˆä¸€ä¸ªã€‚å¦‚æœæˆ‘ä»¬æ„¿æ„ï¼Œæˆ‘ä»¬å¯ä»¥æ˜¾å¼åœ°å‘Šè¯‰ç¼–è¯‘å™¨ä½¿ç”¨ `= default` è¯­æ³•ä¸ºæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªé»˜è®¤çš„å¤åˆ¶æ„é€ å‡½æ•°ï¼š

```cpp
#include <iostream>

class Fraction
{
private:
    int m_numerator{ 0 };
    int m_denominator{ 1 };

public:
    // é»˜è®¤æ„é€ å‡½æ•°
    Fraction(int numerator=0, int denominator=1)
        : m_numerator{numerator}, m_denominator{denominator}
    {
    }

    
    Fraction(const Fraction& fraction) = default;

    void print() const
    {
        std::cout << "Fraction(" << m_numerator << ", " << m_denominator << ")\n";
    }
};

int main()
{
    Fraction f { 5, 3 };
    Fraction fCopy { f };

    f.print();
    fCopy.print();

    return 0;
}
```

---

## ä½¿ç”¨ `=delete`é˜²æ­¢å¤åˆ¶

æœ‰æ—¶å€™æˆ‘ä»¬ä¼šé‡åˆ°è¿™æ ·çš„éœ€æ±‚,æˆ‘ä»¬ä¸å¸Œæœ›æŸä¸ªç±»çš„å¯¹è±¡æ˜¯å¯ä»¥å¤åˆ¶çš„,æˆ‘ä»¬å¯ä»¥é€šè¿‡ä½¿ç”¨`=delete`æ¥å°†å¤åˆ¶æ„é€ å‡½æ•°æ ‡è®°ä¸ºåˆ é™¤ä»¥å®ç°è¯¥éœ€æ±‚ã€‚

```cpp
#include <iostream>

class Fraction
{
private:
    int m_numerator{ 0 };
    int m_denominator{ 1 };

public:
    // Default constructor
    Fraction(int numerator=0, int denominator=1)
        : m_numerator{numerator}, m_denominator{denominator}
    {
    }

    // åˆ é™¤å¤åˆ¶æ„é€ å‡½æ•° æ— æ³•å†å¤åˆ¶
    Fraction(const Fraction& fraction) = delete;

    void print() const
    {
        std::cout << "Fraction(" << m_numerator << ", " << m_denominator << ")\n";
    }
};

int main()
{
    Fraction f { 5, 3 };
    Fraction fCopy { f }; //ç¼–è¯‘é”™è¯¯

    return 0;
}
```

åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå½“ç¼–è¯‘å™¨å»å¯»æ‰¾ä¸€ä¸ªæ„é€ å‡½æ•°æ¥ç”¨ `f` åˆå§‹åŒ– `fCopy` æ—¶ï¼Œå®ƒä¼šå‘ç°å¤åˆ¶æ„é€ å‡½æ•°å·²ç»è¢«åˆ é™¤äº†ã€‚è¿™å°†å¯¼è‡´å®ƒå‘å‡ºç¼–è¯‘é”™è¯¯ã€‚

> é€šå¸¸ï¼ŒC++ ç±»çš„ **æ‹·è´æ„é€ å‡½æ•°** æ˜¯ public çš„ï¼Œè¿™æ ·å¤–éƒ¨ä»£ç ï¼ˆä¾‹å¦‚æŒ‰å€¼ä¼ é€’å¯¹è±¡ã€å¯¹è±¡èµ‹å€¼ç­‰ï¼‰å¯ä»¥æ­£å¸¸å¤åˆ¶å¯¹è±¡ã€‚ä½†å¦‚æœä½  **ä¸å¸Œæœ›å¯¹è±¡è¢«éšæ„å¤åˆ¶**ï¼Œå¯ä»¥å°†æ‹·è´æ„é€ å‡½æ•°è®¾ä¸º privateï¼Œè¿™æ ·å°±æ— æ³•åœ¨ç±»å¤–éƒ¨è¿›è¡Œå¤åˆ¶ã€‚
>
> ç„¶è€Œï¼Œè¿™æ ·åšæœ‰ä¸€ä¸ªä¾‹å¤–ï¼š**ç±»çš„æˆå‘˜å‡½æ•°ä»ç„¶å¯ä»¥è®¿é—®ç§æœ‰æ‹·è´æ„é€ å‡½æ•°**ï¼Œæ‰€ä»¥å¦‚æœä½ çš„ç±»å†…éƒ¨æœ‰æŸäº›ä»£ç ä»ç„¶éœ€è¦å¤åˆ¶å¯¹è±¡ï¼Œè¿™ä¸ªæ–¹æ³•å°±ä¸é€‚åˆã€‚

```cpp
#include <iostream>

class NonCopyable
{
private:
    // ç§æœ‰æ‹·è´æ„é€ å‡½æ•°ï¼Œé˜²æ­¢å¤–éƒ¨å¤åˆ¶
    NonCopyable(const NonCopyable& other) 
    {
        std::cout << "æ‹·è´æ„é€ å‡½æ•°è¢«è°ƒç”¨\n";
    }

public:
    // é»˜è®¤æ„é€ å‡½æ•°
    NonCopyable() 
    {
        std::cout << "é»˜è®¤æ„é€ å‡½æ•°è¢«è°ƒç”¨\n";
    }

    void show() const 
    {
        std::cout << "æˆ‘æ˜¯ä¸€ä¸ª NonCopyable å¯¹è±¡\n";
    }
};

int main()
{
    NonCopyable obj1; // âœ… è°ƒç”¨é»˜è®¤æ„é€ å‡½æ•°

    // NonCopyable obj2 = obj1; // âŒ è¿™é‡Œä¼šæŠ¥é”™ï¼Œå› ä¸ºæ‹·è´æ„é€ å‡½æ•°æ˜¯ private çš„
    // printNonCopyable(obj1);  // âŒ è¿™é‡Œä¹Ÿä¼šæŠ¥é”™ï¼ŒæŒ‰å€¼ä¼ é€’éœ€è¦æ‹·è´

    return 0;
}
```

---

## ç±»åˆå§‹åŒ–å’Œå¤åˆ¶çœç•¥

å…ˆå›é¡¾ä¸€ä¸‹å…·æœ‰åŸºæœ¬æ•°æ®ç±»å‹çš„å¯¹è±¡çš„6ç§åŸºæœ¬åˆå§‹åŒ–æ–¹å¼:

```cpp
int a;         // æ²¡æœ‰åˆå§‹åŒ–å™¨ï¼ˆé»˜è®¤åˆå§‹åŒ–ï¼‰  
int b = 5;     // åœ¨ç­‰å·åä½¿ç”¨åˆå§‹åŒ–å™¨ï¼ˆæ‹·è´åˆå§‹åŒ–ï¼‰  
int c(6);      // ä½¿ç”¨æ‹¬å·å†…çš„åˆå§‹åŒ–å™¨ï¼ˆç›´æ¥åˆå§‹åŒ–ï¼‰  

// åˆ—è¡¨åˆå§‹åŒ–æ–¹æ³•ï¼ˆC++11ï¼‰  
int d { 7 };   // ä½¿ç”¨å¤§æ‹¬å·çš„åˆå§‹åŒ–å™¨ï¼ˆç›´æ¥åˆ—è¡¨åˆå§‹åŒ–ï¼‰  
int e = { 8 }; // åœ¨ç­‰å·åä½¿ç”¨å¤§æ‹¬å·çš„åˆå§‹åŒ–å™¨ï¼ˆæ‹·è´åˆ—è¡¨åˆå§‹åŒ–ï¼‰  
int f {};      // åˆå§‹åŒ–å™¨ä¸ºç©ºçš„å¤§æ‹¬å·ï¼ˆå€¼åˆå§‹åŒ–ï¼‰  
```

æ‰€æœ‰è¿™äº›åˆå§‹åŒ–ç±»å‹å¯¹äºå…·æœ‰ç±»ç±»å‹çš„å¯¹è±¡éƒ½æ˜¯æœ‰æ•ˆçš„ï¼š

```cpp
#include <iostream>

class Foo
{
public:

    // é»˜è®¤æ„é€ å‡½æ•°ï¼ˆæ— å‚æ•°ï¼‰
    Foo()
    {
        std::cout << "Foo()\n";
    }

    // æ™®é€šæ„é€ å‡½æ•°ï¼ˆå¸¦ä¸€ä¸ª int å‚æ•°ï¼‰
    Foo(int x)
    {
        std::cout << "Foo(int) " << x << '\n';
    }

    // æ‹·è´æ„é€ å‡½æ•°ï¼ˆç”¨äºå¤åˆ¶å·²æœ‰å¯¹è±¡ï¼‰
    Foo(const Foo&)
    {
        std::cout << "Foo(const Foo&)\n";
    }
};

int main()
{
    // è°ƒç”¨ Foo() é»˜è®¤æ„é€ å‡½æ•°
    Foo f1;           // é»˜è®¤åˆå§‹åŒ–
    Foo f2{};         // å€¼åˆå§‹åŒ–ï¼ˆæ¨èï¼‰

    // è°ƒç”¨ Foo(int) æ™®é€šæ„é€ å‡½æ•°
    Foo f3 = 3;       // æ‹·è´åˆå§‹åŒ–ï¼ˆä»…é€‚ç”¨äºé explicit æ„é€ å‡½æ•°ï¼‰
    Foo f4(4);        // ç›´æ¥åˆå§‹åŒ–
    Foo f5{ 5 };      // ç›´æ¥åˆ—è¡¨åˆå§‹åŒ–ï¼ˆæ¨èï¼‰
    Foo f6 = { 6 };   // æ‹·è´åˆ—è¡¨åˆå§‹åŒ–ï¼ˆä»…é€‚ç”¨äºé explicit æ„é€ å‡½æ•°ï¼‰

    // è°ƒç”¨ Foo(const Foo&) æ‹·è´æ„é€ å‡½æ•°
    Foo f7 = f3;      // æ‹·è´åˆå§‹åŒ–
    Foo f8(f3);       // ç›´æ¥åˆå§‹åŒ–
    Foo f9{ f3 };     // ç›´æ¥åˆ—è¡¨åˆå§‹åŒ–ï¼ˆæ¨èï¼‰
    Foo f10 = { f3 }; // æ‹·è´åˆ—è¡¨åˆå§‹åŒ–

    return 0;
}
```

åœ¨ç°ä»£C++ä¸­,å¤åˆ¶åˆå§‹åŒ–ã€ç›´æ¥åˆå§‹åŒ–å’Œåˆ—è¡¨åˆå§‹åŒ–çš„æœ¬è´¨åšçš„éƒ½æ˜¯åŒä¸€ä»¶äº‹: **åˆå§‹åŒ–ä¸€ä¸ªå¯¹è±¡**ã€‚

å¯¹äºæ‰€æœ‰ç±»å‹çš„åˆå§‹åŒ–:

- åˆå§‹åŒ–ç±»ç±»å‹æ—¶,å°†æ£€æŸ¥è¯¥ç±»çš„æ„é€ å‡½æ•°é›†,å¹¶ä½¿ç”¨é‡è½½è§£ææ¥ç¡®å®šæœ€ä½³åŒ¹é…çš„æ„é€ å‡½æ•°ã€‚è¿™å¯èƒ½æ¶‰åŠå‚æ•°çš„éšå¼è½¬æ¢ã€‚
- åˆå§‹åŒ–éç±»ç±»å‹æ—¶,ç¼–è¯‘å™¨ä¼šä½¿ç”¨**éšå¼è½¬æ¢è§„åˆ™**æ¥æ£€æŸ¥æ˜¯å¦å¯ä»¥å°†æä¾›çš„å€¼è½¬æ¢ä¸ºç›®æ ‡ç±»å‹ã€‚

> åŒæ ·å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼ŒæŸäº›å½¢å¼çš„åˆå§‹åŒ–æ˜¯ä¸å…è®¸çš„ï¼ˆä¾‹å¦‚ï¼Œåœ¨æ„é€ å‡½æ•°æˆå‘˜åˆå§‹åŒ–åˆ—è¡¨ä¸­ï¼Œæˆ‘ä»¬åªèƒ½ä½¿ç”¨ç›´æ¥å½¢å¼çš„åˆå§‹åŒ–ï¼Œè€Œä¸èƒ½å¤åˆ¶åˆå§‹åŒ–ï¼‰ã€‚

---

## ä¸å¿…è¦çš„å¤åˆ¶

è€ƒè™‘ä¸‹é¢çš„ç¨‹åº:

```cpp
#include<iostream>

class Something
{
  int m_x {};
public:
    Something(int x) : m_x{x}
    {
        std::cout <<"Normal constructor called\n";
    }

    Something(const Something& s):m_x {s.m_x}
    {
        std::cout << "Copy constructor\n";
    }

    void print() const
    {
        std::cout << "Something(" << m_x << ")\n";
    }
};

int main()
{
    Something s {Something {6}};
    s.print();

    return 0;
}

```

åœ¨ä¸Šé¢çš„å˜é‡`s`çš„åˆå§‹åŒ–ä¸­,æˆ‘ä»¬é¦–å…ˆæ„é€ ä¸€ä¸ªä¸´æ—¶çš„`Something`,åˆå§‹åŒ–å€¼ä¸º`6`. ç„¶åä½¿ç”¨è¿™ä¸ªä¸´æ—¶å˜é‡æ¥åˆå§‹åŒ–`s`  ,å› ä¸ºä¸´æ—¶å¯¹è±¡å’Œ `s` å…·æœ‰ç›¸åŒçš„ç±»å‹ï¼ˆå®ƒä»¬éƒ½æ˜¯ `Something` å¯¹è±¡ï¼‰ï¼Œæ‰€ä»¥è¿™é‡Œé€šå¸¸ä¼šè°ƒç”¨ `Somethingï¼ˆconst Somethingï¼‰` å¤åˆ¶æ„é€ å‡½æ•°æ¥å°†ä¸´æ—¶å¯¹è±¡ä¸­çš„å€¼å¤åˆ¶åˆ° `s` ä¸­ã€‚æœ€ç»ˆç»“æœæ˜¯ `s` è¢«åˆå§‹åŒ–ä¸ºå€¼ `6`ã€‚

åœ¨**æ²¡æœ‰ä»»ä½•ä¼˜åŒ–**çš„æƒ…å†µä¸‹,ä¸Šé¢çš„ç¨‹åºå°†ä¼šæ‰“å°:

```cpp
Normal constructor
Copy constructor
Something(5)
```

ç„¶è€Œï¼Œè¿™ä¸ªç¨‹åºæ˜¯ä¸å¿…è¦çš„ä½æ•ˆç‡ï¼Œå› ä¸ºæˆ‘ä»¬å¿…é¡»è¿›è¡Œä¸¤æ¬¡æ„é€ å‡½æ•°è°ƒç”¨ï¼šä¸€æ¬¡æ˜¯å¯¹ Somethingï¼ˆintï¼‰ï¼Œå¦ä¸€æ¬¡æ˜¯å¯¹ `Somethingï¼ˆconst Something&ï¼‰`ã€‚è¯·æ³¨æ„ï¼Œä¸Šé¢çš„æœ€ç»ˆç»“æœä¸æˆ‘ä»¬ç¼–å†™ä»¥ä¸‹ä»£ç çš„ç»“æœç›¸åŒï¼š

```cpp
Something s { 5 }; 
```

---

## å¤åˆ¶æ¶ˆé™¤

ç”±äºç¼–è¯‘å™¨å¯ä»¥è‡ªç”±åœ°é‡å†™è¯­å¥æ¥ä¼˜åŒ–å®ƒä»¬ï¼Œäººä»¬å¯èƒ½ä¼šæƒ³ï¼Œç¼–è¯‘å™¨æ˜¯å¦å¯ä»¥ä¼˜åŒ–æ‰ä¸å¿…è¦çš„å‰¯æœ¬ï¼Œå¹¶å°† `Something s { Something{5} }` è§†ä¸ºæˆ‘ä»¬æœ€ç»ˆçš„å†™æ³•ã€‚

ç­”æ¡ˆæ˜¯è‚¯å®šçš„ï¼Œè¿™æ ·åšçš„è¿‡ç¨‹è¢«ç§°ä¸º*å¤åˆ¶çœç•¥* ã€‚ **å¤åˆ¶çœç•¥**æ˜¯ä¸€ç§ç¼–è¯‘å™¨ä¼˜åŒ–æŠ€æœ¯ï¼Œå®ƒå…è®¸ç¼–è¯‘å™¨åˆ é™¤ä¸å¿…è¦çš„å¯¹è±¡å¤åˆ¶ã€‚

æ¢å¥è¯è¯´ï¼Œåœ¨ç¼–è¯‘å™¨é€šå¸¸ä¼šè°ƒç”¨å¤åˆ¶æ„é€ å‡½æ•°çš„æƒ…å†µä¸‹ï¼Œç¼–è¯‘å™¨å¯ä»¥è‡ªç”±åœ°é‡å†™ä»£ç ä»¥å®Œå…¨é¿å…å¯¹å¤åˆ¶æ„é€ å‡½æ•°çš„è°ƒç”¨ã€‚å½“ç¼–è¯‘å™¨ä¼˜åŒ–æ‰å¯¹å¤åˆ¶æ„é€ å‡½æ•°çš„è°ƒç”¨æ—¶ï¼Œæˆ‘ä»¬è¯´è¯¥æ„é€ å‡½æ•°å·²è¢«**çœç•¥** ã€‚

ä¸å…¶ä»–ç±»å‹çš„ä¼˜åŒ–ä¸åŒï¼Œå¤åˆ¶çœç•¥ä¸å—â€œas-ifâ€è§„åˆ™çš„çº¦æŸã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå…è®¸å¤åˆ¶çœç•¥æ¥çœç•¥å¤åˆ¶æ„é€ å‡½æ•°ï¼Œå³ä½¿å¤åˆ¶æ„é€ å‡½æ•°è¿˜ä¼šæ‰§è¡Œå…¶ä»–ä»»åŠ¡ã€‚

è¿™å°±æ˜¯å‰é¢ä¸ºä»€ä¹ˆè¯´ **å¤åˆ¶æ„é€ å‡½æ•°ä¸åº”è¯¥å­˜åœ¨é™¤å¤åˆ¶åŠŸèƒ½ä¹‹å¤–å…¶ä»–æ“ä½œ**çš„åŸå› ã€‚ 

æ‰€ä»¥ä¸Šé¢çš„ç¨‹åºå¦‚æœåœ¨C++17ç¯å¢ƒä¸‹ç¼–è¯‘,é‚£ä¹ˆä½ çš„æ‰“å°å°†å’Œæˆ‘ä¸€æ ·:

![image-20250324175809736](https://images.waer.ltd/notes/202503241758804.png)

---

## **C++17 ä¸­çš„å¼ºåˆ¶å¤åˆ¶çœç•¥**

åœ¨ `C++`17 ä¹‹å‰ï¼Œå¤åˆ¶çœç•¥æ˜¯ç¼–è¯‘å™¨å¯ä»¥è¿›è¡Œçš„ä¸¥æ ¼çš„å¯é€‰ä¼˜åŒ–ã€‚åœ¨ `C++17` ä¸­ï¼Œå¤åˆ¶çœç•¥åœ¨æŸäº›æƒ…å†µä¸‹æ˜¯å¼ºåˆ¶æ€§çš„ã€‚åœ¨è¿™äº›æƒ…å†µä¸‹ï¼Œå¤åˆ¶çœç•¥å°†è‡ªåŠ¨æ‰§è¡Œï¼ˆå³ä½¿æ‚¨å‘Šè¯‰ç¼–è¯‘å™¨ä¸è¦æ‰§è¡Œå¤åˆ¶çœç•¥ï¼‰ã€‚

- åœ¨å¯é€‰çš„çœç•¥æƒ…å†µä¸‹ï¼Œå¯è®¿é—®çš„å¤åˆ¶æ„é€ å‡½æ•°å¿…é¡»å¯ç”¨ï¼ˆä¾‹å¦‚æœªåˆ é™¤ï¼‰ï¼Œå³ä½¿å¯¹å¤åˆ¶æ„é€ å‡½æ•°çš„å®é™…è°ƒç”¨è¢«çœç•¥ã€‚
- åœ¨å¼ºåˆ¶çœç•¥çš„æƒ…å†µä¸‹ï¼Œå¯è®¿é—®çš„å¤åˆ¶æ„é€ å‡½æ•°ä¸éœ€è¦å¯ç”¨ï¼ˆæ¢å¥è¯è¯´ï¼Œå³ä½¿åˆ é™¤äº†å¤åˆ¶æ„é€ å‡½æ•°ï¼Œä¹Ÿä¼šå‘ç”Ÿå¼ºåˆ¶çœç•¥ï¼‰ã€‚

---

## æä¸€å˜´explict

åœ¨ `C++` ä¸­ï¼Œ`explicit` å…³é”®å­—ç”¨äºä¿®é¥°**æ„é€ å‡½æ•°**å’Œ**è½¬æ¢è¿ç®—ç¬¦**ï¼Œå®ƒçš„ä¸»è¦ä½œç”¨æ˜¯**é˜²æ­¢éšå¼è½¬æ¢**ï¼Œç¡®ä¿ç±»çš„å¯¹è±¡ä¸ä¼šè¢«æ„å¤–åœ°ä»å…¶ä»–ç±»å‹çš„å€¼éšå¼æ„é€ ã€‚

- **é»˜è®¤æƒ…å†µä¸‹ï¼Œåº”è¯¥å°†æ‰€æœ‰æ¥å—å•ä¸ªå‚æ•°çš„æ„é€ å‡½æ•°å£°æ˜ä¸º explicitã€‚**
  - è¿™æ ·å¯ä»¥é˜²æ­¢**éšå¼ç±»å‹è½¬æ¢**ï¼Œé¿å…æ„å¤–çš„ç±»å‹è½¬æ¢å¯¼è‡´çš„é”™è¯¯ã€‚
- **å¦‚æœæŸç§ç±»å‹è½¬æ¢åœ¨è¯­ä¹‰ä¸Šæ˜¯åˆç†çš„ï¼Œå¹¶ä¸”æ€§èƒ½ä¸Šæ²¡æœ‰é—®é¢˜ï¼Œåˆ™å¯ä»¥è€ƒè™‘ä¸ä½¿ç”¨ explicitï¼Œå…è®¸éšå¼è½¬æ¢ã€‚**
  - ä¾‹å¦‚ï¼Œå¦‚æœç±» `String` æœ‰ä¸€ä¸ªæ¥å— `const char*` çš„æ„é€ å‡½æ•°ï¼Œå¹¶ä¸”å…è®¸ä» `const char*` éšå¼è½¬æ¢ä¸º `String` æ˜¯åˆç†çš„ï¼Œå¯ä»¥å»æ‰ `explicit`ã€‚
- **ä¸è¦å°†æ‹·è´æ„é€ å‡½æ•°æˆ–ç§»åŠ¨æ„é€ å‡½æ•°å£°æ˜ä¸º explicitï¼Œå› ä¸ºå®ƒä»¬å¹¶ä¸ä¼šè¿›è¡Œç±»å‹è½¬æ¢ã€‚**
  - æ‹·è´æ„é€ `ï¼ˆT(const T&)ï¼‰`å’Œç§»åŠ¨æ„é€ ï¼ˆ`T(T&&)ï¼‰`çš„ä½œç”¨æ˜¯å¤åˆ¶æˆ–ç§»åŠ¨ç›¸åŒç±»å‹çš„å¯¹è±¡ï¼Œè€Œä¸æ˜¯è¿›è¡Œç±»å‹è½¬æ¢ï¼Œå› æ­¤ä¸åº”è¯¥åŠ  `explicit`ï¼Œå¦åˆ™ä¼šå½±å“å¯¹è±¡çš„æ­£å¸¸å¤åˆ¶å’Œç§»åŠ¨æ“ä½œã€‚

ç¤ºä¾‹:

**âœ… æ­£ç¡®ï¼šä½¿ç”¨ explicit é˜²æ­¢éšå¼è½¬æ¢**

```cpp
class Foo
{
public:
    explicit Foo(int x) // âœ… é»˜è®¤åŠ  explicitï¼Œé˜²æ­¢éšå¼è½¬æ¢
    {
        std::cout << "Foo(int) called with " << x << '\n';
    }
};

void printFoo(Foo f) {}

int main()
{
    Foo f1 = 10; // âŒ ç¼–è¯‘é”™è¯¯ï¼šexplicit ç¦æ­¢äº†éšå¼è½¬æ¢
    Foo f2(10);  // âœ… ç›´æ¥åˆå§‹åŒ–å¯ä»¥
    printFoo(10); // âŒ ç¼–è¯‘é”™è¯¯ï¼Œæ— æ³•ä» int éšå¼è½¬æ¢ä¸º Foo
}
```

**âœ… åˆç†å»æ‰ explicit å…è®¸éšå¼è½¬æ¢**

```cpp
class String
{
public:
    String(const char* str) // âœ… å…è®¸ä» const char* éšå¼è½¬æ¢ä¸º String
    {
        std::cout << "String constructor called\n";
    }
};

void printString(String s) {}

int main()
{
    printString("Hello"); // âœ… å…è®¸éšå¼è½¬æ¢
}
```

**âŒ ä¸è¦ç»™æ‹·è´/ç§»åŠ¨æ„é€ å‡½æ•°åŠ  explicit**

```cpp
class Bar
{
public:
    Bar(const Bar&) = default; // âœ… æ­£ç¡®ï¼Œæ‹·è´æ„é€ å‡½æ•°ä¸åº” explicit
    Bar(Bar&&) = default;      // âœ… æ­£ç¡®ï¼Œç§»åŠ¨æ„é€ å‡½æ•°ä¸åº” explicit
};
```

> å¦‚æœåŠ ä¸Š `explicit`ï¼Œå°†ä¼šå¯¼è‡´ `Bar b2 = b1`; æ— æ³•ç¼–è¯‘ã€‚

| **è§„åˆ™**                                    | **è§£é‡Š**                                            |
| ------------------------------------------- | --------------------------------------------------- |
| **å•å‚æ•°æ„é€ å‡½æ•°é»˜è®¤ explicit**             | é˜²æ­¢æ„å¤–çš„éšå¼è½¬æ¢                                  |
| **å¦‚æœéšå¼è½¬æ¢åˆç†ä¸”é«˜æ•ˆï¼Œå¯å»æ‰ explicit** | ä¾‹å¦‚ String(const char*)                            |
| **æ‹·è´/ç§»åŠ¨æ„é€ å‡½æ•°ä¸è¦ explicit**          | è¿™äº›æ„é€ å‡½æ•°ä¸ä¼šæ‰§è¡Œç±»å‹è½¬æ¢ï¼Œé¿å…å½±å“æ­£å¸¸å¤åˆ¶/ç§»åŠ¨ |

