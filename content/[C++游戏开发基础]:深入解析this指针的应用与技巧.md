+++
title = "C++æ¸¸æˆå¼€å‘åŸºç¡€-æ·±å…¥è§£æthisæŒ‡é’ˆçš„åº”ç”¨ä¸æŠ€å·§"
date = 2024-12-15
tags = ["C++", "æ¸¸æˆå¼€å‘"]
description = "è¯¦ç»†ä»‹ç»C++é¢å‘å¯¹è±¡ç¼–ç¨‹ä¸­çš„thisæŒ‡é’ˆ,åŒ…æ‹¬éšè—çš„thisæŒ‡é’ˆã€thisçš„åº•å±‚å®ç°ã€æ˜¾å¼å¼•ç”¨thisç­‰æœ€ä½³å®è·µã€‚"
+++


å¦‚æœä½ æ²¡æœ‰å…¶ä»–é¢å‘å¯¹è±¡çš„ç¼–ç¨‹è¯­è¨€åŸºç¡€,æ¯”å¦‚`Java`ã€`c#`ç­‰,é‚£ä¹ˆä½ åœ¨å­¦ä¹ C++é¢å‘å¯¹è±¡æ—¶å¯èƒ½ä¼šå¥½å¥‡,å½“ä¸€ä¸ªæˆå‘˜å‡½æ•°è¢«è°ƒç”¨çš„æ—¶å€™,C++æ˜¯å¦‚ä½•è·Ÿè¸ªå®ƒè¢«è°ƒç”¨çš„å¯¹è±¡çš„?

è€ƒè™‘ä¸‹é¢çš„ç¨‹åº:

```cpp
#include <iostream>

class Simple
{
private:
    int m_id{};

public:
    Simple(int id)
        : m_id{ id }
    {
    }

    int getID() const { return m_id; }
    void setID(int id) { m_id = id; }

    void print() const { std::cout << m_id; }
};

int main()
{
    Simple simple{1};
    simple.setID(2);

    simple.print();

    return 0;
}
```

å¯¹äºä¸Šè¿°ä»£ç ,å½“æˆ‘ä»¬è°ƒç”¨ `simple.setIDï¼ˆ2ï¼‰;` æ—¶ï¼ŒC++çŸ¥é“å‡½æ•° `setIDï¼ˆï¼‰` åº”è¯¥å¯¹å¯¹è±¡ `simple è¿›è¡Œ`æ“ä½œï¼Œå¹¶ä¸” `m_id` å®é™…ä¸Šå¼•ç”¨äº† `simple.m_id`ã€‚

ä¸ºä»€ä¹ˆä¼šè¿™æ ·?è¿™å› ä¸ºC++ä½¿ç”¨äº†ä¸€ä¸ªåä¸º`this`çš„éšè—æŒ‡é’ˆã€‚

---

## éšè—çš„thisæŒ‡é’ˆ

åœ¨æ¯ä¸€ä¸ªæˆå‘˜å‡½æ•°ä¸­,å…³é”®å­—`this`æ˜¯ä¸€ä¸ªå¸¸é‡æŒ‡é’ˆ,å®ƒä¿å­˜å½“å‰éšå¼å¯¹è±¡çš„åœ°å€ã€‚å› æ­¤,ä¸‹é¢ä¸¤ç§å†™æ³•æ˜¯ç­‰æ•ˆçš„;

```cpp
void print() const {std::cout <<m_id;}
void print() const {std::cout <<this->m_id;}
```

ä½†æ˜¯äº‹å®è¯æ˜,å‰è€…æ˜¯åè€…çš„ç®€å†™ã€‚å½“æˆ‘ä»¬ç¨‹åºç¼–è¯‘æ—¶,ç¼–è¯‘å™¨å°†éšå¼åœ°åœ¨å¼•ç”¨éšå¼å¯¹è±¡çš„ä»»ä½•æˆå‘˜å‰é¢åŠ ä¸Š`this->` ã€‚ è¿™æœ‰åŠ©äºæˆ‘ä»¬çš„ä»£ç è·Ÿæ›´ç®€æ´,è€Œä¸éœ€è¦ä¸€ééçš„é‡å¤`this->`

> æˆ‘ä»¬ä½¿ç”¨ `->` ä»æŒ‡å‘å¯¹è±¡çš„æŒ‡é’ˆä¸­é€‰æ‹©æˆå‘˜ã€‚`this->m_id` ç›¸å½“äº `ï¼ˆ*thisï¼‰.m_id`ã€‚

---

## thisåº•å±‚å®ç°

å›é¡¾ä¸‹é¢å‡½æ•°çš„è°ƒç”¨:

```cpp
simple.setID(2);
```

è™½ç„¶å¯¹å‡½æ•°`setID(2)`çš„è°ƒç”¨è¡¨é¢ä¸Šçœ‹èµ·æ¥å¥½åƒå°±ä¸€ä¸ªå‚æ•°,ä½†å®é™…ä¸Šæœ‰ä¸¤ä¸ªã€‚åœ¨ç¼–è¯‘æ—¶,ç¼–è¯‘å™¨ä¼šé‡å†™è¡¨è¾¾å¼`simple.setID(2)`:

```cpp
Simple::simple(&simple,2);
```

åŒç†,ç”±äºå‡½æ•°çš„è°ƒç”¨ç°åœ¨å¢åŠ äº†ä¸€ä¸ªå‚æ•°,é‚£ä¹ˆæˆå‘˜å‡½æ•°å®šä¹‰ä¹Ÿéœ€è¦è¿›è¡Œè°ƒæ•´ä»¥é€‚åº”æ¥å—æ­¤å‚æ•°ã€‚ä¸‹é¢æ˜¯`setID()`çš„åŸå§‹å®šä¹‰:

```cpp
void setID(int id) {m_id = id;}
```

ç¼–è¯‘å™¨é‡å†™ä¹‹åçš„ç»“æœå¯èƒ½æ˜¯ä¸‹é¢è¿™æ ·çš„:

```cpp
static void setID(Simple* const this,int id)
{
  this->m_id = id;
}
```

âš ï¸æ³¨æ„,é‡å†™åçš„å‡½æ•°å‚æ•°å¤šäº†ä¸€ä¸ª`this`å‚æ•°,å®ƒæ˜¯ä¸€ä¸ªå¸¸é‡æŒ‡é’ˆã€‚ä½¿ç”¨`this`æŒ‡é’ˆ,`m_id`æˆå‘˜ä¹Ÿè¢«é‡å†™ä¸º`this->m_id`;

> åœ¨è¿™ç§æƒ…å†µä¸‹,å…³é”®å­—`static`æ„å‘³ç€å‡½æ•°ä¸ç±»çš„å¯¹è±¡æ— å…³,è€Œæ˜¯è¢«è§†ä¸ºç±»ä½œç”¨åŸŸå†…çš„æ™®é€šå‡½æ•°ã€‚

æ‰€ä»¥æ€»ç»“ä¸€ä¸‹å°±æ˜¯:

- å½“æˆ‘ä»¬è°ƒç”¨ `simple.setIDï¼ˆ2ï¼‰` æ—¶ï¼Œç¼–è¯‘å™¨å®é™…ä¸Šè°ƒç”¨ `Simpleï¼šï¼šsetIDï¼ˆsimpleï¼Œ2ï¼‰`ï¼Œ`simple` é€šè¿‡åœ°å€ä¼ é€’ç»™å‡½æ•°ã€‚
- å‡½æ•°æœ‰ä¸€ä¸ªåä¸º `this çš„`éšè—å‚æ•°ï¼Œå®ƒæ¥æ”¶ `simple` çš„åœ°å€ã€‚
- `setIDï¼ˆï¼‰`ä¸­çš„æˆå‘˜å˜é‡ä»¥ `this-> ä¸º`å‰ç¼€ï¼Œå®ƒæŒ‡å‘ `simple`ã€‚å› æ­¤ï¼Œå½“ç¼–è¯‘å™¨`è®¡ç®—`->m_idæ—¶ ï¼Œå®ƒå®é™…ä¸Šæ˜¯è§£æä¸º `simple.m_id`ã€‚

> åœ¨ C++ ä¸­ï¼Œæ‰€æœ‰éé™æ€æˆå‘˜å‡½æ•°ï¼ˆå³ç±»çš„æˆå‘˜å‡½æ•°ï¼‰éƒ½æœ‰ä¸€ä¸ªéšå«çš„æŒ‡é’ˆ thisï¼Œå®ƒæŒ‡å‘å½“å‰å¯¹è±¡ï¼ˆå³è°ƒç”¨è¯¥æˆå‘˜å‡½æ•°çš„å¯¹è±¡ï¼‰çš„åœ°å€ã€‚

**éé™æ€æˆå‘˜å‡½æ•°**ï¼š

éé™æ€æˆå‘˜å‡½æ•°æ˜¯ä¸æŸä¸ªå…·ä½“å¯¹è±¡ç›¸å…³çš„å‡½æ•°ï¼Œå®ƒä»¬ä¾èµ–äºå¯¹è±¡çš„çŠ¶æ€ï¼ˆæˆå‘˜å˜é‡ï¼‰ã€‚è¿™äº›å‡½æ•°ä¸èƒ½ç‹¬ç«‹äºç±»çš„å¯¹è±¡å­˜åœ¨ï¼Œéœ€è¦é€šè¿‡å¯¹è±¡æ¥è°ƒç”¨ã€‚

---

## æ˜¾å¼çš„å¼•ç”¨this

å¤§å¤šæ•°æ—¶å€™,æˆ‘ä»¬ä¸éœ€è¦æ˜¾å¼çš„å¼•ç”¨`this`ã€‚ ä½†æ˜¯,åœ¨ä¸€äº›ç‰¹å®šæƒ…å†µä¸‹è¿™æ ·åšæ˜¯ä¸ªä¸é”™çš„é€‰æ‹©ã€‚

é¦–å…ˆ,å¦‚æœä½ æœ‰ä¸€ä¸ªæˆå‘˜å‡½æ•°,å®ƒæœ‰ä¸€ä¸ªä¸æ•°æ®æˆå‘˜åŒåçš„å‚æ•°,é‚£ä¹ˆä½ å¯ä»¥é€šè¿‡è¿™ç§æ–¹å¼æ¥æ¶ˆé™¤æ­§ä¹‰:

```cpp
struct Something
{
    int data{}; 

    void setData(int data)
    {
        this->data = data; 
    }
};
```

è¿™ä¸ª `Something` ç±»æœ‰ä¸€ä¸ªåä¸º `data çš„`æˆå‘˜ã€‚`setDataï¼ˆï¼‰` çš„å‡½æ•°å‚æ•°ä¹Ÿè¢«å‘½åä¸º `data`ã€‚åœ¨ `setDataï¼ˆï¼‰` å‡½æ•°ä¸­ï¼Œ`data` å¼•ç”¨å‡½æ•°å‚æ•°ï¼ˆå› ä¸ºå‡½æ•°å‚æ•°éšè—äº†æ•°æ®æˆå‘˜ï¼‰ï¼Œæ‰€ä»¥å¦‚æœæˆ‘ä»¬æƒ³å¼•ç”¨`æ•°æ®`æˆå‘˜ï¼Œå¯ä»¥ä½¿ç”¨ `this->data`ã€‚

æœ‰äº›ç¨‹åºå‘˜ä¹ æƒ¯ä½¿ç”¨è¿™æ ·çš„å†™æ³•,å¯èƒ½æ˜¯ç”±äºJavaçš„ä¹ æƒ¯,ä½†æ˜¯åœ¨C++ä¸­,å¹¶ä¸å»ºè®®è¿™æ ·åš,è¿˜æ˜¯æ¨èä¹‹å‰è¯´è¿‡çš„ä½¿ç”¨`m_`å‰ç¼€æ¥åŒºåˆ†ç§æœ‰æˆå‘˜å’Œéæˆå‘˜å˜é‡ã€‚

å…¶æ¬¡,æœ‰æ—¶è®©æˆå‘˜å‡½æ•°å°†éšå¼å¯¹è±¡ä½œä¸ºè¿”å›å€¼è¿”å›ä¹Ÿæ˜¯å¾ˆæœ‰ç”¨çš„ã€‚è¿™æ ·åšçš„ä¸»è¦åŸå› æ˜¯å…è®¸æˆå‘˜å‡½æ•°å¯ä»¥è¢«é“¾å¼è°ƒç”¨ã€‚

è¿™è¢«ç§°ä¸º **å‡½æ•°é“¾æˆ–è€…æ–¹æ³•é“¾** ;

è€ƒè™‘ä¸‹é¢çš„ä¾‹å­:

```cpp
class Calc
{
private:
    int m_value{};

public:

    void add(int value) { m_value += value; }
    void sub(int value) { m_value -= value; }
    void mult(int value) { m_value *= value; }

    int getValue() const { return m_value; }
};
```

åŸºäºä¸Šè¿°å†™æ³•,å¦‚æœä½ ç°åœ¨æƒ³è¦æ‰§è¡ŒåŠ 6å‡2ä¹˜ä»¥3,é‚£ä¹ˆä½ å¿…é¡»è¿™æ ·åš:

```cpp
#include <iostream>

int main()
{
    Calc calc{};
    calc.add(2); 
    calc.sub(2); 
    calc.mult(3); 

    std::cout << calc.getValue() << '\n';

    return 0;
}
```

ä½†æ˜¯,å¦‚æœæˆ‘ä»¬é€šè¿‡å¼•ç”¨ä½¿æ¯ä¸ªå‡½æ•°è¿”å›`*this`,å°±å¯ä»¥å°†è°ƒç”¨é“¾æ¥åœ¨ä¸€èµ·ã€‚

```cpp
class Calc
{
private:
    int m_value{};

public:
    Calc& add(int value) { m_value += value; return *this; }
    Calc& sub(int value) { m_value -= value; return *this; }
    Calc& mult(int value) { m_value *= value; return *this; }

    int getValue() const { return m_value; }
};
```

å› æ­¤,æˆ‘ä»¬å¯ä»¥åƒä¸‹é¢è¿™æ ·è¿›è¡Œé“¾å¼è°ƒç”¨:

```cpp
#include <iostream>

int main()
{
    Calc calc{};
    calc.add(6).sub(2).mult(3); 

    std::cout << calc.getValue() << '\n';

    return 0;
}
```

é¦–å…ˆï¼Œè°ƒç”¨ `calc.addï¼ˆ5ï¼‰`ï¼Œå®ƒå°† `m_value` åŠ ä¸Š `5`ã€‚`addï¼ˆï¼‰` ç„¶åè¿”å›ä¸€ä¸ªå¯¹ `*this çš„`å¼•ç”¨ï¼Œè¿™æ˜¯å¯¹éšå¼å¯¹è±¡ `calc` çš„å¼•ç”¨ï¼Œå› æ­¤ `calc` å°†æ˜¯åç»­è®¡ç®—ä¸­ä½¿ç”¨çš„å¯¹è±¡ã€‚ä¸‹ä¸€ä¸ª `calc.subï¼ˆ3ï¼‰` æ±‚å€¼ï¼Œä» `m_value` ä¸­å‡å» `3`ï¼Œå¹¶å†æ¬¡è¿”å› `calc . sub`ï¼ˆ3ï¼‰ã€‚æœ€åï¼Œ`calc.multï¼ˆ4ï¼‰` å°† `m_value` ä¹˜ä»¥ `4` å¹¶è¿”å› `calc`ï¼Œå®ƒä¸ä¼šè¢«è¿›ä¸€æ­¥ä½¿ç”¨ï¼Œå› æ­¤è¢«å¿½ç•¥ã€‚

ç”±äºæ¯ä¸ªå‡½æ•°åœ¨æ‰§è¡Œæ—¶éƒ½ä¼šä¿®æ”¹ `calc`ï¼Œ` å› æ­¤ calc` çš„ `m_value` ç°åœ¨åŒ…å«å€¼ï¼ˆ0 + 5ï¼‰- 3ï¼‰* 4ï¼‰ï¼Œå³ `8`ã€‚

> å› ä¸º`å®ƒ`æ€»æ˜¯æŒ‡å‘éšå¼å¯¹è±¡ï¼Œæ‰€ä»¥åœ¨è§£å¼•ç”¨å®ƒä¹‹å‰ï¼Œæˆ‘ä»¬ä¸éœ€è¦æ£€æŸ¥å®ƒæ˜¯å¦æ˜¯ç©ºæŒ‡é’ˆã€‚

---

## é‡ç½®ç±»çš„é»˜è®¤çŠ¶æ€

å¦‚æœä½ çš„ç±»æœ‰ä¸€ä¸ªé»˜è®¤çš„æ„é€ å‡½æ•°,ä½ å¯èƒ½ä¼šæä¾›ä¸€ç§æ–¹æ³•æ¥å°†ç°æœ‰çš„å¯¹è±¡é‡ç½®åˆ°å®ƒé»˜è®¤çš„çŠ¶æ€ã€‚ä½†æ˜¯ä¹‹å‰è¯´è¿‡,æ„é€ å‡½æ•°ä»…ç”¨äºåˆå§‹åŒ–æ–°å¯¹è±¡,ä¸åº”ç›´æ¥è°ƒç”¨ã€‚è¿™æ ·åšä¼šå¯¼è‡´æ„å¤–çš„è¡Œä¸ºã€‚

æ‰€ä»¥è¦å®ç°ä¸Šé¢é‡ç½®çŠ¶æ€çš„éœ€æ±‚,æœ€ä½³çš„æ–¹æ³•æ˜¯åˆ›å»ºä¸€ä¸ªç±»ä¼¼äº`reset()`è¿™æ ·çš„å‡½æ•°, è®©è¯¥å‡½æ•°åˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡(ä½¿ç”¨é»˜è®¤æ„é€ å‡½æ•°),ç„¶åå°†è¯¥æ–°å¯¹è±¡å¤åˆ¶ç»™å½“å‰éšå¼å¯¹è±¡ã€‚

```cpp
void reset()
{
  *this = {};
}
```

ä¸‹é¢æ˜¯ä¸€ä¸ªå®Œæ•´çš„ç¤ºä¾‹:

```cpp
#include <iostream>

class Calc
{
private:
    int m_value{};

public:
    Calc& add(int value) { m_value += value; return *this; }
    Calc& sub(int value) { m_value -= value; return *this; }
    Calc& mult(int value) { m_value *= value; return *this; }

    int getValue() const { return m_value; }

    void reset() { *this = {}; }
};


int main()
{
    Calc calc{};
    calc.add(5).sub(3).mult(4);

    std::cout << calc.getValue() << '\n'; // prints 8

    calc.reset();

    std::cout << calc.getValue() << '\n'; // prints 0

    return 0;
}
```

---

## thiså’Œconstå¯¹è±¡çš„å…³ç³»

- å¯¹äºé`const`æˆå‘˜å‡½æ•°,`this`æ˜¯ä¸€ä¸ªæŒ‡å‘é`const`å€¼çš„`cosn`æŒ‡é’ˆã€‚(è¿™æ„å‘³ç€`this`ä¸èƒ½æŒ‡å‘å…¶ä»–å¯¹è±¡,ä½†æŒ‡å‘çš„å¯¹è±¡å¯ä»¥è¢«ä¿®æ”¹)ã€‚

- å¯¹äº`const`æˆå‘˜å‡½æ•°,`this`æ˜¯ä¸€ä¸ªæŒ‡å‘`const`å€¼çš„`const`æŒ‡é’ˆ(æ„å‘³ç€æŒ‡é’ˆä¸èƒ½æŒ‡å‘å…¶ä»–å¯¹è±¡,ä¹Ÿä¸èƒ½ä¿®æ”¹è¢«æŒ‡å‘çš„å¯¹è±¡)ã€‚

## ä¸ºä»€ä¹ˆthisæ˜¯æŒ‡é’ˆè€Œä¸æ˜¯å¼•ç”¨?

å’ŒJavaä»¥åŠC#ä¸åŒ,`this`åœ¨C++ä¸­å‡ºç°çš„æ—¶å€™,`C++`è¿˜æ²¡æœ‰å¼•å…¥å¼•ç”¨è¿™ç§ä¸œè¥¿(ğŸ¤ª)!

---

## å¾€æœŸæ¨è

- [æ¸¸æˆç®—æ³•åŸºç¡€- Aæ˜Ÿå¯»è·¯](https://www.ilikexff.cn/articles/163)
- [æ„é€ å‡½æ•°8000å­—é•¿æ–‡æµ…æ](https://www.ilikexff.cn/articles/161)

