



+++
title = "Dockerå¿…çŸ¥å¿…ä¼š"
date = 2023-02-04
tags = ["Docker", "å®¹å™¨åŒ–æŠ€æœ¯", "è¿ç»´"]
categories = ["è¿ç»´æŠ€æœ¯"]
description = "å…¨é¢ä»‹ç» Docker çš„å®‰è£…ã€å¸¸ç”¨å‘½ä»¤ã€é•œåƒä¸å®¹å™¨ç®¡ç†ã€Dockerfile ç¼–å†™ã€ç½‘ç»œé…ç½®ã€Compose ç¼–æ’ä»¥åŠ Portainer ç®¡ç†å·¥å…·ç­‰å†…å®¹ã€‚"
+++

### æ›´æ–°æ—¥å¿—ğŸ‰

2023-2-4

> - ä¿®æ­£äº†å·²çŸ¥çš„é”™åˆ«å­—è¯
> - é‡æ–°è°ƒæ•´å…¨éƒ¨é…å›¾çš„ä¸Šä¼ æº(ä¸ƒç‰›äº‘)
> - è°ƒæ•´æ’ç‰ˆã€ä¼˜åŒ–å¸ƒå±€æ ¼å¼

> - æ–°å¢dockerç½‘ç»œ
> - æ–°å¢ Compose
> - æ–°å¢ Portainer


2022-8-14

> - æ–°å¢`docker`[æ•°æ®å·]å†…å®¹
> - ä¿®æ­£äº†ä¸€äº›å·²çŸ¥çš„é”™è¯¯

2022-8-15

> - æ–°å¢`docker`å¸¸è§„è½¯ä»¶çš„å®‰è£…(`docker`è¸¢é¦†è®°)

2022-8-26

> - æ–°å¢`Dockerfile`éƒ¨åˆ†çš„å†…å®¹

---

---

## å®‰è£…docker

**å®‰è£…ï¼š**

**Docker åˆ†ä¸º CE å’Œ EE ä¸¤å¤§ç‰ˆæœ¬ã€‚CE å³ç¤¾åŒºç‰ˆï¼ˆå…è´¹ï¼Œæ”¯æŒå‘¨æœŸ 7 ä¸ªæœˆï¼‰ï¼ŒEE å³ä¼ä¸šç‰ˆï¼Œå¼ºè°ƒå®‰å…¨ï¼Œä»˜è´¹ä½¿ç”¨ï¼Œæ”¯æŒå‘¨æœŸ 24 ä¸ªæœˆã€‚**

**Docker CE åˆ†ä¸º **`stable`ï¼Œ`test` å’Œ `nightly` ä¸‰ä¸ªæ›´æ–°é¢‘é“ã€‚

**å®˜æ–¹ç½‘ç«™ä¸Šæœ‰å„ç§ç¯å¢ƒä¸‹çš„**[å®‰è£…æŒ‡å—](https://docs.docker.com/install/)ï¼Œè¿™é‡Œä¸»è¦ä»‹ç» `DockerCE `åœ¨ `CentOS`ä¸Šçš„å®‰è£…ã€‚

### å®‰è£…å‰å¸è½½

**å¦‚æœä¹‹å‰å®‰è£…è¿‡æ—§ç‰ˆæœ¬çš„Dockerï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢å‘½ä»¤å¸è½½ï¼š**

```
yum remove docker \
                  docker-client \
                  docker-client-latest \
                  docker-common \
                  docker-latest \
                  docker-latest-logrotate \
                  docker-logrotate \
                  docker-selinux \
                  docker-engine-selinux \
                  docker-engine \
                  docker-ce
```

**é¦–å…ˆéœ€è¦å¤§å®¶è™šæ‹Ÿæœºè”ç½‘ï¼Œå®‰è£…yumå·¥å…·**

```
yum install -y yum-utils \
           device-mapper-persistent-data \
           lvm2 --skip-broken
```

**ç„¶åæ›´æ–°æœ¬åœ°é•œåƒæºï¼š**

```
# è®¾ç½®dockeré•œåƒæº
yum-config-manager \
    --add-repo \
    https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo
    
sed -i 's/download.docker.com/mirrors.aliyun.com\/docker-ce/g' /etc/yum.repos.d/docker-ce.repo

yum makecache fast
```

**ç„¶åè¾“å…¥å‘½ä»¤ï¼š**

```
yum install -y docker-ce
```

**ç¨ç­‰ç‰‡åˆ»ï¼Œdockerå³å¯å®‰è£…æˆåŠŸã€‚**

### æ¼”ç¤ºdemo

**æŒ‰ç…§å®˜ç½‘**[https://docs.docker.com/engine/install/centos/](https://docs.docker.com/engine/install/centos/)çš„æ–‡æ¡£åœ°å€ï¼Œå®Œæˆdockerçš„å¯åŠ¨ã€è¿è¡Œ`hello-world`demoçš„ç¤ºä¾‹,è¿›ä¸€æ­¥ä½“éªŒä»¥åŠ æ·±ç†è§£ã€‚

## å¸è½½docker

**æŒ‰ç…§ä¸‹é¢çš„æ­¥éª¤å¸è½½docker**

```
# 1.
yum remove docker-ce docker-ce-cli containerd.io docker-compose-plugin
# 2.
rm -rf /var/lib/docker
# 3.
rm -rf /var/lib/containerd
```

> **å¸è½½æ‰§è¡Œä¹‹å‰å»ºè®®å…ˆåœæ­¢docker**
>
> `systemctl stop docker`

## é…ç½®é˜¿é‡Œäº‘é•œåƒåŠ é€Ÿ

> **é¦–å…ˆå»é˜¿é‡Œäº‘å®˜ç½‘è·å–è‡ªå·±çš„åŠ é€Ÿåœ°å€ã€‚**

[https://cr.console.aliyun.com/cn-hangzhou/instances/mirrors](https://cr.console.aliyun.com/cn-hangzhou/instances/mirrors)

**æŒ‰ç…§å®˜æ–¹æä¾›çš„æ­¥éª¤è¿›è¡Œé•œåƒåœ°å€çš„ä¿®æ”¹ï¼š**

![image-20220812120103204](https://b3logfile.com/file/2022/08/solo-fetchupload-11920706785547519347-da3282cd.png)

```
sudo mkdir -p /etc/docker
sudo tee /etc/docker/daemon.json <<-'EOF'
{
  "registry-mirrors": ["https://zjv4zmyk.mirror.aliyuncs.com"]
}
EOF
sudo systemctl daemon-reload
sudo systemctl restart docker
```

**ä¸Šé¢æ‰§è¡Œä¹‹åè¿è¡Œä¸‹é¢çš„å‘½ä»¤ï¼Œæ‰§è¡Œ**`hello-world`ç¨‹åºã€‚

```
docker run hello-world
```

![image-20220812120510723](https://b3logfile.com/file/2022/08/solo-fetchupload-5299290355025351570-8d428af0.png)

> **å¦‚ä¸Šè¡¨ç¤ºæˆåŠŸè¿è¡Œï¼**

**runçš„å·¥ä½œæµç¨‹**

![image-20220812120754486](https://b3logfile.com/file/2022/08/solo-fetchupload-16566290565199026087-d055b8cd.png)

## Dockerå¸¸ç”¨å‘½ä»¤

### å¸®åŠ©å¯åŠ¨ç±»å‘½ä»¤

> **é¡¾åæ€ä¹‰ï¼Œè¿™ç±»å‘½ä»¤ä¸€èˆ¬ç”¨æ¥å¸®åŠ©å¯åŠ¨å’Œç®¡ç†`docker`å®¹å™¨çš„ã€‚**

```
# å¯åŠ¨docker
systemctl start docker
# åœæ­¢docker
systemctl stop docker
# é‡å¯dcoker
systemctl restart docker
# æŸ¥çœ‹dockerçŠ¶æ€
systemctl status docker
# å¼€æœºå¯åŠ¨
systemctl enable docker
# æŸ¥çœ‹dockeræ¦‚è¦ä¿¡æ¯
docker info
# æŸ¥çœ‹dockerå¸®åŠ©å‘½ä»¤
docker --help
# å…·ä½“çš„å‘½ä»¤å¸®åŠ©
docker å…·ä½“çš„å‘½ä»¤ --help
```

### é•œåƒå‘½ä»¤

> **é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯ç”¨æ¥æ“ä½œå’Œç®¡ç†dockeré•œåƒçš„å‘½ä»¤ã€‚**

```
# æ˜¾ç¤ºæœ¬æœºä¸Šçš„é•œåƒ
docker images [options]
# options:
- a åˆ—å‡ºæ‰€æœ‰æœ¬åœ°é•œåƒ(å«å†å²é•œåƒå±‚)
- q åªæ˜¾ç¤ºé•œåƒID 
# â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
# æœç´¢é•œåƒ
docker search é•œåƒåç§°
# options
--limit number é•œåƒåç§° é»˜è®¤æ˜¾ç¤ºç‚¹èµæ•°é«˜çš„å‰numberä¸ªæœç´¢ç»“æœ
# è¿œç¨‹æ‹‰å–é•œåƒï¼Œå¦‚æœé•œåƒåç§°åé¢ä¸æŒ‡å®šç‰ˆæœ¬å·TAGï¼Œå°±ä¼šé»˜è®¤æ‹‰å–æœ€æ–°ç‰ˆ
docker pull é•œåƒåç§°
# æŸ¥çœ‹é•œåƒ/å®¹å™¨/æ•°æ®å·æ‰€å çš„ç©ºé—´
docker system df
# åˆ é™¤æŸä¸ªé•œåƒ
# å¼ºåˆ¶åˆ é™¤åŠ ä¸Š-få‚æ•°
docker rmi é•œåƒåç§°æˆ–è€…ID
# å…¨éƒ¨åˆ é™¤çš„å‘½ä»¤
docker rmi -f $(docker images -qa)[æ…ç”¨]
```

**é¢è¯•é¢˜**

* **è°ˆè°ˆä»€ä¹ˆæ˜¯dockerè™šæ‚¬é•œåƒï¼Ÿ**

> **ä»“åº“åã€æ ‡ç­¾éƒ½æ˜¯**<none>**çš„é•œåƒï¼Œä¿—ç§°è™šæ‚¬é•œåƒ**`dangling images`

---

### å®¹å™¨å‘½ä»¤

> **é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯ç”¨æ¥æ“ä½œå’Œç®¡ç†`docker`æ¯ä¸€ä¸ªå…·ä½“å®¹å™¨çš„å‘½ä»¤ã€‚**
>
> **è¿™é‡Œä»¥æ“ä½œ`ubuntu`å®¹å™¨ä½œä¸ºæ¼”ç¤ºå®ä¾‹ã€‚**

**å‚æ•°è¯´æ˜**

> **â€”name=â€œå®¹å™¨çš„æ–°åå­—â€ ä¸ºå®¹å™¨æŒ‡å®šä¸€ä¸ªåç§°ï¼Œä¸æŒ‡å®šä¼šéšæœºåˆ†é…ä¸€ä¸ª**
>
> **-d: åå°è¿è¡Œå®¹å™¨å¹¶è¿”å›å®¹å™¨çš„IDï¼Œä¹Ÿå°±æ˜¯å¯åŠ¨å®ˆæŠ¤å¼å®¹å™¨(å®ˆæŠ¤è¿›ç¨‹ã€åå°è¿è¡Œ)**
>
> **-iï¼šä»¥äº¤äº’æ¨¡å¼è¿è¡Œå®¹å™¨ï¼Œé€šå¸¸ä¸-tå‚æ•°ä¸€èµ·ä½¿ç”¨**
>
> **-t: ä¸ºå®¹å™¨åˆ›æ–°åˆ†é…ä¸€ä¸ªä¼ªè¾“å…¥ç»ˆç«¯ï¼Œé€šå¸¸ä¸`-i`ä¸€èµ·ä½¿ç”¨**
>
> **-P ï¼šéšæœºç«¯å£æ˜ å°„ï¼Œ**
>
> **-p:æŒ‡å®šç«¯å£æ˜ å°„(å¦‚ï¼š-p 8080:8080)**

```
# è¿è¡Œå®¹å™¨
docker run [å‚æ•°options]
```

**éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç”±äºUbuntuæœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªæ“ä½œç³»ç»Ÿï¼Œå¦‚æœéœ€è¦ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨**`-it`å‚æ•°è¿›å…¥äº¤äº’è¿è¡Œæ¨¡å¼ï¼Œå®¹å™¨å¯åŠ¨åï¼Œä¼šå¼¹å‡ºä¸€ä¸ªå±äº`ubuntu`çš„æ“ä½œç»ˆç«¯ã€‚

![image-20220812160349423](https://b3logfile.com/file/2022/08/solo-fetchupload-10926752778261890752-2d85349c.png)

> **æ³¨æ„åé¢çš„**`/bin/bash`ç”¨æ¥æŒ‡å®šäº¤äº’ä½¿ç”¨çš„`shell`ç±»å‹ã€‚
>
> **å¦‚æœéœ€è¦é€€å‡ºå®¹å™¨äº¤äº’ï¼Œä½¿ç”¨**`exit`å‘½ä»¤ã€‚

```
# æŸ¥çœ‹dockerå®¹å™¨è¿è¡Œæƒ…å†µ
docker ps [options]
```

* **options**

> **-a åˆ—å‡ºå½“å‰æ‰€æœ‰æ­£åœ¨è¿è¡Œçš„å®¹å™¨å’Œå†å²è¿è¡Œè¿‡çš„å®¹å™¨**
>
> **-l æ˜¾ç¤ºæœ€è¿‘åˆ›å»ºçš„å®¹å™¨**
>
> **-n æ˜¾ç¤ºæœ€è¿‘nä¸ªåˆ›å»ºçš„å®¹å™¨**
>
> **-q é™é»˜æ¨¡å¼ï¼Œåªæ˜¾ç¤ºå®¹å™¨çš„ç¼–å·**
>
> **æ›´å¤šå‘½ä»¤è¯·å‚è€ƒhelp**

```
# é‡å¯å®¹å™¨
docker restart å®¹å™¨IDæˆ–åç§°
# åœæ­¢å®¹å™¨
docker stop å®¹å™¨IDæˆ–åç§°
#å¼ºåˆ¶åœæ­¢å®¹å™¨
docker kill å®¹å™¨IDæˆ–åç§°
# åˆ é™¤å®¹å™¨
docker rm å®¹å™¨IDæˆ–åç§°
# ä¸€æ¬¡æ€§åˆ é™¤å¤šä¸ªå®¹å™¨
docker rm -f$(docker ps -a -q)
docker ps -a -q | xargs docker rm
# æŸ¥çœ‹è¿è¡Œå®¹å™¨çš„æ—¥å¿—
docker logs å®¹å™¨IDæˆ–åç§°
# æŸ¥çœ‹å®¹å™¨å†…éƒ¨è¿è¡Œç»†èŠ‚
docker inspect å®¹å™¨ID
# åå°è¿è¡Œæ¨¡å¼è¿›å…¥å®¹å™¨å†…éƒ¨
1.docker exec -it å®¹å™¨ID æ“ä½œçš„shelç±»å‹(æ¯”å¦‚`bash`æˆ–è€…`zsh`)
2.docker attach å®¹å™¨ID
```

> **æ¨èä½¿ç”¨`docker exec`è€Œä¸æ˜¯`attach`ï¼Œå› ä¸ºé€€å‡ºç»ˆç«¯ä¸ä¼šé€€å‡ºå®¹å™¨.**
>
> **`attach`ä¸ä¼šå¯åŠ¨æ–°è¿›ç¨‹ï¼Œexité€€å‡ºä¼šå¯¼è‡´å®¹å™¨åœæ­¢ï¼Œè€Œexecåˆ™æ²¡æœ‰è¿™ç§é—®é¢˜ã€‚**

**é—®é¢˜**

**æœ‰æ—¶å€™ä½¿ç”¨-dåå°è¿è¡Œä¸€ä¸ªå®¹å™¨ä¹‹åï¼Œåœ¨ä½¿ç”¨docker psæŸ¥çœ‹å‘ç°å¹¶æ²¡æœ‰è¿è¡Œè®°å½•ï¼Œä¹Ÿå°±æ˜¯å·²ç»é€€å‡ºï¼Œè¿™æ˜¯ä»€ä¹ˆæƒ…å†µï¼Ÿ**

> **docker å®¹å™¨åå°è¿è¡Œï¼Œå¿…é¡»æœ‰ä¸€ä¸ªå‰å°è¿›ç¨‹ï¼Œå®¹å™¨è¿è¡Œçš„å‘½ä»¤å¦‚æœä¸æ˜¯å“ªäº›ä¸€ç›´æŒ‚èµ·çš„å‘½ä»¤(top,tailç­‰),å°±ä¼šè‡ªåŠ¨é€€å‡ºçš„ã€‚**
>
> **æ‰€ä»¥å¯ä»¥é€šè¿‡äº¤äº’æ¨¡å¼è¿è¡Œã€‚**

**ä»å®¹å™¨æ‹·è´æ–‡ä»¶åˆ°ä¸»æœº**

```
docker cp å®¹å™¨IDï¼šå®¹å™¨å†…è·¯å¾„ ç›®çš„ä¸»æœºè·¯å¾„
```

> **æ³¨æ„è¯¥æ“ä½œæ˜¯åœ¨ä¸»æœºä¸Šè¿›è¡Œã€‚**

**å¯¼å…¥/å¯¼å‡ºå®¹å™¨**

* **export**

> **å¯¼å‡ºå®¹å™¨çš„å†…å®¹æµä½œä¸ºä¸€ä¸ªtarå½’æ¡£æ–‡ä»¶**

* **import**

> **ä»taråŒ…ä¸­çš„å†…å®¹åˆ›å»ºä¸€ä¸ªæ–°çš„æ–‡ä»¶ç³»ç»Ÿï¼Œå†å¯¼å…¥ä¸ºé•œåƒ**

* **å‘½ä»¤æ“ä½œ**

```
# å¯¼å‡º
docker export å®¹å™¨ID > æ–‡ä»¶å.tar
# å¯¼å…¥
cat æ–‡ä»¶å.tar | docker import -é•œåƒç”¨æˆ·/åï¼šç‰ˆæœ¬å·
```

![image-20220812173159310](https://b3logfile.com/file/2022/08/solo-fetchupload-7663123706109863513-ccc4b8a9.png)

---

## Dockeré•œåƒ(åŸºç¡€ç†è®º)

### é•œåƒçš„æ¦‚å¿µ

é•œåƒæ˜¯ä¸€ç§è½»é‡çº§ã€å¯æ‰§è¡Œçš„ç‹¬ç«‹è½¯ä»¶åŒ…ï¼Œå®ƒåŒ…å«äº†æŸä¸ªè½¯ä»¶æ‰€éœ€è¦çš„æ‰€æœ‰å†…å®¹ï¼Œæˆ‘ä»¬æŠŠåº”ç”¨ç¨‹åºå’Œé…ç½®ä¾èµ–æ‰“åŒ…å¥½ï¼Œå½¢æˆä»¥ä¸€ä¸ªå¯äº¤ä»˜çš„è¿è¡Œç¯å¢ƒï¼Œè¿™ä¸ªæ‰“åŒ…å¥½çš„ç¯å¢ƒå°±æ˜¯`image`é•œåƒï¼Œå…¶ä¸­åŒ…å«äº†**ä»£ç ã€è¿è¡Œæ—¶æ‰€éœ€çš„åº“ã€ç¯å¢ƒå˜é‡å’Œé…ç½®æ–‡ä»¶ç­‰**å†…å®¹ã€‚**åªæœ‰é€šè¿‡è¿™ä¸ªé•œåƒæ–‡ä»¶æ‰èƒ½ç”Ÿæˆ`Docker`å®¹å™¨å®ä¾‹ã€‚**

### æ–‡ä»¶è”åˆç³»ç»Ÿ(`UnionFS`)

**`UnionFS`æ˜¯ä¸€ç§åˆ†å±‚ã€è½»é‡çº§å¹¶ä¸”é«˜æ€§èƒ½çš„æ–‡ä»¶ç³»ç»Ÿï¼Œæ”¯æŒ**å¯¹æ–‡ä»¶ç³»ç»Ÿçš„ä¿®æ”¹ä½œä¸ºä¸€æ¬¡æäº¤æ¥ä¸€å±‚å±‚çš„å åŠ ã€‚åŒæ—¶å¯ä»¥å°†ä¸åŒç›®å½•æŒ‚è½½åˆ°åŒä¸€ä¸ªè™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿä¸‹ã€‚

**`UnionFS`æ–‡ä»¶ç³»ç»Ÿä¹Ÿæ˜¯`docker`é•œåƒçš„åŸºç¡€ã€‚é•œåƒå¯ä»¥é€šè¿‡åˆ†å±‚æ¥è¿›è¡Œç»§æ‰¿ï¼Œå¦‚æ­¤å°±å¯ä»¥åŸºäºåŸºç¡€é•œåƒæ¥åˆ¶ä½œå„ç§å…·ä½“çš„åº”ç”¨é•œåƒã€‚**

**ä¸€æ¬¡å¯ä»¥åŒæ—¶åŠ è½½å¤šä¸ªæ–‡ä»¶ç³»ç»Ÿï¼Œä½†ä»å¤–é¢çœ‹èµ·æ¥ï¼Œåªèƒ½çœ‹åˆ°ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿï¼Œè”åˆåŠ è½½ä¼šæŠŠå„å±‚æ–‡ä»¶ç³»ç»Ÿå åŠ èµ·æ¥ï¼Œè¿™æ ·æœ€ç»ˆçš„æ–‡ä»¶ç³»ç»Ÿä¼šåŒ…å«æ‰€æœ‰åº•å±‚çš„æ–‡ä»¶å’Œç›®å½•ã€‚**

### é•œåƒåŠ è½½åŸç†

`Docker`çš„é•œåƒå®é™…ä¸Šæ˜¯ç”±ä¸€å±‚å±‚çš„æ–‡ä»¶ç³»ç»Ÿç»„æˆï¼Œå³å‰é¢æåˆ°çš„`UnionFS`ã€‚

**å‡ ä¸ªæœ¯è¯­çš„æ¦‚å¿µ**

* `bootfs(boot file system)`

**ä¸»è¦åŒ…å«**`bootloader`å’Œ`kernel,bootloader`ä¸»è¦æ˜¯å¼•å¯¼åŠ è½½`kernel,Linux`åˆšå¯åŠ¨æ—¶ä¼šåŠ è½½`bootfs`æ–‡ä»¶ç³»ç»Ÿï¼Œåœ¨**Dockeré•œåƒçš„æœ€åº•å±‚æ˜¯å¼•å¯¼æ–‡ä»¶ç³»ç»Ÿ`bootfs`ã€‚**è¿™ä¸€å±‚ä¸ç»å…¸çš„`Linux/Unix`ç³»ç»Ÿæ˜¯ä¸€æ ·çš„ï¼ŒåŒ…å«äº†`boot`**åŠ è½½å™¨å’Œå†…æ ¸**ã€‚å½“`boot`åŠ è½½å®Œæˆä¹‹åæ•´ä¸ªå†…æ ¸å°±éƒ½åœ¨å†…å­˜ä¸­äº†ï¼Œæ­¤æ—¶å†…å­˜çš„ä½¿ç”¨æƒå·²ç”±`bootfs`è½¬äº¤ç»™å†…æ ¸ï¼ŒåŒæ—¶ç³»ç»Ÿä¹Ÿä¼šå¸è½½`bootfs`ã€‚

* `rootfs(root file system)`

**åœ¨**`bootfs`ä¹‹ä¸Šï¼ŒåŒ…å«çš„å°±æ˜¯å…¸å‹`Linux`ç³»ç»Ÿä¸­çš„`/dev,/proc,/bin,/etc`ç­‰æ ‡å‡†ç›®å½•æ–‡ä»¶ã€‚`rootfs`å°±æ˜¯å„ç§ä¸åŒçš„æ“ä½œç³»ç»Ÿå‘è¡Œç‰ˆï¼Œæ¯”å¦‚`Ununtu`ã€`CentOS`ç­‰ã€‚

![image-20220813133531384](https://b3logfile.com/file/2022/08/solo-fetchupload-3047026354977519431-14a9815f.png)

> **å¯¹äºä¸€ä¸ªç²¾ç®€çš„OSï¼Œ**`rootfs`å¯ä»¥å¾ˆå°ï¼Œåªéœ€è¦åŒ…æ‹¬**æœ€åŸºæœ¬çš„å‘½ä»¤ã€å·¥å…·å’Œç¨‹åºåº“**å°±å¯ä»¥äº†ï¼Œå› ä¸ºåº•å±‚ç›´æ¥ç”¨`Host`çš„`kernel`ï¼Œè‡ªå·±åªéœ€è¦æä¾› `rootfs`å°±è¡Œäº†ã€‚ç”±æ­¤å¯è§å¯¹äºä¸åŒçš„`linux`å‘è¡Œç‰ˆ, `bootfs`åŸºæœ¬æ˜¯ä¸€è‡´çš„, `rootfs`ä¼šæœ‰å·®åˆ«, å› æ­¤ä¸åŒçš„å‘è¡Œç‰ˆå¯ä»¥å…±ç”¨`bootfs`ã€‚

### åˆ†å±‚ç»“æ„çš„ä¼˜åŠ¿

é•œåƒåˆ†å±‚æœ€å¤§çš„ä¸€ä¸ªå¥½å¤„å°±æ˜¯**èµ„æºå…±äº«**ï¼Œ**æ–¹ä¾¿å¤åˆ¶è¿ç§»å’Œå¤ç”¨**ã€‚

> **æ¯”å¦‚è¯´æœ‰å¤šä¸ªé•œåƒéƒ½ä»ç³»ç»Ÿçš„baseé•œåƒæ„å»ºè€Œæ¥ï¼Œé‚£ä¹ˆDocker Hoståªéœ€è¦åœ¨ç£ç›˜ä¿å­˜ä¸€ä»½baseé•œåƒï¼Œå°±å¯ä»¥ä¸ºæ‰€æœ‰å®¹å™¨æœåŠ¡äº†ã€‚è€Œä¸”é•œåƒçš„æ¯ä¸€å±‚éƒ½å¯ä»¥è¢«å…±äº«ã€‚**

### é‡ç‚¹ï¼Œåœˆèµ·æ¥ï¼Œè¦è€ƒ

**dockeré•œåƒéƒ½æ˜¯åªè¯»çš„ï¼Œå®¹å™¨å±‚æ˜¯å¯å†™çš„**ã€‚å½“å®¹å™¨å¯åŠ¨æ—¶ï¼Œä¸€ä¸ªæ–°çš„å¯å†™å±‚è¢«åŠ è½½åˆ°é•œåƒçš„é¡¶éƒ¨ï¼Œè¿™ä¸€å±‚é€šå¸¸è¢«ç§°ä¸º**å®¹å™¨å±‚**ï¼Œå®¹å™¨å±‚ä¹‹ä¸‹çš„éƒ½å«**é•œåƒå±‚ã€‚**

æ‰€æœ‰å¯¹**å®¹å™¨å±‚çš„æ”¹åŠ¨(CRUDä¹‹ç±»)éƒ½åªä¼šå‘ç”Ÿåœ¨å®¹å™¨å±‚ä¸­**ï¼Œåªæœ‰å®¹å™¨å±‚æ˜¯å¯å†™çš„ï¼Œå…¶ä¸‹çš„æ‰€æœ‰é•œåƒå±‚éƒ½åªæ˜¯åªè¯»ã€‚

![image-20220813155426943](https://b3logfile.com/file/2022/08/solo-fetchupload-7838168480958821044-2699ed22.png)

---

### Dockerçš„Commitå‘½ä»¤

#### å®æ“æ¡ˆä¾‹

æˆ‘ä»¬å°†åœ¨å·²æœ‰çš„`ubunutu`é•œåƒçš„åŸºç¡€ä¸Šï¼Œè¿è¡Œè¯¥é•œåƒå®¹å™¨å¹¶åœ¨å†…éƒ¨å®‰è£…`vim`å‘½ä»¤(åŸæ¥çš„æ²¡æœ‰çš„)ã€‚å®‰è£…ä¹‹åé€šè¿‡`commit`å‘½ä»¤å°†è¯¥é•œåƒé‡æ–°æäº¤ä¸ºå‰¯æœ¬é•œåƒï¼Œæ­¤æ—¶è¯¥é•œåƒå°±æ˜¯ä¸€ä¸ªå·²ç»åŒ…å«æœ‰`vim`æ”¯æŒçš„`Ubuntu`é•œåƒï¼ŒåŒæ—¶ä¹ŸåŒ…å«äº†æ‰€æœ‰ä¹‹å‰å®¿ä¸»æœºä¸ŠUbuntué•œåƒçš„æ‰€æœ‰å†…å®¹å’ŒåŠŸèƒ½ã€‚

**æŸ¥çœ‹åŸå§‹çš„Ubuntué•œåƒå’Œå®¹å™¨æƒ…å†µã€‚**

![image-20220813153749129](https://b3logfile.com/file/2022/08/solo-fetchupload-8827317075400878678-bc4895e9.png)

å¯ä»¥çœ‹åˆ°ï¼Œ`ID`å°¾å·`29`çš„æ˜¯æˆ‘ä»¬åŸå§‹çš„é•œåƒï¼Œè€Œæ­£åœ¨è¿è¡Œçš„`ID`å°¾å·çš„`0a`åˆ™æ˜¯é€šè¿‡è¿è¡Œ`29`é•œåƒåˆ›å»ºå‡ºæ¥çš„æ–°çš„é•œåƒï¼Œæˆ‘ä»¬åœ¨`0a`ä¸­å®‰è£…`vim`å‘½ä»¤æ”¯æŒåï¼Œé€šè¿‡`commit`é‡æ–°æ„å»ºã€‚

![image-20220813154020123](https://b3logfile.com/file/2022/08/solo-fetchupload-4941418772468590502-ffe6a819.png)

**æ„å»ºè¿‡ç¨‹å¦‚ä¸‹:**

```
docker commit -m='update vim cmd' -a='å…«å°ºå¦–å‰‘' 3cb0176c220a ubuntu/myubuntu:1.2
```

> **è§£é‡Šä¸€ä¸‹å‘½ä»¤ï¼š**
>
> **å¼€å±€ä¸€ä¸ª`docker commit` è£…å¤‡å…¨é å‚æ•°ã€‚**
>
> **`-m`å‚æ•°ç”¨æ¥æŒ‡å®šæäº¤çš„å†…å®¹ï¼Œç±»ä¼¼äºgitä¸­commitçš„æäº¤ä¿¡æ¯**
>
> **`-a` å‚æ•°ç”¨æ¥æŒ‡å®šæœ¬æ­¤ç‰ˆæœ¬çš„æäº¤ä½œè€…ã€‚**
>
> **ä¹‹åè·Ÿéœ€è¦æäº¤çš„é•œåƒID å†æ˜¯æœ¬æ¬¡æäº¤çš„é•œåƒç‰ˆæœ¬æƒ…å†µã€‚**

![image-20220813155000053](https://b3logfile.com/file/2022/08/solo-fetchupload-11807712326428170689-44dbd88d.png)

**å¦‚ä¸Šï¼Œæ„å»ºæäº¤ä¹‹åï¼Œæˆ‘ä»¬å†æ¬¡æŸ¥çœ‹imagesçš„æƒ…å†µã€‚**

![image-20220813155040338](https://b3logfile.com/file/2022/08/solo-fetchupload-15598055540361177103-68476850.png)

æ˜¯ä¸æ˜¯å‘ç°æ–°çš„é•œåƒå·²ç»æˆåŠŸæ„å»ºï¼Œç”±äºæˆ‘ä»¬æ–°å¢äº†`vim`åŠŸèƒ½çš„æ”¯æŒï¼Œå†å¤§å°ä¸Šï¼Œæ–°ç‰ˆæœ¬çš„`ubuntu:1.0`ä¹Ÿæ¯”åŸæ¥çš„ç‰ˆæœ¬å¤§äº†ä¸å°‘ã€‚å¦‚æ­¤ï¼Œå¦‚æœä»Šåæˆ‘ä»¬å†ä½¿ç”¨è‡ªå·±`commit`çš„æ–°ç‰ˆæœ¬çš„`ubuntu`é•œåƒæ—¶ï¼Œå°±ä¼šå‘ç°å®ƒè‡ªå¸¦äº†`vim`åŠŸèƒ½ï¼Œä¸”ä¿ç•™äº†åŸæ¥ä¸€åˆ‡çš„å†…å®¹ã€‚

**å½“ç„¶ï¼Œä½ ä¹Ÿå¯ä»¥å†åœ¨baseé•œåƒçš„åŸºç¡€ä¸Šæ„å»ºå«æœ‰æ›´å¤šåŠŸèƒ½çš„å…¶ä»–ç‰ˆæœ¬é•œåƒï¼Œä¹Ÿå¯ä»¥åœ¨æ–°æ„å»ºçš„é•œåƒçš„åŸºç¡€ä¸Šå†æ¬¡æ„å»ºæ–°çš„é•œåƒï¼Œæ”¯æŒå¥—å¨ƒæ“ä½œï¼Œä¸è¿‡ï¼Œåœ¨åŠŸèƒ½å¼ºå¤§çš„åŒæ—¶ï¼Œä½“ç§¯ä¹Ÿä¸ä¼šæ‹‰è·¨ï¼**

---

### æœ¬åœ°é•œåƒä¸Šä¼ åˆ°é˜¿é‡Œäº‘

**é¦–å…ˆåœ¨é˜¿é‡Œäº‘å¼€é€šè‡ªå·±çš„é•œåƒä»“åº“ä¹‹åï¼Œåˆ›å»ºå‘½åç©ºé—´ã€‚**

![image-20220813172115062](https://b3logfile.com/file/2022/08/solo-fetchupload-12883805053204955031-9bd36134.png)

**å‘½åç©ºé—´åˆ›å»ºä¹‹åï¼Œæˆ‘ä»¬åœ¨å‘½åç©ºé—´ä¸‹åˆ›å»ºä¸€ä¸ªæ–°çš„é•œåƒä»“åº“ï¼Œç”¨æ¥å­˜å‚¨æˆ‘ä»¬è‡ªå·±æ„å»ºçš„é•œåƒæ•°æ®ã€‚**

![image-20220813172232922](https://b3logfile.com/file/2022/08/solo-fetchupload-17868706244304431681-588ac5ff.png)

**åœ¨é•œåƒä»“åº“åˆ›å»ºç»“æŸä¹‹åï¼Œä¼šè‡ªåŠ¨è·³è½¬åˆ°å®˜æ–¹æä¾›çš„æ“ä½œæŒ‡å—é¡µï¼Œå®‰è£…æç¤ºä¸€æ­¥ä¸€æ­¥å°†æˆ‘ä»¬çš„é•œåƒä¸Šä¼ åˆ°ä»“åº“ä¸­ã€‚**

![image-20220813172349195](https://b3logfile.com/file/2022/08/solo-fetchupload-9653814762994880645-8d014765.png)

**æ¯”å¦‚æˆ‘å°†å‰é¢åˆ›å»ºçš„`ubuntu:1.2`ä¸Šä¼ åˆ°è‡ªå·±çš„é˜¿é‡Œäº‘é•œåƒä»“åº“ï¼Œæ“ä½œå¦‚ä¸‹ï¼š**

![image-20220813172521572](https://b3logfile.com/file/2022/08/solo-fetchupload-16663582775326683632-26893b53.png)

å¦‚æ­¤ç­‰å¾…`pushing`å®Œæˆå³å¯åœ¨è¿œç¨‹ä»“åº“ä¸­çœ‹åˆ°è‡ªå·±ä¸Šä¼ çš„é•œåƒäº†ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥è‡ªç”±æ‹‰å–ä»“åº“ä¸­çš„é•œåƒæ–‡ä»¶æ¥ä½¿ç”¨ï¼Œå¦‚æœæ˜¯å…¬å¼€çš„ä»“åº“ï¼Œè¿˜å¯ä»¥ç»™å…¶ä»–äººè¿›è¡Œä½¿ç”¨ï¼Œæ‹‰å–çš„å‘½ä»¤å®˜æ–¹é¡µæä¾›äº†ï¼š

```java
docker pull registry.cn-hangzhou.aliyuncs.com/xu-docker/myubuntu:[é•œåƒç‰ˆæœ¬å·]
```

---

### æœ¬åœ°é•œåƒæ¨é€åˆ°ç§æœ‰åº“

#### Docker Registry

`Dockerhub`ã€é˜¿é‡Œäº‘è¿™æ ·çš„å…¬å…±é•œåƒä»“åº“å¯èƒ½ä¸å¤ªæ–¹ä¾¿ï¼Œæ¶‰åŠæœºå¯†çš„å…¬å¸ä¸å¯èƒ½æä¾›é•œåƒç»™å…¬ç½‘ï¼Œæ‰€ä»¥éœ€è¦åˆ›å»ºä¸€ä¸ªæœ¬åœ°ç§äººä»“åº“ä¾›ç»™å›¢é˜Ÿä½¿ç”¨ï¼ŒåŸºäºå…¬å¸å†…éƒ¨é¡¹ç›®æ„å»ºé•œåƒã€‚`Docker Registry`æ˜¯å®˜æ–¹æä¾›çš„å·¥å…·ï¼Œ**å¯ä»¥ç”¨äºæ„å»ºç§æœ‰é•œåƒä»“åº“ã€‚**

#### ç§æœ‰åº“æ­å»ºæµç¨‹

**æ‹‰å–registry**

```java
docker pull registry
```

**è¿è¡Œç§æœ‰åº“**

> é»˜è®¤æƒ…å†µï¼Œä»“åº“è¢«åˆ›å»ºåœ¨å®¹å™¨çš„`/var/lib/registry`ç›®å½•ä¸‹ï¼Œå»ºè®®è‡ªè¡Œç”¨å®¹å™¨å·æ˜ å°„ï¼Œæ–¹ä¾¿ä¸å®¿ä¸»æœºè”è°ƒã€‚

```
docker run -d -p 5000:5000  -v /ilikexff/myregistry/:/tmp/registry --privileged=true registry
```

![image-20220813183441736](https://b3logfile.com/file/2022/08/solo-fetchupload-1164883366238816564-7ad663fb.png)

**å‚æ•°è¯´æ˜:**

> -d è¡¨ç¤ºè®¾ä¸ºåå°è¿è¡Œ
>
> -p æŒ‡å®šè¿è¡Œä½¿ç”¨çš„ç«¯å£å·(å®¿ä¸»æœºç«¯å£å·:å®¹å™¨å†…ç«¯å£å·)
>
> -v æŒ‡å®šæ•°æ®å·æ˜ å°„

**åœ¨å¯åŠ¨ç§æœ‰ä»“åº“ä¹‹åï¼Œä¸ºäº†èƒ½æ›´å¥½çš„ç†è§£æ•´ä¸ªpushæµç¨‹ï¼Œä¸‹é¢æˆ‘åœ¨æº`ubuntu`é•œåƒçš„åŸºç¡€ä¸Šæ–°`commit`ä¸€ä¸ªé•œåƒï¼Œè¯¥é•œåƒæ–°å¢ä¸€ä¸ª**`net-tools`å·¥å…·ï¼Œé€šè¿‡`ifconfig`å‘½ä»¤å¯ä»¥æŸ¥çœ‹å½“å‰å®¹å™¨çš„IPåœ°å€ã€‚

![image-20220813212758367](https://images.waer.ltd/img/solo-fetchupload-1355004452767630664-306cbe0e.png)

> èƒ½çœ‹åˆ°ï¼Œ`ID`ä¸º`346`çš„å°±æ˜¯æ–°åˆ›å»ºçš„å®¹å™¨ã€‚

![image-20220813213105721](https://images.waer.ltd/img/solo-fetchupload-5507794109957557169-44dbd50f.png)

æ¥ä¸‹æ¥æˆ‘ä»¬å°†é€šè¿‡`commit`æ„å»ºå®Œæˆè¿™ä¸ªæ–°çš„é•œåƒï¼Œæˆ‘ç»™ä»–å‘½åä¸º`myubuntu:1.2`,é€šè¿‡ä¸‹é¢çš„å‘½ä»¤æäº¤æ„å»ºã€‚

```java
docker commit -m='update ifconfig cmd' -a='å…«å°ºå¦–å‰‘' 3f16668ea346 ubuntu/myubuntu:1.2
```

![image-20220813213511867](https://images.waer.ltd/img/solo-fetchupload-10272846739865788233-feb976fb.png)

**ä¸‹é¢å°±å°†è¯¥é•œåƒä½œä¸ºæ–°çš„é•œåƒæ¨é€åˆ°ç§æœä»“åº“ã€‚**

**åœ¨æ‰§è¡Œæ¨é€ä¹‹å‰ï¼Œæˆ‘ä»¬æœ€å¥½æŸ¥çœ‹ä¸€ä¸‹è¿œç¨‹ç§æœä»“åº“çš„é•œåƒæƒ…å†µã€‚**

```java
curl -XGET http://101.37.150.110:5000/v2/_catalog
```

> æ³¨æ„å‘½ä»¤æ˜¯åœ¨**å®¿ä¸»æœºæ‰§è¡Œ**ï¼Œè®°å¾—`IP`æ”¹ä¸€ä¸‹è‡ªå·±çš„ã€‚æ‰§è¡Œè¿™ä¸ªå‘½ä»¤ä¹‹åå‡ºç°ä¸‹é¢çš„æƒ…å†µè¡¨ç¤ºè¯¥ç§æœä»“åº“**è¿˜æ²¡æœ‰ä»»ä½•é•œåƒ**ã€‚

![image-20220813215310368](https://images.waer.ltd/img/solo-fetchupload-6388359107471626906-ff91fb5a.png)

**è¡€çš„æ•™è®­ï¼šè¯·å…³é—­é˜²ç«å¢™ï¼Œæ”¾è¡Œ5000ç«¯å£ï¼ï¼ï¼ï¼**

**è¡€çš„æ•™è®­ï¼šè¯·å…³é—­é˜²ç«å¢™ï¼Œæ”¾è¡Œ5000ç«¯å£ï¼ï¼ï¼ï¼**

**è¡€çš„æ•™è®­ï¼šè¯·å…³é—­é˜²ç«å¢™ï¼Œæ”¾è¡Œ5000ç«¯å£ï¼ï¼ï¼ï¼**

~ä¸ç„¶æ€•ä½ å‘½ä»¤æ‰§è¡Œå‡ ç™¾æ¬¡éƒ½æ²¡æœ‰å“åº”ï¼Œä¼šæ¿€æ€’å¿ƒä¸­é‚£å¤´æš´èºçš„å°é‡å…½!!å—·å—·~~~

**æŒ‰ç…§ä¸‹é¢çš„æ ¼å¼å‡†å¤‡å¥½æ–°çš„é•œåƒï¼Œ**

> **docker   tag   é•œåƒ:Tag   Host:Port/Repository:Tag**

**æ‰€ä»¥æœ‰**

```java
docker tag ubuntu/myubuntu:1.2  101.37.150.110:5000/ubuntu/myubuntu:1.2
```

![image-20220813221213222](https://images.waer.ltd/img/solo-fetchupload-11407495650052434662-f0b08c3f.png)

å…ˆåˆ«æ€¥ç€`push`ï¼Œå‡ºäºå®‰å…¨è€ƒè™‘ï¼Œ`docker`æ˜¯ç¦æ­¢ä½¿ç”¨`http`åè®®æ¨é€é•œåƒçš„ï¼Œæ‰€ä»¥è¿™é‡Œéœ€è¦å…ˆä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œæš‚æ—¶å–æ¶ˆç¦åˆ¶ã€‚

```sh
# æ‰“å¼€è¯¥æ–‡ä»¶
vim /etc/docker/daemon.json
```

![image-20220813220544374](https://images.waer.ltd/img/solo-fetchupload-2157136057553653815-ea70db06.png)

å¦‚ä¸Šï¼Œæ–°å¢éƒ¨åˆ†çš„å†…å®¹æˆ‘å·²ç»ç”¨è“è‰²æ¡†å‡ºæ¥äº†ï¼Œæ³¨æ„å³è¾¹çš„é€—å·ï¼Œéœ€è¦ç¬¦åˆ`JSON`æ ¼å¼å“ˆã€‚è¿˜æœ‰`IP`æ”¹ä¸ºè‡ªå·±çš„`IP`ï¼Œåˆ«åšæ— è„‘`CV`å·¥ç¨‹å¸ˆã€‚

**å¼€å§‹æ¨é€é•œåƒåˆ°ç§æœä»“åº“ã€‚**

```java
docker push 101.37.150.110:5000/ubuntu/myubuntu:1.2
```

å¦‚æœæ¨é€çš„æ—¶å€™é‡åˆ°è¿™ç§æƒ…å†µï¼ŒåŸå› æ˜¯å‰é¢ä¿®æ”¹çš„æ–‡ä»¶å¯èƒ½æ²¡æœ‰ç”Ÿæ•ˆï¼Œè§£å†³åŠæ³•å°±æ˜¯é‡å¯`docker`ï¼Œç„¶åè¿è¡Œ**docker registry**ç§æœï¼Œå†æ¬¡æ¨é€å°±æˆåŠŸäº†ã€‚

**æ¨é€ä¹‹åï¼Œå¯ä»¥å†æ¬¡æŸ¥çœ‹ç§æœä¸­æœ‰å“ªäº›é•œåƒã€‚**

```bash
curl -XGET http://101.37.150.110:5000/v2/_catalog
```

![image.png](https://images.waer.ltd/img/image-09f5b244.png)

è‡³æ­¤å‘ç§æœæ¨é€é•œåƒå°±å®Œæˆäº†ï¼Œå¯ä»¥é€šè¿‡ä¸‹é¢çš„æ–¹å¼ä»ç§æœæ‹‰å–åˆšåˆš`push`çš„é•œåƒä¸‹æ¥ç©ç©çœ‹çœ‹æ­£ä¸æ­£å¸¸ï¼Œè¿™ä¸æ˜¯å¿…é¡»çš„æ­¥éª¤ï¼Œä¸»è¦æ˜¯æ„Ÿå—ä¸€ä¸‹è¿™ä¸ª`commit`ã€`pushã€pull`çš„è¿‡ç¨‹ã€‚

```bash
docker pull 101.37.150.110:5000/ubuntu/myubuntu:1.2
```

### æ•°æ®å·

#### æ¦‚å¿µ

å·å°±æ˜¯ç›®å½•æˆ–è€…æ–‡ä»¶ï¼Œå­˜åœ¨äºä¸€ä¸ªæˆ–è€…å¤šä¸ªå®¹å™¨ä¸­ï¼Œç”±`docker`æŒ‚è½½åˆ°å®¹å™¨ï¼Œä½†**ä¸å±äºè”åˆæ–‡ä»¶ç³»ç»Ÿ**ï¼Œå› æ­¤èƒ½å¤Ÿç»•è¿‡`UnionFS`,æä¾›çš„ä¸€äº›ç”¨äºæŒç»­å­˜å‚¨æˆ–å…±äº«æ•°æ®çš„ç‰¹æ€§ã€‚

> å‰é¢çš„å†…å®¹å¯è¿˜æœ‰å°è±¡ï¼Œå½’å› äºå®¹å™¨æ•°æ®çš„å¤‡ä»½ï¼Œæ‰‹åŠ¨`cp`ã€‚
>
> å…³äºå®¹å™¨çš„å¯¼å…¥å¯¼å‡ºçš„`impot`ã€`export`å‘½ä»¤ã€‚

ä¸Šé¢çš„å†…å®¹æœ¬è´¨ä¸Šéƒ½æ˜¯ä¸ºäº†å¯¹å®¹å™¨é•œåƒæ•°æ®è¿›è¡Œå¤‡ä»½è€Œæ¥çš„ï¼Œä½†å®é™…æ“ä½œèµ·æ¥æ¯”è¾ƒéº»çƒ¦ã€‚æ‰€ä»¥å·è®¾è®¡çš„ç›®çš„å°±æ˜¯ä¸ºäº†æ•°æ®çš„æŒä¹…åŒ–ï¼Œå®Œå…¨ç‹¬ç«‹äºå®¹å™¨çš„ç”Ÿå­˜å‘¨æœŸï¼Œå› æ­¤`Docker`**ä¸ä¼šå†å®¹å™¨åˆ é™¤æ—¶æŠŠæŒ‚è½½çš„æ•°æ®å·ä¹Ÿé¡ºèµ°äº†**ã€‚

**ç‰¹ç‚¹:**

> 1ï¼šæ•°æ®å·å¯åœ¨å®¹å™¨ä¹‹é—´å…±äº«æˆ–é‡ç”¨æ•°æ®
> 2ï¼šå·ä¸­çš„æ›´æ”¹å¯ä»¥ç›´æ¥å®æ—¶ç”Ÿæ•ˆ
> 3ï¼šæ•°æ®å·ä¸­çš„æ›´æ”¹ä¸ä¼šåŒ…å«åœ¨é•œåƒçš„æ›´æ–°ä¸­
> 4ï¼šæ•°æ®å·çš„ç”Ÿå‘½å‘¨æœŸä¸€ç›´æŒç»­åˆ°æ²¡æœ‰å®¹å™¨ä½¿ç”¨å®ƒä¸ºæ­¢

**è¿è¡Œä¸€ä¸ªå¸¦æœ‰å®¹å™¨å·å­˜å‚¨åŠŸèƒ½çš„å®¹å™¨å®ä¾‹**

```java
docker run -it --privileged=true -v /å®¿ä¸»æœºç»å¯¹è·¯å¾„ç›®å½•:/å®¹å™¨å†…ç›®å½•      é•œåƒå
```

**è¿™é‡Œç‰¹åˆ«æ³¨æ„ä¸€ä¸‹**`--privileged=true`å‚æ•°ï¼Œå®ƒçš„ä½œç”¨å°±æ˜¯å¼€å¯æ•°æ®å·çš„**ç›®å½•æƒé™**ï¼Œå¦åˆ™æ•°æ®å·åœ¨æŒ‚è½½ä½¿ç”¨çš„è¿‡ç¨‹ä¸­å¯èƒ½ä¼šé‡åˆ°ä¸€äº›æƒé™ä¸è¶³ç­‰ç­‰ä¹±ä¸ƒå…«ç³Ÿçš„é—®é¢˜ï¼Œæ‰€ä»¥ä¿é™©èµ·è§ï¼Œå»ºè®®éƒ½å¸¦ä¸Šå®ƒï¼Œäººç•œæ— å®³ï¼

#### ä½¿ç”¨ç¤ºä¾‹

> **æ¼”ç¤ºæ•°æ®å·çš„å¤§è‡´ä½¿ç”¨è¿‡ç¨‹ä»¥åŠä¸€äº›éœ€è¦æ³¨æ„çš„åœ°æ–¹ã€‚**

**å…ˆä½œè¿™æ ·ä¸€ä¸ªçº¦å®šï¼š**

æˆ‘ä»¬åœ¨å®¿ä¸»æœº(`centos`)ä¸Šè¿è¡Œä¸€ä¸ª`ubuntu`é•œåƒï¼Œå¹¶é€šè¿‡æ•°æ®å·æŒ‚è½½çš„æ–¹å¼å°†é•œåƒçš„æ•°æ®æ–‡ä»¶ç›®å½•æŒ‚è½½åˆ°å®¿ä¸»æœºçš„`/tmp/dokcer_backup`ç›®å½•ä¸‹ï¼Œå¯¹åº”äº`ubuntu`é•œåƒä¸­çš„`/tmp/docker_data`ç›®å½•ã€‚

**ä¸Šé¢çš„çº¦å®šå¯ä»¥ç®€å•çš„ä½¿ç”¨æ˜ å°„çš„æ–¹å¼è¡¨ç¤ºï¼š**

> /tmp/docker_backup:/tmp/docker_data **å†’å·å·¦è¾¹çš„éƒ¨åˆ†è¡¨ç¤ºå®¿ä¸»æœºçš„ç›®å½•**ï¼Œå³è¾¹éƒ¨åˆ†è¡¨ç¤ºæ˜ å°„çš„**é•œåƒå†…éƒ¨**çš„ç›®å½•ã€‚

å®Œæˆä¸Šè¿°çš„æ˜ å°„è®¾ç½®ä¹‹åï¼Œç†è®ºä¸Šæˆ‘ä»¬åœ¨`docker`å®¹å™¨å†…éƒ¨`/tmp/docker_data/`ç›®å½•ä¸‹äº§ç”Ÿçš„æ‰€æœ‰æ–‡ä»¶éƒ½ä¼šå®æ—¶çš„æ›´æ–°åˆ°å®¿ä¸»æœºçš„`/docker_backup/`ç›®å½•ä¸‹ã€‚

**å…·ä½“çš„æ“ä½œ**

* **æŒ‚è½½è¿è¡Œubuntué•œåƒå®¹å™¨ã€‚**

```
docker run -it --privileged=true -v /tmp/docker_backup:/tmp/docker_data --name=myub1 ubuntu
```

![image-20220814143227660](https://images.waer.ltd/img/solo-fetchupload-1428822832276749836-3df23f28.png)

å®¹å™¨å·²ç»è¿è¡Œï¼Œæˆ‘ä»¬åœ¨å®¹å™¨å†…è¿›å…¥æŒ‡å®šçš„æ˜ å°„ç›®å½•ï¼Œçœ‹çœ‹æ˜¯å¦çœŸçš„å­˜åœ¨

![image-20220814143329554](https://images.waer.ltd/img/solo-fetchupload-2249120678644538093-a005f784.png)

> ç¡®å®èƒ½æ‰¾åˆ°è¿™ä¸ªè·¯å¾„ï¼Œäº‹å®ä¸Šï¼Œæˆ‘ä»¬æŒ‚è½½çš„æ•°æ®å·çš„ç›®å½•ï¼Œå¦‚æœæå‰æ²¡æœ‰åˆ›å»ºï¼Œé‚£ä¹ˆç³»ç»Ÿä¼šè‡ªåŠ¨æ£€æµ‹ï¼Œä¸å­˜åœ¨å°±ä¼šå¸®ä½ è‡ªåŠ¨åˆ›å»ºï¼Œæ‰€ä»¥ä¸ç”¨æ‹…å¿ƒè·¯å¾„ç›®å½•ä¸å­˜åœ¨çš„æƒ…å†µã€‚

åŒç†ï¼Œåœ¨å®¿ä¸»æœºä¸­ä¹Ÿæ˜¯å¯ä»¥æ‰¾åˆ°`/tmp/docker_backup/`ç›®å½•çš„ã€‚

* **åˆ›å»ºæ•°æ®æ–‡ä»¶**

åœ¨å®¹å™¨å†…çš„æŒ‡å®šç›®å½•ä¸‹éšæ„åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ï¼Œå›åˆ°å®¿ä¸»æœºçš„ç›®å½•ä¸‹çœ‹çœ‹æ˜¯å¦çœŸçš„èƒ½å¤ŸåŒæ­¥è¿‡å»ã€‚

> **åœ¨å®¹å™¨å†…ç›®å½•åˆ›å»ºä¸€ä¸ªdockers.txtæ–‡ä»¶ã€‚**

```java
cd /tmp/docker_data/
touch dockers.txt
```

![image-20220814143906504](https://images.waer.ltd/img/solo-fetchupload-5284680104238031988-5f22f783.png)

å›åˆ°å®¿ä¸»æœºçœ‹çœ‹æƒ…å†µã€‚

![image-20220814143945080](https://images.waer.ltd/img/solo-fetchupload-4995985329528350771-4f7edc6e.png)

ä¸­å›½äººä¸éª—ä¸­å›½äººï¼Œè¿™ä¸ªæ–‡ä»¶ç¡®å®è¢«åŒæ­¥åˆ°å®¿ä¸»æœºäº†ã€‚

**é‚£ä¹ˆï¼Œæ—¢ç„¶åœ¨å®¹å™¨å†…çš„æ–‡ä»¶æ•°æ®èƒ½å¤ŸåŒæ­¥åˆ°å®¿ä¸»æœºï¼Œå®¿ä¸»æœºä¸Šäº§ç”Ÿçš„æ•°æ®ä¼šä¸ä¼šä¸€æ ·ä¹Ÿèƒ½å¤Ÿè¢«åŒæ­¥åˆ°å®¹å™¨å†…å‘¢ï¼Ÿï¼Ÿ**

> ç­”æ¡ˆæ˜¯è‚¯å®šçš„ï¼Œè¿™é‡Œå°±ä¸ä½œæ¼”ç¤ºäº†ï¼Œè‡ªå·±è¯•è¯•å°±çŸ¥é“äº†ã€‚

* **æŸ¥çœ‹æŒ‚è½½ä¿¡æ¯**

**æŒ‚è½½æ˜¯æŒ‚è½½äº†ï¼Œæ˜ å°„ä¹Ÿæ²¡å•¥é—®é¢˜ã€‚ä½†å¦‚æœæ—¶é—´å¤Ÿé•¿ï¼Œæ“ä½œå¤Ÿå¤æ‚ï¼Œä¹Ÿéš¾å…ä¼šå‡ºç°é—å¿˜çš„æƒ…å†µï¼Œå°±æ˜¯æˆ‘å¯èƒ½ä¸è®°å¾—è‡ªå·±çš„å®¿ä¸»æœºæŒ‚è½½åˆ°å®¹å™¨å“ªä¸ªä½ç½®äº†ï¼Œè¿™æ—¶å€™å°±è¦ç”¨åˆ°ä¹‹å‰çš„ä¸€ä¸ªå‘½ä»¤ï¼š**`inspect`

```java
docker inspect å®¹å™¨ID
```

![image-20220814145019188](https://images.waer.ltd/img/solo-fetchupload-12312341694518264738-e8e6e297.png)

> å‘½ä»¤æ‰§è¡Œçš„ç»“æœè¿”å›çš„æ˜¯ä¸€ä¸ªå¾ˆé•¿çš„`JSON`æ•°æ®ï¼Œä½†å°±æœ¬å¤„çš„å†…å®¹è€Œè¨€ï¼Œåªéœ€è¦äº†è§£å…¶ä¸­ä¸€å°éƒ¨åˆ†å³å¯ï¼Œå¦‚ä¸Šå›¾ï¼Œ`JSON`ä¸²ä¸­æœ‰ä¸€å—åä¸º`Mounts`çš„æ•°æ®ï¼Œè¿™å°±æ˜¯æŒ‚è½½çš„æƒ…å†µã€‚
>
> **Source:å®¿ä¸»æœºå¯¹åº”çš„ç›®å½•**
>
> **Destinationï¼šå®¹å™¨å†…æ˜ å°„çš„ç›®å½•**
>
> **å…¶ä»–ä¿¡æ¯â€¦**

å¦‚æœæ­¤æ—¶å®¹å™¨åœæ­¢ï¼Œå®¿ä¸»æœºæ–‡ä»¶æœ‰å˜åŠ¨ï¼Œå†æ¬¡é‡å¯å®¹å™¨ï¼Œé‚£ä¹ˆå®¿ä¸»æœºçš„å˜æ›´ä¹Ÿè¿˜ä¼šåŒæ­¥åˆ°å®¹å™¨å†…çš„å“ˆ

**åŒæ—¶ï¼Œ-vå‚æ•°å¯ä»¥æœ‰å¤šä¸ªï¼Œä¹Ÿå°±æ˜¯æ•°æ®å·æ”¯æŒåŒæ—¶æŒ‚è½½å¤šä¸ª**

#### æƒé™è°ƒæ•´

ä¸Šé¢æ‰§è¡Œçš„æŒ‚è½½ä½¿ç”¨çš„é»˜è®¤è§„åˆ™ï¼Œä¹Ÿå°±æ˜¯æŒ‚è½½ç”¨çš„å®¹å™¨å†…éƒ¨ç›®å½•æ‹¥æœ‰`rw`è¯»å†™æƒé™ã€‚

```java
docker run -it --privileged=true -v /å®¿ä¸»æœºç»å¯¹è·¯å¾„ç›®å½•:/å®¹å™¨å†…ç›®å½•:rw      é•œåƒå
```

å¦‚æœè¯´å®é™…éœ€è¦ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥è‡ªå·±è°ƒæ•´å®¹å™¨å†…ç›®å½•çš„æƒé™ä¸º`ro`å³åªè¯»æƒé™(`read only`)ã€‚

```java
docker run -it --privileged=true -v /å®¿ä¸»æœºç»å¯¹è·¯å¾„ç›®å½•:/å®¹å™¨å†…ç›®å½•:ro     é•œåƒå
```

#### å·çš„ç»§æ‰¿&å…±äº«

å‡è®¾æˆ‘ä»¬å¯¹`Ubuntu1`å’Œå®¿ä¸»æœºä½œäº†æ˜ å°„ä¹‹åï¼Œå†éœ€è¦å¦å¤–ä¸€ä¸ªé•œåƒæ¥å¤ç”¨`Ubuntu1`çš„æ•°æ®å·æŒ‚è½½ä¿¡æ¯ï¼Œå¯ä»¥é€šè¿‡ç»§æ‰¿`Ubtuntu1`çš„æ–¹å¼å®ç°ã€‚

```java
docker run -it  --privileged=true --volumes-from çˆ¶ç±»  --name u2 ubuntu
```

**ç‰¹ç‚¹ï¼š**

> **`Ubuntu1`(ç®€ç§°`u1`)ä½œä¸ºè¢«`u2`ç»§æ‰¿çš„çˆ¶é•œåƒï¼Œä»–ä»¬å’Œå®¿ä¸»æœºä¹‹é—´æ˜¯å¯ä»¥ä¿¡æ¯äº’é€šçš„ã€‚**
>
> **å°½ç®¡`u2`ç»§æ‰¿è‡ª`u1`ï¼Œå¦‚æœ`u1`æŒ‚æ‰äº†ï¼Œæ­¤æ—¶å¹¶ä¸ä¼šå½±å“`u2`å’Œå®¿ä¸»æœºä¹‹é—´çš„äº’é€š**
>
> **è‹¥é‡å¯æŒ‚æ‰çš„`u2`ä¹‹åï¼Œä¹‹å‰`u1`å’Œå®¿ä¸»æœºä¹‹é—´çš„æ•°æ®ä¹Ÿä¼šåŒæ­¥åˆ°`u2`**

## Dockerè¸¢é¦†è®°

**æ¥”å­**

> è¯è¯´æœ‰ä¸€å¤©ï¼Œä½œä¸ºåèµ·ä¹‹ç§€çš„dockerï¼Œè§‰å¾—è‡ªå·±å¤‡å—çˆ±æˆ´ï¼Œç‰›é€¼åäº†çš„å®ƒå‡†å¤‡èƒŒèµ·è¡Œå›Šï¼Œå‘¨æ¸¸ä¸šå†…å„å›½åå°†ï¼Œæ‰€åˆ°ä¹‹å¤„ï¼Œé‚£æ˜¯è…¥é£è¡€é›¨ï¼Œå¯¸è‰ä¸ç”Ÿâ€¦â€¦

### å®‰è£…Tomcat

#### é•œåƒæ‹‰å–

é•œåƒå¯ä»¥åœ¨å®˜æ–¹çš„dockerhubæœç´¢ï¼Œç„¶åæŒ‰ç…§ä¸Šé¢çš„æ‹‰å–å‘½ä»¤æ‹‰å–ã€‚å®˜æ–¹é•œåƒåœ°å€[https://hub.docker.com/_/tomcat](https://hub.docker.com/_/tomcat)

![image-20220815163954643](https://images.waer.ltd/img/solo-fetchupload-6169731484143770530-35b8aa51.png)

**è®°ä½ï¼Œå¦‚æœåœ¨æ‹‰å–æ—¶ä¸æŒ‡å®šç‰ˆæœ¬å·ï¼Œé‚£é»˜è®¤ä¼šæ‹‰å–æœ€æ–°ç‰ˆæœ¬ï¼Œä½†å°±tomcatæœ€æ–°çš„dockerç‰ˆæ¥è¯´ï¼Œå…¶å®æ˜¯æœ‰ä¸€äº›å‘çš„ï¼Œä¸ºäº†èŠ‚çº¦æ—¶é—´å’Œç¯‡å¹…(ä¸»è¦æ˜¯æˆ‘ä¸ƒç‰›äº‘OSSç©ºé—´ä¸œè¥¿å¤ªå¤šï¼Œä¸æƒ³è´´å›¾äº†å“ˆå“ˆå“ˆ)æˆ‘ç®€å•çš„è¯´ä¸€ä¸‹è¿™ä¸ªå‘å°±å¥½äº†ã€‚**

> æˆ‘ä»¬åœ¨æ‹‰å–æœ€æ–°ç‰ˆçš„`tomcat`ä¹‹åï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œåªéœ€è¦æŒ‰ç…§å®˜æ–¹æä¾›çš„è¿è¡Œå‘½ä»¤ç›´æ¥å¯åŠ¨`tomcat`ï¼Œç„¶åè®¿é—®æ˜ å°„çš„ç«¯å£å·å³å¯æˆåŠŸè®¿é—®åˆ°å®ƒç»å…¸çš„çŒ«é¡µï¼Œå¯æ–°ç‰ˆçš„`tomcat`åœ¨è¿™äº›æ­¥éª¤å®Œæˆä¹‹åè®¿é—®å‘ç°å‡ºç°äº†`404`ã€‚åŸå› æ˜¯åœ¨tomcatçš„é…ç½®æ–‡ä»¶`webapps`ä¸­çš„å†…å®¹æ˜¯ç©ºçš„ï¼Œæ–°çš„ä¸œè¥¿åº”è¯¥æ˜¯`webapps.dist`ï¼Œæ‰€ä»¥è§£å†³åŠæ³•ï¼šæŠŠ`webapps.dist`ç›®å½•æ¢æˆ`webapps`
>
> * **å°†åŸæ¥çš„**`webapps`ç›®å½•åˆ é™¤
>
> ```
> rm rf webapps
> ```
>
> * **å°†**`webapps.dist`æ›¿æ¢ä¸º`webapps`ã€‚
>
> ```
> mv webapps.dist webapps
> ```
>
> * **æ‰“å®Œæ”¶å·¥ï¼ï¼è¿™æ¬¡å°±èƒ½çœ‹åœ¨æµè§ˆå™¨çœ‹åˆ°çŒ«å”äº†ã€‚**

#### å…ä¿®æ”¹ç‰ˆæœ¬æ¼”ç¤º

æ‰€ä»¥é‰´äºä¸Šï¼Œæˆ‘ç›´æ¥æ¼”ç¤ºå…¶ä»–ç‰ˆæœ¬çš„tomcatçš„æ•´ä¸ªå®‰è£…æµç¨‹ã€‚

```java
# æ‹‰å–å…ä¿®æ”¹çš„tomcatç‰ˆæœ¬ï¼Œè™½ç„¶æˆ‘æ‰§è¡Œçš„æ˜¯è¿è¡Œå‘½ä»¤ï¼Œä½†ç”±äºæˆ‘æœ¬æ¥å°±æ²¡æœ‰è¿™ä¸ªé•œåƒï¼Œæ‰€ä»¥å®ƒä¼šè‡ªåŠ¨æ‹‰å–
docker run -d -p 8080:8080 --name mytomcat8 billygoo/tomcat8-jdk8
```

æŸ¥çœ‹å¯åŠ¨æˆåŠŸä¹‹åï¼Œæˆ‘ä»¬åœ¨æµè§ˆå™¨è®¿é—®ip:8080ç«¯å£,çœ‹çœ‹èƒ½ä¸èƒ½é¡ºåˆ©çš„å»åˆ°çŒ«å”å®¶ã€‚

![image-20220815170335631](https://images.waer.ltd/img/solo-fetchupload-5426165259532121138-6c1d3dc5.png)

å¥½ï¼ŒæˆåŠŸäº†ï¼Œso easy to happy ï¼ï¼

ä¸‹é¢è¯·è·Ÿç€æˆ‘æ‰“ä¸€å¥—ç»„åˆæ‹³ï¼Œä¸€å£æ°”ç­å®ƒ9æ—ï¼Œæ¯•ç«Ÿæˆ‘æ˜¯ä¸ªè«å¾—æ„Ÿæƒ…çš„æœºå™¨äººï¼Œä½ äºæˆ‘æ— ç”¨äº†ï¼Œæˆ‘å°±ä¼šæ— æƒ…çš„æŠ›å¼ƒä½ ã€‚

```java
docker stop å®¹å™¨ID
docker rm -f å®¹å™¨ID
docker rmi é•œåƒID
```

æ‰“å®Œæ”¶å·¥ï¼Œå‡ºå‘ä¸‹ä¸€å®¶ï¼ï¼ï¼

> æ­¤æ—¶è½»æ¾æ‹¿ä¸‹çŒ«å”çš„`docker`å˜´è§’ä¸Šæ‰¬ï¼Œå¿ƒæƒ³ï¼ŒçŒ«å”éƒ½éƒ½ä¸å ªä¸€å‡»ï¼Œæ¥ä¸‹æ¥çš„`MySql`ä¹Ÿä¸ä¼šæ£˜æ‰‹ï¼ï¼ï¼

### å®‰è£…MySql

> ä¸ºäº†è¯æ˜è‡ªå·±çš„å®åŠ›ï¼Œdockerå¹¶ä¸æ‰“ç®—æŒ‘æˆ˜æœ€æ–°ç‰ˆçš„`mysql`(æ¯•ç«Ÿæ–°äººç»éªŒä¸è¶³),è€Œæ˜¯ç›´æ¥å¯¹çº¿å¸¸èƒœå°†å†›`mysql:5.7`ï¼Œå®ƒçš„èµ„å†è™½æ¯”çŒ«å”ç•¥é€Šé‚£ä¹ˆä¸€ç‚¹ç‚¹ï¼Œä½†è‡ªå·±ç»éªŒé‚£å«ä¸€ä¸ªè€é“ï¼Œç¨³å¦‚è€ç‹—ï¼äºæ˜¯ä¹ï¼Œ`mysql:5.7`ä¹Ÿæ˜¯æ¬£ç„¶æ¥å—äº†Â·çš„æŒ‘æˆ˜

```java
# æ‹‰å–mysql:5.7
docker pull mysql:5.7
```

```java
# è¿è¡Œå®¹å™¨å®ä¾‹(æ•°æ®å·æŒ‚è½½çš„æ–¹å¼)
docker run -d -p 3306:3306 --privileged=true -v /tools/mysql/log:/var/log/mysql -v /tools/mysql/data:/var/lib/mysql -v /tools/mysql/conf:/etc/mysql/conf.d -e MYSQL_ROOT_PASSWORD=123456  --name mysql mysql:5.7
```

![image-20220815175037225](https://images.waer.ltd/img/solo-fetchupload-9455904427670233517-0fe5e675.png)

> ç¬¬ä¸€å›åˆä¸‹æ¥ï¼Œ`docker`æ„Ÿè§‰æ²¡æœ‰ä»»ä½•å‹åŠ›ï¼Œè½»æ¾æ‹¿æå°±æ˜¯äº†ï¼ï¼ï¼

#### åŸºæœ¬é…ç½®

```java
# åœ¨å®¿ä¸»æœºä¸Šåˆ‡åˆ°/confç›®å½•
cd /tools/mysql.conf
# æ–°å»ºmy.cnf,é€šè¿‡æŒ‚è½½å·åœ¨å®¿ä¸»æœºæ“ä½œå®¹å™¨
vim.cnf
# æ·»åŠ æ–‡ä»¶å†…å®¹
[client]
default_character_set=utf8 
[mysqld]
collation_server = utf8_general_ci
character_set_server = utf8
# é‡å¯å®ä¾‹ï¼ŒåŠ è½½é…ç½®
docker restart mysql
```

> ç¬¬äºŒå›åˆå°±è¿™æ ·ç»“æŸäº†ã€‚å°½ç®¡`mysql`æ­¤æ—¶å·²ä¼¤ç—•ç´¯ç´¯ï¼Œä½†`docker`é¢å¤´ä¹Ÿæ˜¯æ¸—å‡ºäº†è±†å¤§çš„æ±—ç ï¼Œå®ƒæš—è‡ªå˜€å’•:æƒ³ä¸åˆ°è¿™å®¶ä¼™ç¡®æœ‰ä¸¤æŠŠåˆ·å­â€¦

#### ä½¿ç”¨æµ‹è¯•

```java
# è¿›å…¥å®¹å™¨å†…éƒ¨
docker exec -it mysql bash
# ç™»å½•mysql
mysql -uroot -p
# é”®å…¥å¯†ç ....
# æˆåŠŸç™»å½•
```

![image-20220815180306326](https://images.waer.ltd/img/solo-fetchupload-1478160933299215099-02b8954e.png)

```java
# æŸ¥çœ‹å­—ç¬¦é›†æ˜¯å¦è®¾ç½®ç”Ÿæ•ˆ
# dockerå®‰è£…å®ŒMySQLå¹¶runå‡ºå®¹å™¨åï¼Œå»ºè®®è¯·å…ˆä¿®æ”¹å®Œå­—ç¬¦é›†ç¼–ç åå†æ–°å»ºmysqlåº“-è¡¨-æ’æ•°æ®
SHOW VARIABLES LIKE 'character%';
```

![image-20220815180730126](https://images.waer.ltd/img/solo-fetchupload-13053466134966946764-faaf7d80.png)

```sql
# å»ºåº“å»ºè¡¨
CREATE DATABASE t1
USE t1
CREATE TABLE user(id int,name varchar(20));
```

![image-20220815181117122](https://images.waer.ltd/img/solo-fetchupload-5307588143745079317-b2e2ddfa.png)

**ä½¿ç”¨**`navcat`å®¢æˆ·ç«¯è¿æ¥è¯¥æ•°æ®åº“è¿›è¡ŒåŸºæœ¬æµ‹è¯•

![image-20220815181834976](https://images.waer.ltd/img/solo-fetchupload-3456468250938236248-a7ce5701.png)

```sql
# æ–°å¢å’ŒæŸ¥è¯¢
INSERT user
VALUES(1,'ilikexff')

INSERT user
VALUES(2,'å…«å°ºå¦–å‰‘')

SELECT id,name 
FROM user
```

![image-20220815182611587](https://images.waer.ltd/img/solo-fetchupload-2169595883318097734-7371eab1.png)

> ç¬¬ä¸‰å›åˆä¸‹æ¥ï¼Œæ­¤æ—¶çš„`docker`å¯è°“æ˜¯ä¼¤æ•Œä¸€åƒï¼Œè‡ªæŸå…«ç™¾ã€‚å®ƒä¸æ›¾æƒ³è¿‡ï¼Œçœ¼å‰è¿™ä¸ª`5.7`åˆ«çœ‹é•¿çš„ä¸æ€ä¹ˆæ ·ï¼Œæ‰“èµ·æ¶æ¥å¯æ˜¯åˆç‹ åˆç¨³ï¼Œä¸€ç‚¹ä¹Ÿä¸å«ç³Šï¼Œç”šè‡³è¿˜è¯·æ¥äº†çŒ«å”çš„è¿œæˆ¿äº²æˆš`navcat`å¤§è¡¨å“¥åŠ©é˜µã€‚å¯ä¸ºäº†é¢å­ï¼Œ`docker`è¿˜å¾—è£…ä½œå•¥äº‹æ²¡æœ‰çš„è¡¨æƒ…ï¼Œè¿æ¥`5.7`çš„æœ€åä¸€å‡»â€¦â€¦

#### æ•°æ®æŒä¹…åŒ–æµ‹è¯•

**å¯ä»¥çœ‹åˆ°ï¼Œåœ¨å®¿ä¸»æœºä¸­å·²ç»æœ‰äº†æ•°æ®åº“çš„æ•°æ®æ–‡ä»¶ã€‚**

![image-20220815183756511](https://b3logfile.com/file/2022/08/solo-fetchupload-17854143796692009672-8ba14694.png)

```java
# å¯¹mysqlè¿›è¡Œåˆ åº“è·‘è·¯ï¼Œå†é‡å¯ï¼Œä»¥æµ‹è¯•ä¹‹å‰çš„æ•°æ®å·æ˜ å°„æ˜¯å¦èµ·åˆ°äº†æ•°æ®æŒä¹…åŒ–å¤‡ä»½çš„åŠŸèƒ½
docker rm -f mysql
# é‡æ–°è¿è¡Œmysql
docker run -d -p 3306:3306 --privileged=true -v /tools/mysql/log:/var/log/mysql -v /tools/mysql/data:/var/lib/mysql -v /tools/mysql/conf:/etc/mysql/conf.d -e MYSQL_ROOT_PASSWORD=123456  --name mysql mysql:5.7
```

![image-20220815184105977](https://b3logfile.com/file/2022/08/solo-fetchupload-2515771610511412997-2fcab004.png)

**å“‡å“¦ï¼Œæ•°æ®æœç„¶éƒ½åœ¨ï¼ŒçœŸä¸é”™ï¼æœ‰ç‚¹ä¸œè¥¿å•Šã€‚**

è¿™æ˜¯æœ€åä¸€ä¸ªå›åˆäº†ï¼Œä¸€æ¶ä¸‹æ¥ï¼Œ`mysql:5.7`çš„ä¼¤åŠ¿ä¸¥é‡ï¼Œäº”è„å…­è…‘éƒ½è¢«`docker`æ‘¸äº†ä¸ªéï¼Œå®ƒæ‚ç€èƒ¸å£å–˜æ¯:

> > `docker`å…„ä¸æ„§ä¸ºå¼€å‘ç•Œçš„åèµ·ä¹‹ç§€ï¼Œåœ¨ä¸‹ä½©æœï¼è¯æ¯•ï¼Œå®ƒåˆä¸€å£è€è¡€å–·å‡ºï¼ŒæŠŠæ‰¶ç€å®ƒçš„è¿œæ–¹å¤§è¡¨å“¥å–·äº†ä¸€è„¸éƒ½æ˜¯ã€‚
> >
> > å›ºä¸ºäº²æˆš,å¤§è¡¨å“¥å˜´ä¸Šä¸è¯´ï¼Œå¿ƒé‡Œä¸€é˜µå˜€å’•:
> >
> > > **æ·¦ï¼ï¼ä½ å†å–·ä¸€ä¸ªè¯•è¯•ï¼Œä¿¡ä¸ä¿¡åŠ³èµ„åæ‰‹ä¸€ä¸ªå¤§å˜´å·´å­ç›´æ¥æŠŠä½ é€èµ°ã€‚**
>
> **`docker`å®åœ¨æ˜¯ä¼¤çš„ä¸è½»ï¼Œå®ƒä¹Ÿé¡¾ä¸å¾—é¢å­ï¼Œèµ¶ç´§æå‡ºä¸æ—¶ä¹‹éœ€çš„é‡‘ç–®è¯å¾€è‚šçš®ä¸Šå°±æ˜¯é¡¿è´´ï¼Œæ¯•ç«Ÿè‡ªå·±å¤ªå‚²å¨‡ï¼Œå¸¸å¹´æ²¡æœ‰å¥èº«çš„å®ƒæ—©å°±å¤§è…¹ä¾¿ä¾¿ï¼Œè¿™æ¬¡å€’å¥½ï¼Œè¢«`mysql`è¿™å®¶ä¼™æ…äº†å‡ ä¸ªæ´ï¼Œæµ·æ°´ç›´æµ:**
>
> > **`mysql`,ä½ æ±Ÿæ¹–äººç§°ç¨³å¦‚è€ç‹—çš„åå·æœç„¶ä¸æ˜¯ç›–çš„ï¼Œä½ æ˜¯ä¸ªå€¼å¾—å°Šé‡çš„å¯¹æ‰‹ï¼Œè¿™æ¬¡å°±ä¸æ€ä½ äº†ï¼Œæˆ‘å¾—ä¿ç•™ä½“åŠ›ï¼Œåé¢è¿˜è¦æŒ‘æˆ˜`redis`å’Œ`nginx`ï¼Œä»–ä»¬ä¹Ÿéç­‰é—²ä¹‹è¾ˆï¼ï¼è¯´å®Œå°±èµ°äº†â€¦..**

### å®‰è£…Redis

å°½ç®¡å’Œ`mysql`é‚£ä¸€æˆ˜è‡ªå·±å—äº†é‡ä¼¤ï¼Œä½†å¥½åœ¨`docker`æœ‰ç¥–ä¼ çš„ç§˜ä¹¦ï¼Œä¸€é‡å¯åˆæ˜¯ä¸€ä¸ªå…¨æ–°çš„`docker`ä¹‹èº«ã€‚å®ƒé•¿é€”è·‹æ¶‰ï¼Œæ¥åˆ°`redis`å®¶é—¨å£ï¼Œæ‚„æ‚„é—¨ï¼Œæ­¤æ—¶ä¸€ä¸ªå¹´è½»çš„å°ä¼™å­æ‰“å¼€äº†é—¨ï¼š

> > ä½ å°±æ˜¯Redisï¼Ÿdockeré“ã€‚
>
> > å°ä¼™å­æ‘‡æ‘‡å¤´ï¼Œæˆ‘æ˜¯`jedis`,æˆ‘å¸ˆå‚…åœ¨å¥èº«æˆ¿ç­‰å€™ä½ å¤šæ—¶äº†ï¼Œè¿™è¾¹è¯·â€¦
>
> åœ¨`jedis`çš„å¸¦é¢†ä¸‹ï¼ŒäºŒäººæ¥åˆ°äº†ä¸€å¤„å®½æ•çš„å±‹å­ï¼Œé‡Œé¢æ‘†ç€å„å¼å„æ ·çš„å¥èº«å™¨æã€‚åœºåœ°ä¸­å¤®ï¼Œåªè§ä¸€äººæ­£åœ¨ä¸¾ç€ä»€ä¹ˆä¸œè¥¿ï¼Œç»†çœ‹å»ï¼ŒåŸæ¥æ˜¯ä¸€å¯¹å“‘é“ƒï¼Œåˆ†åˆ«æ ‡ç€`RDB`**å’Œ**`AOF`å­—æ ·ï¼Œä¸€çœ‹å°±çŸ¥é“æœ‰äº›åˆ†é‡ã€‚
>
> > `docker`äºŒè¯ä¸è¯´ï¼Œèº«ä¸Šçš„åŒ…è¢±ä¸€ç”©ï¼Œå¥”ç€`redis`åè„‘å‹ºå°±æ˜¯ä¸€æ²™åŒ…å¤§çš„æ‹³å¤´æŠ¡è¿‡å»ï¼Œä¸¤ä¸ªå¹´è½»äººçš„æˆ˜æ–—å°±æ­¤æ‹‰å¼€â€¦

### å®‰è£…Nginx

> å¾…æ›´æ–°....

****

## Dockerfile

### æ¦‚è¿°

`Dockerfile`æ˜¯ç”¨æ¥æ„å»º`Docker`é•œåƒçš„æ–‡æœ¬æ–‡ä»¶ï¼Œæ˜¯ç”±ä¸€æ¡æ¡æ„å»ºé•œåƒæ‰€éœ€çš„æŒ‡ä»¤å’Œå‚æ•°æ„æˆçš„è„šæœ¬ã€‚

![image-20220826105611886](https://images.waer.ltd/img/image-20220826105611886.png)

å®˜ç½‘ï¼šhttps://docs.docker.com/engine/reference/builder/

æ„å»ºæ­¥éª¤ï¼š

- ç¼–å†™Dockerfileæ–‡ä»¶
- docker buildå‘½ä»¤æ„å»ºé•œåƒ
- docker run ä¾é•œåƒè¿è¡Œå®¹å™¨å®ä¾‹

### Dockerfileæ„å»ºè¿‡ç¨‹

#### DocklerfileåŸºç¡€çŸ¥è¯†

- æ¯æ¡ä¿ç•™å­—æŒ‡ä»¤éƒ½å¿…é¡»æ˜¯**å¤§å†™å­—æ¯**ä¸”åé¢è¦è·Ÿéšè‡³å°‘ä¸€ä¸ªå‚æ•°ã€‚
- æŒ‡ä»¤ä»ä¸Šåˆ°ä¸‹é¡ºåºæ‰§è¡Œ
- \# è¡¨ç¤ºæ³¨é‡Šå†…å®¹
- æ¯æ¡æŒ‡ä»¤éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„é•œåƒå±‚å¹¶å¯¹é•œåƒè¿›è¡Œæäº¤

#### æ‰§è¡ŒDockerfileçš„å¤§è‡´æµç¨‹

- `docker`ä»åŸºç¡€é•œåƒè¿è¡Œä¸€ä¸ªå®¹å™¨
- æ‰§è¡Œä¸€æ¡æŒ‡ä»¤å¹¶å¯¹å®¹å™¨ä½œå‡ºä¿®æ”¹
- æ‰§è¡Œç±»ä¼¼`docker commit`çš„æ“ä½œæäº¤ä¸€ä¸ªæ–°çš„é•œåƒå±‚
- `docker`åœ¨åŸºäºåˆšæäº¤çš„é•œåƒè¿è¡Œä¸€ä¸ªæ–°çš„å®¹å™¨
- æ‰§è¡Œ`dockerfile`ä¸­çš„ä¸‹ä¸€æ¡æŒ‡ä»¤ç›´åˆ°æ‰€æœ‰æŒ‡ä»¤éƒ½æ‰§è¡Œå®Œæˆã€‚

æ‰€æœ‰æŒ‡ä»¤æ‰§è¡Œå®Œæˆã€‚

#### æ‰©å±•

ä»åº”ç”¨è½¯ä»¶çš„è§’åº¦æ¥çœ‹ï¼Œ`Dockerfile`ã€`Docker`é•œåƒä¸`Docker`å®¹å™¨åˆ†åˆ«ä»£è¡¨è½¯ä»¶çš„ä¸‰ä¸ªä¸åŒé˜¶æ®µï¼Œ

*  `Dockerfile`æ˜¯è½¯ä»¶çš„åŸææ–™
*  `Docker`é•œåƒæ˜¯è½¯ä»¶çš„äº¤ä»˜å“
*  `Docker`å®¹å™¨åˆ™å¯ä»¥è®¤ä¸ºæ˜¯è½¯ä»¶é•œåƒçš„è¿è¡Œæ€ï¼Œä¹Ÿå³ä¾ç…§é•œåƒè¿è¡Œçš„å®¹å™¨å®ä¾‹
   `Dockerfile`é¢å‘å¼€å‘ï¼Œ`Docker`é•œåƒæˆä¸ºäº¤ä»˜æ ‡å‡†ï¼Œ`Docker`å®¹å™¨åˆ™æ¶‰åŠéƒ¨ç½²ä¸è¿ç»´ï¼Œä¸‰è€…ç¼ºä¸€ä¸å¯ï¼ŒåˆåŠ›å……å½“`Docker`ä½“ç³»çš„åŸºçŸ³ã€‚

![image-20220826114215288](https://images.waer.ltd/img/image-20220826114215288.png)

1.  `Dockerfile`ï¼Œéœ€è¦å®šä¹‰ä¸€ä¸ª`Dockerfile`ï¼Œ`Dockerfile`å®šä¹‰äº†è¿›ç¨‹éœ€è¦çš„ä¸€åˆ‡ä¸œè¥¿ã€‚`Dockerfile`æ¶‰åŠçš„å†…å®¹åŒ…æ‹¬æ‰§è¡Œä»£ç æˆ–è€…æ˜¯æ–‡ä»¶ã€ç¯å¢ƒå˜é‡ã€ä¾èµ–åŒ…ã€è¿è¡Œæ—¶ç¯å¢ƒã€åŠ¨æ€é“¾æ¥åº“ã€æ“ä½œç³»ç»Ÿçš„å‘è¡Œç‰ˆã€æœåŠ¡è¿›ç¨‹å’Œå†…æ ¸è¿›ç¨‹(å½“åº”ç”¨è¿›ç¨‹éœ€è¦å’Œç³»ç»ŸæœåŠ¡å’Œå†…æ ¸è¿›ç¨‹æ‰“äº¤é“ï¼Œè¿™æ—¶éœ€è¦è€ƒè™‘å¦‚ä½•è®¾è®¡`namespace`çš„æƒé™æ§åˆ¶)ç­‰ç­‰;
2.  `Docker`é•œåƒï¼Œåœ¨ç”¨`Dockerfile`å®šä¹‰ä¸€ä¸ªæ–‡ä»¶ä¹‹åï¼Œ`docker build`æ—¶ä¼šäº§ç”Ÿä¸€ä¸ª`Docker`é•œåƒï¼Œå½“è¿è¡Œ `Docker`é•œåƒæ—¶ä¼šçœŸæ­£å¼€å§‹æä¾›æœåŠ¡;
3.  `Docker`å®¹å™¨ï¼Œå®¹å™¨æ˜¯ç›´æ¥æä¾›æœåŠ¡çš„ã€‚

### Dockerfileå¸¸ç”¨ä¿ç•™å­—

> ä¸‹é¢åˆ—å‡ºçš„ä¿ç•™å­—éƒ½å¯ä»¥åœ¨å®˜ç½‘æŸ¥çœ‹ã€‚

**FROM**

> åŸºç¡€é•œåƒï¼Œå½“å‰é•œåƒæ˜¯åŸºäºå“ªä¸ªé•œåƒçš„ï¼ŒæŒ‡å®šä¸€ä¸ªå·²ç»å­˜åœ¨çš„é•œåƒæœ€ä¸ºæ¨¡æ¿ï¼Œç¬¬ä¸€æ¡å¿…é¡»æ˜¯FROMã€‚

**MAINTAINER**

> é•œåƒç»´æŠ¤è€…çš„å§“åå’Œé‚®ç®±åœ°å€ã€‚

**RUN**

> - å®¹å™¨æ„å»ºæ—¶éœ€è¦è¿è¡Œçš„å‘½ä»¤ã€‚
>
> - æ ¼å¼
>
>   - shell
>
>     ![image-20220826114832066](https://images.waer.ltd/img/image-20220826114832066.png)
>
>   - exec
>
>     ![image-20220826114842611](https://images.waer.ltd/img/image-20220826114842611.png)
>
> - RUNæ˜¯åœ¨docker buildæ—¶è¿è¡Œã€‚

**EXPOSE**

> å½“å‰å®¹å™¨å¯¹å¤–æš´éœ²çš„ç«¯å£å·ã€‚

**WORKDIR**

> æŒ‡å®šåœ¨åˆ›å»ºå®¹å™¨ä¹‹åï¼Œç»ˆç«¯é»˜è®¤ç™»å½•è¿›æ¥çš„å·¥ä½œç›®å½•ï¼Œä½œä¸ºä¸€ä¸ªèµ·å§‹è½è„šç‚¹ã€‚

**USER**

> æŒ‡å®šè¯¥é•œåƒä»¥ä»€ä¹ˆæ ·çš„ç”¨æˆ·å»æ‰§è¡Œï¼Œå¦‚æœéƒ½ä¸æŒ‡å®šï¼Œé»˜è®¤æ˜¯rootã€‚

**ENV**

> - ç”¨æ¥åœ¨æ„å»ºé•œåƒè¿‡ç¨‹ä¸­è®¾ç½®ç¯å¢ƒå˜é‡ã€‚
>
> - `ENV MY_PATH /usr/mytest`
>
>   > è¿™ä¸ªç¯å¢ƒå˜é‡å¯ä»¥åœ¨åç»­çš„ä»»ä½•`RUN`æŒ‡ä»¤ä¸­ä½¿ç”¨ï¼Œè¿™å°±å¦‚åŒåœ¨å‘½ä»¤å‰é¢æŒ‡å®šäº†ç¯å¢ƒå˜é‡å‰ç¼€ä¸€æ ·ï¼›
>   > ä¹Ÿå¯ä»¥åœ¨å…¶å®ƒæŒ‡ä»¤ä¸­ç›´æ¥ä½¿ç”¨è¿™äº›ç¯å¢ƒå˜é‡ï¼Œ
>   >
>   > æ¯”å¦‚ï¼š`WORKDIR $MY_PATH`

**ADD**

> å°†å®¿ä¸»æœºç›®å½•ä¸‹çš„æ–‡ä»¶æ‹·è´è¿›é•œåƒä¸”ä¼šè‡ªåŠ¨å¤„ç†URLå’Œè§£å‹tarå‹ç¼©åŒ…ã€‚

**COPY** 

> ç±»ä¼¼ADDï¼Œæ‹·è´æ–‡ä»¶å’Œç›®å½•åˆ°é•œåƒä¸­ã€‚
> å°†ä»æ„å»ºä¸Šä¸‹æ–‡ç›®å½•ä¸­ <æºè·¯å¾„> çš„æ–‡ä»¶/ç›®å½•å¤åˆ¶åˆ°æ–°çš„ä¸€å±‚çš„é•œåƒå†…çš„ <ç›®æ ‡è·¯å¾„> ä½ç½®ã€‚
>
> > `COPY src dest`
> >
> > `COPY ["src", "dest"]`
> >
> > <srcæºè·¯å¾„>ï¼šæºæ–‡ä»¶æˆ–è€…æºç›®å½•
> > <destç›®æ ‡è·¯å¾„>ï¼šå®¹å™¨å†…çš„æŒ‡å®šè·¯å¾„ï¼Œè¯¥è·¯å¾„ä¸ç”¨äº‹å…ˆå»ºå¥½ï¼Œè·¯å¾„ä¸å­˜åœ¨çš„è¯ï¼Œä¼šè‡ªåŠ¨åˆ›å»ºã€‚

**VOLUME**

> å®¹å™¨æ•°æ®å·ï¼Œç”¨äºæ•°æ®ä¿å­˜å’ŒæŒä¹…åŒ–å·¥ä½œã€‚

**CMD**

> - æŒ‡å®šå®¹å™¨å¯åŠ¨åçš„è¦åšçš„äº‹æƒ…ã€‚
> - æ³¨æ„
>   - `Dockerfile `ä¸­å¯ä»¥æœ‰å¤šä¸ª `CMD `æŒ‡ä»¤ï¼Œä½†åªæœ‰æœ€åä¸€ä¸ªç”Ÿæ•ˆï¼Œ`CMD `ä¼šè¢« `docker run `ä¹‹åçš„å‚æ•°æ›¿æ¢
> - å®ƒå’Œå‰é¢RUNå‘½ä»¤çš„åŒºåˆ«
>   - `CMD`æ˜¯åœ¨`docker run `æ—¶è¿è¡Œã€‚
>   - `RUN`æ˜¯åœ¨ `docker build`æ—¶è¿è¡Œã€‚

**ENTRYPOINT**

> ä¹Ÿæ˜¯ç”¨æ¥æŒ‡å®šä¸€ä¸ªå®¹å™¨å¯åŠ¨æ—¶è¦è¿è¡Œçš„å‘½ä»¤
>
> ç±»ä¼¼äº `CMD `æŒ‡ä»¤ï¼Œä½†æ˜¯`ENTRYPOINT`ä¸ä¼šè¢«`docker run`åé¢çš„å‘½ä»¤è¦†ç›–ï¼Œ
> è€Œä¸”è¿™äº›å‘½ä»¤è¡Œå‚æ•°ä¼šè¢«å½“ä½œå‚æ•°é€ç»™ `ENTRYPOINT `æŒ‡ä»¤æŒ‡å®šçš„ç¨‹åºã€‚
>
> å‘½ä»¤æ ¼å¼/æ¡ˆä¾‹
>
> > å‘½ä»¤æ ¼å¼ï¼š
> > `ENTRYPOINT`å¯ä»¥å’Œ`CMD`ä¸€èµ·ç”¨ï¼Œä¸€èˆ¬æ˜¯å˜å‚æ‰ä¼šä½¿ç”¨ `CMD `ï¼Œè¿™é‡Œçš„ `CMD `ç­‰äºæ˜¯åœ¨ç»™ `ENTRYPOINT `ä¼ å‚ã€‚
> > å½“æŒ‡å®šäº†`ENTRYPOINT`åï¼Œ`CMD`çš„å«ä¹‰å°±å‘ç”Ÿäº†å˜åŒ–ï¼Œä¸å†æ˜¯ç›´æ¥è¿è¡Œå…¶å‘½ä»¤è€Œæ˜¯å°†`CMD`çš„å†…å®¹ä½œä¸ºå‚æ•°ä¼ é€’ç»™`ENTRYPOINT`æŒ‡ä»¤ï¼Œä»–ä¸¤ä¸ªç»„åˆä¼šå˜æˆ
> >
> > æ¡ˆä¾‹å¦‚ä¸‹ï¼šå‡è®¾å·²é€šè¿‡ `Dockerfile `æ„å»ºäº† `nginx:test `é•œåƒï¼š
> >
> > ![image-20220826115931550](https://images.waer.ltd/img/image-20220826115931550.png)
> >
> > | æ˜¯å¦ä¼ å‚         | æŒ‰ç…§`dockerfile`ç¼–å†™æ‰§è¡Œ         | ä¼ å‚è¿è¡Œ                                        |
> > | ---------------- | -------------------------------- | ----------------------------------------------- |
> > | Dockerå‘½ä»¤       | `docker run  nginx:test`         | `docker run  nginx:test -c /etc/nginx/new.conf` |
> > | è¡ç”Ÿå‡ºçš„å®é™…å‘½ä»¤ | `nginx -c /etc/nginx/nginx.conf` | `nginx -c /etc/nginx/new.conf`                  |
>
> ä¼˜ç‚¹
>
> > åœ¨æ‰§è¡Œ`docker run`çš„æ—¶å€™å¯ä»¥æŒ‡å®š `ENTRYPOINT `è¿è¡Œæ‰€éœ€çš„å‚æ•°ã€‚
>
> æ³¨æ„
>
> >  `Dockerfile `ä¸­å¦‚æœå­˜åœ¨å¤šä¸ª `ENTRYPOINT `æŒ‡ä»¤ï¼Œä»…æœ€åä¸€ä¸ªç”Ÿæ•ˆã€‚

### æ¡ˆä¾‹æ¼”ç¤º

####  æ„å»ºéœ€æ±‚

> åŸºäºæœ€æ–°ç‰ˆçš„`centos`é•œåƒæ„å»ºï¼Œä½¿å…·å¤‡`vim+ifconfig+jdk11`æ”¯æŒã€‚
>
> å…·ä½“ç‰ˆæœ¬:`jdk-11.0.16_linux-x64_bin.tar.gz`

å…³äº`JDK`çš„ä¸‹è½½åœ°å€

https://www.oracle.com/java/technologies/downloads

> æˆ‘å°†ä¸Šé¢ä¸‹è½½çš„JDKæ”¾åˆ°äº†/rootç›®å½•ä¸‹ã€‚

#### æ–‡ä»¶ç¼–å†™

> ç¼–å†™å†…å®¹ä¹‹å‰å…ˆpullä¸€ä¸‹`centos`é•œåƒã€‚
>
> ```bash
> docker pull centos
> ```

```dockerfile
FROM centos:7
MAINTAINER å…«å°ºå¦–å‰‘<ilikexff@163.com>
 
ENV MYPATH /usr/local
WORKDIR $MYPATH

#å®‰è£…vimç¼–è¾‘å™¨
RUN yum -y install vim
#å®‰è£…ifconfigå‘½ä»¤æŸ¥çœ‹ç½‘ç»œIP
RUN yum -y install net-tools
#å®‰è£…java8åŠlibåº“
RUN yum -y install glibc.i686
RUN mkdir /usr/local/java
#ADD æ˜¯ç›¸å¯¹è·¯å¾„jar,æŠŠjdk-11.0.16_linux-x64_bin.tar.gzæ·»åŠ åˆ°å®¹å™¨ä¸­,å®‰è£…åŒ…å¿…é¡»è¦å’ŒDockerfileæ–‡ä»¶åœ¨åŒä¸€ä½ç½®
ADD jdk-11.0.16_linux-x64_bin.tar.gz /usr/local/java/
#é…ç½®javaç¯å¢ƒå˜é‡
ENV JAVA_HOME /usr/local/java/jdk-11.0.16
ENV JRE_HOME $JAVA_HOME/jre
ENV CLASSPATH $JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar:$JRE_HOME/lib:$CLASSPATH
ENV PATH $JAVA_HOME/bin:$PATH

EXPOSE 80

CMD echo $MYPATH
CMD echo "success--------------ok"
CMD /bin/bash
```

åŒæ ·çš„ï¼ŒDockerfileæ–‡ä»¶ä¹Ÿæ”¾åœ¨å’ŒJDKç›¸åŒçš„/rootç›®å½•ä¸‹ã€‚

#### æ„å»ºDockerfile

```bash
docker build -t centosjava11:1.5 .
```

> æ ¼å¼:docker build -t æ–°é•œåƒåå­—:TAG .
>
> æ³¨æ„TAGåé¢æœ‰ä¸€ä¸ªç©ºæ ¼å†åŠ ä¸Š.(åŠè§’)

æ„å»ºè¿‡ç¨‹

![image-20220826192853279](https://images.waer.ltd/img/image-20220826192853279.png)

èƒ½çœ‹åˆ°ç¡®å®å·²ç»æ‰§è¡Œåˆ°äº†æ–‡ä»¶è„šæœ¬çš„æœ€åä¸€è¡Œå¹¶æ‰“å°äº†æˆåŠŸçš„è¾“å‡ºã€‚æŸ¥çœ‹é•œåƒå‘ç°ï¼Œç¡®å®å·²ç»æˆåŠŸæ„å»º

![image-20220826193004880](https://images.waer.ltd/img/image-20220826193004880.png)

é‚£ä¹ˆæ˜¯ä¸æ˜¯çœŸçš„å…·æœ‰äº†å‰é¢éœ€æ±‚ä¸­çš„åŠŸèƒ½ï¼Œæˆ‘ä»¬éªŒéªŒè´§ã€‚

```bash
docker run -it å®¹å™¨ID /bin/bash
```

![image-20220826193421296](https://images.waer.ltd/img/image-20220826193421296.png)

éªŒè¯é€šè¿‡ï¼Œéœ€æ±‚æåˆ°çš„æ‰€æœ‰åŠŸèƒ½å·²ç»å…¨éƒ¨æ”¯æŒã€‚

#### è™šæ‚¬é•œåƒä½“éªŒ

**æ¦‚å¿µ**

ä»“åº“åã€æ ‡ç­¾éƒ½æ˜¯<none>çš„é•œåƒï¼Œä¿—ç§°dangling 

æ¥è‡ªå·±åˆ›å»ºä¸€ä¸ªè™šæ‚¬é•œåƒä½“éªŒä¸€ä¸‹ã€‚ä¸‹é¢çš„`Dockerfile`çš„å†…å®¹:

```bash
from ubuntu
CMD echo 'action is success'
```

è¿è¡Œï¼š

```bash
docker build .
```

**æŸ¥çœ‹é•œåƒ**

```bash
# ä¸“é—¨æŸ¥çœ‹è™šæ‚¬é•œåƒçš„å‘½ä»¤
docker image ls -f dangling=true
```

![image-20220826194502455](https://images.waer.ltd/img/image-20220826194502455.png)

ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œè™šæ‚¬é•œåƒå¯èƒ½ç”±äºæˆ‘ä»¬å†åˆ›å»ºå’Œè¾“åˆ é™¤é•œåƒçš„è¿‡ç¨‹ä¸­å‡ºç°å¼‚å¸¸äº§ç”Ÿçš„ï¼Œæœ¬èº«å¹¶æ²¡æœ‰å®ç”¨ä»·å€¼ï¼Œæ‰€ä»¥å¦‚æœå‡ºç°è™šæ‚¬é•œåƒï¼Œå»ºè®®ç›´æ¥åˆ é™¤ï¼Œä¸è¦ç•™æ‹ï¼ï¼

**åˆ é™¤è™šæ‚¬é•œåƒ**

```bash
docker image prune
```

****

## Dockerå¾®æœåŠ¡å®æˆ˜

### é€šè¿‡IDEAæ–°å»ºä¸€ä¸ªæ™®é€šå¾®æœåŠ¡æ¨¡å—

- mavené…ç½®

  ```xml
  <?xml version="1.0" encoding="UTF-8"?>
  <project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
           xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd">
      <modelVersion>4.0.0</modelVersion>
      <parent>
          <groupId>org.springframework.boot</groupId>
          <artifactId>spring-boot-starter-parent</artifactId>
          <version>2.7.3</version>
          <relativePath/> <!-- lookup parent from repository -->
      </parent>
      <groupId>com.docker</groupId>
      <artifactId>docker-boot</artifactId>
      <version>0.0.1-SNAPSHOT</version>
      <name>docker-boot</name>
      <description>Demo project for Spring Boot</description>
      <properties>
          <java.version>11</java.version>
      </properties>
      <dependencies>
          <dependency>
              <groupId>org.springframework.boot</groupId>
              <artifactId>spring-boot-starter-web</artifactId>
          </dependency>
  
          <dependency>
              <groupId>org.springframework.boot</groupId>
              <artifactId>spring-boot-starter-test</artifactId>
              <scope>test</scope>
          </dependency>
      </dependencies>
  
      <build>
          <plugins>
              <plugin>
                  <groupId>org.springframework.boot</groupId>
                  <artifactId>spring-boot-maven-plugin</artifactId>
              </plugin>
          </plugins>
      </build>
  
  </project>
  ```

- application.properties

  ```yaml
  server.port=8081
  blog.addr=https://www.waer.ltd
  ```

- helloController.java

  ```java
  package com.waer.docker.dockerboot.controller;
  
  import org.springframework.beans.factory.annotation.Value;
  import org.springframework.web.bind.annotation.GetMapping;
  import org.springframework.web.bind.annotation.RestController;
  
  @SuppressWarnings("all")
  /**
   * @author: å…«å°ºå¦–å‰‘
   * @date: 2022/8/29 18:09
   * @email: ilikexff@gmail.com
   * @blog: https://www.waer.ltd
   */
  @RestController
  public class helloController {
      @Value("${server.port}")
      private String port;
      @Value("${blog.addr}")
      private String addr;
  
      @GetMapping("/hello/docker")
      public String helloDocker () {
          return "æœåŠ¡ç«¯å£å·:" + port + "åšå®¢åœ°å€:" + addr;
      }
  }
  ```

****

### å°†é¡¹ç›®æ‰“æˆjaråŒ…

![image-20220829183742924](https://images.waer.ltd/img/image-20220829183742924.png)

****

### ç¼–å†™Dockerfileæ–‡ä»¶å¹¶ä¸Šä¼ 

```dockerfile
# åŸºç¡€é•œåƒä½¿ç”¨java
FROM java:8
# ä½œè€…
MAINTAINER å…«å°ºå¦–å‰‘
# VOLUME æŒ‡å®šä¸´æ—¶æ–‡ä»¶ç›®å½•ä¸º/tmpï¼Œåœ¨ä¸»æœº/var/lib/dockerç›®å½•ä¸‹åˆ›å»ºäº†ä¸€ä¸ªä¸´æ—¶æ–‡ä»¶å¹¶é“¾æ¥åˆ°å®¹å™¨çš„/tmp
VOLUME /tmp
# å°†jaråŒ…æ·»åŠ åˆ°å®¹å™¨ä¸­å¹¶æ›´åä¸ºhello_docker.jar
ADD docker-boot-0.0.1-SNAPSHOT.jar hello_docker.jar
# è¿è¡ŒjaråŒ…
RUN bash -c 'touch /hello_docker.jar'
ENTRYPOINT ["java","-jar","/hello_docker.jar"]
#æš´éœ²8081ç«¯å£ä½œä¸ºå¾®æœåŠ¡
EXPOSE 8081
CMD echo 'æ„å»ºå®Œæˆ.....build success!'
```

ä¹‹åå°†å†™å¥½å¾—æ–‡ä»¶ä¸Šä¼ åˆ°`/root/docker`ç›®å½•ä¸‹ï¼Œå½“ç„¶è¿™ä¸ªç›®å½•ä½ å¯ä»¥è‡ªå®šä¹‰ï¼Œä½†æ˜¯å»ºè®®æŠŠjaråŒ…å’Œdockerfileæ”¾åˆ°ç›¸åŒç›®å½•ä¸‹ã€‚

![image-20220829190639024](https://images.waer.ltd/img/image-20220829190639024.png)

****

### æ„å»ºé•œåƒ

```bash
docker build -t hello_docker:1.5 .
```

![image-20220829191258216](https://images.waer.ltd/img/image-20220829191258216.png)

> docker images

![image-20220829191342153](https://images.waer.ltd/img/image-20220829191342153.png)

****

### è¿è¡Œå®¹å™¨

> è¿è¡Œå‘½ä»¤ä¹‹å‰è¯·ç¡®ä¿8081ç«¯å£å·²ç»æ‰“å¼€ã€‚

```bash
docker run -d -p 8081:8081 hello_docker:1.5
```

![image-20220829194859285](https://images.waer.ltd/img/image-20220829194859285.png)

**å¦‚æœåœ¨è¿è¡Œæ˜¯é‡åˆ°ä¸‹çš„é—®é¢˜**

![image-20220829194944787](https://images.waer.ltd/img/image-20220829194944787.png)

è¿™æ˜¯ç”±äºæ‰“åŒ…çš„æœ¬åœ°`Java`ç‰ˆæœ¬å’Œ`FROM `çš„`Java`ç‰ˆæœ¬ä¸ä¸€è‡´å¯¼è‡´çš„ï¼Œä¸¥æ ¼åœ°è¯´å°±æ˜¯ä½¿ç”¨é«˜ç‰ˆæœ¬æ‰“åŒ…çš„`jar`è¿è¡Œåœ¨ä½ç‰ˆæœ¬çš„`java`ç¯å¢ƒå¾—ä¸åˆ°æ”¯æŒã€‚è§£å†³æ–¹æ³•æ˜¯ä¿®æ”¹æœ¬åœ°`pom.xml`ï¼š

```xml
<properties>
    <java.version>1.8</java.version>
</properties>
```

ä¿®æ”¹ä¸º`1.8`å†åˆ·æ–°`maven`ä¹‹åé‡æ–°æ‰“åŒ…ä¸Šä¼ å³å¯è§£å†³ã€‚

****

## Dockerç½‘ç»œ

### å¼€å±€ä¸€æ¡å‘½(ä»¤)

åœ¨å®¿ä¸»æœºä¸Šå¯åŠ¨dockerä¹‹åï¼Œæˆ‘ä»¬é€šè¿‡`ifconfig`å‘½ä»¤æŸ¥çœ‹ä¸»æœºçš„ç½‘ç»œæƒ…å†µï¼š

![image-20220827180000423](https://images.waer.ltd/img/image-20220827180000423.png)

ä½ ä¼šå‘ç°è¿™é‡Œå¤šäº†ä¸€ä¸ªåä¸º`docker0`çš„ç½‘ç»œæ¨¡å—ã€‚ä¸ä¸¥æ ¼çš„è¯´ï¼Œè¿™ä¸ªå°±æ˜¯dockerçš„ç½‘ç»œã€‚

**æŸ¥çœ‹ç½‘ç»œæ¨¡å¼**

dockeré»˜è®¤æœ‰ä¸‰å¤§ç½‘ç»œæ¨¡å¼ï¼Œé€šè¿‡ä¸‹é¢çš„å‘½ä»¤å¯ä»¥æŸ¥çœ‹ã€‚

```bash
docker network ls
```

![image-20220827180746719](https://images.waer.ltd/img/image-20220827180746719.png)

åˆ†åˆ«æ˜¯æ¡¥æ¥ã€ä¸»æœºã€ç©ºæ¨¡å¼ã€‚

### è£…å¤‡å…¨é help

> äº†è§£å…³äº`doker`ç½‘ç»œçš„åŸºæœ¬å‘½ä»¤çš„ä½¿ç”¨ï¼Œæœ€å¿«çš„æ–¹å¼å°±æ˜¯å®˜æ–¹çš„`help`å‘½ä»¤ã€‚

```bash
docker network COMMAND --help
```

![image-20220827181152203](https://images.waer.ltd/img/image-20220827181152203.png)

é€šè¿‡ä¸€ä¸ªå°æ¡ˆä¾‹å®é™…æ“ä½œä¸€éä¸Šé¢çš„å¤§éƒ¨åˆ†å‘½ä»¤ã€‚æˆ‘ä»¬è‡ªå·±åˆ›å»ºä¸€ä¸ªdockerç½‘ç»œã€‚

```shll
docker network create mynet
```

æŸ¥çœ‹ç½‘ç»œ

```bash
docker network ls
```

æŸ¥çœ‹ç½‘ç»œæ•°æ®æº

```sh
docker network inspect mynet
```

åˆ é™¤ç½‘ç»œ

```bash
docker network rm mynet
```

**dockerç½‘ç»œå¯ä»¥ä½œå®¹å™¨çš„äº’è”å’Œé€šä¿¡ã€ç«¯å£æ˜ å°„ã€‚å®¹å™¨IPå˜åŠ¨æ—¶å¯ä»¥é€šè¿‡æœåŠ¡åç§°ç›´æ¥è¿›è¡Œç½‘ç»œé€šä¿¡ï¼Œè€Œä¸å—åˆ°å½±å“ã€‚**

### ç½‘ç»œæ¨¡å¼

![image-20220827182448518](https://images.waer.ltd/img/image-20220827182448518.png)

ä¸Šé¢åˆ—å‡ºçš„å››ç§æ¨¡å¼åˆ†åˆ«ä½¿ç”¨ä¸‹é¢çš„æ–¹å¼è¿›è¡ŒæŒ‡å®šï¼š

```bash
--network bridge æŒ‡å®šï¼Œé»˜è®¤ä½¿ç”¨docker0
--network hostæŒ‡å®š
--network noneæŒ‡å®š
--network container:NAMEæˆ–è€…å®¹å™¨IDæŒ‡å®š
```

**å®¹å™¨å®ä¾‹å†…é»˜è®¤ç½‘ç»œIPç”Ÿæˆè§„åˆ™**

å…ˆå¯åŠ¨ä¸¤ä¸ªå®¹å™¨

![image-20220827184218063](https://images.waer.ltd/img/image-20220827184218063.png)

å†é€šè¿‡`docker inspect å®¹å™¨å`æ¥æŸ¥çœ‹å®¹å™¨çš„ç½‘ç»œæƒ…å†µã€‚

![image-20220827184410564](https://images.waer.ltd/img/image-20220827184410564.png)

![image-20220827184551683](https://images.waer.ltd/img/image-20220827184551683.png)

å¯ä»¥çœ‹åˆ°ä¸¤ä¸ªéƒ½æ˜¯é‡‡ç”¨`bridge`æ¡¥æ¥æ¨¡å¼ä¸”å…¬ç”¨ä¸€ä¸ªç½‘å…³ï¼Œä½†å„è‡ªçš„IPæ˜¯ä¸ä¸€æ ·çš„ã€‚ä¹Ÿå°±æ˜¯è¯´**dockerå®¹å™¨å†…éƒ¨çš„ipæ˜¯æœ‰å¯èƒ½ä¼šå‘ç”Ÿæ”¹å˜çš„ã€‚**

#### bridge

`Docker `æœåŠ¡é»˜è®¤ä¼šåˆ›å»ºä¸€ä¸ª `docker0` ç½‘æ¡¥ï¼ˆå…¶ä¸Šæœ‰ä¸€ä¸ª `docker0` å†…éƒ¨æ¥å£ï¼‰ï¼Œè¯¥æ¡¥æ¥ç½‘ç»œçš„åç§°ä¸º`docker0`ï¼Œå®ƒåœ¨å†…æ ¸å±‚è¿é€šäº†å…¶ä»–çš„ç‰©ç†æˆ–è™šæ‹Ÿç½‘å¡ï¼Œè¿™å°±å°†æ‰€æœ‰å®¹å™¨å’Œæœ¬åœ°ä¸»æœºéƒ½æ”¾åˆ°åŒä¸€ä¸ªç‰©ç†ç½‘ç»œã€‚`Docker `é»˜è®¤æŒ‡å®šäº† `docker0 `æ¥å£ çš„ `IP `åœ°å€å’Œå­ç½‘æ©ç ï¼Œè®©ä¸»æœºå’Œå®¹å™¨ä¹‹é—´å¯ä»¥é€šè¿‡ç½‘æ¡¥ç›¸äº’é€šä¿¡ã€‚

æŸ¥çœ‹ `bridge `ç½‘ç»œçš„è¯¦ç»†ä¿¡æ¯ï¼Œå¹¶é€šè¿‡ `grep `è·å–åç§°é¡¹

```bash
docker network inspect bridge | grep nameæˆ–è€…ifcong | grep docker
```

![image-20220827185858829](https://images.waer.ltd/img/image-20220827185858829.png)

****

## Docker-composeå®¹å™¨ç¼–æ’

### æ¦‚è¿°

`Compose `æ˜¯ `Docker `å…¬å¸æ¨å‡ºçš„ä¸€ä¸ªå·¥å…·è½¯ä»¶ï¼Œå¯ä»¥ç®¡ç†å¤šä¸ª `Docker `å®¹å™¨ç»„æˆä¸€ä¸ªåº”ç”¨ã€‚ä½ éœ€è¦å®šä¹‰ä¸€ä¸ª `YAML `æ ¼å¼çš„é…ç½®æ–‡ä»¶`docker-compose.yml`ï¼Œå†™å¥½å¤šä¸ªå®¹å™¨ä¹‹é—´çš„è°ƒç”¨å…³ç³»ã€‚ç„¶åï¼Œåªè¦ä¸€ä¸ªå‘½ä»¤ï¼Œå°±èƒ½åŒæ—¶å¯åŠ¨/å…³é—­è¿™äº›å®¹å™¨ã€‚

`docker`å»ºè®®æˆ‘ä»¬æ¯ä¸€ä¸ªå®¹å™¨ä¸­åªè¿è¡Œä¸€ä¸ªæœåŠ¡,å› ä¸º`docker`å®¹å™¨æœ¬èº«å ç”¨èµ„æºæå°‘,æ‰€ä»¥æœ€å¥½æ˜¯å°†æ¯ä¸ªæœåŠ¡å•ç‹¬çš„åˆ†å‰²å¼€æ¥ä½†æ˜¯è¿™æ ·æˆ‘ä»¬åˆé¢ä¸´äº†ä¸€ä¸ªé—®é¢˜ï¼Ÿå¦‚æœæˆ‘éœ€è¦åŒæ—¶éƒ¨ç½²å¥½å¤šä¸ªæœåŠ¡,éš¾é“è¦æ¯ä¸ªæœåŠ¡å•ç‹¬å†™`Dockerfile`ç„¶ååœ¨æ„å»ºé•œåƒ,æ„å»ºå®¹å™¨,è¿™æ ·ç´¯éƒ½ç´¯æ­»äº†,æ‰€ä»¥`docker`å®˜æ–¹ç»™æˆ‘ä»¬æä¾›äº†`docker-compose`å¤šæœåŠ¡éƒ¨ç½²çš„å·¥å…·ã€‚

ä¾‹å¦‚è¦å®ç°ä¸€ä¸ªWebå¾®æœåŠ¡é¡¹ç›®ï¼Œé™¤äº†`Web`æœåŠ¡å®¹å™¨æœ¬èº«ï¼Œå¾€å¾€è¿˜éœ€è¦å†åŠ ä¸Šåç«¯çš„æ•°æ®åº“`mysql`æœåŠ¡å®¹å™¨ï¼Œ`redis`æœåŠ¡å™¨ï¼Œæ³¨å†Œä¸­å¿ƒ`eureka`ï¼Œç”šè‡³è¿˜åŒ…æ‹¬è´Ÿè½½å‡è¡¡å®¹å™¨ç­‰ç­‰ã€‚

`Compose`å…è®¸ç”¨æˆ·é€šè¿‡ä¸€ä¸ªå•ç‹¬çš„`docker-compose.yml`æ¨¡æ¿æ–‡ä»¶ï¼ˆ`YAML `æ ¼å¼ï¼‰æ¥å®šä¹‰ä¸€ç»„ç›¸å…³è”çš„åº”ç”¨å®¹å™¨ä¸ºä¸€ä¸ªé¡¹ç›®ï¼ˆ`project`ï¼‰ã€‚

å¯ä»¥å¾ˆå®¹æ˜“åœ°ç”¨ä¸€ä¸ªé…ç½®æ–‡ä»¶å®šä¹‰ä¸€ä¸ªå¤šå®¹å™¨çš„åº”ç”¨ï¼Œç„¶åä½¿ç”¨ä¸€æ¡æŒ‡ä»¤å®‰è£…è¿™ä¸ªåº”ç”¨çš„æ‰€æœ‰ä¾èµ–ï¼Œå®Œæˆæ„å»ºã€‚`Docker-Compose` è§£å†³äº†å®¹å™¨ä¸å®¹å™¨ä¹‹é—´å¦‚ä½•ç®¡ç†ç¼–æ’çš„é—®é¢˜ã€‚

****

### ä¸‹è½½å®‰è£…

ä¸‹è½½å®‰è£…å­¦ä¹ ï¼Œé¦–é€‰å®˜æ–¹æ–‡æ¡£ã€‚

[ä¸‹è½½åœ°å€](https://docs.docker.com/compose/install/)

[æ–‡æ¡£åœ°å€](https://docs.docker.com/compose/compose-file/compose-file-v3/)

~~æ³¨æ„å…ˆå»å®˜æ–¹æ–‡æ¡£çœ‹ä¸€ä¸‹composeå’Œdockerç‰ˆæœ¬ä¹‹é—´çš„è¦æ±‚ï¼Œåˆ«çœ‹ç€å‘½ä»¤å°±æ˜¯ä¸€é¡¿çæï¼Œç»“æœä¸‹äº†ä¸ªå¯‚å¯..~~

#### å…·ä½“å‘½ä»¤

```bash
# ä¸‹è½½compose
curl -SL https://github.com/docker/compose/releases/download/v2.7.0/docker-compose-linux-x86_64 -o $DOCKER_CONFIG/cli-plugins/docker-compose
# æå‡æƒé™
chmod +x /usr/local/bin/docker-compose
# æŸ¥çœ‹ç‰ˆæœ¬
docker-compose --version
```

### æ ¸å¿ƒæ¦‚å¿µ

#### æ–‡ä»¶

`docker-compose.yml`

#### æœåŠ¡(service)

ä¸€ä¸ªä¸ªåº”ç”¨å®¹å™¨å®ä¾‹ï¼Œæ¯”å¦‚è®¢å•æœåŠ¡ã€åº“å­˜æœåŠ¡ã€`mysql`å®¹å™¨ã€`nginx`å®¹å™¨æˆ–è€…`redis`å®¹å™¨ã€‚

#### å·¥ç¨‹(project)

ç”±ä¸€ç»„å…³è”çš„åº”ç”¨å®¹å™¨ç»„æˆçš„ä¸€ä¸ªå®Œæ•´çš„ä¸šåŠ¡å•å…ƒï¼Œåœ¨`docker-compose.yml`ä¸­å®šä¹‰ã€‚

****

### ä½¿ç”¨æ­¥éª¤

- ç¼–å†™`Dockerfile`å®šä¹‰å„ä¸ªå¾®æœåŠ¡åº”ç”¨å¹¶æ„å»ºå‡ºå¯¹åº”çš„é•œåƒæ–‡ä»¶ã€‚
- ä½¿ç”¨`docker-compose.yml`å®šä¹‰ä¸€ä¸ªå®Œæ•´çš„ä¸šåŠ¡å•å…ƒï¼Œå®‰æ’å¥½æ•´ä½“åº”ç”¨ä¸­çš„å„ä¸ªå®¹å™¨æœåŠ¡ã€‚
- æ‰§è¡Œ`docker-compose up`å‘½ä»¤æ¥å¯åŠ¨å¹¶è¿è¡Œæ•´ä¸ªåº”ç”¨ç¨‹åºï¼Œå®Œæˆä¸€é”®éƒ¨ç½²ä¸Šçº¿ã€‚

****

### Composeå¸¸ç”¨å‘½ä»¤

```bash
# å¸®åŠ©
docker-compose -h
# å¯åŠ¨æ‰€æœ‰çš„docker-composeæœåŠ¡
docker-compose up
# å¯åŠ¨æœåŠ¡å¹¶ä¿æŒåå°è¿è¡Œ
docker-compose up -d
# åœæ­¢å¹¶åˆ é™¤å®¹å™¨ã€ç½‘ç»œã€å·ã€é•œåƒ
docker-compose down
# è¿›å…¥å®¹å™¨å®ä¾‹å†…éƒ¨
 docker-compose exec [docker-compose.ymlæ–‡ä»¶ä¸­å†™çš„æœåŠ¡id] /bin/bash
# å±•ç¤ºå½“å‰docker-composeç¼–æ’è¿‡çš„è¿è¡Œçš„æ‰€æœ‰å®¹å™¨
docker-compose ps
# å±•ç¤ºå½“å‰docker-composeç¼–æ’è¿‡çš„å®¹å™¨è¿›ç¨‹
docker-compose top
# æ£€æŸ¥é…ç½®
docker-compose config
# æ£€æŸ¥é…ç½®ï¼Œæœ‰é—®é¢˜æ‰æœ‰è¾“å‡º
docker-compose config -q
# é‡å¯æœåŠ¡
docker-compose restart   
# å¯åŠ¨æœåŠ¡
docker-compose start     
# åœæ­¢æœåŠ¡
docker-compose stop      
```

****

## Portainer

### æ¦‚è¿°

`Portainer `æ˜¯ä¸€æ¬¾è½»é‡çº§çš„åº”ç”¨ï¼Œå®ƒæä¾›äº†å›¾å½¢åŒ–ç•Œé¢ï¼Œç”¨äºæ–¹ä¾¿åœ°ç®¡ç†Dockerç¯å¢ƒï¼ŒåŒ…æ‹¬å•æœºç¯å¢ƒå’Œé›†ç¾¤ç¯å¢ƒã€‚

[å®˜æ–¹æ–‡æ¡£](https://docs.portainer.io/v/ce-2.9/start/install/server/docker/linux)

### ä¸‹è½½å®‰è£…

> å…·ä½“çš„å®‰è£…ç»†èŠ‚å¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼Œæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤å¯ä»¥ç›´æ¥å®‰è£…ä¹‹ã€‚

```bash
docker run -d -p 8000:8000 -p 9000:9000 --name portainer     --restart=always     -v /var/run/docker.sock:/var/run/docker.sock     -v portainer_data:/data     portainer/portainer
```

å…¶å®æœ¬è´¨ä¸Šå°±æ˜¯è·‘äº†ä¸€ä¸ªå®¹å™¨ï¼Œæ³¨æ„éœ€è¦æ‰“å¼€9000å’Œ8000ç«¯å£ã€‚å®¹å™¨è·‘èµ·æ¥ä¹‹åï¼Œæµè§ˆå™¨è®¿é—®`IP:9000`å³å¯æ‰“å¼€ç®¡ç†é¡µé¢ã€‚

![image-20220901155124820](https://images.waer.ltd/img/image-20220901155124820.png)

è®¾ç½®å¯†ç æ³¨å†Œä¹‹åå¯ä»¥çœ‹åˆ°ä¸»æ¨¡æ¿æ¦‚è§ˆå¦‚ä¸‹ã€‚

![image-20220901155246297](https://images.waer.ltd/img/image-20220901155246297.png)

è‡³æ­¤å®‰è£…å®Œæ¯•ï¼

****

### ä½¿ç”¨Portainerå®‰è£…Ngnix

![image-20220901155640473](https://images.waer.ltd/img/image-20220901155640473.png)

åŸºæœ¬çš„é…ç½®å°±æ˜¯è¿™æ ·ï¼Œå¦‚æœå¯¹ç½‘ç»œã€æ•°æ®å·æŒ‚è½½ç­‰å¤æ‚çš„æ“ä½œï¼ŒæŠŠé¡µé¢ä¸‹æ‹‰å°±å¯ä»¥çœ‹åˆ°ï¼Œå¦‚æœäº†è§£äº†å‘½ä»¤è¡Œçš„ä½¿ç”¨æ–¹å¼ä»¥åŠåŸºæœ¬åŸç†ï¼Œé‚£ä¹ˆå¯è§†åŒ–å°±æ›´å®¹æ˜“ç†è§£äº†ã€‚

****

è¿™ç¯‡åšå®¢å…¨éƒ¨å†…å®¹å°±æš‚æ—¶å›ºå®šäº†ï¼Œåé¢æœ‰æ—¶é—´ä¼šè¡¥æ›´ä¸€äº›å®æˆ˜æ–¹é¢çš„å†…å®¹ï¼Œæ¯•ç«Ÿçº¸ä¸Šå¾—æ¥ç»ˆè§‰æµ…ï¼