
+++
title = "Slf4jä¸Logbackå®ç”¨æŒ‡å—(åŸºäºGradle)"
date = 2024-04-24
tags = ["SLF4J", "Logback", "Java", "æ—¥å¿—æ¡†æ¶", "Gradle"]
description = "æ·±å…¥ä»‹ç»SLF4Jå’ŒLogbackæ—¥å¿—æ¡†æ¶çš„ä½¿ç”¨æ–¹æ³•ï¼ŒåŒ…æ‹¬é…ç½®ã€Appenderã€è¿‡æ»¤å™¨ç­‰é«˜çº§ç‰¹æ€§ï¼ŒåŸºäºGradleæ„å»ºå·¥å…·çš„å®ç”¨æŒ‡å—ã€‚"
+++

## 1. å¼•ç›

åœ¨å½“ä»Šè½¯ä»¶å¼€å‘é¢†åŸŸï¼Œæ—¥å¿—è®°å½•æ˜¯ä¸€é¡¹è‡³å…³é‡è¦çš„ä»»åŠ¡ï¼Œå®ƒä¸ä»…å¸®åŠ©å¼€å‘äººå‘˜è·Ÿè¸ªåº”ç”¨ç¨‹åºçš„è¿è¡ŒçŠ¶æ€å’Œè¡Œä¸ºï¼Œè¿˜æœ‰åŠ©äºæ•…éšœæ’æŸ¥ã€æ€§èƒ½ä¼˜åŒ–å’Œå®‰å…¨ç›‘æ§ã€‚åœ¨æ—¥å¿—è®°å½•é¢†åŸŸï¼Œslf4jï¼ˆSimple Logging Facade for Javaï¼‰å’Œlogbackæ˜¯ä¸¤ä¸ªå¤‡å—æ¨å´‡çš„å·¥å…·ï¼Œå®ƒä»¬ä¸º Java åº”ç”¨ç¨‹åºæä¾›äº†å¼ºå¤§è€Œçµæ´»çš„æ—¥å¿—è®°å½•åŠŸèƒ½ã€‚

slf4jä½œä¸ºä¸€ä¸ªç®€å•çš„æ—¥å¿—é—¨é¢ï¼Œæä¾›äº†ç»Ÿä¸€çš„æ—¥å¿—è®°å½•æ¥å£ï¼Œä½¿å¼€å‘äººå‘˜èƒ½å¤Ÿè½»æ¾åˆ‡æ¢ä¸åŒçš„æ—¥å¿—å®ç°æ¡†æ¶ï¼Œè€Œæ— éœ€ä¿®æ”¹åº”ç”¨ç¨‹åºçš„ä»£ç ã€‚è€Œlogbackåˆ™æ˜¯slf4jçš„ä¸€ä¸ªå®ç°ï¼Œå®ƒæä¾›äº†é«˜æ€§èƒ½ã€çµæ´»æ€§å¼ºçš„æ—¥å¿—æ¡†æ¶ï¼Œå¯ä»¥æ»¡è¶³å„ç§æ—¥å¿—è®°å½•éœ€æ±‚ã€‚

æœ¬æ–‡å°†æ·±å…¥æ¢è®¨slf4jå’Œlogbackæ—¥å¿—æ¡†æ¶çš„æ ¸å¿ƒæ¦‚å¿µã€ä½¿ç”¨æ–¹æ³•ã€æœ€ä½³å®è·µä»¥åŠé«˜çº§æŠ€å·§ã€‚æˆ‘ä»¬å°†ä»‹ç»å¦‚ä½•é…ç½®æ—¥å¿—è®°å½•å™¨ã€å¦‚ä½•ä½¿ç”¨æ ‡è®°ï¼ˆMarkersï¼‰æ¥åŒºåˆ†æ—¥å¿—æ¶ˆæ¯ã€å¦‚ä½•è¿›è¡Œæ—¥å¿—çº§åˆ«çš„åŠ¨æ€è°ƒæ•´ä»¥åŠå¦‚ä½•åˆ©ç”¨logbackçš„å„ç§åŠŸèƒ½æ¥ä¼˜åŒ–æ—¥å¿—è®°å½•ä½“éªŒã€‚

é€šè¿‡æœ¬æ–‡çš„é˜è¿°ï¼Œè¯»è€…å°†èƒ½å¤Ÿæ›´å¥½åœ°ç†è§£å’Œåˆ©ç”¨slf4jä¸logbackè¿™ä¸¤ä¸ªå¼ºå¤§çš„æ—¥å¿—è®°å½•å·¥å…·ï¼Œä»è€Œæå‡åº”ç”¨ç¨‹åºçš„æ—¥å¿—è®°å½•è´¨é‡ã€æ•ˆç‡å’Œå¯ç»´æŠ¤æ€§ã€‚è®©æˆ‘ä»¬ä¸€èµ·æ·±å…¥æ¢ç´¢æ—¥å¿—è®°å½•çš„ä¸–ç•Œï¼ŒæŒæ¡slf4jä¸logbackçš„ç²¾é«“ï¼Œä¸ºæˆ‘ä»¬çš„è½¯ä»¶å¼€å‘ä¹‹è·¯å¢æ·»ä¸€ä»½æŠ€æœ¯çš„å…‰å½©ã€‚

å…ˆç®€å•çœ‹ä¸€ä¸‹æœ¬æ–‡çš„å¤§çº²ï¼š

![image-20240424222613795](https://images.waer.ltd/notes/image-20240424222613795.png)

---

## 2. SLF4Jæ¡†æ¶

`SLF4J`ï¼ˆ**Simple Logging Facade for Java**ï¼‰æ˜¯ä¸€ä¸ªä¸º Java åº”ç”¨ç¨‹åºæä¾›æ—¥å¿—åŠŸèƒ½çš„ç®€å•æ—¥å¿—é—¨é¢æ¡†æ¶ã€‚å®ƒçš„è®¾è®¡ç›®çš„æ˜¯é€šè¿‡æä¾›ä¸€ä¸ªç»Ÿä¸€çš„æ—¥å¿—æ¥å£ï¼Œä½¿å¾—åº”ç”¨ç¨‹åºèƒ½å¤Ÿåœ¨ä¸åŒçš„æ—¥å¿—å®ç°ï¼ˆå¦‚`Logback`ã€`Log4j`ã€`java.util.logging`ç­‰ï¼‰ä¹‹é—´è¿›è¡Œåˆ‡æ¢ï¼Œè€Œæ— éœ€ä¿®æ”¹åº”ç”¨ç¨‹åºçš„ä»£ç ã€‚

çœ‹é‡ç‚¹ï¼Œä»–æ˜¯ä¸€ä¸ªç»Ÿä¸€æ¥å£çš„å®ç°è§„èŒƒï¼Œè€Œä¸æ˜¯å…·ä½“çš„å®ç°æä¾›è€…ï¼ŒåŸºäºæ­¤ï¼Œå¾ˆå¤šå…·ä½“çš„æ—¥å¿—å®ç°å·¥å…·éƒ½å¯ä»¥åœ¨åœ¨è¿™ä¸ªæ¡ä»¶ä¸‹è¿›è¡Œè‡ªå·±çš„å®ç°ï¼Œæœ€å¸¸ç”¨çš„æœ‰`Logbackã€Log4j`ã€‚

![image-20240424170420302](https://images.waer.ltd/notes/image-20240424170420302.png)

ä½¿ç”¨`slf4j`çš„å‡ ç‚¹ç†ç”±:

1. çµæ´»æ€§é«˜ï¼š`SLF4J `æä¾›äº†ä¸€ä¸ªç»Ÿä¸€çš„æ—¥å¿—é—¨é¢ï¼Œä½¿å¾—åº”ç”¨ç¨‹åºå¯ä»¥è½»æ¾åœ°åˆ‡æ¢å’Œé…ç½®ä¸åŒçš„æ—¥å¿—å®ç°æ¡†æ¶ï¼Œè€Œæ— éœ€ä¿®æ”¹åº”ç”¨ç¨‹åºçš„ä»£ç ã€‚
2. ä¸°å¯Œçš„å¯é€‰å®ç°: ä»–æä¾›ä¸æ‰€æœ‰æµè¡Œçš„æ—¥å¿—æ¡†æ¶çš„æ”¯æŒï¼Œå¦‚ä¸Šé¢çš„æåˆ°çš„`log4j,logback`ç­‰ç­‰ï¼Œå¯ä»¥åœ¨å…¶ä¸­æ ¹æ®éœ€æ±‚æ— ç¼åˆ‡æ¢ï¼›
3. ç”±äº `SLF4J `å°†åº”ç”¨ç¨‹åºå’Œæ—¥å¿—æ¡†æ¶è§£è€¦ï¼Œå› æ­¤å¯ä»¥è½»æ¾åœ°ç¼–å†™ç‹¬ç«‹äºæ—¥å¿—æ¡†æ¶çš„åº”ç”¨ç¨‹åºã€‚æ— éœ€ä¸ºç”¨äºç¼–å†™åº”ç”¨ç¨‹åºçš„æ—¥å¿—è®°å½•æ¡†æ¶è€Œçƒ¦æ¼ã€‚
4. `SLF4J `æ”¯æŒå‚æ•°åŒ–æ—¥å¿—è®°å½•æ¶ˆæ¯ï¼Œä¸”ä¸å—é™äºä½ ä½¿ç”¨å“ªä¸€ç§å…·ä½“å®ç°ï¼›

---

### 2.1 åŸºæœ¬ç»„ä»¶

![image-20240424171738737](https://images.waer.ltd/notes/image-20240424171738737.png)

ä¸€æ¬¾æ—¥å¿—è®°å½•æ¡†æ¶ä¸€èˆ¬ç”±ä»¥ä¸‹ä¸‰ç§è§£æ„æ„æˆï¼š

- è®°å½•
  - ç”¨äºæ•è·æ•°æ®å’Œè®°å½•æ¶ˆæ¯
- æ ¼å¼åŒ–
  - å¯ä»¥è®²è®°å½•çš„æ¶ˆæ¯ä¹Ÿå°±æ˜¯æˆ‘ä»¬æ‰€è°“çš„æ—¥å¿—ä¿¡æ¯è¿›è¡Œæ ¼å¼åŒ–ï¼Œè§„èŒƒè¾“å‡ºï¼›
- å¤„ç†æ–¹å¼
  - å°†æ—¥å¿—ä¿¡æ¯é€šè¿‡æ§åˆ¶å°ã€æ–‡ä»¶ã€æ•°æ®åº“ç­‰è½½ä½“è¿›è¡Œè¾“å‡ºå¤„ç†ï¼›

---

### 2.2 æ—¥å¿—çº§åˆ«

æ ¹æ®æ—¥å¿—æ¶ˆæ¯çš„é‡è¦ç¨‹åº¦ï¼Œæˆ–è€…è¯´å¯¹é¡¹ç›®å½±å“ç¨‹åº¦çš„ä¸åŒï¼Œæ—¥å¿—ä¸€èˆ¬æœ‰ä¸åŒçš„çº§åˆ«:

![image-20240424172222270](https://images.waer.ltd/notes/image-20240424172222270.png)

- **TRACEï¼š** **æœ€ä½çº§åˆ«çš„æ—¥å¿—**ï¼Œé€šå¸¸ç”¨äºè®°å½•ç¨‹åºæ‰§è¡Œè¿‡ç¨‹ä¸­çš„è¯¦ç»†ä¿¡æ¯ï¼Œå¦‚æ–¹æ³•è°ƒç”¨ã€å˜é‡å€¼ç­‰ã€‚`TRACE `çº§åˆ«çš„æ—¥å¿—å¯¹äºæ’æŸ¥é—®é¢˜å’Œè°ƒè¯•éå¸¸æœ‰ç”¨ï¼Œä½†**é€šå¸¸ä¸ä¼šåœ¨ç”Ÿäº§ç¯å¢ƒä¸­å¯ç”¨ï¼Œå› ä¸ºä¼šäº§ç”Ÿå¤§é‡è¾“å‡º**ã€‚
- **DEBUGï¼š** ç”¨äº**è®°å½•è°ƒè¯•ä¿¡æ¯**ã€‚`DEBUG `çº§åˆ«çš„æ—¥å¿—é€šå¸¸ç”¨äºè®°å½•ç¨‹åºæ‰§è¡Œè¿‡ç¨‹ä¸­çš„è¯¦ç»†ä¿¡æ¯ï¼Œä½†ç›¸**æ¯” TRACE çº§åˆ«æ›´åŠ ç²¾ç®€**ã€‚åœ¨**å¼€å‘å’Œæµ‹è¯•é˜¶æ®µ**å¯ç”¨ `DEBUG `æ—¥å¿—æœ‰åŠ©äºå®šä½é—®é¢˜å’Œè°ƒè¯•ä»£ç ã€‚
- **INFOï¼š** ç”¨äºè®°å½•ç¨‹åº**è¿è¡Œæ—¶çš„é‡è¦ä¿¡æ¯**ã€‚`INFO `çº§åˆ«çš„æ—¥å¿—é€šå¸¸ç”¨äºè®°å½•ç¨‹åºçš„è¿è¡ŒçŠ¶æ€ã€é‡è¦äº‹ä»¶ç­‰ï¼Œå¯ä»¥å¸®åŠ©äº†è§£ç¨‹åºçš„è¿è¡Œæƒ…å†µï¼Œä½†ä¸ä¼šäº§ç”Ÿè¿‡å¤šçš„è¾“å‡ºã€‚
- **WARNï¼š** ç”¨äº**è®°å½•è­¦å‘Šä¿¡æ¯**ã€‚`WARN `çº§åˆ«çš„æ—¥å¿—é€šå¸¸è¡¨ç¤ºä¸€äº›**æ½œåœ¨çš„é—®é¢˜æˆ–å¼‚å¸¸æƒ…å†µ**ï¼Œè™½ç„¶ä¸ä¼šå¯¼è‡´ç¨‹åºå‡ºé”™ï¼Œä½†å¯èƒ½éœ€è¦æ³¨æ„æˆ–å¤„ç†ã€‚
- **ERRORï¼š** ç”¨äº**è®°å½•é”™è¯¯ä¿¡æ¯**ã€‚`ERROR `çº§åˆ«çš„æ—¥å¿—è¡¨ç¤ºç¨‹åºå‘ç”Ÿäº†**é”™è¯¯æˆ–å¼‚å¸¸æƒ…å†µ**ï¼Œéœ€è¦å¼•èµ·å…³æ³¨å¹¶å¯èƒ½éœ€è¦è¿›è¡Œå¤„ç†æˆ–ä¿®å¤ã€‚
- **FATALï¼š** **æœ€é«˜çº§åˆ«çš„æ—¥å¿—ï¼Œç”¨äºè®°å½•ä¸¥é‡é”™è¯¯**ã€‚`FATAL `çº§åˆ«çš„æ—¥å¿—è¡¨ç¤ºç¨‹åºé‡åˆ°äº†æ— æ³•æ¢å¤çš„ä¸¥é‡é”™è¯¯ï¼Œ**å¯èƒ½ä¼šå¯¼è‡´ç¨‹åºå´©æºƒæˆ–æ— æ³•ç»§ç»­è¿è¡Œã€‚**

> è™½ç„¶è¿™é‡Œåˆ—å‡ºäº†6ä¸­çº§åˆ«ï¼Œä½†æ—¥å¸¸ä½¿ç”¨è¿‡ç¨‹ä¸­`fatal`å’Œ`trace`ç”¨çš„ä¸æ˜¯å¾ˆå¤šã€‚

---

###  2.3 Slf4JåŸºæœ¬ä½¿ç”¨

> æ¼”ç¤ºé¡¹ç›®åŸºäºï¼š
>
> - `SpringBoot 3.2.10`
> - `Gradle:8.7`
> - `JDK 17`

- æ·»åŠ ä¾èµ–

``groovy
// https://mvnrepository.com/artifact/org.slf4j/slf4j-api
implementation 'org.slf4j:slf4j-api:2.0.13'
```

æˆ‘ä»¬å¯ä»¥é€šè¿‡`slf4j`æä¾›çš„å·¥å‚æ–¹æ³•åˆ›å»ºä¸€ä¸ªç®€å•æ—¥å¿—å¯¹è±¡,å¯¼åŒ…çš„æ—¶å€™æ³¨æ„çœ‹æ˜¯`import org.slf4j.Logger;`ï¼Œå› ä¸ºè¿˜æœ‰ä¸€ä¸ªåŒåçš„`Logger`æ¥è‡ª`java.util*`åŒ…ä¸‹ï¼Œæ³¨æ„åŒºåˆ†ã€‚

```java
Logger logger = LoggerFactory.getLogger("SampleLogger");
```

> 1. **`Logger `æ¥å£ï¼š**
>    - `Logger` æ˜¯ `SLF4J `æ¡†æ¶ä¸­å®šä¹‰çš„ä¸€ä¸ªæ¥å£ï¼Œç”¨äºè®°å½•æ—¥å¿—æ¶ˆæ¯ã€‚é€šè¿‡ Logger æ¥å£ï¼Œå¯ä»¥ä½¿ç”¨ä¸åŒçš„æ—¥å¿—çº§åˆ«ï¼ˆå¦‚ INFOã€DEBUGã€ERROR ç­‰ï¼‰è®°å½•æ—¥å¿—æ¶ˆæ¯ã€‚
>
> 2. **`LoggerFactory `ç±»ï¼š**
>    - `LoggerFactory` æ˜¯ `SLF4J `æ¡†æ¶ä¸­çš„ä¸€ä¸ªå·¥å‚ç±»ï¼Œç”¨äºè·å– `Logger `å®ä¾‹ã€‚å¼€å‘äººå‘˜å¯ä»¥ä½¿ç”¨ `LoggerFactory `ç±»çš„é™æ€æ–¹æ³• `getLogger()` æ¥è·å–ä¸€ä¸ªç‰¹å®šåç§°çš„ Logger å®ä¾‹ã€‚
>
> 3. **"`SampleLogger`" å‚æ•°ï¼š**
>    - åœ¨ `getLogger()` æ–¹æ³•ä¸­ä¼ å…¥çš„å‚æ•°æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œç”¨äºæŒ‡å®šè¦è·å–çš„ `Logger `å®ä¾‹çš„åç§°ã€‚é€šå¸¸ï¼Œè¿™ä¸ªåç§°å¯ä»¥æ˜¯ç±»åã€åŒ…åæˆ–è€…ä»»ä½•æè¿°æ€§çš„å­—ç¬¦ä¸²ã€‚

é€šè¿‡è¿™ä¸ªæ–¹æ³•ï¼Œæˆ‘ä»¬è·å¾—äº†ä¸€ä¸ª`Logger`å®ä¾‹ï¼Œé€šè¿‡æºç å¯çŸ¥ï¼Œä»–åŒ…å«äº†ä¸Šé¢æåˆ°çš„å‡ ç§æ—¥å¿—çº§åˆ«çš„å„ç§å¸¸ç”¨æ–¹æ³•ï¼š

![image-20240424180736466](https://images.waer.ltd/notes/image-20240424180736466.png)

``java
public static void main(String[] args) {
    // åˆ›å»ºæ—¥å¿—Loggerå¯¹è±¡
     Logger logger = LoggerFactory.getLogger("SampleLogger");

     // å‡ ç§æ—¥å¿—çº§åˆ«æ–¹æ³•çš„çº§åˆ«ä½¿ç”¨
    logger.trace("è¿™æ¡æ—¥å¿—æ¥è‡ª[trace]çº§åˆ«...");
    logger.debug("è¿™æ¡æ—¥å¿—æ¥è‡ª[debug]çº§åˆ«...");
    logger.info("è¿™æ¡æ—¥å¿—æ¥è‡ª[info]çº§åˆ«...");
    logger.warn("è¿™æ¡æ—¥å¿—æ¥è‡ª[warn]çº§åˆ«...");
    logger.error("è¿™æ¡æ—¥å¿—æ¥è‡ª[error]çº§åˆ«...");
}
```

è¿è¡Œä¸Šé¢çš„ä»£ç 

![image-20240424181420177](https://images.waer.ltd/notes/image-20240424181420177.png)

ä»æ§åˆ¶å°æ¥çœ‹ï¼Œè¿™é‡Œå°‘æ‰“å°äº†`debug`å’Œ`trace`çº§åˆ«çš„å†…å®¹ï¼Œè¿™æ˜¯å› ä¸º`SLF4J `å’Œ `Logback `é»˜è®¤çš„æ—¥å¿—çº§åˆ«æ˜¯ INFOï¼Œè¿™æ„å‘³ç€åªæœ‰ INFO çº§åˆ«åŠä»¥ä¸Šçš„æ—¥å¿—ä¼šè¢«è¾“å‡ºåˆ°æ§åˆ¶å°ã€‚ä»£ç ä¸­ä½¿ç”¨äº† INFOã€WARN å’Œ ERROR ä¸‰ç§æ—¥å¿—çº§åˆ«ï¼Œå› æ­¤åªæœ‰è¿™ä¸‰ç§çº§åˆ«çš„æ—¥å¿—ä¼šè¢«è¾“å‡ºï¼Œè€Œ TRACE å’Œ DEBUG çº§åˆ«çš„æ—¥å¿—ä¸ä¼šæ˜¾ç¤ºåœ¨æ§åˆ¶å°ä¸Šã€‚

ä¹Ÿå¯ä»¥ä½¿ç”¨å ä½ç¬¦çš„å½¢å¼è¿›è¡Œæ—¥å¿—çš„æ‰“å°ï¼Œè¿™ä¹Ÿæ˜¯æ¯”è¾ƒå¸¸ç”¨çš„ï¼š

``java
 // ä½¿ç”¨å ä½ç¬¦çš„å½¢å¼
    String str = "è¿™æ˜¯å ä½ç¬¦çš„æ•°æ®";
    logger.info("{}",str);
```

é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡ä½¿ç”¨ç±»åè·å–å®ä¾‹åŒ–`Logger`å®ä¾‹çš„æ–¹å¼ï¼š

``java
public class LogMain {
    private static final Logger LOGGER  =LoggerFactory.getLogger(LogMain.class);
    public static void main(String[] args) {
         // å‡ ç§æ—¥å¿—çº§åˆ«æ–¹æ³•çš„çº§åˆ«ä½¿ç”¨
        LOGGER.info("è¿™æ¡æ—¥å¿—æ¥è‡ª[info]çº§åˆ«...");
        LOGGER.warn("è¿™æ¡æ—¥å¿—æ¥è‡ª[warn]çº§åˆ«...");
        LOGGER.error("è¿™æ¡æ—¥å¿—æ¥è‡ª[error]çº§åˆ«...");
        // ä½¿ç”¨å ä½ç¬¦çš„å½¢å¼
        String str = "è¿™æ˜¯å ä½ç¬¦çš„æ•°æ®";

        LOGGER.info("{}",str);
    }
}
```

ä¸‹é¢æ˜¯ä¸¤ç§æ–¹å¼çš„ç®€å•å¯¹æ¯”:

1. **ä½¿ç”¨ç±»åè·å– Logger å®ä¾‹**ï¼š

   ```java
   private static final Logger LOGGER = LoggerFactory.getLogger(LogMain.class);
   ```

   è¿™ç§æ–¹å¼æ˜¯é€šè¿‡ç±»å `LogMain.class` æ¥è·å– Logger å®ä¾‹ï¼Œè¿™æ ·å¯ä»¥ç¡®ä¿æ¯ä¸ªç±»éƒ½æœ‰è‡ªå·±çš„ Logger å®ä¾‹ï¼Œå¹¶ä¸”å¯ä»¥æ›´å®¹æ˜“åœ°è¿½è¸ªæ—¥å¿—ä¿¡æ¯çš„æ¥æºã€‚è¿™ç§æ–¹å¼åœ¨å®è·µä¸­æ˜¯æ¯”è¾ƒå¸¸è§çš„ï¼Œç‰¹åˆ«æ˜¯åœ¨ç±»çš„é™æ€æ–¹æ³•ä¸­ä½¿ç”¨ã€‚

2. **ä½¿ç”¨è‡ªå®šä¹‰åç§°è·å– Logger å®ä¾‹**ï¼š

   ```java
   Logger logger = LoggerFactory.getLogger("SampleLogger");
   ```

   è¿™ç§æ–¹å¼æ˜¯é€šè¿‡è‡ªå®šä¹‰çš„åç§° "`SampleLogger`" æ¥è·å– Logger å®ä¾‹ã€‚ä½¿ç”¨è‡ªå®šä¹‰åç§°å¯ä»¥å°†å¤šä¸ªç±»çš„æ—¥å¿—ä¿¡æ¯å½’ç±»åˆ°åŒä¸€ä¸ª Logger å®ä¾‹ä¸­ï¼Œä»è€Œæ–¹ä¾¿å¯¹æ—¥å¿—ä¿¡æ¯è¿›è¡Œç®¡ç†å’Œè¿‡æ»¤ã€‚è¿™ç§æ–¹å¼é€‚ç”¨äºéœ€è¦å¯¹å¤šä¸ªç±»çš„æ—¥å¿—è¿›è¡Œç»Ÿä¸€ç®¡ç†çš„æƒ…å†µã€‚

ä¸¤ç§æ–¹å¼éƒ½å¯ä»¥è·å– Logger å®ä¾‹ï¼Œé€‰æ‹©å“ªç§æ–¹å¼å–å†³äºå…·ä½“çš„éœ€æ±‚å’Œåœºæ™¯ã€‚å¦‚æœä½ æƒ³è¦æ¯ä¸ªç±»æœ‰è‡ªå·±çš„ Logger å®ä¾‹å¹¶ä¸”æ›´å®¹æ˜“è¿½è¸ªæ—¥å¿—æ¥æºï¼Œå¯ä»¥ä½¿ç”¨ç±»åè·å–ï¼›å¦‚æœéœ€è¦å¯¹å¤šä¸ªç±»çš„æ—¥å¿—è¿›è¡Œç»Ÿä¸€ç®¡ç†ï¼Œå¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰åç§°è·å–ã€‚

---

## 3. Logback

### 3.1 å¯¼å…¥ä¾èµ–

åœ¨ä¸Šé¢çš„å†…å®¹ä¸­ï¼Œç®€å•ä½“éªŒäº†ä¸€äº›`slf4j`æ¡†æ¶çš„åŸºæœ¬ä½¿ç”¨æµç¨‹ä»¥åŠå¸¸ç”¨çš„æ–¹æ³•ï¼Œåœ¨æ—¥å¸¸çš„è°ƒè¯•å¼€å‘ä¸­ï¼Œå¯¹äºæ§åˆ¶å°è¾“å‡ºä¿¡æ¯æ¥è¯´ï¼Œç¡®å®ä¹Ÿå¤Ÿç”¨äº†ï¼Œä½†å°±å®é™…çš„é¡¹ç›®éœ€æ±‚æ¥è®²è¿˜æ˜¯å·®ç‚¹æ„æ€ï¼Œæ‰€ä»¥æœ¬ç« èŠ‚è¿˜æ˜¯ä»‹ç»ä¸€ä¸‹ä»–çš„ä¸€æ¬¾å…·ä½“å®ç°ï¼Œé‚£å°±æ˜¯`logback`ï¼›

**å¯¼å…¥ä¾èµ–ï¼š** æˆ‘ä»¬éœ€è¦å¯¼å…¥ä¸‹é¢ä¸¤ä¸ªä¾èµ–ï¼Œå½“ç„¶å‰é¢å¯¼å…¥çš„`slf4j`çš„æ ¸å¿ƒä¾èµ–è¿˜æ˜¯è¦çš„ï¼Œä»€ä¹ˆæ„æ€ï¼Œå’±ä¸è¯´ï¼Œä½ å“ï¼Œä½ ç»†å“(ğŸ˜)ï¼ï¼!!

``groovy
// https://mvnrepository.com/artifact/ch.qos.logback/logback-core
implementation 'ch.qos.logback:logback-core:1.5.6'
// https://mvnrepository.com/artifact/ch.qos.logback/logback-classic
implementation 'ch.qos.logback:logback-classic:1.5.6'
```

æ¬§å…‹ï¼Œä¾èµ–å¯¼å…¥ä¹‹ååˆ«å¿˜äº†åˆ·æ–°ä¸€ä¸‹ï¼Œå®Œæˆæ„å»ºå†ç»§ç»­ã€‚

ä¾èµ–åŠ è½½å®Œæˆåï¼Œè¿˜æ˜¯åŸºäºä¹‹å‰çš„ä»£ç ï¼Œæˆ‘ä»¬ä»€ä¹ˆä¹Ÿä¸åšé…ç½®ï¼Œçœ‹çœ‹æ—¥å¿—çš„æ‰“å°æœ‰ä»€ä¹ˆåŒºåˆ«ï¼š

![image-20240424191527626](https://images.waer.ltd/notes/image-20240424191527626.png)

> æµ‹è¯•ç»“æœä¸»æ‰“ä¸€ä¸ªä¸€æˆä¸å˜!!

---

### 3.2 é…ç½®logback

è¦é…ç½® `Logback`ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ `XML `æ–‡ä»¶ä»¥åŠ `Groovy `æ–‡ä»¶ã€‚è¿™é‡Œå°†ä½¿ç”¨ XML æ–¹æ³•ã€‚åœ¨é¡¹ç›®çš„ `resources `æ–‡ä»¶å¤¹ä¸­åˆ›å»º `logback.xml` æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å« ä»¥ä¸‹å†…å®¹å¹¶ç»™å‡ºè¯¦ç»†çš„æ³¨é‡Šä»¥åŠè§£é‡Šï¼Œå…„å°ä¸å¿…å¤šè¨€ï¼

```
<configuration>
    <!-- é…ç½®ä¸€ä¸ªåä¸º "STDOUT" çš„ appenderï¼Œä½¿ç”¨ AsyncAppender å¼‚æ­¥è¾“å‡ºæ—¥å¿— -->
    <appender name="STDOUT" class="ch.qos.logback.classic.AsyncAppender">
        <!-- é…ç½®æ—¥å¿—è¾“å‡ºçš„æ ¼å¼ -->
        <encoder>
            <!-- æŒ‡å®šæ—¥å¿—è¾“å‡ºçš„æ ¼å¼ï¼ŒåŒ…æ‹¬æ—¶é—´ã€æ—¥å¿—çº§åˆ«ã€logger åç§°ã€æ—¥å¿—æ¶ˆæ¯ -->
            <pattern>%d{HH:mm.SSS} %-5level %logger{36} - %msg%n</pattern>
        </encoder>
    </appender>
    
    <!-- é…ç½®æ ¹æ—¥å¿—çº§åˆ«ä¸º INFO -->
    <root level="info">
        <!-- å°†åä¸º "STDOUT" çš„ appender å¼•ç”¨åˆ°æ ¹æ—¥å¿—ä¸­ -->
        <appender-ref ref="STDOUT"/>
    </root>
</configuration>
```

> - `<appender>` å…ƒç´ ç”¨äºé…ç½®æ—¥å¿—è¾“å‡ºçš„ç›®æ ‡ï¼Œè¿™é‡Œé…ç½®äº†ä¸€ä¸ªåä¸º "`STDOUT`" çš„ `appender`ï¼Œä½¿ç”¨ `AsyncAppender` å¼‚æ­¥è¾“å‡ºæ—¥å¿—ã€‚
> - `<encoder>` å…ƒç´ ç”¨äºé…ç½®æ—¥å¿—è¾“å‡ºçš„æ ¼å¼ï¼Œè¿™é‡ŒæŒ‡å®šäº†è¾“å‡ºæ ¼å¼çš„æ¨¡å¼ï¼ŒåŒ…æ‹¬æ—¶é—´ `%d{HH:mm.SSS}`ã€æ—¥å¿—çº§åˆ« `%-5level`ã€logger åç§° `%logger{36}`ã€æ—¥å¿—æ¶ˆæ¯ `%msg` ç­‰ã€‚
> - `<pattern>` å…ƒç´ å®šä¹‰äº†æ—¥å¿—è¾“å‡ºçš„æ ¼å¼æ¨¡å¼ï¼Œ`%d{HH:mm.SSS}` è¡¨ç¤ºè¾“å‡ºæ—¶é—´ï¼Œ`%-5level` è¡¨ç¤ºè¾“å‡ºæ—¥å¿—çº§åˆ«ï¼ˆå·¦å¯¹é½ï¼Œæœ€å¤šå 5ä¸ªå­—ç¬¦ï¼‰ï¼Œ`%logger{36}` è¡¨ç¤ºè¾“å‡º logger åç§°ï¼ˆæœ€å¤š36ä¸ªå­—ç¬¦ï¼‰ï¼Œ`%msg` è¡¨ç¤ºè¾“å‡ºæ—¥å¿—æ¶ˆæ¯ï¼Œ`%n` è¡¨ç¤ºæ¢è¡Œã€‚
> - `<root>` å…ƒç´ å®šä¹‰äº†æ ¹æ—¥å¿—çš„é…ç½®ï¼Œè¿™é‡Œå°†æ ¹æ—¥å¿—çº§åˆ«è®¾ç½®ä¸º `INFO`ã€‚
> - `<appender-ref>` å…ƒç´ ç”¨äºå°†æŒ‡å®šçš„ appender å¼•ç”¨åˆ°æ ¹æ—¥å¿—ä¸­ï¼Œè¿™é‡Œå°†åä¸º "`STDOUT`" çš„ `appender `å¼•ç”¨åˆ°æ ¹æ—¥å¿—ä¸­ï¼Œè¡¨ç¤ºä½¿ç”¨è¿™ä¸ª `appender` è¾“å‡ºæ ¹æ—¥å¿—çš„æ—¥å¿—ä¿¡æ¯ã€‚

#### 3.2.1  **Logback appender**

`Logback appender` æ˜¯ `Logback `ç”¨äºå†™å…¥æ—¥å¿—äº‹ä»¶çš„ç»„ä»¶ã€‚`Logback`æä¾›äº†å¤šç§ç±»å‹çš„`Appenders`ï¼Œæ¯ç§`Appender`éƒ½æœ‰ä¸åŒçš„åŠŸèƒ½å’Œç”¨é€”,ä¸‹é¢åˆ—ä¸€äº›å¸¸è§çš„å§

> 1. **ConsoleAppender**ï¼šå°†æ—¥å¿—æ¶ˆæ¯è¾“å‡ºåˆ°æ§åˆ¶å°ã€‚
> 2. **FileAppender**ï¼šå°†æ—¥å¿—æ¶ˆæ¯è¾“å‡ºåˆ°æ–‡ä»¶ã€‚
> 3. **RollingFileAppender**ï¼šå°†æ—¥å¿—æ¶ˆæ¯è¾“å‡ºåˆ°æ–‡ä»¶ï¼Œå¹¶æ”¯æŒæ—¥å¿—æ–‡ä»¶çš„æ»šåŠ¨ï¼ˆå³æŒ‰ç…§ä¸€å®šæ¡ä»¶åˆ‡åˆ†æ—¥å¿—æ–‡ä»¶ï¼Œå¦‚æŒ‰æ—¥æœŸã€æ–‡ä»¶å¤§å°ç­‰ï¼‰ã€‚
> 4. **SMTPAppender**ï¼šé€šè¿‡é‚®ä»¶å‘é€æ—¥å¿—æ¶ˆæ¯ã€‚
> 5. **SocketAppender**ï¼šå°†æ—¥å¿—æ¶ˆæ¯é€šè¿‡ç½‘ç»œå‘é€åˆ°è¿œç¨‹æœåŠ¡å™¨ã€‚
> 6. **DBAppender**ï¼šå°†æ—¥å¿—æ¶ˆæ¯å†™å…¥æ•°æ®åº“ã€‚
> 7. **AsyncAppender**ï¼šå¼‚æ­¥åœ°å°†æ—¥å¿—æ¶ˆæ¯è¾“å‡ºåˆ°å…¶ä»–`Appender`ï¼Œå¯ä»¥æé«˜æ—¥å¿—ç³»ç»Ÿçš„æ€§èƒ½ã€‚
> 8. **SyslogAppender**ï¼šå°†æ—¥å¿—æ¶ˆæ¯å‘é€åˆ°`Syslog`æœåŠ¡å™¨ã€‚

#### 3.2.2 **logback-classic**

åœ¨æœ¬ç« èŠ‚çš„å¼€å§‹ï¼Œæˆ‘ä»¬è¿˜å¼•å¦‚äº†è¿™ä¸ª`logback-classic`çš„ä¾èµ–ï¼Œè¿™æ˜¯`Logback`æ¡†æ¶ä¸­çš„ä¸€ä¸ªæ¨¡å—ï¼Œå®ƒæä¾›äº†ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§ä¸”çµæ´»çš„æ—¥å¿—ç³»ç»Ÿï¼Œå¯ä»¥ç”¨äºJavaåº”ç”¨ç¨‹åºä¸­è¿›è¡Œæ—¥å¿—è®°å½•ã€‚ä¸€äº›`logback-classic`æ¨¡å—ä¸­çš„é‡è¦ç»„ä»¶åŒ…æ‹¬ï¼š

> 1. **Loggerï¼ˆæ—¥å¿—è®°å½•å™¨ï¼‰**ï¼šLoggerç”¨äºè®°å½•æ—¥å¿—æ¶ˆæ¯ã€‚åœ¨`Logback`ä¸­ï¼Œ`Logger`æ˜¯æœ€æ ¸å¿ƒçš„ç»„ä»¶ä¹‹ä¸€ï¼Œè´Ÿè´£ç”Ÿæˆå’Œå¤„ç†æ—¥å¿—æ¶ˆæ¯ã€‚
> 2. **Appenderï¼ˆè¾“å‡ºç›®çš„åœ°ï¼‰**ï¼šAppenderç”¨äºå®šä¹‰æ—¥å¿—æ¶ˆæ¯çš„è¾“å‡ºç›®çš„åœ°ï¼Œæ¯”å¦‚æ§åˆ¶å°ã€æ–‡ä»¶ã€æ•°æ®åº“ç­‰ã€‚`logback-classic`æä¾›äº†å¤šç§ç±»å‹çš„Appendersæ¥æ»¡è¶³ä¸åŒçš„è¾“å‡ºéœ€æ±‚ã€‚
> 3. **Layoutï¼ˆæ—¥å¿—æ ¼å¼åŒ–ï¼‰**ï¼šLayoutç”¨äºå®šä¹‰æ—¥å¿—æ¶ˆæ¯çš„æ ¼å¼ï¼ŒåŒ…æ‹¬æ—¥å¿—æ¶ˆæ¯çš„æ—¶é—´æˆ³ã€æ—¥å¿—çº§åˆ«ã€æ—¥å¿—å†…å®¹ç­‰ã€‚é€šè¿‡Layoutï¼Œå¯ä»¥è‡ªå®šä¹‰æ—¥å¿—æ¶ˆæ¯çš„è¾“å‡ºæ ¼å¼ã€‚
> 4. **Levelï¼ˆæ—¥å¿—çº§åˆ«ï¼‰**ï¼šLevelç”¨äºå®šä¹‰æ—¥å¿—æ¶ˆæ¯çš„çº§åˆ«ï¼Œå¦‚`DEBUGã€INFOã€WARNã€ERROR`ç­‰ã€‚å¯ä»¥é€šè¿‡Levelæ¥æ§åˆ¶æ—¥å¿—æ¶ˆæ¯çš„è¾“å‡ºçº§åˆ«ã€‚
> 5. **é…ç½®æ–‡ä»¶**ï¼š`logback-classic`ä½¿ç”¨XMLæˆ–Groovyç­‰æ ¼å¼çš„é…ç½®æ–‡ä»¶æ¥é…ç½®æ—¥å¿—ç³»ç»Ÿçš„è¡Œä¸ºï¼ŒåŒ…æ‹¬é…ç½®æ—¥å¿—çº§åˆ«ã€`Appendersã€Layou`tç­‰ã€‚

ç”±äº`logback`æä¾›çš„åŠŸèƒ½å®åœ¨å¾ˆå¤šï¼Œè¿™é‡Œä¹Ÿä¸å¯èƒ½ä¸€ä¸€åˆ—ä¸¾ï¼Œä¸‹é¢å°±ä»¥å°†æ—¥å¿—ä¿¡æ¯å†™å…¥æ§åˆ¶å°å’Œæ–‡ä»¶ä¸ºä¾‹ï¼Œä¹Ÿå°±æ˜¯`RollingFileAppender`;

- ä»£ç è¿˜æ˜¯è¿™ç‚¹å†…å®¹

``java
public class LogMain {
    private static final Logger LOGGER  =LoggerFactory.getLogger(LogMain.class);
    public static void main(String[] args) {
        LOGGER.info("è¿™æ˜¯ä¸€æ¡INFOçº§åˆ«çš„æ—¥å¿—....");
        LOGGER.error("è¿™æ˜¯ä¸€æ¡ERRORçº§åˆ«çš„æ—¥å¿—...");
    }
}
```

- é…ç½®æ–‡ä»¶å°±æœ‰äº›å˜åŒ–äº†

```
<configuration>
    <!-- é…ç½®ä¸€ä¸ªåä¸º "STDOUT" çš„ appenderï¼Œä½¿ç”¨ AsyncAppender å¼‚æ­¥è¾“å‡ºæ—¥å¿— -->
    <appender name="STDOUT" class="ch.qos.logback.classic.AsyncAppender">
        <!-- é…ç½®ç›®æ ‡ Appender ä¸º ConsoleAppenderï¼Œå³è¾“å‡ºåˆ°æ§åˆ¶å° -->
        <appender-ref ref="CONSOLE" />
        <encoder>
            <!-- æŒ‡å®šæ—¥å¿—è¾“å‡ºçš„æ ¼å¼ï¼ŒåŒ…æ‹¬æ—¶é—´ã€æ—¥å¿—çº§åˆ«ã€logger åç§°ã€æ—¥å¿—æ¶ˆæ¯ -->
            <pattern>%d{HH:mm.SSS} %-5level %logger{36} - %msg%n</pattern>
        </encoder>
    </appender>

    <!-- å®šä¹‰ä¸€ä¸ªåä¸º "CONSOLE" çš„ ConsoleAppenderï¼Œç”¨äºå°†æ—¥å¿—æ¶ˆæ¯è¾“å‡ºåˆ°æ§åˆ¶å° -->
    <appender name="CONSOLE" class="ch.qos.logback.core.ConsoleAppender">
        <encoder>
            <pattern>%d{HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n</pattern>
        </encoder>
    </appender>

    <!-- å®šä¹‰ä¸€ä¸ªåä¸º "file" çš„ FileAppenderï¼Œç”¨äºå°†æ—¥å¿—æ¶ˆæ¯è¾“å‡ºåˆ°æ–‡ä»¶ -->
    <appender name="file" class="ch.qos.logback.core.FileAppender">
        <!-- æŒ‡å®šæ—¥å¿—æ–‡ä»¶çš„è·¯å¾„ -->
        <file>src/main/resources/mylogs.log</file>
        <!-- å¦‚æœä¸º trueï¼Œåˆ™æ—¥å¿—æ¶ˆæ¯å°†è¿½åŠ åˆ°æ–‡ä»¶æœ«å°¾ï¼›å¦‚æœä¸º falseï¼Œåˆ™ä¼šè¦†ç›–å·²æœ‰çš„æ–‡ä»¶å†…å®¹ -->
        <append>true</append>
        <!-- å¦‚æœä¸º trueï¼Œåˆ™æ¯æ¬¡å†™å…¥æ—¥å¿—æ¶ˆæ¯åä¼šç«‹å³åˆ·æ–°è¾“å‡ºæµï¼›å¦‚æœä¸º falseï¼Œåˆ™å¯èƒ½ä¼šç¼“å†²ä¸€æ®µæ—¶é—´åå†åˆ·æ–° -->
        <immediateFlush>true</immediateFlush>
        <!-- é…ç½®æ—¥å¿—æ¶ˆæ¯çš„è¾“å‡ºæ ¼å¼ï¼ŒåŒ…æ‹¬æ—¶é—´æˆ³ã€çº¿ç¨‹åã€æ—¥å¿—çº§åˆ«ã€Loggeråç§°ã€æ—¥å¿—æ¶ˆæ¯å†…å®¹ç­‰ -->
        <encoder>
            <pattern>%d{HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n</pattern>
        </encoder>
    </appender>

    <!-- å®šä¹‰ä¸€ä¸ªåä¸º "cn.ilikexff.springsecuritydemo2.controller.LogMain" çš„ Logger -->
    <!-- æ³¨æ„è¿™é‡Œè¦æ­£ç¡®æŒ‡å®šä½ çš„æ—¥å¿—ä¿¡æ¯çš„æ¥æºè·¯å¾„ -->
    <logger name="cn.ilikexff.springsecuritydemo2.controller.LogMain" level="INFO">
        <!-- å°† Logger ä¸åä¸º "STDOUT" çš„ Appender å…³è” -->
        <appender-ref ref="STDOUT"/>
    </logger>

    <!-- é…ç½®æ ¹ Logger çš„è¡Œä¸º -->
    <root level="info">
        <!-- å°†æ ¹ Logger ä¸åä¸º "file" çš„ Appender å…³è”ï¼Œè¡¨ç¤ºæ ¹ Logger çš„æ—¥å¿—æ¶ˆæ¯å°†è¾“å‡ºåˆ°æ–‡ä»¶ -->
        <appender-ref ref="file" />
    </root>
</configuration>
```

æ‰§è¡Œç¨‹åºä¹‹åå‘ç°åœ¨æŒ‡å®šçš„æ—¥å¿—æ–‡ä»¶å’Œæ§åˆ¶å°éƒ½æ‰“å°äº†ç›¸å…³çš„æ—¥å¿—ä¿¡æ¯:

![image-20240424202540003](https://images.waer.ltd/notes/image-20240424202540003.png)

---

#### 3.2.3 RollingFileAppender

`RollingFileAppender`æ˜¯`Logback`æ¡†æ¶ä¸­çš„ä¸€ä¸ª`Appender`ï¼Œç”¨äºå°†æ—¥å¿—è¾“å‡ºåˆ°æ–‡ä»¶ï¼Œå¹¶æ”¯æŒæ—¥å¿—æ–‡ä»¶çš„æ»šåŠ¨ï¼ˆ`rolling`ï¼‰åŠŸèƒ½ã€‚å…¶ä½œç”¨åŒ…æ‹¬ï¼š

1. **æ—¥å¿—æ–‡ä»¶æ»šåŠ¨**ï¼š`RollingFileAppender`å¯ä»¥é…ç½®æ—¥å¿—æ–‡ä»¶çš„æ»šåŠ¨ç­–ç•¥ï¼Œä¾‹å¦‚æŒ‰æ–‡ä»¶å¤§å°æ»šåŠ¨ã€æŒ‰æ—¶é—´æ»šåŠ¨ç­‰ã€‚è¿™æ ·å¯ä»¥é™åˆ¶å•ä¸ªæ—¥å¿—æ–‡ä»¶çš„å¤§å°ï¼Œé¿å…æ—¥å¿—æ–‡ä»¶è¿‡å¤§å½±å“ç³»ç»Ÿæ€§èƒ½ï¼ŒåŒæ—¶ä¿ç•™ä¸€å®šæ•°é‡çš„å†å²æ—¥å¿—æ–‡ä»¶ï¼Œæ–¹ä¾¿æŸ¥çœ‹å’Œç®¡ç†ã€‚

2. **æ—¥å¿—æ–‡ä»¶ç®¡ç†**ï¼š`RollingFileAppender`å¯ä»¥ç®¡ç†æ—¥å¿—æ–‡ä»¶çš„å†™å…¥å’Œåˆ‡æ¢ï¼Œç¡®ä¿æ—¥å¿—ä¿¡æ¯è¢«æ­£ç¡®è®°å½•åˆ°æ–‡ä»¶ä¸­ã€‚å®ƒå¯ä»¥è‡ªåŠ¨åˆ›å»ºæ–°çš„æ—¥å¿—æ–‡ä»¶ã€å…³é—­æ—§çš„æ—¥å¿—æ–‡ä»¶ï¼Œå¹¶æ ¹æ®é…ç½®è¿›è¡Œæ—¥å¿—æ–‡ä»¶çš„æ»šåŠ¨å’Œæ¸…ç†ã€‚

3. **é…ç½®çµæ´»**ï¼š`RollingFileAppender`æä¾›äº†ä¸°å¯Œçš„é…ç½®é€‰é¡¹ï¼Œå¯ä»¥æ ¹æ®éœ€æ±‚å®šåˆ¶æ—¥å¿—æ–‡ä»¶çš„æ»šåŠ¨ç­–ç•¥ã€æ–‡ä»¶å‘½åè§„åˆ™ã€æ–‡ä»¶å¤§å°é™åˆ¶ç­‰å‚æ•°ï¼Œä»¥æ»¡è¶³ä¸åŒåœºæ™¯ä¸‹çš„æ—¥å¿—è®°å½•éœ€æ±‚ã€‚

è€ƒè™‘ä¸‹é¢çš„é…ç½®:

> è¯¥é…ç½®å°†æ—¥å¿—æ–‡ä»¶é™åˆ¶åœ¨å•ä¸ªæ–‡ä»¶æœ€å¤§10MBï¼Œä¿ç•™30ä¸ªå†å²æ—¥å¿—æ–‡ä»¶ï¼Œå¹¶é™åˆ¶æ‰€æœ‰å†å²æ—¥å¿—æ–‡ä»¶æ€»å¤§å°ä¸è¶…è¿‡1GBã€‚

```
<configuration>

    <!-- å®šä¹‰æ§åˆ¶å°è¾“å‡ºçš„Appender -->
    <appender name="STDOUT" class="ch.qos.logback.core.ConsoleAppender">
        <encoder>
            <pattern>%d{HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n</pattern>
        </encoder>
    </appender>

    <!-- å®šä¹‰RollingFileAppenderï¼Œå°†æ—¥å¿—è¾“å‡ºåˆ°æ–‡ä»¶ä¸­ï¼Œå¹¶æ”¯æŒæ—¥å¿—æ–‡ä»¶çš„æ»šåŠ¨ -->
    <appender name="FILE" class="ch.qos.logback.core.rolling.RollingFileAppender">
        <file>logs/mylog.log</file> <!-- æ—¥å¿—æ–‡ä»¶çš„è·¯å¾„å’Œåç§° -->
        <encoder>
            <pattern>%d{HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n</pattern>
        </encoder>

        <!-- é…ç½®æ—¥å¿—æ–‡ä»¶çš„æ»šåŠ¨ç­–ç•¥ -->
        <rollingPolicy class="ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy">
            <fileNamePattern>logs/mylog-%d{yyyy-MM-dd}.%i.log</fileNamePattern> <!-- æ—¥å¿—æ–‡ä»¶çš„å‘½åè§„åˆ™ -->
            <maxFileSize>2MB</maxFileSize> <!-- å•ä¸ªæ—¥å¿—æ–‡ä»¶çš„æœ€å¤§å¤§å° -->
            <maxHistory>7</maxHistory> <!-- ä¿ç•™çš„å†å²æ—¥å¿—æ–‡ä»¶æ•°é‡ -->
            <totalSizeCap>1GB</totalSizeCap> <!-- æ‰€æœ‰å†å²æ—¥å¿—æ–‡ä»¶çš„æ€»å¤§å°ä¸Šé™ -->
        </rollingPolicy>
    </appender>

    <!-- é…ç½®Loggerï¼ŒæŒ‡å®šæ—¥å¿—è®°å½•çº§åˆ«å’ŒAppender -->
    <logger name="cn.ilikexff.springsecuritydemo2.controller.LogMain" level="INFO">
        <appender-ref ref="STDOUT" /> <!-- å°†æ—¥å¿—è¾“å‡ºåˆ°æ§åˆ¶å° -->
        <appender-ref ref="FILE" /> <!-- å°†æ—¥å¿—è¾“å‡ºåˆ°æ–‡ä»¶ä¸­ -->
    </logger>

    <!-- é…ç½®æ ¹Loggerï¼ŒæŒ‡å®šæ—¥å¿—è®°å½•çº§åˆ«å’ŒAppender -->
    <root level="INFO">
        <appender-ref ref="STDOUT" /> <!-- å°†æ—¥å¿—è¾“å‡ºåˆ°æ§åˆ¶å° -->
        <appender-ref ref="FILE" /> <!-- å°†æ—¥å¿—è¾“å‡ºåˆ°æ–‡ä»¶ä¸­ -->
    </root>

</configuration>
```

æ ¹æ®ä¸Šé¢çš„é…ç½®ï¼Œæˆ‘ä»¬ç®€å•æµ‹è¯•ä»¥ä¸‹é…ç½®æ˜¯å¦ç”Ÿæ•ˆï¼Œæ¯”å¦‚å¤šæ‰§è¡Œå‡ æ¬¡ç¨‹åºï¼Œä¸æ–­çš„è¾“å‡ºæ—¥å¿—ï¼Œçœ‹çœ‹å•ä¸ªæ–‡ä»¶æœ€å¤§å¤§å°è¾¾åˆ°`2M`æ—¶ä¼šæ€æ ·ã€‚

![image-20240424205922590](https://images.waer.ltd/notes/image-20240424205922590.png)

æˆªè‡³ä¸Šå›¾`mylog.log`çš„å¤§å°ä¸º`2KB`,ä¸ºäº†åŠ å¿«æµ‹è¯•ï¼Œç®€å•ä¿®æ”¹ä»£ç å¦‚ä¸‹:

``java
public class LogMain {
    private static final Logger LOGGER  =LoggerFactory.getLogger(LogMain.class);
    public static void main(String[] args) {
        for (int i = 0; i < 1000; i++) {
            LOGGER.info("è¿™æ˜¯ä¸€æ¡INFOçº§åˆ«çš„æ—¥å¿—....");
            LOGGER.error("è¿™æ˜¯ä¸€æ¡ERRORçº§åˆ«çš„æ—¥å¿—...");
        }
    }
}
```

ä¸æ–­æµ‹è¯•ä¹‹åå‘ç°å½“æˆ‘ä»¬çš„åŸæ—¥å¿—æ–‡ä»¶å¤§å°è¶…è¿‡`2M`æ—¶ï¼Œå°±å‘ç”Ÿäº†æ»šåŠ¨ï¼Œå°†åŸæ—¥å¿—ä¿¡æ¯æ”¾åˆ°äº†ä¸€ä¸ªæ–°çš„æ—¥å¿—æ–‡ä»¶ä¸­ï¼Œå¹¶ä¸”è¿™ä¸ªæ–‡ä»¶çš„å‘½åä¹Ÿæ˜¯æŒ‰ç…§é…ç½®æ–‡ä»¶æŒ‡å®šçš„è§„åˆ™åˆ›å»ºçš„ï¼ŒæˆåŠŸå‘ç”Ÿäº†æ»šåŠ¨ï¼Œè¯´æ˜é…ç½®æ˜¯ç”Ÿæ•ˆäº†çš„ã€‚

![image-20240424211105513](https://images.waer.ltd/notes/image-20240424211105513.png)

![image-20240424210815077](https://images.waer.ltd/notes/image-20240424210815077.png)

å…³äº`RollingFileAppender`å°±åˆ°è¿™äº†ï¼Œå»ºè®®è‡ªå·±åŠ¨æ‰‹ä¿®æ”¹é…ç½®å¤šæ“ä½œå‡ æ¬¡ï¼ŒåŠ æ·±å°è±¡å’Œç†è§£ï¼Œä¸‹é¢æä¸€å˜´`Logback`ç¼–ç å™¨ï¼›

---

#### 3.2.4 Logback Encoders

è¿™ç©æ„æœ‰ä»€ä¹ˆç”¨å‘¢ï¼Œä¸å¦¨é€šè¿‡åç§°å¤§èƒ†çŒœæµ‹ï¼Œè¿™æ˜¯ç”¨æ¥ä½œæ—¥å¿—æ ¼å¼è½¬æ¢çš„æ¨¡å—ã€‚æ²¡é”™ï¼Œ`Encoder`ç”¨äºå°†æ—¥å¿—äº‹ä»¶è½¬æ¢ä¸ºç‰¹å®šæ ¼å¼çš„æ–‡æœ¬ï¼Œä»¥ä¾¿è¾“å‡ºåˆ°ç›®æ ‡`Appender`ã€‚`Encoder`è´Ÿè´£å°†æ—¥å¿—äº‹ä»¶è½¬æ¢ä¸ºå­—ç¬¦ä¸²å½¢å¼ï¼Œä»¥ä¾¿æ—¥å¿—ç³»ç»Ÿèƒ½å¤Ÿå°†å…¶è¾“å‡ºåˆ°é€‚å½“çš„ç›®æ ‡ï¼Œæ¯”å¦‚æ§åˆ¶å°ã€æ–‡ä»¶æˆ–è€…å…¶ä»–åœ°æ–¹ã€‚

Logbackæä¾›äº†å¤šç§Encoderï¼Œå¸¸è§çš„æœ‰ï¼š

> 1. **PatternLayoutEncoder**ï¼šé€šè¿‡æŒ‡å®šçš„æ¨¡å¼ï¼ˆpatternï¼‰å°†æ—¥å¿—äº‹ä»¶æ ¼å¼åŒ–ä¸ºæ–‡æœ¬ã€‚å¯ä»¥è‡ªå®šä¹‰æ—¥å¿—è¾“å‡ºçš„æ ¼å¼ï¼ŒåŒ…æ‹¬æ—¥æœŸã€æ—¥å¿—çº§åˆ«ã€çº¿ç¨‹åç­‰ä¿¡æ¯ã€‚
> 2. **JsonEncoder**ï¼šå°†æ—¥å¿—äº‹ä»¶è¾“å‡ºä¸º`JSON`æ ¼å¼çš„å­—ç¬¦ä¸²ï¼Œé€‚ç”¨äºç»“æ„åŒ–æ—¥å¿—ã€‚
> 3. **EchoEncoder**ï¼šå°†æ—¥å¿—äº‹ä»¶è¾“å‡ºåˆ°æ§åˆ¶å°ï¼Œç±»ä¼¼äºSystem.out.println()ã€‚
> 4. **RawFileAppender**ï¼šå°†æ—¥å¿—äº‹ä»¶ä»¥åŸå§‹æ ¼å¼è¾“å‡ºåˆ°æ–‡ä»¶ï¼Œä¸è¿›è¡Œä»»ä½•æ ¼å¼åŒ–ã€‚

ä½†æ˜¯å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å…¶å®ä¸å¤ªéœ€è¦ä¿®æ”¹è¿™ä¸ªé…ç½®ï¼Œæœ€å¸¸ç”¨çš„å°±æ˜¯ä¸Šé¢é…ç½®ä¸­å†™çš„æ ¼å¼ï¼š

```
<configuration>
    <appender name="console" class="ch.qos.logback.core.ConsoleAppender">
        <encoder>
            <pattern>%d{HH:mm:ss.SSS} %-5level %logger{36} - %msg%n</pattern>
            <outputPatternAsHeader>true</outputPatternAsHeader>
        </encoder>
    </appender>
    <root level="info">
        <appender-ref ref="console" />
    </root>
</configuration>
```

---

#### 3.2.5 Logback Filters

åœ¨`Logback`ä¸­ï¼ŒFiltersï¼ˆè¿‡æ»¤å™¨ï¼‰ç”¨äºè¿‡æ»¤æ—¥å¿—äº‹ä»¶ï¼Œåªæœ‰ç¬¦åˆç‰¹å®šæ¡ä»¶çš„æ—¥å¿—äº‹ä»¶æ‰ä¼šè¢«å¤„ç†å’Œè®°å½•ã€‚Filterså¯ä»¥å¸®åŠ©æ‚¨æ§åˆ¶å“ªäº›æ—¥å¿—äº‹ä»¶åº”è¯¥è¢«è®°å½•ï¼Œå“ªäº›åº”è¯¥è¢«å¿½ç•¥ï¼Œä»è€Œæé«˜æ—¥å¿—ç³»ç»Ÿçš„æ•ˆç‡å’Œå¯æ§æ€§ã€‚

`Logback`æä¾›äº†å¤šç§å†…ç½®çš„`Filters`ï¼Œä»¥åŠæ”¯æŒ**è‡ªå®šä¹‰Filters**ã€‚ä¸‹é¢æ˜¯ä¸€äº›å¸¸è§çš„å†…ç½®Filtersï¼š

> 1. **LevelFilter**ï¼šæ ¹æ®æ—¥å¿—çº§åˆ«è¿‡æ»¤æ—¥å¿—äº‹ä»¶ï¼Œåªå¤„ç†ç¬¦åˆæŒ‡å®šçº§åˆ«èŒƒå›´çš„æ—¥å¿—äº‹ä»¶ã€‚
> 2. **ThresholdFilter**ï¼šç±»ä¼¼äº`LevelFilter`ï¼Œæ ¹æ®æŒ‡å®šçš„é˜ˆå€¼çº§åˆ«è¿‡æ»¤æ—¥å¿—äº‹ä»¶ã€‚
> 3. **TurboFilter**ï¼šé«˜æ€§èƒ½çš„è¿‡æ»¤å™¨ï¼Œå¯ä»¥æ ¹æ®æ›´å¤æ‚çš„æ¡ä»¶è¿‡æ»¤æ—¥å¿—äº‹ä»¶ã€‚
> 4. **MarkerFilter**ï¼šæ ¹æ®Markeræ ‡è®°è¿‡æ»¤æ—¥å¿—äº‹ä»¶ï¼Œåªå¤„ç†å¸¦æœ‰ç‰¹å®š`Marker`çš„æ—¥å¿—äº‹ä»¶ã€‚

æ¯”å¦‚æˆ‘ä»¬éœ€è¦è¿‡æ»¤`ERROR`çº§åˆ«çš„æ—¥å¿—ä¿¡æ¯ï¼Œå¯ä»¥å‚è€ƒä¸‹é¢çš„é…ç½®:

```
<!-- Logback é…ç½®æ–‡ä»¶ -->
<configuration>

    <!-- å®šä¹‰ä¸€ä¸ªè¾“å‡ºåˆ°æ§åˆ¶å°çš„ appender -->
    <appender name="CONSOLE" class="ch.qos.logback.core.ConsoleAppender">
        <encoder>
            <!-- å®šä¹‰æ—¥å¿—è¾“å‡ºæ ¼å¼ -->
            <pattern>%d{HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n</pattern>
        </encoder>
        
        <!-- æ·»åŠ  LevelFilter è¿‡æ»¤å™¨ -->
        <filter class="ch.qos.logback.classic.filter.LevelFilter">
            <!-- æŒ‡å®šè¿‡æ»¤çº§åˆ«ä¸º ERROR -->
            <level>ERROR</level>
            <!-- åŒ¹é…åˆ° ERROR çº§åˆ«çš„æ—¥å¿—æ—¶æ‹’ç» -->
            <onMatch>DENY</onMatch>
            <!-- ä¸åŒ¹é…æ—¶ä¸è¿›è¡Œå¤„ç† -->
            <onMismatch>NEUTRAL</onMismatch>
        </filter>
    </appender>

    <!-- é…ç½®æ ¹èŠ‚ç‚¹çš„æ—¥å¿—çº§åˆ«ä¸º INFO -->
    <root level="INFO">
        <!-- å¼•ç”¨ CONSOLE appender -->
        <appender-ref ref="CONSOLE" />
    </root>
</configuration>
```

é™¤äº†ä½¿ç”¨è¿™ç§é…ç½®æ–‡ä»¶çš„æ–¹å¼è¿›è¡Œè¿‡æ»¤ä¹‹å¤–ï¼Œ`logback`ä¹Ÿæä¾›äº†ä»£ç æ–¹å¼çš„è¿‡æ»¤ï¼Œæ¯”å¦‚ä¾æ—§å®ç°ä¸Šé¢çš„éœ€æ±‚ï¼Œç”¨ä»£ç å¯ä»¥è¿™æ ·å†™ã€‚

```
public class SampleFilter extends Filter<ILoggingEvent> {
    @Override
    public FilterReply decide(ILoggingEvent event) {
        if (event.getMessage().contains("ERROR")) {
            return FilterReply.ACCEPT;
        }
        return FilterReply.DENY;
    }
}
```

å†é…ç½®æ–‡ä»¶ä¸­å°†ä¸Šé¢ç¼–å†™å¥½çš„è¿‡æ»¤è§„åˆ™æ·»åŠ è¿›å»:

```
<!-- Logback é…ç½®æ–‡ä»¶ -->
<configuration>

    <!-- å®šä¹‰ä¸€ä¸ªè¾“å‡ºåˆ°æ§åˆ¶å°çš„ appender -->
    <appender name="console" class="ch.qos.logback.core.ConsoleAppender">
        <encoder>
            <!-- å®šä¹‰æ—¥å¿—è¾“å‡ºæ ¼å¼ -->
            <pattern>%d{HH:mm:ss.SSS} %-5level %logger{36} - %msg%n</pattern>
        </encoder>

        <!-- æ·»åŠ è‡ªå®šä¹‰çš„ SampleFilter è¿‡æ»¤å™¨ -->
        <filter class="cn.ilikexff.springsecuritydemo2.filter.SampleFilter" />
    </appender>

    <!-- é…ç½®æ ¹èŠ‚ç‚¹çš„æ—¥å¿—çº§åˆ«ä¸º INFO -->
    <root level="info">
        <!-- å¼•ç”¨ console appender -->
        <appender-ref ref="console" />
    </root>
</configuration>

```

æ‰§è¡Œç¨‹åºï¼Œå‘ç°æ§åˆ¶å°å’Œæ—¥å¿—æ–‡ä»¶ä¸­éƒ½åªæœ‰`ERROR`çº§åˆ«çš„æ—¥å¿—ä¿¡æ¯äº†ï¼Œ`Ojbk!`ï¼›

![image-20240424214719787](https://images.waer.ltd/notes/image-20240424214719787.png)

---

## 4. å°ç»“ä¸€ä¸‹

è¿™ç¯‡æ–‡ç« ä»`Slf4J`å…¥æ‰‹ï¼Œæ¢³ç†äº†è¿™ä¸ªæ—¥å¿—æ¡†æ¶çš„åŸºæœ¬æ¦‚å¿µå’Œç”¨æ³•ï¼Œéšä¹‹å¼•å‡ºäº†åŸºäº`Slf4j`å®ç°çš„`logback`ï¼Œå¹¶è¯¦ç»†è®²è§£äº†ç›¸å…³çš„ä½¿ç”¨æ–¹æ³•ï¼Œå½“ç„¶ï¼Œæ–‡ç« è‡³æ­¤å·²å°†è¿‘6700å­—ï¼Œè€Œè¿™ä¸æ˜¯`typora`çš„ä¸Šé™ï¼Œä¹Ÿä¸æ˜¯`CSDN`çš„ä¸Šé™ï¼Œè‡ªç„¶ä¹Ÿä¸æ˜¯ä½ æˆ‘çš„ä¸Šé™ï¼Œåªæ˜¯ç¡®å®å¤œå¤ªæ·±ï¼Œæœ‰äº›å¯‚å¯äº†...æºœäº†æºœäº†ã€‚

> åç»­å†…å®¹å°†é€æ­¥åœ¨[æˆ‘çš„åšå®¢](https://www.ilikexff.cn)ç«¯è¿›è¡Œä¸å®šæœŸæ›´æ–°ï¼Œå› ä¸º`CSDN`æ–‡ç« æ›´æ–°åå¹¶æ²¡æœ‰ä»»ä½•æç¤ºï¼Œæˆ‘çš„åšå®¢æœ‰è®¢é˜…åŠŸèƒ½ï¼Œè¿™ä¸€ç‚¹æ¥è¯´ï¼Œåœ¨åšå®¢ç«¯æ›´æ–°ç¡®å®æ˜¯ä¸é”™çš„é€‰æ‹©ï¼Œæ„Ÿè°¢é˜…è¯»!

---

