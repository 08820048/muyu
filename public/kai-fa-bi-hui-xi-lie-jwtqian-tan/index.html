<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>慕予博客</title>
  <script src="https://cdn.jsdelivr.net/npm/js-cookie@3.0.5/dist/js.cookie.min.js"
    integrity="sha256-WCzAhd2P6gRJF9Hv3oOOd+hFJi/QJbv+Azn4CGB8gfY=" crossorigin="anonymous" defer></script>
  <script src="/js/index.js" defer></script>
  <script src="/js/prompt.js" defer></script>
  <script src="/js/keyboard.js" defer></script>
  <script src="/js/tab.js" defer></script>
  <script src="/js/commands.js" defer></script>
  <script src="/js/config.js" defer></script><script src="/config.js"></script><link rel="stylesheet" href="/css/base.css"><link rel="stylesheet" href="style.css"><link rel="stylesheet" href="/css/page.css"></head><body onkeydown='exec(event)' style='background-image: url("/assets/background.jpg");'><main>
      <div class="files" id="files" tabindex="0">
<ul>

  <li class="file">
    <span><a href='https://ilikexff.cn/8-kuan-rang-ni-kai-fa-qi-fei-de-intellijidea-cha-jian/'
      tabindex="-2">  8款让你开发起飞的IntellijIDEA插件</a></span>
  </li><li class="file">
    <span><a href='https://ilikexff.cn/aop-jie-mi-qie-mian-bian-cheng-de-zong-he-zhi-nan/'
      tabindex="-3">  AOP揭秘：切面编程的综合指南</a></span>
  </li><li class="file">
    <span><a href='https://ilikexff.cn/c-you-xi-kai-fa-ji-chu-mei-ju-pian-yi-wu-fan-wei-mei-ju/'
      tabindex="-4">  C++游戏开发基础-枚举篇一：无范围枚举</a></span>
  </li><li class="file">
    <span><a href='https://ilikexff.cn/c-you-xi-kai-fa-ji-chu-std-optional/'
      tabindex="-5">  C++游戏开发基础-深入解析std::optional</a></span>
  </li><li class="file">
    <span><a href='https://ilikexff.cn/c-you-xi-kai-fa-ji-chu-shen-ru-jie-xi-thiszhi-zhen-de-ying-yong-yu-ji-qiao/'
      tabindex="-6">  C++游戏开发基础-深入解析this指针的应用与技巧</a></span>
  </li><li class="file">
    <span><a href='https://ilikexff.cn/c-you-xi-kai-fa-ji-chu-fu-zhi-gou-zao-han-shu/'
      tabindex="-7">  C++游戏开发基础-深入解析复制构造函数</a></span>
  </li><li class="file">
    <span><a href='https://ilikexff.cn/c-you-xi-kai-fa-ji-chu-lei-mo-ban-he-can-shu-tui-dao-zhi-nan/'
      tabindex="-8">  C++游戏开发基础-类模版和参数推导指南</a></span>
  </li><li class="file">
    <span><a href='https://ilikexff.cn/dockerbi-zhi-bi-hui/'
      tabindex="-9">  Docker必知必会</a></span>
  </li><li class="file">
    <span><a href='https://ilikexff.cn/githithub-xiao-ce/'
      tabindex="-10">  GitGitHub小册</a></span>
  </li><li class="file">
    <span><a href='https://ilikexff.cn/google-hacking/'
      tabindex="-11">  Google Hacking</a></span>
  </li><li class="file">
    <span><a href='https://ilikexff.cn/googleguan-fang-ti-shi-gong-cheng-bai-pi-shu-zhong-wen-yi-ben/'
      tabindex="-12">  Google官方《提示工程白皮书（中文译本）》</a></span>
  </li><li class="file">
    <span><a href='https://ilikexff.cn/idea-dai-ma-bu-quan-ti-shi-gong-neng-xiao-shi-de-ji-chong-jie-jue-fang-an-re-geng-ban/'
      tabindex="-13">  IDEA代码补全&amp;提示功能消失的几种解决方案(热更版)</a></span>
  </li><li class="file">
    <span><a href='https://ilikexff.cn/idea-chen-jin-shi-bian-cheng-ti-yan/'
      tabindex="-14">  IDEA沉浸式编程体验</a></span>
  </li><li class="file">
    <span><a href='https://ilikexff.cn/java-han-shu-shi-bian-cheng/'
      tabindex="-15">  Java函数式编程</a></span>
  </li><li class="file">
    <span><a href='https://ilikexff.cn/java-ji-he-yuan-ma-qian-xi/'
      tabindex="-16">  Java集合源码浅析</a></span>
  </li><li class="file">
    <span><a href='https://ilikexff.cn/mysql-shi-wu-te-xing-yu-ge-chi-ji-bie-xiang-jie/'
      tabindex="-17">  MySQL_事务特性与隔离级别详解</a></span>
  </li><li class="file">
    <span><a href='https://ilikexff.cn/ocao-zuo-fu-shi-xian-mei-ju-de-shu-ru-shu-chu/'
      tabindex="-18">  O操作符,实现枚举的输入输出</a></span>
  </li><li class="file">
    <span><a href='https://ilikexff.cn/prdsuan-fa-ting-shuo-ni-xiang-ping-yun-qi-chou-yi-ke-rong-yao-shui-jing/'
      tabindex="-19">  PRD算法：听说你想凭运气抽一颗荣耀水晶?</a></span>
  </li><li class="file">
    <span><a href='https://ilikexff.cn/picgo-pei-zhi-ge-chong-tu-chuang/'
      tabindex="-20">  PicGo配置各种图床</a></span>
  </li><li class="file">
    <span><a href='https://ilikexff.cn/redis-bi-zhi-bi-hui/'
      tabindex="-21">  Redis必知必会</a></span>
  </li><li class="file">
    <span><a href='https://ilikexff.cn/rust-zhong-de-move-yu-yi-sui-bi/'
      tabindex="-22">  Rust中的move语义随笔</a></span>
  </li><li class="file">
    <span><a href='https://ilikexff.cn/ssm-kuang-jia-shi-xian-ji-cheng-duan-xin-yan-zheng-ma-gong-neng/'
      tabindex="-23">  SSM框架实现集成短信验证码功能</a></span>
  </li><li class="file">
    <span><a href='https://ilikexff.cn/slf4jyu-logbackshi-yong-zhi-nan-ji-yu-gradle/'
      tabindex="-24">  Slf4j与Logback实用指南(基于Gradle)</a></span>
  </li><li class="file">
    <span><a href='https://ilikexff.cn/spring-security5-xdao-spring-security6-xde-qian-yi/'
      tabindex="-25">  Spring Security5.x到Spring Security6.x的迁移</a></span>
  </li><li class="file">
    <span><a href='https://ilikexff.cn/springboot-webkai-fa-jing-jie/'
      tabindex="-26">  SpringBoot Web开发精解</a></span>
  </li><li class="file">
    <span><a href='https://ilikexff.cn/springsecurity/'
      tabindex="-27">  SpringSecurity</a></span>
  </li><li class="file">
    <span><a href='https://ilikexff.cn/unity6xia-jia-zhong-guo-qu-tuan-jie-yin-qing-jie-bang-zhe-shi-fen-lie-huan-shi-ben-di-hua-de-kai-shi/'
      tabindex="-28">  Unity6下架中国区，团结引擎接棒：这是分裂，还是本地化的开始？</a></span>
  </li><li class="file">
    <span><a href='https://ilikexff.cn/vim-cong-0-dao-1-da-zao-quan-yu-yan-zhi-chi-de-mo-neng-bian-ji-qi-yu-fa-pian/'
      tabindex="-29">  Vim从0到1打造全语言支持的万能编辑器-语法篇</a></span>
  </li><li class="file">
    <span><a href='https://ilikexff.cn/vim-tiao-tou-powershell-pian/'
      tabindex="-30">  Vim折腾之 PowerShell篇</a></span>
  </li><li class="file">
    <span><a href='https://ilikexff.cn/c-you-xi-kai-fa-ji-chu-di-zhi-chuan-di-xiang-jie/'
      tabindex="-31">  [C++游戏开发基础]:地址传递详解</a></span>
  </li><li class="file">
    <span><a href='https://ilikexff.cn/c-you-xi-kai-fa-ji-chu-yin-yong-fan-hui-he-di-zhi-fan-hui/'
      tabindex="-32">  [C++游戏开发基础]:引用返回和地址返回</a></span>
  </li><li class="file">
    <span><a href='https://ilikexff.cn/c-you-xi-kai-fa-ji-chu-zhi-zhen-he-const/'
      tabindex="-33">  [C++游戏开发基础]:指针和const</a></span>
  </li><li class="file">
    <span><a href='https://ilikexff.cn/c-you-xi-kai-fa-ji-chu-shu-ju-feng-zhuang-yin-cang-de-hao-chu/'
      tabindex="-34">  [C++游戏开发基础]:数据封装(隐藏)的好处</a></span>
  </li><li class="file">
    <span><a href='https://ilikexff.cn/c-you-xi-kai-fa-ji-chu-gou-zao-han-shu-qian-xi-8000zi/'
      tabindex="-35">  [C++游戏开发基础]:构造函数浅析(8000字)</a></span>
  </li><li class="file">
    <span><a href='https://ilikexff.cn/c-you-xi-kai-fa-ji-chu-li-jie-kong-zhi-zhen/'
      tabindex="-36">  [C++游戏开发基础]:理解空指针</a></span>
  </li><li class="file">
    <span><a href='https://ilikexff.cn/c-you-xi-kai-fa-ji-chu-lei-zhong-de-fang-wen-han-shu/'
      tabindex="-37">  [C++游戏开发基础]:类中的访问函数</a></span>
  </li><li class="file">
    <span><a href='https://ilikexff.cn/c-you-xi-kai-fa-ji-chu-zhi-zhen-de-ji-ben-gai-nian-li-jie/'
      tabindex="-38">  [C++游戏开发基础]指针的基本概念理解</a></span>
  </li><li class="file">
    <span><a href='https://ilikexff.cn/fanatical-wu-yue-feng-kuang-te-hui-wei-ni-de-steam-ku-jia-dian-liao/'
      tabindex="-39">  _Fanatical 五月疯狂特惠：为你的 Steam 库加点料！</a></span>
  </li><li class="file">
    <span><a href='https://ilikexff.cn/rust-kai-yuan-mi-ma-gong-ju-xpwd-zhong-wen-ban-bian-geng-ri-zhi/'
      tabindex="-40">  _Rust开源密码工具xpwd中文版变更日志</a></span>
  </li><li class="file">
    <span><a href='https://ilikexff.cn/readme/'
      tabindex="-41">  readme</a></span>
  </li><li class="file">
    <span><a href='https://ilikexff.cn/wblog-bo-ke-xian-shang-bu-shu/'
      tabindex="-42">  wblog博客线上部署</a></span>
  </li><li class="file">
    <span><a href='https://ilikexff.cn/shang-gu-shen-qi-vim-su-cheng-bei-wang-lu/'
      tabindex="-43">  上古神器_Vim速成备忘录</a></span>
  </li><li class="file">
    <span><a href='https://ilikexff.cn/mian-fei-ji-huo-quan-ban-ben-typora-zui-xin-ban-wei-li/'
      tabindex="-44">  免费激活全版本Typora，最新版为例</a></span>
  </li><li class="file">
    <span><a href='https://ilikexff.cn/guan-yu-lombokxian-wei-ren-zhi-de-ji-ge-qi-ji-yin-qiao/'
      tabindex="-45">  关于Lombok鲜为人知的几个奇技淫巧</a></span>
  </li><li class="file">
    <span><a href='https://ilikexff.cn/guan-yu-jie-kou-xian-liu-de-yi-ci-jian-dan-shi-jian/'
      tabindex="-46">  关于接口限流的一次简单实践</a></span>
  </li><li class="file">
    <span><a href='https://ilikexff.cn/tu-jie-er-jin-zhi/'
      tabindex="-47">  图解二进制</a></span>
  </li><li class="file">
    <span><a href='https://ilikexff.cn/ru-he-xie-de-yi-shou-you-ya-gui-fan-de-springboot-jie-kou/'
      tabindex="-48">  如何写得一手优雅规范的SpringBoot 接口？</a></span>
  </li><li class="file">
    <span><a class="selected"href='https://ilikexff.cn/kai-fa-bi-hui-xi-lie-jwtqian-tan/'
      tabindex="-49">  开发必会系列_JWT浅谈</a></span>
  </li><li class="file">
    <span><a href='https://ilikexff.cn/ji-qiao-jiu-shi-xiao-lu-chatgpt-diao-jiao-zhi-bei/'
      tabindex="-50">  技巧就是效率，ChatGPT调教指北</a></span>
  </li><li class="file">
    <span><a href='https://ilikexff.cn/ti-sheng-intellij-kai-fa-xiao-lu-zhe-kuan-dai-ma-tu-ding-cha-jian-codepins-zhi-de-yi-shi/'
      tabindex="-51">  提升 IntelliJ 开发效率？这款代码图钉插件 CodePins 值得一试</a></span>
  </li><li class="file">
    <span><a href='https://ilikexff.cn/ti-wen-de-zhi-hui-zhuan-zai/'
      tabindex="-52">  提问的智慧转载</a></span>
  </li><li class="file">
    <span><a href='https://ilikexff.cn/xiao-lu-gong-ju-markdown/'
      tabindex="-53">  效率工具Markdown</a></span>
  </li><li class="file">
    <span><a href='https://ilikexff.cn/wu-wei-bing-fa-rust-sheng-ming-zhou-qi-qian-tan/'
      tabindex="-54">  无畏并发_Rust 生命周期浅谈</a></span>
  </li><li class="file">
    <span><a href='https://ilikexff.cn/you-xi-kai-fa-yu-de-bei-sai-er-qu-xian-gan-shou-si-hua-de-shu-xue-zhi-mei/'
      tabindex="-55">  游戏开发与的贝塞尔曲线_感受丝滑的数学之美</a></span>
  </li><li class="file">
    <span><a href='https://ilikexff.cn/you-xi-kai-fa-bi-bei-gao-xiao-de-aabb-qiu-ti-he-obb-peng-zhuang-jian-ce-suan-fa/'
      tabindex="-56">  游戏开发必备：高效的 AABB、球体和 OBB 碰撞检测算法</a></span>
  </li><li class="file">
    <span><a href='https://ilikexff.cn/you-xi-suan-fa-ji-chu-a-xun-lu-suan-fa-chi-xu-wei-hu/'
      tabindex="-57">  游戏算法基础-深入解析A*寻路算法</a></span>
  </li><li class="file">
    <span><a href='https://ilikexff.cn/du-li-you-xi-kai-fa-zhe-gong-ju-xiang-2025jing-xuan-tui-jian-yu-shi-yong-zhi-nan/'
      tabindex="-58">  独立游戏开发者工具箱：2025精选推荐与实用指南</a></span>
  </li><li class="file">
    <span><a href='https://ilikexff.cn/xu-huan-yin-qing-you-xi-kai-fa-xi-lie-zhuan-ti-guan-fang-bian-ma-biao-zhun-huo-gui-yue/'
      tabindex="-59">  虚幻引擎游戏开发系列专题-官方编码标准或规约</a></span>
  </li><li class="file">
    <span><a href='https://ilikexff.cn/xiang-jie-she-ji-mo-shi-dan-li-de-jin-hua-zhi-lu/'
      tabindex="-60">  详解设计模式_单例的进化之路</a></span>
  </li><li class="file">
    <span><a href='https://ilikexff.cn/xie-e-de-fei-chang-liang-quan-ju-bian-liang/'
      tabindex="-61">  邪恶的非常量全局变量</a></span>
  </li>
</ul>
</div>
      <div class="viewer page" id="viewer" tabindex="0">
        <div class="tab">
<div class="file-manager" onclick='document.getElementById("files").classList.toggle("open"); document.getElementById("content").classList.toggle("close")'> </div>
<ul id="tabs">
</ul>


</div>
        <div class="content" id="content"><h2 id="1-yin-yan">1. 引言</h2>
<p>现在前后端分离项目已经成为 主流的开发模式，而在项目开发过程中多多少少都会接触到登录相关的业务，几乎是绕不开的一部分。而只要涉及到登录模块，大部分的开发中都会用提到一种叫做<code>token</code>的东西，顾名思义，<code>token</code>就是一个令牌，用来作用户身份校验的一种技术，或者具体点说，<code>token</code>不过是一串含有特定用户身份信息的字符串。一般由后端颁发，前端携带。</p>
<p>可能提到<code>token</code>，很多人会不自觉的将它和接下来要重点介绍的<code>JWT</code>联系到一起，甚至可能不少人都会以为<code>JWT</code>和<code>Token</code>不就是同一个东西吗？并不完全是。<code>Token</code>是一个比较宽泛的定义，而在具体的实现上，<code>Token</code>有很多实现方式，<code>JWT</code>就是其中的一种，也是日常开发中最常见的一种<code>token</code>实现，不管是在单体项目还是分布式微服务中，<code>JWT</code>技术都被广泛的应用，因此，有必要一次性将它安排的明明白白！</p>
<hr />
<h2 id="2-jwtwu-zang-liu-fu">2. JWT五脏六腑</h2>
<h3 id="2-1-chang-shen-me-yang">2.1 长什么样</h3>
<p><code>JWT</code>的缩写是<code>JSON Web Token</code>。常用在网络应用环境中传递声明一种紧凑自包含的方式，这些声明可以被验证和信任，因为他是经过数字签名的，<code>JWT</code>可以被用于身份认证和信息交换。我靠，有一说一，这定义真的是抽象，但是不打紧，你不用也没必要去记下他的定义，你要学的，是理解他的原理和作用即可，就开发行业来说，很多技术其实没那么注重对名词本身的记忆上，更多的是对技术原理和使用的要求，当你学会如何使并理解了他背后的实现原理之后，你也就掌握了这门技术，晦涩的术语定义不过是回个头的事。</p>
<p>先看个实际项目中基于<code>JWT</code>实现的<code>Token</code>字符串,这是来自我的<a class="" href="https://www.ilikexff.cn">个人博客</a>登录成功之后的响应数据，其中就包含了<code>token</code>字段。</p>
<p><img src="https://images.waer.ltd/notes/image-20240422145939177.png" alt="image-20240422145939177" loading="lazy" decoding="async" /></p>
<p>为了更好的理解<code>JWT</code>，下面以一个具体的例子作为切入进行讲解。</p>
<p>``yml
eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c</p>
<pre style="background-color:#2b303b;color:#c0c5ce;"><code><span>
</span><span>仔细观察这串字符，他其实被一个点`.`分割成了三部分：
</span><span>
</span><span>![image-20240422151408847](https://images.waer.ltd/notes/image-20240422151408847.png)
</span><span>
</span><span>---
</span><span>
</span><span>### 2.2 组成
</span><span>
</span><span>![JWT](https://images.waer.ltd/notes/JWT.png)
</span><span>
</span><span>如上面的图所示，`JWT`由三个部分构成，从左到右以`.`分割，分别为：
</span><span>
</span><span>- Header头部
</span><span>- Payload(载荷)
</span><span>- Signature(签名)
</span><span>
</span><span>![image-20240422151839638](https://images.waer.ltd/notes/image-20240422151839638.png)
</span><span>
</span><span>#### 2.2.1 Header
</span><span>
</span><span>头部通常是包含了两部分信息:
</span><span>
</span><span>- 令牌类型(比如这里为`JWT`)
</span><span>- 使用的签名算法(比如这里用的是`HS256`)
</span><span>
</span><span>``json
</span><span>{
</span><span>  &quot;alg&quot;: &quot;HS256&quot;,
</span><span>  &quot;typ&quot;: &quot;JWT&quot;
</span><span>}
</span></code></pre>
<p>令牌类型除了<code>JWT</code>之外，一般还有:<code>JWE</code>和<code>JWS</code>,这不是本文的重点，当作顺手牵羊知道有这东西就行。而对于签名算法，这里用到的是哈希256算法，这只是其众多算法的一种，常用的还有:</p>
<ol>
<li><strong>RS256（RSA using SHA-256）</strong>：RSA 非对称加密算法结合 SHA-256 哈希算法进行签名。在这种情况下，使用私钥对数据进行签名，然后使用公钥进行验证。</li>
<li><strong>ES256（ECDSA using P-256 and SHA-256）</strong>：使用椭圆曲线数字签名算法（ECDSA）和 SHA-256 哈希算法进行签名。这是基于椭圆曲线加密的一种签名算法。</li>
<li><strong>HS384（HMAC using SHA-384）</strong>：使用 HMAC（Hash-based Message Authentication Code）和 SHA-384 哈希算法进行签名。</li>
<li><strong>RS384（RSA using SHA-384）</strong>：RSA 非对称加密算法结合 SHA-384 哈希算法进行签名。</li>
<li><strong>ES384（ECDSA using P-384 and SHA-384）</strong>：使用椭圆曲线数字签名算法（ECDSA）和 SHA-384 哈希算法进行签名。</li>
<li><strong>HS512（HMAC using SHA-512）</strong>：使用 HMAC 和 SHA-512 哈希算法进行签名。</li>
<li><strong>RS512（RSA using SHA-512）</strong>：RSA 非对称加密算法结合 SHA-512 哈希算法进行签名。</li>
<li><strong>ES512（ECDSA using P-521 and SHA-512）</strong>：使用椭圆曲线数字签名算法（ECDSA）和 SHA-512 哈希算法进行签名。</li>
</ol>
<p>不同的算法实现原理不同，但启用算法对签名进行加密的唯一共性就是用来确保数据的完整性和真实性:</p>
<blockquote>
<ol>
<li><strong>数据完整性验证</strong>：签名算法通过对数据进行签名，生成一个固定长度的字符串，这个字符串会随着 <code>JWT </code>一起发送。接收方可以使用相同的密钥和签名算法重新计算签名，然后将计算出的签名与接收到的签名进行比较，以验证数据在传输过程中是否被篡改。</li>
<li><strong>数据真实性验证</strong>：签名算法使用发送方的密钥对数据进行签名，接收方使用相同的密钥来验证签名。如果接收方能够成功验证签名，就可以确定数据确实是由发送方生成的，从而验证数据的真实性。</li>
<li><strong>防止伪造和篡改</strong>：通过签名算法生成的签名可以有效防止恶意第三方伪造数据或篡改数据。即使数据在传输过程中被修改，接收方也能够通过验证签名来检测出数据的篡改。</li>
<li><strong>身份验证</strong>：签名算法还可以用于验证数据的发送方身份。只有知道正确密钥的发送方才能生成有效的签名，因此接收方可以通过验证签名来确认数据的发送方身份。</li>
</ol>
</blockquote>
<hr />
<h3 id="">2.2.2 Payload</h3>
<p>载荷部分包含了声明(<code>claims</code>)，声明关于实体(比如用户)和其他数据的信息，载荷部分通常是一个 <code>JSON </code>对象，以结构化的方式包含了各种声明和数据信息，并被<code>Base64</code>编码以提供轻量级的传输。</p>
<p>为了在网络上进行传输，<code>JWT </code>的各个部分（包括头部、载荷和签名）通常会被 <code>Base64 </code>编码。<code>Base64 </code>编码是一种将二进制数据转换为文本的编码方式，它可以确保数据在传输过程中不会丢失，并且可以减少传输数据的大小。</p>
<p>也即是说，载荷部分是我们存储用户信息的地方，这些用户信息一般以<code>JSON</code>格式进行存储，比如:</p>
<p>``json
{
“username”:“Gemini48”,
“money”:0
}</p>
<pre style="background-color:#2b303b;color:#c0c5ce;"><code><span>
</span><span>但是请注意，不建议将用户敏感信息存入`JWT`中，这是不安全的做法。为什么不安全，因为没有经过加密啊，注意上上面提到的 **以`Base64`进行编码**，注意`Base64`只是一种编码方式，而不是加密算。所以说经过编码后的数据依旧是可逆的，容易被**网络大黑客**给你解码出来原文，想象一下，一旦你的敏感数据被以这种方式存储在`JWT`中，比如你在某知名交友网站的登录密码和用户名，那就相当于向互联网宣布自己的密码正在裸奔，被别人拿去扒出来你身兼数职做添狗的那几十页聊天记录.....
</span><span>
</span><span>所以请务必记住:
</span><span>
</span><span>- `JWT`不要存敏感信息！
</span><span>- `JWT`不要存敏感信息！
</span><span>- `JWT`不要存敏感信息！
</span><span>
</span><span>我们话又说回来，即使使用了加密算法，也无法完全保证这些信息的安全性。有一部叫《我是谁》的电影我觉得挺好看的，这是一部黑客题材的电影，里面有一句话我觉得很经典:**没有绝对安全的系统!**
</span><span>
</span><span>---
</span><span>
</span><span>### 2.2.3 Signature
</span><span>
</span><span>签名是对头部和载荷的内容进行签名后得到的一段字符串，用于验证 `JWT` 的真实性和完整性。签名通过将头部、载荷以及密钥一起进行加密生成，确保 `JWT `在传输过程中没有被篡改。
</span><span>
</span><span>这部分其实上面已经多多少少说差不多了，需要注意的是，签名算法很多，具体使用哪一种没有固定不变的规则，需要根据自己的业务需求等情况来选择，不管如何加密签名，都需要对`JWT`进行定期轮换，在`JWT`中设置合理的过期时间，以确保令牌在一段时间后失效，减少令牌被滥用的可能性。![image-20240422153638441](https://images.waer.ltd/notes/image-20240422153638441.png)
</span><span>
</span><span>---
</span><span>
</span><span>## 3. JWT 基本工作原理
</span><span>
</span><span>**有个问题: `JWT`是否可逆？？？？**
</span><span>
</span><span>如果你不是直接点一下文章目录跳到这里的话，那我相信你的答案和我一样，**JWT本身是不可逆的**，其实这种说法可能不那么标准，可逆不可逆一般用在密码学领域中较多，简单来说，可逆就是指通过某种加密算法加密后的密文是否能通过某些手段再进行解密回去得到加密之前的明文的过程，一般来说，如果某种算法的加密可以被解密，那么就说这是一种可逆加密算法。
</span><span>
</span><span>那么问题来了，既然`JWT`不可逆，我们在进行信息验证的时候是怎么获取到其载荷部分的用户信息呢？大致步骤如下:
</span><span>
</span><span>&gt; 1. **解析JWT**：首先，需要解析JWT，将其分解为头部、载荷和签名三个部分。这可以通过将JWT字符串拆分为这三部分来完成。
</span><span>&gt; 2. **验证签名**：使用JWT中的头部和载荷以及事先约定的密钥，对JWT进行签名验证。具体的验证过程取决于JWT使用的签名算法，可以是对称加密算法（如HMAC）或非对称加密算法（如RSA）。
</span><span>&gt; 3. **提取载荷数据**：如果签名验证成功，说明JWT未被篡改，可以提取载荷数据。载荷部分通常包含关于用户身份、权限等信息的声明。
</span><span>&gt; 4. **使用载荷数据**：一旦获得有效的载荷数据，可以根据需要使用这些数据来进行授权、身份验证等操作。
</span><span>
</span><span>为了更好的理解`JWT`，这里推荐一个在线地址:[https://jwt.io/#debugger-io](https://jwt.io/#debugger-io),网站上可以直接根据需三部分的需求生成和解析`JWT`，使用方式很简单，将自己的`token`粘贴到左侧的`Encoded`中，选择签名加密算法即可解析在右侧(`Decoded`)部分显示。也可以直接修改右侧的三部分信息，他会在左侧实时的生成目标`JWT`。不得不说，这可比在代码中写`demo`来的方便快捷!!
</span><span>
</span><span>![image-20240422164656044](https://images.waer.ltd/notes/image-20240422164656044.png)
</span><span>
</span><span>大可不必太担心你的令牌泄漏，因为：
</span><span>
</span><span>![image-20240422170220673](https://images.waer.ltd/notes/image-20240422170220673.png)
</span><span>
</span><span>下面是`JWT`在`Web`开发中的基本工作原理:
</span><span>
</span><span>![image-20240422163237414](https://images.waer.ltd/notes/image-20240422163237414.png)
</span><span>
</span><span>&gt; 问:为什么图大都是英文啊，别问，问就是中文没有这种字体，而我挺中意这种自由自在随性风格的字体的。
</span><span>
</span><span>虽然有图了，这里还是大致用文字的方式捋一遍：
</span><span>
</span><span>- 客户端向服务器发起登录请求，执行用户登录
</span><span>- 服务器生成`JWT`并颁发`JWT`响应给客户端
</span><span>- 客户端再次请求服务端其他接口时会在请求头等信息中携带`JWT`生成的`Token`信息
</span><span>- 服务端收到请求之后对请求中`Token`进行校验，校验通过后才会允许请求执行并响应到客户端；
</span><span>
</span><span>---
</span><span>
</span><span>### 4. JWT的优势
</span><span>
</span><span>- 无状态：由于 `JWT `本身携带所有必要的信息，因此服务器不需要维护会话信息。这使得 `JWT `无状态，从而减少了服务器负载并简化了可伸缩性。
</span><span>- 紧凑高效：由于其紧凑的解构，`JWT `适合通过网络传输，并且易于客户端解析。
</span><span>- 安全性：`JWT `经过数字签名，确保数据完整性并防止篡改。使用加密算法可以进一步增强安全性。
</span><span>- 跨域通信：`JWT `可以跨不同的域或微服务使用，因为它们不依赖于 `cookie `或服务器端会话。
</span><span>
</span><span>---
</span><span>
</span><span>### 5. 代码实践
</span><span>
</span><span>巴拉巴拉说了这么多，最终还是要写代码的啊。老规矩，演示还是基于`Gradle`构建的`SpringBoot`项目，`Maven`玩家请自行变通。
</span><span>
</span><span>下面给出`Maven`仓库地址，进去直接搜索关键字即可:[https://mvnrepository.com/](https://mvnrepository.com/)
</span><span>
</span><span>关于`Token`的具体实现的依赖库有很多，这里采用`com.auth0`的`java-jwt`进行演示。
</span><span>
</span><span>#### 5.1 添加依赖
</span><span>
</span><span>``groovy
</span><span>// https://mvnrepository.com/artifact/com.auth0/java-jwt
</span><span>implementation &#39;com.auth0:java-jwt:4.4.0&#39;
</span></code></pre>
<h4 id="-1">5.2 生成Token</h4>
<p>``java
// 密钥，这里使用HMAC SHA-256算法举例，实际项目中应妥善保管和配置
private static final String SECRET_KEY = “DHSDNSJDSndjsdjsSAJKDS”;</p>
<p>/**</p>
<ul>
<li>生成JWT Token</li>
<li></li>
<li>@param issuer       签发者，通常是服务提供者的名称或URL，用于标识JWT的来源</li>
<li>@param expirationTimeInMinutes 过期时间（分钟），指定JWT的有效期限</li>
<li>@return 生成的JWT字符串，可作为Bearer Token用于HTTP请求的Authorization头
*/</li>
</ul>
<p>public static String generateToken(String issuer, long expirationTimeInMinutes) {
// 使用指定的密钥和HMAC SHA-256算法创建JWT签名算法实例
Algorithm algorithm = Algorithm.HMAC256(SECRET_KEY);
Map&lt;String,Object&gt; headers = new HashMap&lt;&gt;();
// 获取当前时间，并计算过期时间点
Date now = Date.from(Instant.now());
Date expirationDate = Date.from(now.toInstant().plusSeconds(expirationTimeInMinutes * 60));
headers.put(“CSDN:”,“小妖剑”);</p>
<pre style="background-color:#2b303b;color:#c0c5ce;"><code><span>// 创建JWT并设置必要的属性（主题、签发者、发行时间和过期时间），最后使用指定的算法签名
</span><span>return JWT.create()
</span><span>        .withHeader(headers) // 头部
</span><span>        .withClaim(&quot;userId&quot;, 408) // 载荷
</span><span>        .withClaim(&quot;username&quot;,&quot;小妖剑&quot;) // 载荷
</span><span>        .withIssuer(issuer)
</span><span>        .withIssuedAt(now)
</span><span>        .withExpiresAt(expirationDate)
</span><span>        .sign(algorithm); // 签名算法
</span></code></pre>
<p>}</p>
<pre style="background-color:#2b303b;color:#c0c5ce;"><code><span>
</span><span>执行代码之后，我们不妨将控制台打印的`token`信息放到上面提到的`jwt.io`网站上进行解析，得到下面的结果:![image-20240422182007708](https://images.waer.ltd/notes/image-20240422182007708.png)
</span><span>
</span><span>注意，这个代码生成的`token`中，我们发现在`header`部分除了有我们之前说的令牌类型和签名算法信息之外，还有一个我们自定义的`CSDN`的字段，显然，如果我们需要在头部进行自定义信息的话，上面的写法可以参考，其实就是传入一个`Map`集合，在集合中定义我们需要放在头部的信息数据，但是一般情况下，我们是不需要自定义`header`信息的，所以上面的代码可以修改为:
</span><span>
</span></code></pre>
<p>/**</p>
<ul>
<li>生成JWT Token</li>
<li></li>
<li>@param issuer       签发者，通常是服务提供者的名称或URL，用于标识JWT的来源</li>
<li>@param expirationTimeInMinutes 过期时间（分钟），指定JWT的有效期限</li>
<li>@return 生成的JWT字符串，可作为Bearer Token用于HTTP请求的Authorization头
*/</li>
</ul>
<p>public static String generateToken(String issuer, long expirationTimeInMinutes) {
// 使用指定的密钥和HMAC SHA-256算法创建JWT签名算法实例
Algorithm algorithm = Algorithm.HMAC256(SECRET_KEY);</p>
<pre style="background-color:#2b303b;color:#c0c5ce;"><code><span>// 获取当前时间，并计算过期时间点
</span><span>Date now = Date.from(Instant.now());
</span><span>Date expirationDate = Date.from(now.toInstant().plusSeconds(expirationTimeInMinutes * 60));
</span><span>
</span><span>// 创建JWT并设置必要的属性（主题、签发者、发行时间和过期时间），最后使用指定的算法签名
</span><span>return JWT.create()
</span><span>        .withClaim(&quot;userId&quot;, 408)
</span><span>        .withClaim(&quot;username&quot;,&quot;小妖剑&quot;)
</span><span>        .withIssuer(issuer)
</span><span>        .withIssuedAt(now)
</span><span>        .withExpiresAt(expirationDate)
</span><span>        .sign(algorithm);
</span></code></pre>
<p>}</p>
<pre style="background-color:#2b303b;color:#c0c5ce;"><code><span>
</span><span>![image-20240422182846195](https://images.waer.ltd/notes/image-20240422182846195.png)
</span><span>
</span><span>关于这个`jwt.io`工具网站的使用，其实埋了一些小技巧的，不知道各位有没有认真观察。写完了`Token`的生成，接下来继续`Token`的解析方法。解析`Token`用到了`java-jwt`中的一个`verify()`方法，方法返回一个`DecodedJWT`对象，该对象中包含了所有`token`信息，我们可以看看源码:
</span><span>
</span><span>![image-20240422183832248](https://images.waer.ltd/notes/image-20240422183832248.png)
</span><span>
</span></code></pre>
<p>/**</p>
<ul>
<li>
<p>验证并解析JWT Token</p>
</li>
<li></li>
<li>
<p>@param token 待验证的JWT字符串</p>
</li>
<li>
<p>@return 经过验证的DecodedJWT对象，包含了JWT的原始信息和已验证的claims</p>
</li>
<li>
<p>@throws JWTVerificationException 如果验证失败，例如密钥不匹配、签发者不符、过期或被篡改等
*/
public static DecodedJWT validateAndDecodeToken(String token) throws JWTVerificationException {
// 使用指定的密钥和HMAC SHA-256算法创建JWT验证器实例
Algorithm algorithm = Algorithm.HMAC256(SECRET_KEY);
JWTVerifier verifier = JWT.require(algorithm)
// 设置期望的签发者，验证时会检查传入的JWT是否与此相符
.withIssuer(“https://www.ilikexff.cn”)
.build();</p>
<p>// 使用验证器对传入的JWT进行验证，并返回解析后的DecodedJWT对象
return verifier.verify(token);
}</p>
</li>
</ul>
<pre style="background-color:#2b303b;color:#c0c5ce;"><code><span>
</span><span>![image-20240422183938687](https://images.waer.ltd/notes/image-20240422183938687.png)
</span><span>
</span><span>目前为止，我们使用`java-jwt`完成了`JWT`的生成和解析功能，至于如何在实际的项目中使用生成的`Token`，应该难不倒在看的各位了！但是这里还有一些比较重要的工作没有做，那就是测试`Token`的时效性，这重要但不难，就不再赘述。在我后续的文章中，也会用到`JWT`实现`Token`的登录功能，敬请关注！
</span><span>
</span><span>----
</span><span>
</span><span>&gt; 感谢阅读，期待下次与你再见!
</span><span>
</span></code></pre>

        </div>
      </div>
      <div class="prompt" id="terminal"><input
    type="text"
    id="setter"
    onkeydown="writeit(this, event);moveIt(this.value.length, event)"
    onchange="writeit(this, event)"
    onkeyup="writeit(this, event)"
    onkeypress="writeit(this, event);"
    >
<label for="setter" id="writer"> </label><b class="cursor" id="cursor"></b></div>
      <footer class="footer">
        <div class="footer-content">
          <p class="icp-info">
            <a href="https://beian.miit.gov.cn/" target="_blank" rel="noopener noreferrer">黔ICP备2021010295号</a>
          </p>
        </div>
      </footer>
    </main>
  </body>

</html>
