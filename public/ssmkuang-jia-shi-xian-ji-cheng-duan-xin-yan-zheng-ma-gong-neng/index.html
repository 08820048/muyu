<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>慕予博客</title>
  <script src="https://cdn.jsdelivr.net/npm/js-cookie@3.0.5/dist/js.cookie.min.js"
    integrity="sha256-WCzAhd2P6gRJF9Hv3oOOd+hFJi/QJbv+Azn4CGB8gfY=" crossorigin="anonymous" defer></script>
  <script src="/js/index.js" defer></script>
  <script src="/js/prompt.js" defer></script>
  <script src="/js/keyboard.js" defer></script>
  <script src="/js/tab.js" defer></script>
  <script src="/js/commands.js" defer></script>
  <script src="/js/config.js" defer></script><script src="/config.js"></script><link rel="stylesheet" href="/css/base.css"><link rel="stylesheet" href="style.css"><link rel="stylesheet" href="/css/page.css"></head><body onkeydown='exec(event)' style='background-image: url("/assets/background.jpg");'><main>
      <div class="files" id="files" tabindex="0">
<ul>

  <li class="file">
    <span><a href='https://muyu-git-main-08820048s-projects.vercel.app/gitgithubxiao-ce/'
      tabindex="-2">  Github 修炼小册</a></span>
  </li><li class="file">
    <span><a href='https://muyu-git-main-08820048s-projects.vercel.app/google-hacking/'
      tabindex="-3">  Google Hacking</a></span>
  </li><li class="file">
    <span><a href='https://muyu-git-main-08820048s-projects.vercel.app/javahan-shu-shi-bian-cheng/'
      tabindex="-4">  Java函数式编程</a></span>
  </li><li class="file">
    <span><a href='https://muyu-git-main-08820048s-projects.vercel.app/javaji-he-yuan-ma-qian-xi/'
      tabindex="-5">  Java集合源码浅析</a></span>
  </li><li class="file">
    <span><a class="selected"href='https://muyu-git-main-08820048s-projects.vercel.app/ssmkuang-jia-shi-xian-ji-cheng-duan-xin-yan-zheng-ma-gong-neng/'
      tabindex="-6">  SSM框架实现短信验证码功能集成</a></span>
  </li><li class="file">
    <span><a href='https://muyu-git-main-08820048s-projects.vercel.app/springsecurity/'
      tabindex="-7">  Spring Security</a></span>
  </li><li class="file">
    <span><a href='https://muyu-git-main-08820048s-projects.vercel.app/vimzhe-teng-powershellpian/'
      tabindex="-8">  Vim折腾之 PowerShell篇</a></span>
  </li><li class="file">
    <span><a href='https://muyu-git-main-08820048s-projects.vercel.app/ti-wen-de-zhi-hui-zhuan-zai/'
      tabindex="-9">  提问的智慧</a></span>
  </li><li class="file">
    <span><a href='https://muyu-git-main-08820048s-projects.vercel.app/xiao-lu-gong-ju-markdown/'
      tabindex="-10">  效率工具 Markdown 快速入门</a></span>
  </li><li class="file">
    <span><a href='https://muyu-git-main-08820048s-projects.vercel.app/readme/'
      tabindex="-11">  说明文档</a></span>
  </li>
</ul>
</div>
      <div class="viewer page" id="viewer" tabindex="0">
        <div class="tab">
<div class="file-manager" onclick='document.getElementById("files").classList.toggle("open"); document.getElementById("content").classList.toggle("close")'> </div>
<ul id="tabs">
</ul>


</div>
        <div class="content" id="content"><h3 id="geng-xin-ri-zhi">更新日志</h3>
<p>2022-09-03 晚</p>
<blockquote>
<ul>
<li>本次更新无新内容，仅调整目录结构</li>
</ul>
</blockquote>
<h2 id="yan-zheng-ma-gong-neng">验证码功能</h2>
<blockquote>
<p>在实际开发中，验证码功能已经是一个很常见的模块了。
今天就来给自己的项目加一个属于自己的短信验证码功能。</p>
</blockquote>
<h3 id="zhun-bei-gong-zuo">准备工作</h3>
<blockquote>
<p>在开始敲代码之前，你需要准备一下。</p>
</blockquote>
<ul>
<li><a class="" href="https://www.yuntongxun.com/?ly=baidu-pz-p&amp;qd=cpc&amp;cp=ppc&amp;xl=ds&amp;kw=12006270">容联云</a>平台账号一个。</li>
<li>可以正常收发短信的手机一台。</li>
<li>一台可用的计算机。</li>
<li>怎么说也得会一点Java吧【本文以SSM项目集成为例】。</li>
<li>会一点JavaScript或者jQuery。</li>
</ul>
<h2 id="kai-shi-lu">开始撸</h2>
<h4 id="xian-kan-kan-zui-hou-de-yang-shi">先看看最后的样式</h4>
<p><img src="https://b3logfile.com/file/2022/08/solo-fetchupload-10700891916562075776-7c2ef8f7.png" alt="" loading="lazy" decoding="async" /></p>
<ul>
<li>登录官网，进入控制台找到如下几个重要的key保存下来，后面需要用到。
<img src="https://b3logfile.com/file/2022/08/solo-fetchupload-1220627229440284181-acd23658.png" alt="" loading="lazy" decoding="async" /></li>
<li>找到页面中【开发手册】&gt;【SDK参考】
<img src="https://b3logfile.com/file/2022/08/solo-fetchupload-12422133158768438033-a14ac3c0.png" alt="" loading="lazy" decoding="async" /></li>
<li>如此打开便可以找到Java需要安装的依赖，将maven依赖复制过来，放入pom.xml文件中正确的位置。</li>
</ul>
<pre style="background-color:#2b303b;color:#c0c5ce;"><code><span>&lt;dependency&gt;
</span><span>    &lt;groupId&gt;com.cloopen&lt;/groupId&gt;
</span><span>    &lt;artifactId&gt;java-sms-sdk&lt;/artifactId&gt;
</span><span>    &lt;version&gt;1.0.3&lt;/version&gt;
</span><span>&lt;/dependency&gt;
</span></code></pre>
<p><img src="https://b3logfile.com/file/2022/08/solo-fetchupload-13592634646042885320-d414f365.png" alt="" loading="lazy" decoding="async" /></p>
<hr />
<h2 id="">处理后端核心业务</h2>
<ul>
<li>service层处理验证码发送逻辑</li>
</ul>
<blockquote>
<p>由于不涉及与数据库的交互，可以将下面的短信验证码的业务逻辑直接在服务层进行处理即可。
<img src="https://b3logfile.com/file/2022/08/solo-fetchupload-11745832972173914333-55ae2419.png" alt="" loading="lazy" decoding="async" /></p>
</blockquote>
<blockquote>
<p>具体的：</p>
</blockquote>
<ul>
<li>在如下位置将你对应的密钥填入。</li>
</ul>
<pre data-lang="Java" style="background-color:#2b303b;color:#c0c5ce;" class="language-Java "><code class="language-Java" data-lang="Java"><span>restAPI.</span><span style="color:#bf616a;">setAccount</span><span>(&quot;</span><span style="color:#a3be8c;">你的countID</span><span>&quot;);
</span><span style="color:#65737e;">// 初始化主账号名称和主账号令牌
</span><span>restAPI.</span><span style="color:#bf616a;">setAppId</span><span>(&quot;</span><span style="color:#a3be8c;">你的countToken</span><span>&quot;);
</span></code></pre>
<ul>
<li>以下部分是对所生成验证码范围的设置，我是随机六位，你可以自定义你的规则。</li>
</ul>
<pre data-lang="Java" style="background-color:#2b303b;color:#c0c5ce;" class="language-Java "><code class="language-Java" data-lang="Java"><span style="color:#65737e;">/*生成随机六位验证码*/
</span><span>  </span><span style="color:#ebcb8b;">Random</span><span> random = </span><span style="color:#b48ead;">new </span><span style="color:#ebcb8b;">Random</span><span>();
</span><span>  </span><span style="color:#ebcb8b;">String</span><span> codes = &quot;&quot;;
</span><span>  </span><span style="color:#b48ead;">for </span><span>(</span><span style="color:#b48ead;">int</span><span> i = </span><span style="color:#d08770;">0</span><span>; i &lt; </span><span style="color:#d08770;">6</span><span>; i++) {
</span><span>  codes += random.</span><span style="color:#bf616a;">nextInt</span><span>(</span><span style="color:#d08770;">10</span><span>);
</span><span>}
</span></code></pre>
<ul>
<li>使用短信验证码模板：由于我们是未上线的测试，所以可以使用的模板是由限定的。可以自己参考文档，具体的，我的配置如下。</li>
</ul>
<pre data-lang="Java" style="background-color:#2b303b;color:#c0c5ce;" class="language-Java "><code class="language-Java" data-lang="Java"><span style="color:#65737e;">// 请使用管理控制台中已创建应用的APPID
</span><span>result = restAPI.</span><span style="color:#bf616a;">sendTemplateSMS</span><span>(userPhone, &quot;</span><span style="color:#a3be8c;">1</span><span>&quot;, </span><span style="color:#b48ead;">new </span><span style="color:#ebcb8b;">String</span><span>[]{codes, &quot;</span><span style="color:#a3be8c;">2</span><span>&quot;});
</span></code></pre>
<ul>
<li>设置验证码的有效期</li>
</ul>
<blockquote>
<p>实际开发中，验证码是不可以一直有效的，我们应该设置一个有效期限，比如2分钟有效，过期只能重新发送获取新的验证码，下面是我利用session进行的实现，提供参考，你也用可以缓存或者redis等方式实现。</p>
</blockquote>
<pre data-lang="Java" style="background-color:#2b303b;color:#c0c5ce;" class="language-Java "><code class="language-Java" data-lang="Java"><span style="color:#65737e;">/*设置验证码有效期为2分钟*/
</span><span>session.</span><span style="color:#bf616a;">setMaxInactiveInterval</span><span>(</span><span style="color:#d08770;">120</span><span>);
</span></code></pre>
<hr />
<h2 id="-1">处理前端页面和校验逻辑</h2>
<blockquote>
<p>后台核心业务结束之后，就可以进行前端页面的编写。首先，有一个提供输入手机号的控件是必须的【<strong>当然，特殊业务场景可能不一定需要显式的输入</strong>】 不要杠！！
总而言之，要发送短信验证码，你得有一个验证码的接收对象吧，这个对象便是一个可用的手机号。具体的：</p>
</blockquote>
<ul>
<li>在页面中放一个输入验证码的控件，当然还需要一个发送验证码的按钮。
<img src="https://b3logfile.com/file/2022/08/solo-fetchupload-14383750180005044555-568cff4d.png" alt="" loading="lazy" decoding="async" /></li>
<li>由于不可能让用户频繁的发送验证码，我们还需要对点击的按钮进行限制，一般的做法是，当用户点击一次发送按钮之后便将该按钮进行禁用掉，避免频繁的被点击，倒计时一分钟后解除禁用，可以再次发送。
这样的需求比较简单，可通过简单的JS进行实现。</li>
</ul>
<pre data-lang="JavaScript" style="background-color:#2b303b;color:#c0c5ce;" class="language-JavaScript "><code class="language-JavaScript" data-lang="JavaScript"><span style="color:#65737e;">/*短信再次发送倒计时*/
</span><span>    </span><span style="color:#b48ead;">function </span><span style="color:#8fa1b3;">outime</span><span>(time) {
</span><span>        </span><span style="color:#b48ead;">if</span><span>(</span><span style="color:#bf616a;">time</span><span>==</span><span style="color:#d08770;">0</span><span>){
</span><span>            </span><span style="color:#bf616a;">$</span><span>(&quot;</span><span style="color:#a3be8c;">#getCode</span><span>&quot;).</span><span style="color:#bf616a;">attr</span><span>(&quot;</span><span style="color:#a3be8c;">disabled</span><span>&quot;,</span><span style="color:#d08770;">false</span><span>);
</span><span>            </span><span style="color:#bf616a;">$</span><span>(&quot;</span><span style="color:#a3be8c;">#getCode</span><span>&quot;).</span><span style="color:#bf616a;">html</span><span>(&quot;</span><span style="color:#a3be8c;">重新发送</span><span>&quot;);
</span><span>        }</span><span style="color:#b48ead;">else</span><span>{
</span><span>            </span><span style="color:#bf616a;">time</span><span>--;
</span><span>            </span><span style="color:#bf616a;">$</span><span>(&quot;</span><span style="color:#a3be8c;">#getCode</span><span>&quot;).</span><span style="color:#bf616a;">html</span><span>(</span><span style="color:#bf616a;">time</span><span>+&quot;</span><span style="color:#a3be8c;">s后重新发送</span><span>&quot;).</span><span style="color:#bf616a;">attr</span><span>(&quot;</span><span style="color:#a3be8c;">disabled</span><span>&quot;,</span><span style="color:#d08770;">true</span><span>);
</span><span>            </span><span style="color:#96b5b4;">setTimeout</span><span>(</span><span style="color:#b48ead;">function </span><span>() {
</span><span>                </span><span style="color:#bf616a;">outime</span><span>(</span><span style="color:#bf616a;">time</span><span>);
</span><span>            },</span><span style="color:#d08770;">1000</span><span>);
</span><span>        }
</span><span>    }
</span></code></pre>
<blockquote>
<p>以上实现只是一种参考，实现方式没有局限。
当时出于安全考虑，这样的前端校验是不够的，实际开发中，一般还会再服务端进行再一次的校验逻辑，实现也比较简单，具体不再赘述。</p>
</blockquote>
<ul>
<li>添加测试的手机号
由于是测试用，所以不是所有手机号都可以接受到验证码的短信，需要在控制台绑定测试用的手机号，操作很简单，不再赘述。</li>
</ul>
<hr />
<h2 id="-2">来看看最终的成果。</h2>
<p><img src="https://b3logfile.com/file/2022/08/solo-fetchupload-9567963583923876937-61c53beb.jpeg" alt="" loading="lazy" decoding="async" /></p>

        </div>
      </div>
      <div class="prompt" id="terminal"><input
    type="text"
    id="setter"
    onkeydown="writeit(this, event);moveIt(this.value.length, event)"
    onchange="writeit(this, event)"
    onkeyup="writeit(this, event)"
    onkeypress="writeit(this, event);"
    >
<label for="setter" id="writer"> </label><b class="cursor" id="cursor"></b></div>
    </main>
  </body>

</html>
