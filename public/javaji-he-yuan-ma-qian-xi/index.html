<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>æ…•äºˆåšå®¢</title>
  <script src="https://cdn.jsdelivr.net/npm/js-cookie@3.0.5/dist/js.cookie.min.js"
    integrity="sha256-WCzAhd2P6gRJF9Hv3oOOd+hFJi/QJbv+Azn4CGB8gfY=" crossorigin="anonymous" defer></script>
  <script src="/js/index.js" defer></script>
  <script src="/js/prompt.js" defer></script>
  <script src="/js/keyboard.js" defer></script>
  <script src="/js/tab.js" defer></script>
  <script src="/js/commands.js" defer></script>
  <script src="/js/config.js" defer></script><script src="/config.js"></script><link rel="stylesheet" href="/css/base.css"><link rel="stylesheet" href="style.css"><link rel="stylesheet" href="/css/page.css"></head><body onkeydown='exec(event)' style='background-image: url("/assets/background.jpg");'><main>
      <div class="files" id="files" tabindex="0">
<ul>

  <li class="file">
    <span><a href='https://muyu-git-main-08820048s-projects.vercel.app/gitgithubxiao-ce/'
      tabindex="-2">ï’¥  Github ä¿®ç‚¼å°å†Œ</a></span>
  </li><li class="file">
    <span><a href='https://muyu-git-main-08820048s-projects.vercel.app/google-hacking/'
      tabindex="-3">ï’¥  Google Hacking</a></span>
  </li><li class="file">
    <span><a href='https://muyu-git-main-08820048s-projects.vercel.app/javahan-shu-shi-bian-cheng/'
      tabindex="-4">ï’¥  Javaå‡½æ•°å¼ç¼–ç¨‹</a></span>
  </li><li class="file">
    <span><a class="selected"href='https://muyu-git-main-08820048s-projects.vercel.app/javaji-he-yuan-ma-qian-xi/'
      tabindex="-5">ï’¥  Javaé›†åˆæºç æµ…æ</a></span>
  </li><li class="file">
    <span><a href='https://muyu-git-main-08820048s-projects.vercel.app/ssmkuang-jia-shi-xian-ji-cheng-duan-xin-yan-zheng-ma-gong-neng/'
      tabindex="-6">ï’¥  SSMæ¡†æ¶å®ç°çŸ­ä¿¡éªŒè¯ç åŠŸèƒ½é›†æˆ</a></span>
  </li><li class="file">
    <span><a href='https://muyu-git-main-08820048s-projects.vercel.app/springsecurity/'
      tabindex="-7">ï’¥  Spring Security</a></span>
  </li><li class="file">
    <span><a href='https://muyu-git-main-08820048s-projects.vercel.app/vimzhe-teng-powershellpian/'
      tabindex="-8">ï’¥  VimæŠ˜è…¾ä¹‹ PowerShellç¯‡</a></span>
  </li><li class="file">
    <span><a href='https://muyu-git-main-08820048s-projects.vercel.app/ti-wen-de-zhi-hui-zhuan-zai/'
      tabindex="-9">ï’¥  æé—®çš„æ™ºæ…§</a></span>
  </li><li class="file">
    <span><a href='https://muyu-git-main-08820048s-projects.vercel.app/xiao-lu-gong-ju-markdown/'
      tabindex="-10">ï’¥  æ•ˆç‡å·¥å…· Markdown å¿«é€Ÿå…¥é—¨</a></span>
  </li><li class="file">
    <span><a href='https://muyu-git-main-08820048s-projects.vercel.app/readme/'
      tabindex="-11">ï’¥  è¯´æ˜æ–‡æ¡£</a></span>
  </li>
</ul>
</div>
      <div class="viewer page" id="viewer" tabindex="0">
        <div class="tab">
<div class="file-manager" onclick='document.getElementById("files").classList.toggle("open"); document.getElementById("content").classList.toggle("close")'>ï„• </div>
<ul id="tabs">
</ul>


</div>
        <div class="content" id="content"><h3 id="geng-xin-ri-zhi-tada">æ›´æ–°æ—¥å¿—ğŸ‰</h3>
<p>2023-01-29 æ˜ŸæœŸå…­</p>
<blockquote>
<ul>
<li>ä¿®æ­£ä¸€äº›å·²çŸ¥é”™è¯¯</li>
<li>è°ƒæ•´æ–‡ç« å¸ƒå±€ç»“æ„</li>
<li>ä¿®æ­£é”™åˆ«å­—è¯</li>
</ul>
</blockquote>
<p>2022-05-26 10:20:23 æ˜ŸæœŸå››</p>
<blockquote>
<ul>
<li>ä¿®æ­£è¯­è¨€è¡¨è¾¾é€»è¾‘</li>
<li>åˆ é™¤/ä¿®æ”¹äº†é”™åˆ«å­—è¯</li>
<li>æ›´æ–°äº†éƒ¨åˆ†é…å›¾</li>
</ul>
</blockquote>
<p>2022-08-02</p>
<blockquote>
<ul>
<li>ä¿®æ­£é”™åˆ«å­—</li>
<li>ä¿®æ­£è¯­è¨€è¡¨è¾¾é€»è¾‘</li>
</ul>
</blockquote>
<p>2022-08-22</p>
<blockquote>
<ul>
<li>è¿˜æ˜¯ä¿®å·²çŸ¥çš„æ­£é”™åˆ«è¯è¯­</li>
</ul>
</blockquote>
<hr />
<hr />
<p>Javaé›†åˆè§£è¯»</p>
<h2 id="ideakuai-jie-jian">IDEAå¿«æ·é”®</h2>
<blockquote>
<p>æŸ¥çœ‹æºç :F4</p>
<p>è¿›å…¥å®ç°:Ctrl+Alt+B(é¼ æ ‡ç‚¹å‡»)</p>
<p>æ·»åŠ å®ç°ç±»:ç©ºæ ¼</p>
<p>æ˜¾ç¤ºå›¾:Ctrl+Alt+Shift+U</p>
</blockquote>
<h2 id="gai-lan">æ¦‚è§ˆ</h2>
<p>**è¯´æ˜ï¼š**ä»¥ä¸‹å†…å®¹çš„æºç åˆ†æï¼Œå¦‚æ²¡æœ‰ç‰¹åˆ«è¯´æ˜ï¼Œå‡æ¥è‡ªJDK8.</p>
<blockquote>
<ol>
<li>
<p>é›†åˆä¸»è¦åˆ†ä¸ºä¸¤ç»„ï¼šå•åˆ—é›†åˆå’ŒåŒåˆ—é›†åˆ</p>
<blockquote>
<p>ä½†åˆ—é›†åˆä¸€èˆ¬æ˜¯æŒ‡å­˜æ”¾å•ä¸ªå¯¹è±¡çš„é›†åˆï¼Œè€ŒåŒåˆ—é›†åˆä¸€èˆ¬æ˜¯ä»¥&lt;k,v&gt;é”®å€¼å¯¹å½¢å¼å­˜æ”¾æ•°æ®çš„é›†åˆã€‚</p>
</blockquote>
</li>
<li>
<p><code>Collection</code>æ¥å£ä¸‹æœ‰ä¸¤ä¸ªé‡è¦çš„å­æ¥å£<code>List</code>,<code>Set</code>ï¼Œä»–ä»¬çš„å®ç°å­ç±»éƒ½æ˜¯å•åˆ—é›†åˆã€‚</p>
</li>
<li>
<p><code>Map</code>æ¥å£çš„å®ç°å­ç±»æœ‰<code>HashTable</code>ã€<code>HashMap</code>ã€<code>TreeMap</code>,ä¹Ÿéƒ½æ˜¯åŒåˆ—é›†åˆã€‚</p>
</li>
<li>
<p>ä»¥ä¸‹æ˜¯é›†åˆç±»ä¸‹ä¸¤å¤§ä¸»æ¥å£çš„ç±»å›¾å…³ç³»ã€‚</p>
</li>
</ol>
</blockquote>
<h3 id="collectionxi"><strong>Collectionç³»</strong></h3>
<p><img src="https://images.waer.ltd/img/20220525092920.png" alt="" loading="lazy" decoding="async" /></p>
<blockquote>
<p>åœ¨Conllectionæ¥å£ä¸‹ï¼Œæ´¾ç”Ÿå‡ºäº†ä¸‰ä¸ªä¸»è¦çš„å­æ¥å£ï¼Œåˆ†åˆ«ä¸ºæ— åºé›†åˆ<code>Set</code>,é˜Ÿåˆ—<code>Queue</code>å’Œæœ‰åºé›†åˆ<code>List</code>ã€‚åœ¨ä¸‰å¤§å­æ¥å£ä¹‹ä¸‹ï¼Œè¿˜æœ‰ç€ä¼—å¤šçš„å®ç°å­ç±»æˆ–è€…æ´¾ç”Ÿçš„å­æ¥å£ï¼Œå…¶ä¸­æœ€å¸¸ç”¨çš„æœ‰ï¼š</p>
</blockquote>
<ul>
<li>TreeSet</li>
<li>LinkedHashSet</li>
<li>HashSet</li>
<li>LinkedList</li>
<li>ArrayList</li>
<li>Stack</li>
</ul>
<hr />
<h3 id=""><strong>Mapç³»</strong></h3>
<p><img src="https://images.waer.ltd/img/20220525092947.png" alt="" loading="lazy" decoding="async" /></p>
<blockquote>
<p><code>Map</code>é›†åˆä¸ºåŒåˆ—é›†åˆã€‚<code>Map</code>**æ²¡æœ‰ç›´æ¥ç»§æ‰¿çš„å­æ¥å£,**ä¸»è¦æœ‰ä¸‰ä¸ªå®ç°ç±»ï¼Œåˆ†åˆ«æ˜¯<code>HashMap</code>ã€<code>HashTable</code>ã€<code>SortedMap</code>ã€‚åœ¨ä¸‰ä¸ªä¸»è¦å®ç°ä¹‹ä¸‹ï¼Œæ¯”è¾ƒå¸¸ç”¨çš„å®ç°åŠå…¶å®ç°å­ç±»æœ‰ï¼š</p>
<ul>
<li><code>HashMap</code>(æ€§èƒ½é«˜ï¼Œéçº¿ç¨‹å®‰å…¨)</li>
<li><code>Hashtable</code>(æ€§èƒ½è¾ƒä½ï¼Œçº¿ç¨‹å®‰å…¨ï¼Œä½†å±äºè€æ—§çš„APIï¼Œä¸€èˆ¬ä¸æ¨èä½¿ç”¨)</li>
<li><code>TreeMap</code>(æœ‰åº<code>map</code>)</li>
</ul>
</blockquote>
<hr />
<h2 id="-1">ç»†è¯´</h2>
<h3 id="collection"><code>Collection</code></h3>
<p>ç”±äº<code>Collection</code>æ¥å£ç›´æ¥ç»§æ‰¿äº†<code>Iterable</code>ï¼Œå®ƒæ˜¯æ²¡æœ‰å®ç°çš„ï¼Œå®ƒçš„æ‰€æœ‰æ–¹æ³•éƒ½æ˜¯ç”±å®ƒçš„<strong>å­æ¥å£</strong>çš„å®ç°ç±»è¿›è¡Œå®ç°ï¼Œæ‰€ä»¥è¿™é‡Œå°±ä»¥<code>Collection</code>ä¸‹å­æ¥å£<code>List</code>çš„å®ç°ç±»<code>ArrayList</code>æ¥è®²è§£ã€‚æ³¨æ„<code>List</code>æ˜¯<strong>æœ‰åºé›†åˆä¸”å…ƒç´ å¯ä»¥é‡å¤</strong>ï¼Œè€Œ<code>Set</code>åˆ™æ˜¯<strong>æ— åºé›†åˆï¼Œå…ƒç´ ä¸å¯é‡å¤</strong>ã€‚</p>
<p><strong>è®²è§£çš„æ–¹æ³•åˆ—è¡¨</strong></p>
<blockquote>
<ul>
<li>add:æ·»åŠ å•ä¸ªå…ƒç´ </li>
<li>removeï¼šè¾“å‡ºæŒ‡å®šå…ƒç´ </li>
<li>contains:æŸ¥æ‰¾å…ƒç´ æ˜¯å¦å­˜åœ¨</li>
<li>size:è·å–å…ƒç´ ä¸ªæ•°</li>
<li>isEmpty:åˆ¤æ–­æ˜¯å¦ä¸ºç©º</li>
<li>clear:æ¸…ç©º</li>
<li>addAll:æ·»åŠ å¤šä¸ªå…ƒç´ </li>
<li>containsAll:æŸ¥æ‰¾å¤šä¸ªå…ƒç´ æ˜¯å¦éƒ½å­˜åœ¨</li>
<li>removeAll:è¾“å‡ºå¤šä¸ªå…ƒç´ </li>
</ul>
</blockquote>
<p><strong>åŸºæœ¬ç”¨æ³•æ¼”ç¤º</strong></p>
<pre data-lang="java" style="background-color:#2b303b;color:#c0c5ce;" class="language-java "><code class="language-java" data-lang="java"><span style="color:#ebcb8b;">List</span><span> list = </span><span style="color:#b48ead;">new </span><span style="color:#ebcb8b;">ArrayList</span><span>();
</span><span style="color:#65737e;">/*æ·»åŠ å•ä¸ªå…ƒç´ */
</span><span>list.</span><span style="color:#bf616a;">add</span><span>(&quot;</span><span style="color:#a3be8c;">Jack</span><span>&quot;);
</span><span style="color:#65737e;">//è¿™é‡Œå…¶å®æ˜¯ä¸€ä¸ªè‡ªåŠ¨è£…ç®±çš„æ“ä½œ:list.add(new Integer(10))
</span><span>list.</span><span style="color:#bf616a;">add</span><span>(</span><span style="color:#d08770;">10</span><span>);
</span><span>list.</span><span style="color:#bf616a;">add</span><span>(</span><span style="color:#d08770;">true</span><span>);
</span><span style="color:#ebcb8b;">System</span><span>.out.</span><span style="color:#bf616a;">println</span><span>(&quot;</span><span style="color:#a3be8c;">list:</span><span>&quot;+list);
</span><span>
</span><span style="color:#65737e;">/*è¾“å‡ºå…ƒç´ */
</span><span style="color:#65737e;">//è¾“å‡º&quot;Jack&quot;
</span><span style="color:#65737e;">//list.remove(0);
</span><span style="color:#65737e;">//æŒ‡å®šè¾“å‡ºæŸä¸ªå…ƒç´ 
</span><span>list.</span><span style="color:#bf616a;">remove</span><span>(</span><span style="color:#d08770;">true</span><span>);
</span><span style="color:#ebcb8b;">System</span><span>.out.</span><span style="color:#bf616a;">println</span><span>(&quot;</span><span style="color:#a3be8c;">è¾“å‡ºåçš„[list]:</span><span>&quot;+list);
</span><span>
</span><span style="color:#65737e;">/*æŸ¥æ‰¾æŸä¸ªå…ƒç´ æ˜¯å¦å­˜åœ¨*/
</span><span style="color:#65737e;">//true
</span><span style="color:#ebcb8b;">System</span><span>.out.</span><span style="color:#bf616a;">println</span><span>(list.</span><span style="color:#bf616a;">contains</span><span>(&quot;</span><span style="color:#a3be8c;">Jack</span><span>&quot;));
</span><span>
</span><span style="color:#65737e;">/*è·å–å…ƒç´ ä¸ªæ•°*/
</span><span style="color:#65737e;">//2
</span><span style="color:#ebcb8b;">System</span><span>.out.</span><span style="color:#bf616a;">println</span><span>(list.</span><span style="color:#bf616a;">size</span><span>());
</span><span>
</span><span style="color:#65737e;">/*åˆ¤æ–­é›†åˆæ˜¯å¦ä¸ºç©º*/
</span><span style="color:#65737e;">//false
</span><span style="color:#ebcb8b;">System</span><span>.out.</span><span style="color:#bf616a;">println</span><span>(list.</span><span style="color:#bf616a;">isEmpty</span><span>());
</span><span>
</span><span style="color:#65737e;">/*æ¸…ç©ºé›†åˆ*/
</span><span>list.</span><span style="color:#bf616a;">clear</span><span>();
</span><span style="color:#65737e;">//æ¸…ç©ºåçš„[list]ï¼š[]
</span><span style="color:#ebcb8b;">System</span><span>.out.</span><span style="color:#bf616a;">println</span><span>(&quot;</span><span style="color:#a3be8c;">æ¸…ç©ºåçš„[list]ï¼š</span><span>&quot;+list);
</span><span>
</span><span style="color:#65737e;">/*æ·»åŠ å¤šä¸ªå…ƒç´ */
</span><span style="color:#ebcb8b;">ArrayList</span><span> list2 = </span><span style="color:#b48ead;">new </span><span style="color:#ebcb8b;">ArrayList</span><span>();
</span><span>list2.</span><span style="color:#bf616a;">add</span><span>(&quot;</span><span style="color:#a3be8c;">è¥¿æ¸¸è®°</span><span>&quot;);
</span><span>list2.</span><span style="color:#bf616a;">add</span><span>(&quot;</span><span style="color:#a3be8c;">è¥¿å¢è®°</span><span>&quot;);
</span><span>list.</span><span style="color:#bf616a;">addAll</span><span>(list2);
</span><span style="color:#65737e;">//æ·»åŠ å¤šä¸ªå…ƒç´ åçš„[list]:[è¥¿æ¸¸è®°, è¥¿å¢è®°]
</span><span style="color:#ebcb8b;">System</span><span>.out.</span><span style="color:#bf616a;">println</span><span>(&quot;</span><span style="color:#a3be8c;">æ·»åŠ å¤šä¸ªå…ƒç´ åçš„[list]:</span><span>&quot;+list);
</span><span>
</span><span style="color:#65737e;">/*åˆ¤æ–­å¤šä¸ªå…ƒç´ æ˜¯å¦éƒ½å­˜åœ¨*/
</span><span style="color:#65737e;">//true
</span><span style="color:#ebcb8b;">System</span><span>.out.</span><span style="color:#bf616a;">println</span><span>(list.</span><span style="color:#bf616a;">containsAll</span><span>(list2));
</span><span>
</span><span style="color:#65737e;">/*è¾“å‡ºå¤šä¸ªå…ƒç´ */
</span><span>list.</span><span style="color:#bf616a;">add</span><span>(&quot;</span><span style="color:#a3be8c;">åå¼ºåŒ—</span><span>&quot;);
</span><span style="color:#65737e;">//true
</span><span style="color:#ebcb8b;">System</span><span>.out.</span><span style="color:#bf616a;">println</span><span>(list.</span><span style="color:#bf616a;">removeAll</span><span>(list2));
</span><span style="color:#65737e;">//åå¼ºåŒ—
</span><span style="color:#ebcb8b;">System</span><span>.out.</span><span style="color:#bf616a;">println</span><span>(list);
</span></code></pre>
<p><strong>éå†ç”¨æ³•</strong></p>
<blockquote>
<p>ä¸Šé¢çš„ç±»å›¾å·²ç»çŸ¥é“ï¼Œ<code>Collection</code>æ¥å£è¿˜æœ‰ä¸€ä¸ª<code>Iterable</code>çˆ¶æ¥å£ã€‚å®ƒçš„éƒ¨åˆ†å®ç°æºç ä¸­ç¬¬ä¸€ä¸ªæ–¹æ³•å¦‚ä¸‹:</p>
<p><img src="https://images.waer.ltd/img/20220320114101.png" alt="" loading="lazy" decoding="async" /></p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œè¯¥æ–¹æ³•å¯ä»¥è¿”å›å…ƒç´ çš„<code>iterator</code>å¯¹è±¡ã€‚åªè¦æ˜¯å®ç°äº†æ¥å£çš„æ‰€æœ‰å­ç±»ï¼Œéƒ½æœ‰ä¸€ä¸ª<code>iterator()</code>æ–¹æ³•ã€‚åœ¨å¯¹å…ƒç´ çš„éå†ä¸Šï¼Œéƒ½å¯ä»¥é‡‡ç”¨è¿­ä»£å™¨çš„æ–¹å¼è¿›è¡Œéå†ã€‚æ‰€ä»¥<code>Collection</code><strong>åŠå…¶æ‰€æœ‰å­ç±»å®ç°</strong>ï¼Œæˆ‘ä»¬éƒ½å¯ä»¥è·å–åˆ°æ¯ä¸ªå…ƒç´ çš„è¿­ä»£å™¨å¹¶ç”¨åœ¨å¯¹å…ƒç´ çš„éå†æ“ä½œä¸Šã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<code>iterator</code><strong>ä»…ç”¨æ¥éå†é›†åˆï¼Œæœ¬èº«å¹¶ä¸å­˜æ”¾ä»»ä½•å¯¹è±¡ã€‚</strong></p>
</blockquote>
<p><strong>è¿­ä»£å™¨çš„æ‰§è¡ŒåŸç†</strong></p>
<blockquote>
<p>ä½œä¸º<code>Collection</code>çš„çˆ¶æ¥å£ï¼Œ<code>Iterator</code>çš„æ–¹æ³•å¦‚ä¸‹ï¼š</p>
<p><img src="https://images.waer.ltd/img/20220320141211.png" alt="" loading="lazy" decoding="async" /></p>
</blockquote>
<blockquote>
<p>æˆ‘ä»¬ä¸€èˆ¬åœ¨ä½¿ç”¨è¿­ä»£å™¨è¿›è¡Œéå†çš„æ—¶å€™ï¼Œéƒ½ä¼šç”¨åˆ°ä¸€ä¸ª<code>while</code>å¾ªç¯ï¼Œå¾ªç¯çš„æ¡ä»¶æ˜¯<code>iterator.hasNext()</code>ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨æ¯æ¬¡å¾—åˆ°éå†å…ƒç´ ä¹‹å‰ï¼Œ<code>iterator</code>å¯¹è±¡ä¼šè°ƒç”¨è‡ªèº«çš„<code>hasNext()</code>æ–¹æ³•ï¼Œå¯¹é›†åˆé‡Œçš„å…ƒç´ è¿›è¡Œåˆ¤æ–­ï¼Œ<strong>åªæœ‰å½“å­˜åœ¨ä¸‹ä¸€ä¸ªå…ƒç´ æ—¶ï¼Œè¿­ä»£å™¨æ‰ä¼šç»§ç»­å¾€ä¸‹æ‰§è¡Œ</strong>ï¼Œå¦åˆ™ï¼Œè¿­ä»£ç»“æŸã€‚</p>
<p><img src="https://images.waer.ltd/img/20220320140135.png" alt="" loading="lazy" decoding="async" /></p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œ<code>Iterator</code>çš„<code>hasNext()</code>æ–¹æ³•è¿”å›ä¸€ä¸ª<strong>å¸ƒå°”å€¼</strong>ï¼Œå¦‚æœè¯¥è¿­ä»£å¯¹è±¡è¿˜å­˜åœ¨å…ƒç´ çš„æƒ…å†µä¸‹ã€‚è¿™ä¸ªæ–¹æ³•å°±ç›¸å½“äºä¸€ä¸ªæŒ‡å‘é›†åˆå…ƒç´ çš„æŒ‡é’ˆï¼Œæ¯ä¸€æ¬¡è°ƒç”¨éƒ½ä¼šå‘ä¸‹ç§»åŠ¨ä»¥æ£€æŸ¥<strong>æ˜¯å¦åˆ°è¾¾é›†åˆå°¾éƒ¨</strong>ï¼Œåœ¨ç§»åŠ¨çš„åŒæ—¶ï¼Œå®ƒè¿˜ä¼šè°ƒç”¨<code>next()</code>æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¼šå°†ç§»åŠ¨åè¯¥æŒ‡é’ˆæŒ‡å‘ä½ç½®ä¸Šçš„å…ƒç´ è¿›è¡Œè¿”å›ã€‚ä¸ºäº†æœ‰æ•ˆçš„é˜²æ­¢ç©ºæŒ‡é’ˆï¼Œæ¯æ¬¡åœ¨è°ƒç”¨<code>Next()</code>ä¹‹å‰ï¼Œä¼šå…ˆè°ƒç”¨<code>hasNext()</code>,è¿™æ˜¯æœ‰å¿…è¦çš„ã€‚å¦‚æœè¯´ä¸å­˜åœ¨ä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œåˆ™ä¼šæŠ›å‡ºä¸€ä¸ª<code>NoSuchElementException</code>å¼‚å¸¸ã€‚</p>
</blockquote>
<p><strong>Iteratorä½¿ç”¨ç¤ºä¾‹</strong></p>
<pre data-lang="java" style="background-color:#2b303b;color:#c0c5ce;" class="language-java "><code class="language-java" data-lang="java"><span style="color:#b48ead;">package </span><span>collection;
</span><span>
</span><span style="color:#b48ead;">import </span><span>java.util.</span><span style="color:#ebcb8b;">ArrayList</span><span>;
</span><span style="color:#b48ead;">import </span><span>java.util.</span><span style="color:#ebcb8b;">Collection</span><span>;
</span><span style="color:#b48ead;">import </span><span>java.util.</span><span style="color:#ebcb8b;">Iterator</span><span>;
</span><span>
</span><span style="color:#65737e;">/**
</span><span style="color:#65737e;"> * </span><span style="color:#b48ead;">@author</span><span style="color:#65737e;">: å…«å°ºå¦–å‰‘
</span><span style="color:#65737e;"> * @date: 2022/3/20 14:17
</span><span style="color:#65737e;"> * @description: æ¼”ç¤ºè¿­ä»£å™¨[Iterator]çš„ä½¿ç”¨
</span><span style="color:#65737e;"> * @blog:www.waer.ltd
</span><span style="color:#65737e;"> */
</span><span>@</span><span style="color:#bf616a;">SuppressWarnings</span><span>({&quot;</span><span style="color:#a3be8c;">all</span><span>&quot;})
</span><span style="color:#b48ead;">public class </span><span style="color:#ebcb8b;">CollectionIterator </span><span style="color:#eff1f5;">{
</span><span style="color:#eff1f5;">    </span><span style="color:#b48ead;">public static void </span><span style="color:#8fa1b3;">main</span><span style="color:#eff1f5;">(</span><span style="color:#ebcb8b;">String</span><span style="color:#b48ead;">[] </span><span style="color:#bf616a;">args</span><span style="color:#eff1f5;">) {
</span><span style="color:#eff1f5;">        </span><span style="color:#ebcb8b;">Collection</span><span style="color:#eff1f5;"> col </span><span>= </span><span style="color:#b48ead;">new </span><span style="color:#ebcb8b;">ArrayList</span><span style="color:#eff1f5;">();
</span><span style="color:#eff1f5;">        col.</span><span style="color:#bf616a;">add</span><span style="color:#eff1f5;">(</span><span style="color:#b48ead;">new </span><span style="color:#ebcb8b;">Book</span><span style="color:#eff1f5;">(</span><span>&quot;</span><span style="color:#a3be8c;">C++ Primer Plus</span><span>&quot;</span><span style="color:#eff1f5;">,</span><span>&quot;</span><span style="color:#a3be8c;">Stephen Prata</span><span>&quot;</span><span style="color:#eff1f5;">,</span><span style="color:#d08770;">57.4</span><span style="color:#eff1f5;">));
</span><span style="color:#eff1f5;">        col.</span><span style="color:#bf616a;">add</span><span style="color:#eff1f5;">(</span><span style="color:#b48ead;">new </span><span style="color:#ebcb8b;">Book</span><span style="color:#eff1f5;">(</span><span>&quot;</span><span style="color:#a3be8c;">ç¨‹åºå‘˜çš„æ•°å­¦</span><span>&quot;</span><span style="color:#eff1f5;">,</span><span>&quot;</span><span style="color:#a3be8c;">ç»“åŸæµ©</span><span>&quot;</span><span style="color:#eff1f5;">,</span><span style="color:#d08770;">20.5</span><span style="color:#eff1f5;">));
</span><span style="color:#eff1f5;">        col.</span><span style="color:#bf616a;">add</span><span style="color:#eff1f5;">(</span><span style="color:#b48ead;">new </span><span style="color:#ebcb8b;">Book</span><span style="color:#eff1f5;">(</span><span>&quot;</span><span style="color:#a3be8c;">Javaç–¯ç‹‚è®²ä¹‰</span><span>&quot;</span><span style="color:#eff1f5;">,</span><span>&quot;</span><span style="color:#a3be8c;">æåˆš</span><span>&quot;</span><span style="color:#eff1f5;">,</span><span style="color:#d08770;">80.7</span><span style="color:#eff1f5;">));
</span><span style="color:#eff1f5;">
</span><span style="color:#eff1f5;">        </span><span style="color:#ebcb8b;">System</span><span style="color:#eff1f5;">.out.</span><span style="color:#bf616a;">println</span><span style="color:#eff1f5;">(</span><span>&quot;</span><span style="color:#a3be8c;">é›†åˆ[col]:</span><span>&quot;+</span><span style="color:#eff1f5;">col);
</span><span style="color:#eff1f5;">        </span><span style="color:#65737e;">/*éå†é›†åˆ*/
</span><span style="color:#eff1f5;">        </span><span style="color:#65737e;">//1.è·å–é›†åˆçš„è¿­ä»£å¯¹è±¡
</span><span style="color:#eff1f5;">        </span><span style="color:#ebcb8b;">Iterator</span><span style="color:#eff1f5;"> iterator </span><span>=</span><span style="color:#eff1f5;"> col.</span><span style="color:#bf616a;">iterator</span><span style="color:#eff1f5;">();
</span><span style="color:#eff1f5;">        </span><span style="color:#65737e;">//2.whileå¾ªç¯éå†æ•°æ®
</span><span style="color:#eff1f5;">        </span><span style="color:#b48ead;">while</span><span style="color:#eff1f5;">(iterator.</span><span style="color:#bf616a;">hasNext</span><span style="color:#eff1f5;">()){
</span><span style="color:#eff1f5;">            </span><span style="color:#65737e;">//3.æ³¨æ„ï¼šiteratorè¿”å›é»˜è®¤æ—¶ä¸€ä¸ªObjectç±»å‹(é™¤éæŒ‡å®šæ³›å‹)
</span><span style="color:#eff1f5;">            </span><span style="color:#ebcb8b;">Object</span><span style="color:#eff1f5;"> o </span><span>=</span><span style="color:#eff1f5;"> iterator.</span><span style="color:#bf616a;">next</span><span style="color:#eff1f5;">();
</span><span style="color:#eff1f5;">            </span><span style="color:#ebcb8b;">System</span><span style="color:#eff1f5;">.out.</span><span style="color:#bf616a;">println</span><span style="color:#eff1f5;">(</span><span>&quot;</span><span style="color:#a3be8c;">[col]è¿­ä»£è¿”å›:</span><span>&quot;+</span><span style="color:#eff1f5;">o);
</span><span style="color:#eff1f5;">        }
</span><span style="color:#eff1f5;">        </span><span style="color:#65737e;">//4.å½“é€€å‡ºwhileå¾ªç¯ä¹‹åï¼Œæ­¤æ—¶çš„iteratoræŒ‡å‘æœ€åä¸€ä¸ªå…ƒç´ ï¼Œåœ¨è°ƒç”¨next()æ–¹æ³•ä¼šæŠ¥NoSuchElementExceptionå¼‚å¸¸ã€‚
</span><span style="color:#eff1f5;">        </span><span style="color:#65737e;">//å¦‚æœéœ€è¦å†æ¬¡éå†ï¼Œéœ€è¦é‡ç½®è¿­ä»£å™¨ã€‚æ–¹æ³•å¦‚ä¸‹ï¼š
</span><span style="color:#eff1f5;">        </span><span style="color:#65737e;">//IDEAæ”¯æŒå¿«é€Ÿç”Ÿæˆè¿­ä»£æ–¹æ³•ï¼Œä½¿ç”¨[Ctrl+j]å¿«æ·é”®è¿›è¡ŒæŸ¥çœ‹
</span><span style="color:#eff1f5;">        iterator </span><span>=</span><span style="color:#eff1f5;"> col.</span><span style="color:#bf616a;">iterator</span><span style="color:#eff1f5;">();
</span><span style="color:#eff1f5;">        </span><span style="color:#b48ead;">while </span><span style="color:#eff1f5;">(iterator.</span><span style="color:#bf616a;">hasNext</span><span style="color:#eff1f5;">()) {
</span><span style="color:#eff1f5;">            </span><span style="color:#ebcb8b;">Object</span><span style="color:#eff1f5;"> o1 </span><span>=</span><span style="color:#eff1f5;">  iterator.</span><span style="color:#bf616a;">next</span><span style="color:#eff1f5;">();
</span><span style="color:#eff1f5;">            </span><span style="color:#ebcb8b;">System</span><span style="color:#eff1f5;">.out.</span><span style="color:#bf616a;">println</span><span style="color:#eff1f5;">(</span><span>&quot;</span><span style="color:#a3be8c;">[col]å†æ¬¡è¿­ä»£ï¼š</span><span>&quot;+</span><span style="color:#eff1f5;">o1);
</span><span style="color:#eff1f5;">        }
</span><span style="color:#eff1f5;">    }
</span><span style="color:#eff1f5;">}
</span><span>
</span><span style="color:#65737e;">/**
</span><span style="color:#65737e;"> * å†…éƒ¨ç±»
</span><span style="color:#65737e;"> */
</span><span style="color:#65737e;">class  Book{
</span><span style="color:#65737e;">    private String name;
</span><span style="color:#65737e;">    private String author;
</span><span style="color:#65737e;">    private double price;
</span><span style="color:#65737e;">
</span><span style="color:#65737e;">    public Book(String name, String author, double price) {
</span><span style="color:#65737e;">        this.name = name;
</span><span style="color:#65737e;">        this.author = author;
</span><span style="color:#65737e;">        this.price = price;
</span><span style="color:#65737e;">    }
</span><span style="color:#65737e;">
</span><span style="color:#65737e;">    @Override
</span><span style="color:#65737e;">    public String toString() {
</span><span style="color:#65737e;">        return &quot;Book{&quot; +
</span><span style="color:#65737e;">                &quot;name=&#39;&quot; + name + &#39;\&#39;&#39; +
</span><span style="color:#65737e;">                &quot;, author=&#39;&quot; + author + &#39;\&#39;&#39; +
</span><span style="color:#65737e;">                &quot;, price=&quot; + price +
</span><span style="color:#65737e;">                &#39;}&#39;;
</span><span style="color:#65737e;">    }
</span><span style="color:#65737e;">
</span><span style="color:#65737e;">    public String getName() {
</span><span style="color:#65737e;">        return name;
</span><span style="color:#65737e;">    }
</span><span style="color:#65737e;">
</span><span style="color:#65737e;">    public void setName(String name) {
</span><span style="color:#65737e;">        this.name = name;
</span><span style="color:#65737e;">    }
</span><span style="color:#65737e;">
</span><span style="color:#65737e;">    public String getAuthor() {
</span><span style="color:#65737e;">        return author;
</span><span style="color:#65737e;">    }
</span><span style="color:#65737e;">
</span><span style="color:#65737e;">    public void setAuthor(String author) {
</span><span style="color:#65737e;">        this.author = author;
</span><span style="color:#65737e;">    }
</span><span style="color:#65737e;">
</span><span style="color:#65737e;">    public double getPrice() {
</span><span style="color:#65737e;">        return price;
</span><span style="color:#65737e;">    }
</span><span style="color:#65737e;">
</span><span style="color:#65737e;">    public void setPrice(double price) {
</span><span style="color:#65737e;">        this.price = price;
</span><span style="color:#65737e;">    }
</span><span style="color:#65737e;">}
</span></code></pre>
<blockquote>
<p>ä¸€äº›éœ€è¦æ³¨æ„çš„ç‚¹ï¼Œå·²ç»å†™åœ¨äº†æ³¨é‡Šå½“ä¸­ã€‚</p>
</blockquote>
<p><strong>å¢å¼ºfor</strong></p>
<blockquote>
<p>æ‰€è°“å¢å¼ºforï¼Œä¹Ÿå°±æ˜¯é’ˆå¯¹æ™®é€šforå¾ªç¯çš„å¢å¼ºã€‚å®ƒå¯ä»¥æ›¿ä»£<code>iterator</code>è¿­ä»£å™¨ï¼Œç›¸å½“äºä¸€ä¸ªç®€åŒ–ç‰ˆçš„<code>iterator</code>,ä¹Ÿæ­£å› ä¸ºå¦‚æ­¤ï¼Œ<strong>å¢å¼ºforåªèƒ½ç”¨äºéå†é›†åˆæˆ–è€…æ•°ç»„</strong>ã€‚</p>
</blockquote>
<p>åŸºæœ¬è¯­æ³•ï¼š</p>
<pre data-lang="java" style="background-color:#2b303b;color:#c0c5ce;" class="language-java "><code class="language-java" data-lang="java"><span style="color:#b48ead;">for</span><span>(å…ƒç´ ç±»å‹ å…ƒç´ å:é›†åˆæˆ–è€…æ•°ç»„å){
</span><span>    è®¿é—®å…ƒç´ ;
</span><span>}
</span></code></pre>
<pre data-lang="java" style="background-color:#2b303b;color:#c0c5ce;" class="language-java "><code class="language-java" data-lang="java"><span style="color:#b48ead;">package </span><span>collection;
</span><span>
</span><span style="color:#b48ead;">import </span><span>java.util.</span><span style="color:#ebcb8b;">ArrayList</span><span>;
</span><span style="color:#b48ead;">import </span><span>java.util.</span><span style="color:#ebcb8b;">Collection</span><span>;
</span><span>
</span><span style="color:#65737e;">/**
</span><span style="color:#65737e;"> * </span><span style="color:#b48ead;">@author</span><span style="color:#65737e;">: å…«å°ºå¦–å‰‘
</span><span style="color:#65737e;"> * @date: 2022/3/20 14:56
</span><span style="color:#65737e;"> * @description: æ¼”ç¤ºå¢å¼ºforçš„ä½¿ç”¨
</span><span style="color:#65737e;"> * @blog:www.waer.ltd
</span><span style="color:#65737e;"> */
</span><span style="color:#b48ead;">public class </span><span style="color:#ebcb8b;">CollectionFor </span><span style="color:#eff1f5;">{
</span><span style="color:#eff1f5;">    @</span><span style="color:#bf616a;">SuppressWarnings</span><span style="color:#eff1f5;">({</span><span>&quot;</span><span style="color:#a3be8c;">all</span><span>&quot;</span><span style="color:#eff1f5;">})
</span><span style="color:#eff1f5;">    </span><span style="color:#b48ead;">public static void  </span><span style="color:#8fa1b3;">main</span><span style="color:#eff1f5;">(</span><span style="color:#ebcb8b;">String</span><span style="color:#b48ead;">[] </span><span style="color:#bf616a;">args</span><span style="color:#eff1f5;">) {
</span><span style="color:#eff1f5;">        </span><span style="color:#ebcb8b;">Collection</span><span style="color:#eff1f5;"> col </span><span>= </span><span style="color:#b48ead;">new </span><span style="color:#ebcb8b;">ArrayList</span><span style="color:#eff1f5;">();
</span><span style="color:#eff1f5;">        col.</span><span style="color:#bf616a;">add</span><span style="color:#eff1f5;">(</span><span style="color:#b48ead;">new </span><span style="color:#ebcb8b;">Book</span><span style="color:#eff1f5;">(</span><span>&quot;</span><span style="color:#a3be8c;">C++ Primer Plus</span><span>&quot;</span><span style="color:#eff1f5;">,</span><span>&quot;</span><span style="color:#a3be8c;">Stephen Prata</span><span>&quot;</span><span style="color:#eff1f5;">,</span><span style="color:#d08770;">57.4</span><span style="color:#eff1f5;">));
</span><span style="color:#eff1f5;">        col.</span><span style="color:#bf616a;">add</span><span style="color:#eff1f5;">(</span><span style="color:#b48ead;">new </span><span style="color:#ebcb8b;">Book</span><span style="color:#eff1f5;">(</span><span>&quot;</span><span style="color:#a3be8c;">ç¨‹åºå‘˜çš„æ•°å­¦</span><span>&quot;</span><span style="color:#eff1f5;">,</span><span>&quot;</span><span style="color:#a3be8c;">ç»“åŸæµ©</span><span>&quot;</span><span style="color:#eff1f5;">,</span><span style="color:#d08770;">20.5</span><span style="color:#eff1f5;">));
</span><span style="color:#eff1f5;">        col.</span><span style="color:#bf616a;">add</span><span style="color:#eff1f5;">(</span><span style="color:#b48ead;">new </span><span style="color:#ebcb8b;">Book</span><span style="color:#eff1f5;">(</span><span>&quot;</span><span style="color:#a3be8c;">Javaç–¯ç‹‚è®²ä¹‰</span><span>&quot;</span><span style="color:#eff1f5;">,</span><span>&quot;</span><span style="color:#a3be8c;">æåˆš</span><span>&quot;</span><span style="color:#eff1f5;">,</span><span style="color:#d08770;">80.7</span><span style="color:#eff1f5;">));
</span><span style="color:#eff1f5;">
</span><span style="color:#eff1f5;">        </span><span style="color:#65737e;">/*ä½¿ç”¨å¢å¼ºforè¿›è¡Œé›†åˆçš„éå†*/
</span><span style="color:#eff1f5;">        </span><span style="color:#b48ead;">for</span><span style="color:#eff1f5;">(</span><span style="color:#ebcb8b;">Object</span><span style="color:#eff1f5;"> book</span><span>:</span><span style="color:#eff1f5;">col){
</span><span style="color:#eff1f5;">            </span><span style="color:#ebcb8b;">System</span><span style="color:#eff1f5;">.out.</span><span style="color:#bf616a;">println</span><span style="color:#eff1f5;">(</span><span>&quot;</span><span style="color:#a3be8c;">book=</span><span>&quot;+</span><span style="color:#eff1f5;">book);
</span><span style="color:#eff1f5;">        }
</span><span style="color:#eff1f5;">    }
</span><span style="color:#eff1f5;">}
</span></code></pre>
<h4 id="list"><code>List</code>æ¥å£</h4>
<p><strong>å¸¸ç”¨å®ç°åŠå…¶æ–¹æ³•ä¸€è§ˆ</strong></p>
<p><img src="https://images.waer.ltd/img/Lists.png" alt="" loading="lazy" decoding="async" /></p>
<blockquote>
<p><code>List</code>æ¥å£æ˜¯<code>Collection</code>çš„å­æ¥å£ï¼Œä¸Šé¢è®²è§£çš„<code>ArrayList</code>çš„æ–¹æ³•æ˜¯æ¥è‡ª<code>Collection</code>æ¥å£æ–¹æ³•ã€‚è€Œè¿™äº›æ–¹åœ¨<code>Set</code>å­æ¥å£ä¸­ä¹Ÿå¯ä»¥ä½¿ç”¨ã€‚ä¸‹é¢è®²ä¸€ä¸‹å­æ¥å£<code>List</code>ä¸­çš„å®ç°ç±»ï¼Œä¹Ÿæ˜¯ä»¥<code>ArrayList</code>å®ç°ä¸ºä¾‹ã€‚</p>
</blockquote>
<blockquote>
<ul>
<li><code>List</code>é›†åˆç±»ä¸­çš„å…ƒç´ æ˜¯æœ‰åº(æ·»åŠ å’Œå–å‡ºé¡ºåºä¸€è‡´)çš„ï¼Œä¸”æ˜¯å¯é‡å¤çš„ã€‚</li>
<li><code>List</code>é›†åˆä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ éƒ½æœ‰å…¶å¯¹åº”çš„é¡ºåºç´¢å¼•ï¼Œå³ä»–æ˜¯æ”¯æŒ<strong>ç´¢å¼•</strong>çš„ä¸€ç±»é›†åˆã€‚</li>
<li><code>List</code>ä¸­çš„å…ƒç´ éƒ½å¯¹åº”ä¸€ä¸ªæ•´æ•°å‹çš„åºå·è®°è½½å…¶åœ¨å®¹å™¨ä¸­çš„ä½ç½®ï¼Œå¯ä»¥æ ¹æ®åºå·å­˜å–å®¹å™¨ä¸­çš„å…ƒç´ ã€‚</li>
<li><code>List</code>å­æ¥å£çš„ä¸»è¦å¸¸ç”¨å®ç°ç±»æœ‰<code>ArrayList</code>ã€<code>LinkedList</code>ã€<code>Vector</code>ã€‚</li>
</ul>
</blockquote>
<p><strong>Listçš„ä¸€äº›æ–¹æ³•</strong></p>
<pre data-lang="java" style="background-color:#2b303b;color:#c0c5ce;" class="language-java "><code class="language-java" data-lang="java"><span style="color:#b48ead;">package </span><span>List;
</span><span>
</span><span style="color:#b48ead;">import </span><span>java.util.</span><span style="color:#ebcb8b;">ArrayList</span><span>;
</span><span style="color:#b48ead;">import </span><span>java.util.</span><span style="color:#ebcb8b;">List</span><span>;
</span><span>
</span><span style="color:#65737e;">/**
</span><span style="color:#65737e;"> * </span><span style="color:#b48ead;">@author</span><span style="color:#65737e;">: å…«å°ºå¦–å‰‘
</span><span style="color:#65737e;"> * @date: 2022/3/20 16:57
</span><span style="color:#65737e;"> * @description: Listçš„æ–¹æ³•æ¼”ç¤º
</span><span style="color:#65737e;"> * @blog:www.waer.ltd
</span><span style="color:#65737e;"> */
</span><span style="color:#b48ead;">public class </span><span style="color:#ebcb8b;">ListMethod </span><span style="color:#eff1f5;">{
</span><span style="color:#eff1f5;">    @</span><span style="color:#bf616a;">SuppressWarnings</span><span style="color:#eff1f5;">({</span><span>&quot;</span><span style="color:#a3be8c;">all</span><span>&quot;</span><span style="color:#eff1f5;">})
</span><span style="color:#eff1f5;">    </span><span style="color:#b48ead;">public static void </span><span style="color:#8fa1b3;">main</span><span style="color:#eff1f5;">(</span><span style="color:#ebcb8b;">String</span><span style="color:#b48ead;">[] </span><span style="color:#bf616a;">args</span><span style="color:#eff1f5;">) {
</span><span style="color:#eff1f5;">        </span><span style="color:#ebcb8b;">List</span><span style="color:#eff1f5;"> list </span><span>=</span><span style="color:#b48ead;">new </span><span style="color:#ebcb8b;">ArrayList</span><span style="color:#eff1f5;">();
</span><span style="color:#eff1f5;">        list.</span><span style="color:#bf616a;">add</span><span style="color:#eff1f5;">(</span><span>&quot;</span><span style="color:#a3be8c;">å¼ æ— å¿Œ</span><span>&quot;</span><span style="color:#eff1f5;">);
</span><span style="color:#eff1f5;">        list.</span><span style="color:#bf616a;">add</span><span style="color:#eff1f5;">(</span><span>&quot;</span><span style="color:#a3be8c;">å¼ å¤©å¿—</span><span>&quot;</span><span style="color:#eff1f5;">);
</span><span style="color:#eff1f5;">        </span><span style="color:#65737e;">/*åœ¨indexä½ç½®æ’å…¥å…ƒç´ e*/
</span><span style="color:#eff1f5;">        </span><span style="color:#65737e;">/*æ³¨æ„ï¼šè¿™é‡Œå¦‚æœä¸æŒ‡å®šä¸‹æ ‡çš„è¯ï¼Œé»˜è®¤æ˜¯ä»¥å°¾éƒ¨è¿½åŠ çš„æ–¹å¼è¿›è¡Œå…ƒç´ æ’å…¥çš„*/
</span><span style="color:#eff1f5;">        list.</span><span style="color:#bf616a;">add</span><span style="color:#eff1f5;">(</span><span style="color:#d08770;">1</span><span style="color:#eff1f5;">,</span><span>&quot;</span><span style="color:#a3be8c;">Tisox</span><span>&quot;</span><span style="color:#eff1f5;">);
</span><span style="color:#eff1f5;">        </span><span style="color:#65737e;">//list=[å¼ æ— å¿Œ, Tisox, å¼ å¤©å¿—]
</span><span style="color:#eff1f5;">        </span><span style="color:#ebcb8b;">System</span><span style="color:#eff1f5;">.out.</span><span style="color:#bf616a;">println</span><span style="color:#eff1f5;">(</span><span>&quot;</span><span style="color:#a3be8c;">list=</span><span>&quot;+</span><span style="color:#eff1f5;">list);
</span><span style="color:#eff1f5;">
</span><span style="color:#eff1f5;">        </span><span style="color:#65737e;">/*addAll(inr index,Collection e)ï¼šä»indexä½ç½®å¼€å§‹å°†å…ƒç´ eä¸­çš„æ‰€æœ‰å…ƒç´ æ·»åŠ è¿›æ¥*/
</span><span style="color:#eff1f5;">        </span><span style="color:#ebcb8b;">List</span><span style="color:#eff1f5;"> list2 </span><span>=</span><span style="color:#b48ead;">new </span><span style="color:#ebcb8b;">ArrayList</span><span style="color:#eff1f5;">();
</span><span style="color:#eff1f5;">        list2.</span><span style="color:#bf616a;">add</span><span style="color:#eff1f5;">(</span><span>&quot;</span><span style="color:#a3be8c;">èœ˜è››ä¾ </span><span>&quot;</span><span style="color:#eff1f5;">);
</span><span style="color:#eff1f5;">        list2.</span><span style="color:#bf616a;">add</span><span style="color:#eff1f5;">(</span><span>&quot;</span><span style="color:#a3be8c;">é’¢é“ä¾ </span><span>&quot;</span><span style="color:#eff1f5;">);
</span><span style="color:#eff1f5;">        list.</span><span style="color:#bf616a;">addAll</span><span style="color:#eff1f5;">(</span><span style="color:#d08770;">1</span><span style="color:#eff1f5;">,list2);
</span><span style="color:#eff1f5;">        </span><span style="color:#65737e;">//list=[å¼ æ— å¿Œ, èœ˜è››ä¾ , é’¢é“ä¾ , Tisox, å¼ å¤©å¿—]
</span><span style="color:#eff1f5;">        </span><span style="color:#ebcb8b;">System</span><span style="color:#eff1f5;">.out.</span><span style="color:#bf616a;">println</span><span style="color:#eff1f5;">(</span><span>&quot;</span><span style="color:#a3be8c;">list=</span><span>&quot;+</span><span style="color:#eff1f5;">list);
</span><span style="color:#eff1f5;">        </span><span style="color:#65737e;">/*int intdexOf(Object obj):è¿”å›objåœ¨å½“å‰é›†åˆä¸­é¦–æ¬¡å‡ºç°çš„ä½ç½®*/
</span><span style="color:#eff1f5;">        </span><span style="color:#ebcb8b;">System</span><span style="color:#eff1f5;">.out.</span><span style="color:#bf616a;">println</span><span style="color:#eff1f5;">(list.</span><span style="color:#bf616a;">indexOf</span><span style="color:#eff1f5;">(</span><span>&quot;</span><span style="color:#a3be8c;">èœ˜è››ä¾ </span><span>&quot;</span><span style="color:#eff1f5;">));
</span><span style="color:#eff1f5;">
</span><span style="color:#eff1f5;">        </span><span style="color:#65737e;">/*int lastIndexOf(Object obj):è¿”å›objåœ¨å½“å‰é›†åˆä¸­æœ€åä¸€æ¬¡å‡ºç°çš„ä½ç½®*/
</span><span style="color:#eff1f5;">        list.</span><span style="color:#bf616a;">add</span><span style="color:#eff1f5;">(</span><span>&quot;</span><span style="color:#a3be8c;">å‡‹æ®‹</span><span>&quot;</span><span style="color:#eff1f5;">);
</span><span style="color:#eff1f5;">        </span><span style="color:#ebcb8b;">System</span><span style="color:#eff1f5;">.out.</span><span style="color:#bf616a;">println</span><span style="color:#eff1f5;">(list.</span><span style="color:#bf616a;">lastIndexOf</span><span style="color:#eff1f5;">(</span><span>&quot;</span><span style="color:#a3be8c;">å‡‹æ®‹</span><span>&quot;</span><span style="color:#eff1f5;">));
</span><span style="color:#eff1f5;">
</span><span style="color:#eff1f5;">        </span><span style="color:#65737e;">/*remove(int index):ç§»é™¤æŒ‡å®šindexä½ç½®çš„å…ƒç´ ï¼Œå¹¶è¿”å›æ­¤å…ƒç´ */
</span><span style="color:#eff1f5;">        list.</span><span style="color:#bf616a;">remove</span><span style="color:#eff1f5;">(</span><span style="color:#d08770;">0</span><span style="color:#eff1f5;">);
</span><span style="color:#eff1f5;">        </span><span style="color:#ebcb8b;">System</span><span style="color:#eff1f5;">.out.</span><span style="color:#bf616a;">println</span><span style="color:#eff1f5;">(</span><span>&quot;</span><span style="color:#a3be8c;">list=</span><span>&quot;+</span><span style="color:#eff1f5;">list);
</span><span style="color:#eff1f5;">
</span><span style="color:#eff1f5;">        </span><span style="color:#65737e;">/*set(int index,Object ele):è®¾ç½®æŒ‡å®šindexä½ç½®å‡ºçš„å…ƒç´ ä¸ºeleï¼Œç›¸å½“äºæ˜¯æ›¿æ¢å…ƒç´ */
</span><span style="color:#eff1f5;">        list.</span><span style="color:#bf616a;">set</span><span style="color:#eff1f5;">(</span><span style="color:#d08770;">1</span><span style="color:#eff1f5;">,</span><span>&quot;</span><span style="color:#a3be8c;">æ–°çš„åå­—</span><span>&quot;</span><span style="color:#eff1f5;">);
</span><span style="color:#eff1f5;">        </span><span style="color:#ebcb8b;">System</span><span style="color:#eff1f5;">.out.</span><span style="color:#bf616a;">println</span><span style="color:#eff1f5;">(</span><span>&quot;</span><span style="color:#a3be8c;">list=</span><span>&quot;+</span><span style="color:#eff1f5;">list);
</span><span style="color:#eff1f5;">
</span><span style="color:#eff1f5;">        </span><span style="color:#65737e;">/*subList(int fromIndex,int toIndex):è¿”å›ä»fromIndexåˆ°toIndexä½ç½®çš„å­é›†åˆ*/
</span><span style="color:#eff1f5;">        </span><span style="color:#65737e;">//è¿”å›ä¸€ä¸ªå·¦é—­å³å¼€çš„åŒºé—´
</span><span style="color:#eff1f5;">        </span><span style="color:#ebcb8b;">List</span><span style="color:#eff1f5;"> reslist </span><span>=</span><span style="color:#eff1f5;"> list.</span><span style="color:#bf616a;">subList</span><span style="color:#eff1f5;">(</span><span style="color:#d08770;">0</span><span style="color:#eff1f5;">, </span><span style="color:#d08770;">2</span><span style="color:#eff1f5;">);
</span><span style="color:#eff1f5;">        </span><span style="color:#ebcb8b;">System</span><span style="color:#eff1f5;">.out.</span><span style="color:#bf616a;">println</span><span style="color:#eff1f5;">(</span><span>&quot;</span><span style="color:#a3be8c;">relist=</span><span>&quot;+</span><span style="color:#eff1f5;">reslist);
</span><span style="color:#eff1f5;">    }
</span><span style="color:#eff1f5;">}
</span></code></pre>
<p><strong>Listçš„ä¸‰ç§éå†æ–¹å¼</strong></p>
<blockquote>
<p>ç”±äº<code>ArrayList</code>ã€<code>LinkedList</code>å’Œ<code>Vector</code>éƒ½æ˜¯<code>List</code>çš„å®ç°å­ç±»ï¼Œä»¥ä¸‹æ–¹æ³•å¯ä»¥<strong>æ— ç¼åˆ‡æ¢</strong>ï¼Œæ•ˆæœæ˜¯ä¸€æ ·çš„ã€‚</p>
</blockquote>
<pre data-lang="java" style="background-color:#2b303b;color:#c0c5ce;" class="language-java "><code class="language-java" data-lang="java"><span style="color:#b48ead;">package </span><span>List;
</span><span>
</span><span style="color:#b48ead;">import </span><span>java.util.*;
</span><span>
</span><span style="color:#65737e;">/**
</span><span style="color:#65737e;"> * </span><span style="color:#b48ead;">@author</span><span style="color:#65737e;">: Tisox
</span><span style="color:#65737e;"> * @date: 2022/3/20 19:18
</span><span style="color:#65737e;"> * @description: Listçš„ä¸‰ç§éå†æ–¹å¼
</span><span style="color:#65737e;"> * @blog:www.waer.ltd
</span><span style="color:#65737e;"> */
</span><span style="color:#b48ead;">public class </span><span style="color:#ebcb8b;">ListFor </span><span style="color:#eff1f5;">{
</span><span style="color:#eff1f5;">    @</span><span style="color:#bf616a;">SuppressWarnings</span><span style="color:#eff1f5;">({</span><span>&quot;</span><span style="color:#a3be8c;">all</span><span>&quot;</span><span style="color:#eff1f5;">})
</span><span style="color:#eff1f5;">    </span><span style="color:#b48ead;">public static void </span><span style="color:#8fa1b3;">main</span><span style="color:#eff1f5;">(</span><span style="color:#ebcb8b;">String</span><span style="color:#b48ead;">[] </span><span style="color:#bf616a;">args</span><span style="color:#eff1f5;">) {
</span><span style="color:#eff1f5;">        </span><span style="color:#65737e;">//List list =new Vector();
</span><span style="color:#eff1f5;">        </span><span style="color:#ebcb8b;">List</span><span style="color:#eff1f5;"> list </span><span>= </span><span style="color:#b48ead;">new </span><span style="color:#ebcb8b;">LinkedList</span><span style="color:#eff1f5;">();
</span><span style="color:#eff1f5;">        </span><span style="color:#65737e;">//List list = new ArrayList();
</span><span style="color:#eff1f5;">        list.</span><span style="color:#bf616a;">add</span><span style="color:#eff1f5;">(</span><span>&quot;</span><span style="color:#a3be8c;">jack</span><span>&quot;</span><span style="color:#eff1f5;">);
</span><span style="color:#eff1f5;">        list.</span><span style="color:#bf616a;">add</span><span style="color:#eff1f5;">(</span><span>&quot;</span><span style="color:#a3be8c;">tom</span><span>&quot;</span><span style="color:#eff1f5;">);
</span><span style="color:#eff1f5;">        list.</span><span style="color:#bf616a;">add</span><span style="color:#eff1f5;">(</span><span>&quot;</span><span style="color:#a3be8c;">å›é”…è‚‰</span><span>&quot;</span><span style="color:#eff1f5;">);
</span><span style="color:#eff1f5;">        list.</span><span style="color:#bf616a;">add</span><span style="color:#eff1f5;">(</span><span>&quot;</span><span style="color:#a3be8c;">é±¼é¦™è‚‰ä¸</span><span>&quot;</span><span style="color:#eff1f5;">);
</span><span style="color:#eff1f5;">        list.</span><span style="color:#bf616a;">add</span><span style="color:#eff1f5;">(</span><span>&quot;</span><span style="color:#a3be8c;">ç ‚é”…ç²‰</span><span>&quot;</span><span style="color:#eff1f5;">);
</span><span style="color:#eff1f5;">
</span><span style="color:#eff1f5;">        </span><span style="color:#65737e;">/*1.è¿­ä»£å™¨éå†*/
</span><span style="color:#eff1f5;">        </span><span style="color:#ebcb8b;">Iterator</span><span style="color:#eff1f5;"> iterator </span><span>=</span><span style="color:#eff1f5;"> list.</span><span style="color:#bf616a;">iterator</span><span style="color:#eff1f5;">();
</span><span style="color:#eff1f5;">        </span><span style="color:#b48ead;">while </span><span style="color:#eff1f5;">(iterator.</span><span style="color:#bf616a;">hasNext</span><span style="color:#eff1f5;">()) {
</span><span style="color:#eff1f5;">            </span><span style="color:#ebcb8b;">Object</span><span style="color:#eff1f5;"> next </span><span>=</span><span style="color:#eff1f5;"> iterator.</span><span style="color:#bf616a;">next</span><span style="color:#eff1f5;">();
</span><span style="color:#eff1f5;">            </span><span style="color:#ebcb8b;">System</span><span style="color:#eff1f5;">.out.</span><span style="color:#bf616a;">println</span><span style="color:#eff1f5;">(</span><span>&quot;</span><span style="color:#a3be8c;">[list]çš„[è¿­ä»£å™¨iterator]éå†=</span><span>&quot;+</span><span style="color:#eff1f5;">list);
</span><span style="color:#eff1f5;">        }
</span><span style="color:#eff1f5;">        </span><span style="color:#ebcb8b;">System</span><span style="color:#eff1f5;">.out.</span><span style="color:#bf616a;">println</span><span style="color:#eff1f5;">(</span><span>&quot;</span><span style="color:#a3be8c;">====================================</span><span>&quot;</span><span style="color:#eff1f5;">);
</span><span style="color:#eff1f5;">        </span><span style="color:#65737e;">/*2.å¢å¼ºforéå†*/
</span><span style="color:#eff1f5;">        </span><span style="color:#b48ead;">for </span><span style="color:#eff1f5;">(</span><span style="color:#ebcb8b;">Object</span><span style="color:#eff1f5;"> o </span><span>:</span><span style="color:#eff1f5;"> list) {
</span><span style="color:#eff1f5;">            </span><span style="color:#ebcb8b;">System</span><span style="color:#eff1f5;">.out.</span><span style="color:#bf616a;">println</span><span style="color:#eff1f5;">(</span><span>&quot;</span><span style="color:#a3be8c;">[list]çš„[å¢å¼ºfor]éå†=</span><span>&quot;+</span><span style="color:#eff1f5;">list);
</span><span style="color:#eff1f5;">        }
</span><span style="color:#eff1f5;">        </span><span style="color:#ebcb8b;">System</span><span style="color:#eff1f5;">.out.</span><span style="color:#bf616a;">println</span><span style="color:#eff1f5;">(</span><span>&quot;</span><span style="color:#a3be8c;">====================================</span><span>&quot;</span><span style="color:#eff1f5;">);
</span><span style="color:#eff1f5;">        </span><span style="color:#65737e;">/*3.æ™®é€šforå¾ªç¯éå†*/
</span><span style="color:#eff1f5;">        </span><span style="color:#b48ead;">for</span><span style="color:#eff1f5;">(</span><span style="color:#b48ead;">int</span><span style="color:#eff1f5;"> i</span><span>=</span><span style="color:#d08770;">0</span><span style="color:#eff1f5;">;i</span><span>&lt;</span><span style="color:#eff1f5;">list.</span><span style="color:#bf616a;">size</span><span style="color:#eff1f5;">();i</span><span>++</span><span style="color:#eff1f5;">){
</span><span style="color:#eff1f5;">            </span><span style="color:#ebcb8b;">System</span><span style="color:#eff1f5;">.out.</span><span style="color:#bf616a;">println</span><span style="color:#eff1f5;">(</span><span>&quot;</span><span style="color:#a3be8c;">[list]çš„[æ™®é€šforå¾ªç¯]éå†=</span><span>&quot;+</span><span style="color:#eff1f5;">list.</span><span style="color:#bf616a;">get</span><span style="color:#eff1f5;">(i));
</span><span style="color:#eff1f5;">        }
</span><span style="color:#eff1f5;">    }
</span><span style="color:#eff1f5;">}
</span></code></pre>
<h4 id="arraylist"><code>ArrayList</code></h4>
<ul>
<li><code>ArrayList</code><strong>å…è®¸å­˜å…¥<code>null</code>å€¼ã€‚</strong></li>
</ul>
<pre data-lang="java" style="background-color:#2b303b;color:#c0c5ce;" class="language-java "><code class="language-java" data-lang="java"><span style="color:#ebcb8b;">ArrayList</span><span> arrayList = </span><span style="color:#b48ead;">new </span><span style="color:#ebcb8b;">ArrayList</span><span>();
</span><span>arrayList.</span><span style="color:#bf616a;">add</span><span>(</span><span style="color:#d08770;">null</span><span>);
</span><span>arrayList.</span><span style="color:#bf616a;">add</span><span>(&quot;&quot;);
</span><span>arrayList.</span><span style="color:#bf616a;">add</span><span>(&quot;</span><span style="color:#a3be8c;">Java</span><span>&quot;);
</span><span style="color:#ebcb8b;">System</span><span>.out.</span><span style="color:#bf616a;">println</span><span>(arrayList);
</span></code></pre>
<ul>
<li>
<p>åº•å±‚é‡‡ç”¨æ•°ç»„å®ç°ã€‚</p>
</li>
<li>
<p><code>ArrayList</code>çº¿ç¨‹ä¸å®‰å…¨</p>
</li>
</ul>
<p><img src="https://images.waer.ltd/img/20220320204436.png" alt="" loading="lazy" decoding="async" /></p>
<blockquote>
<p>é€šè¿‡å®ƒçš„æºç å¯ä»¥çœ‹åˆ°ï¼Œä»–æ˜¯æ²¡æœ‰<code>synchronized</code>å…³é”®å­—ä¿®é¥°çš„ã€‚ä¹Ÿæ­£æ˜¯å› ä¸ºå¦‚æ­¤ï¼Œå®ƒçš„æ•ˆç‡æ˜¯æ¯”è¾ƒé«˜çš„ï¼Œæ‰€ä»¥å¦‚æœéœ€è¦ä¿è¯çº¿ç¨‹å®‰å…¨çš„åœºæ™¯ä¸‹ï¼Œä¸å»ºè®®ä½¿ç”¨<code>ArrayList</code>ã€‚</p>
</blockquote>
<h5 id="-2">æºç åˆ†æ</h5>
<p>**<code>ArrayList</code>ä¸­ç»´æŠ¤äº†ä¸€ä¸ª<code>Object</code>ç±»å‹çš„æ•°ç»„<code>elementData[]</code>ã€‚**æºç å¦‚ä¸‹:</p>
<pre data-lang="java" style="background-color:#2b303b;color:#c0c5ce;" class="language-java "><code class="language-java" data-lang="java"><span style="color:#b48ead;">transient </span><span style="color:#ebcb8b;">Object</span><span style="color:#b48ead;">[]</span><span> elementData;
</span></code></pre>
<p>è¿™é‡Œçš„<code>elementData[]</code>æ•°ç»„çš„ç±»å‹æ˜¯<code>Object</code>ç±»å‹ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒå¯ä»¥å­˜æ”¾ä»»æ„ç±»å‹çš„æ•°æ®ï¼Œå› ä¸º<code>Object</code>ç±»æ˜¯<strong>æ‰€æœ‰ç±»çš„çˆ¶ç±»</strong>ï¼Œä¹Ÿå°±æ˜¯é¡¶çº§çˆ¶ç±»ã€‚ å…³é”®å­—<code>transient</code>çš„ä½œç”¨æ˜¯å»é™¤åºåˆ—åŒ–ï¼Œå½“æŸä¸ªå±æ€§è¢«åŠ ä¸Šè¯¥å…³é”®å­—å³è¡¨ç¤ºå®ƒåœ¨è¿›è¡Œåºåˆ—åŒ–æ—¶ä¼šè¢«å¿½ç•¥ï¼Œä¸å‚ä¸åºåˆ—åŒ–æ“ä½œã€‚</p>
<h5 id="-3">åº•å±‚æ‰©å®¹åŸç†</h5>
<blockquote>
<p><code>ArrayList</code>åº•å±‚é‡‡ç”¨æ•°ç»„è¿™ç§æ•°æ®ç»“æ„æ¥å®ç°ï¼Œå¿…ç„¶ä¼šæœ‰å®¹é‡çš„é™åˆ¶ï¼Œé‚£ä¹ˆåœ¨å®ƒçš„åº•å±‚æ˜¯å¦‚ä½•å®ç°è‡ªåŠ¨æ‰©å®¹çš„å‘¢ï¼Ÿè¿™é‡Œä»¥å…¶ä¸­çš„<code>add()</code>æ–¹æ³•è¿›è¡Œæµ…æã€‚</p>
</blockquote>
<p><code>ArrayList</code>æœ‰ä¸¤ä¸ªæ„é€ æ–¹æ³•ï¼Œåˆ†åˆ«æ˜¯<strong>æ— å‚æ•°æ„é€ å’Œæœ‰å‚æ„é€ </strong>ã€‚ä¸‹é¢æ˜¯æºç </p>
<pre data-lang="java" style="background-color:#2b303b;color:#c0c5ce;" class="language-java "><code class="language-java" data-lang="java"><span style="color:#65737e;">//æ— å‚æ„é€ 
</span><span style="color:#b48ead;">public </span><span style="color:#bf616a;">ArrayList</span><span>() {
</span><span>    </span><span style="color:#bf616a;">this</span><span>.elementData = </span><span style="color:#d08770;">DEFAULTCAPACITY_EMPTY_ELEMENTDATA</span><span>;
</span><span>}
</span><span style="color:#65737e;">//æœ‰å‚æ„é€ 
</span><span style="color:#b48ead;">public </span><span style="color:#bf616a;">ArrayList</span><span>(</span><span style="color:#b48ead;">int</span><span> initialCapacity) {
</span><span>    </span><span style="color:#b48ead;">if </span><span>(initialCapacity &gt; </span><span style="color:#d08770;">0</span><span>) {
</span><span>        </span><span style="color:#bf616a;">this</span><span>.elementData = </span><span style="color:#b48ead;">new </span><span style="color:#ebcb8b;">Object</span><span>[initialCapacity];
</span><span>    } </span><span style="color:#b48ead;">else if </span><span>(initialCapacity == </span><span style="color:#d08770;">0</span><span>) {
</span><span>        </span><span style="color:#bf616a;">this</span><span>.elementData = </span><span style="color:#d08770;">EMPTY_ELEMENTDATA</span><span>;
</span><span>    } </span><span style="color:#b48ead;">else </span><span>{
</span><span>        </span><span style="color:#b48ead;">throw new </span><span style="color:#ebcb8b;">IllegalArgumentException</span><span>(&quot;</span><span style="color:#a3be8c;">Illegal Capacity: </span><span>&quot;+
</span><span>                                           initialCapacity);
</span><span>    }
</span><span>}
</span></code></pre>
<p>ä¸¤ä¸ªæ„é€ æ–¹æ³•ä¸ä»…åœ¨å‚æ•°ä¸Šæœ‰æ‰€åŒºåˆ«ï¼Œä»–ä»¬çš„åº•å±‚æ‰©å®¹åŸç†ä¹Ÿæ˜¯ä¸ä¸€æ ·çš„ï¼Œå…ˆçœ‹ä¸€ä¸‹æ— å‚æ•°çš„<code> ArrayList()</code>æ„é€ ã€‚</p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨<strong>æ— å‚æ„é€ çš„æ–¹æ³•</strong>ä¸­ï¼Œå®ƒå°†æ•°ç»„çš„åˆå§‹å®¹é‡è®¾ä¸º<code>DEFAULTCAPACITY_EMPTY_ELEMENTDATA</code>ã€‚ä¹Ÿå°±æ˜¯ä¸€ä¸ªç©ºå¯¹è±¡æ•°ç»„ã€‚è¿™ä¸€ç‚¹å¯ä»¥ä»ä¸‹é¢çš„æºç å¾—çŸ¥ã€‚</p>
<p><img src="https://images.waer.ltd/img/20220321195749.png" alt="" loading="lazy" decoding="async" /></p>
<p>ä¸‹é¢å°è¯•åœ¨é›†åˆä¸­æ·»åŠ å…ƒç´ ï¼Œæ¥åˆ†æaddæ–¹æ³•çš„æ‰§è¡Œè¿‡ç¨‹ã€‚</p>
<pre data-lang="java" style="background-color:#2b303b;color:#c0c5ce;" class="language-java "><code class="language-java" data-lang="java"><span style="color:#65737e;">//ä½¿ç”¨æ— å‚æ„é€ å¯¹é›†åˆè¿›è¡Œåˆå§‹åŒ–
</span><span style="color:#ebcb8b;">ArrayList</span><span> list = </span><span style="color:#b48ead;">new </span><span style="color:#ebcb8b;">ArrayList</span><span>();
</span><span style="color:#65737e;">//å‘å…¶ä¸­æ·»åŠ 10ä¸ªå…ƒç´ 
</span><span style="color:#b48ead;">for </span><span>(</span><span style="color:#b48ead;">int</span><span> i = </span><span style="color:#d08770;">1</span><span>; i &lt;= </span><span style="color:#d08770;">10</span><span>; i++) {
</span><span>    list.</span><span style="color:#bf616a;">add</span><span>(i);
</span><span>}
</span></code></pre>
<p><strong>æ‰§è¡Œè¿‡ç¨‹å’Œæ‰©å®¹åŸç†</strong></p>
<ul>
<li>åœ¨åˆå§‹åŒ–å®Œæˆåï¼Œå½“æˆ‘ä»¬è§¦å‘add()æ—¶ï¼Œå®ƒä¼šå…ˆè°ƒç”¨<code>valueOf()</code>æ–¹æ³•å¯¹æ·»åŠ çš„å…ƒç´ è¿›è¡Œä¸€ä¸ª<strong>è£…ç®±</strong>æ“ä½œï¼Œè¿™ä¸æ˜¯æœ¬æ¬¡åˆ†æçš„é‡ç‚¹ï¼Œä¸å†èµ˜è¿°ã€‚æ³¨æ„ä¸‹é¢è¿™ä¸ªè‡ªåŠ¨è£…ç®±çš„æºç æ¥è‡ª<strong>JDK11</strong></li>
</ul>
<p><img src="https://images.waer.ltd/img/20220321200829.png" alt="" loading="lazy" decoding="async" /></p>
<ul>
<li>
<p>è£…ç®±ç»“æŸåï¼Œè¿›å…¥<code>add(E e)</code>è¿™ä¸ªæ–¹æ³•ï¼Œè¯¥æ–¹æ³•æ˜¯é›†åˆä¸­çš„ä¸€ä¸ª<strong>é‡è½½æ–¹æ³•ï¼Œæ¥æ”¶ä¸€ä¸ªæ³›å‹å‚æ•°</strong>ï¼Œæºç å¦‚ä¸‹:</p>
<pre data-lang="java" style="background-color:#2b303b;color:#c0c5ce;" class="language-java "><code class="language-java" data-lang="java"><span style="color:#b48ead;">public boolean </span><span style="color:#bf616a;">add</span><span>(</span><span style="color:#ebcb8b;">E</span><span> e) {
</span><span>    </span><span style="color:#bf616a;">ensureCapacityInternal</span><span>(size + </span><span style="color:#d08770;">1</span><span>);  </span><span style="color:#65737e;">// Increments modCount!!
</span><span>    elementData[size++] = e;
</span><span>    </span><span style="color:#b48ead;">return </span><span style="color:#d08770;">true</span><span>;
</span><span>}
</span></code></pre>
</li>
</ul>
<p>é¦–å…ˆï¼Œåœ¨æ‰§è¡Œæ­£å¼çš„æ·»åŠ æ“ä½œä¹‹å‰ï¼Œä¼šå…ˆæ‰§è¡Œ<code>ensureCapacityInternal()</code>æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¸»è¦æ˜¯ç”¨æ¥<strong>ç¡®è®¤é›†åˆçš„å®¹é‡æƒ…å†µ</strong>ï¼Œå†³å®šæ˜¯å¦éœ€è¦æ‰©å®¹ã€‚å†è°ƒç”¨æ·»åŠ æ–¹æ³•è¿›è¡Œå…ƒç´ çš„æ·»åŠ ã€‚æ˜¾ç„¶ï¼Œè¿™é‡Œå‡ºç°çš„<code>ensureCapacityInternal()</code>æ–¹æ³•æ˜¯é‡ç‚¹ï¼Œæºç å¦‚ä¸‹ï¼š</p>
<pre data-lang="java" style="background-color:#2b303b;color:#c0c5ce;" class="language-java "><code class="language-java" data-lang="java"><span style="color:#b48ead;">private</span><span> void </span><span style="color:#bf616a;">ensureCapacityInternal</span><span>(</span><span style="color:#b48ead;">int</span><span> minCapacity) {
</span><span>    </span><span style="color:#b48ead;">if </span><span>(elementData == </span><span style="color:#d08770;">DEFAULTCAPACITY_EMPTY_ELEMENTDATA</span><span>) {
</span><span>        minCapacity = </span><span style="color:#ebcb8b;">Math</span><span>.</span><span style="color:#bf616a;">max</span><span>(</span><span style="color:#d08770;">DEFAULT_CAPACITY</span><span>, minCapacity);
</span><span>    }
</span><span>    </span><span style="color:#bf616a;">ensureExplicitCapacity</span><span>(minCapacity);
</span><span>}
</span></code></pre>
<p>æ–¹æ³•ä¼ å…¥ä¸€ä¸ªåä¸º<code>minCapacity</code>çš„<code>int</code>ç±»å‹å˜é‡ï¼Œè¡¨ç¤ºæ•°ç»„æœ€å°å®¹é‡ã€‚æ¥ç€åˆ¤æ–­<code>elementData</code>æ˜¯å¦æ˜¯<code>DEFAULTCAPACITY_EMPTY_ELEMENTDATA</code>é»˜è®¤å€¼ï¼Œç”±äºæˆ‘ä»¬é€‰æ‹©çš„æ˜¯æ— å‚æ„é€ ï¼Œæ‰€ä»¥<code>if</code>è¯­å¥ä¸­çš„æ¡ä»¶æ˜¯æˆç«‹çš„ã€‚æ¥ä¸‹æ¥<code>Math.max(DEFAULT_CAPACITY, minCapacity)</code>åœ¨<strong>é»˜è®¤å®¹é‡</strong>å’Œ<strong>æœ€å°å®¹é‡</strong>ä¹‹é—´å–ä¸€ä¸ªæœ€å¤§å€¼å¹¶èµ‹ç»™<code>minCapacity</code>ï¼Œä¹Ÿå°±æ˜¯æ›´æ–°<code>minCapacity</code>çš„å€¼ã€‚å…³äºé»˜è®¤å®¹é‡<code>DEFAULT_CAPACITY</code>ï¼Œä¸‹é¢æ˜¯å®ƒçš„å£°æ˜ï¼š</p>
<pre data-lang="java" style="background-color:#2b303b;color:#c0c5ce;" class="language-java "><code class="language-java" data-lang="java"><span style="color:#b48ead;">private static final int </span><span style="color:#d08770;">DEFAULT_CAPACITY </span><span>= </span><span style="color:#d08770;">10</span><span>;
</span></code></pre>
<p>æ‰§è¡Œä¹‹åï¼Œ<code>minCapacity</code>çš„å€¼å°†æ›´æ–°ä¸º10;ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™ä¸ªæ–¹æ³•ç›®çš„æ˜¯ä¸ºäº†ç¡®è®¤<code>minCapacity</code>çš„å€¼ï¼Œè€Œåœ¨<code>if</code>ä¹‹åï¼Œåˆå‡ºç°äº†ä¸€ä¸ª<code>ensureExplicitCapacity(minCapacity)</code>æ–¹æ³•ï¼Œåœ¨<code>if</code>åˆ¤æ–­æ¡ä»¶ä¸æ»¡è¶³çš„æƒ…å†µä¸‹æ‰§è¡Œï¼Œå‚æ•°å°±æ˜¯ä¸Šé¢æ›´æ–°åçš„<code>minCapacity</code>ï¼Œå¯ä»¥çŒœæµ‹ï¼Œè¿™ä¸ªæ–¹æ³•åº”è¯¥ä¹Ÿæ˜¯å¯¹æ˜¯å¦éœ€è¦æ‰©å®¹è¿›è¡Œä¸€ä¸ªåˆ¤æ–­çš„ç®—æ³•ã€‚</p>
<pre data-lang="java" style="background-color:#2b303b;color:#c0c5ce;" class="language-java "><code class="language-java" data-lang="java"><span style="color:#b48ead;">private</span><span> void </span><span style="color:#bf616a;">ensureExplicitCapacity</span><span>(</span><span style="color:#b48ead;">int</span><span> minCapacity) {
</span><span>    modCount++;
</span><span>    </span><span style="color:#65737e;">// overflow-conscious code
</span><span>    </span><span style="color:#b48ead;">if </span><span>(minCapacity - elementData.length &gt; </span><span style="color:#d08770;">0</span><span>)
</span><span>        </span><span style="color:#bf616a;">grow</span><span>(minCapacity);
</span><span>}
</span></code></pre>
<p>æ³¨æ„,è¿™é‡Œæœ‰ä¸€æ¡ä¸º<code>modCount++;</code>çš„è¯­å¥ï¼Œä»–ä¸»è¦æ˜¯è®°å½•å½“å‰é›†åˆè¢«ä¿®æ”¹çš„æ¬¡æ•°ï¼Œä¸ºäº†é˜²æ­¢è¢«å¤šä¸ªçº¿ç¨‹æ“ä½œï¼Œå¦åˆ™ä¼šæŠ›å¼‚å¸¸ã€‚ç¬¬4è¡Œä¸­ifçš„æ¡ä»¶<code>minCapacity - elementData.length &gt; 0</code>è¡¨ç¤ºæœ€å°å®¹é‡ä¸å½“å‰æ•°ç»„å…ƒç´ å®¹é‡çš„ä¸€ä¸ª<strong>å·®å€¼å¤§äº0æ˜¯å¦æˆç«‹</strong>ï¼Œå°†ä¼šç›´æ¥è°ƒç”¨ä¸‹ä¸€ä¸ªæ–¹æ³•è¿›è¡Œæ‰©å®¹ï¼Œä¹Ÿå°±æ˜¯<code>grow()</code>æ–¹æ³•ã€‚</p>
<blockquote>
<p>æ¯”æ–¹è¯´ï¼Œæ­¤æ—¶çš„<code>minCapacity=10</code>ï¼Œ<code>elementData=0</code>,æ˜¾ç„¶<code>10-0&gt;0</code>,ä¹Ÿå³æ˜¯è¯´ï¼Œæ•°ç»„éœ€è¦ä¸€ä¸ªæœ€å°å®¹é‡ä¸º10ç©ºé—´ï¼Œè€Œæ­¤æ—¶çš„å®¹é‡ä¸º0ï¼Œæ˜¾ç„¶éœ€è¦è¿›è¡Œæ‰©å®¹æ“ä½œã€‚</p>
</blockquote>
<p>ä¸‹é¢æ˜¯<code>grow()</code>æ–¹æ³•ï¼Œä¹Ÿæ˜¯æ‰©å®¹çš„æ ¸å¿ƒå®ç°ã€‚</p>
<pre data-lang="java" style="background-color:#2b303b;color:#c0c5ce;" class="language-java "><code class="language-java" data-lang="java"><span style="color:#b48ead;">private</span><span> void </span><span style="color:#bf616a;">grow</span><span>(</span><span style="color:#b48ead;">int</span><span> minCapacity) {
</span><span>    </span><span style="color:#65737e;">// overflow-conscious code
</span><span>    </span><span style="color:#b48ead;">int</span><span> oldCapacity = elementData.length;
</span><span>    </span><span style="color:#b48ead;">int</span><span> newCapacity = oldCapacity + (oldCapacity &gt;&gt; </span><span style="color:#d08770;">1</span><span>);
</span><span>    </span><span style="color:#b48ead;">if </span><span>(newCapacity - minCapacity &lt; </span><span style="color:#d08770;">0</span><span>)
</span><span>        newCapacity = minCapacity;
</span><span>    </span><span style="color:#b48ead;">if </span><span>(newCapacity - </span><span style="color:#d08770;">MAX_ARRAY_SIZE </span><span>&gt; </span><span style="color:#d08770;">0</span><span>)
</span><span>        newCapacity = </span><span style="color:#bf616a;">hugeCapacity</span><span>(minCapacity);
</span><span>    </span><span style="color:#65737e;">// minCapacity is usually close to size, so this is a win:
</span><span>    elementData = </span><span style="color:#ebcb8b;">Arrays</span><span>.</span><span style="color:#bf616a;">copyOf</span><span>(elementData, newCapacity);
</span><span>}
</span></code></pre>
<p>å¯ä»¥çœ‹åˆ°ï¼Œæ–¹æ³•å¼€å§‹ä¼šå…ˆå°†æ•°ç»„å®¹é‡<code>elementData.length</code>èµ‹å€¼ç»™ä¸€ä¸ªä¸­é—´å˜é‡<code>oldCapacity</code>ã€‚æ¥ç€ä¸ºå˜é‡<code>newCapacity</code>è¿›è¡Œèµ‹å€¼ï¼Œç®—æ³•æ˜¯å°†<code>oldCapacity</code>æ—§<strong>çš„å®¹é‡+æ—§å®¹é‡çš„äºŒåˆ†ä¹‹ä¸€</strong>èµ‹å€¼ç»™è¯¥å˜é‡ã€‚æ³¨æ„è¿™é‡Œ<code>(oldCapacity &gt;&gt; 1)</code>è¡¨å°†<code>oldCapacity</code>å³ç§»ä¸€ä½ï¼Œ<strong>ç­‰åŒäºé™¤ä»¥2</strong>ï¼Œç”¨ä½è¿ç®—å¯ä»¥æé«˜æ‰§è¡Œæ•ˆç‡ã€‚åè¿‡æ¥ï¼Œå¦‚æœæ˜¯å·¦ç§»çš„è¯ï¼Œä»£è¡¨ä¹˜ä»¥<code>2</code>ã€‚</p>
<p>åˆç”±äºå‰é¢å·²ç»çŸ¥é“<code>elemenatData</code>å…¶å®æ˜¯ç­‰äº<code>0</code>çš„ï¼Œé‚£ä¹ˆç›´æ¥å¯¼è‡´è¿™æ¡èµ‹å€¼è¯­å¥ç»“æœä¸º<code>0</code>ï¼Œä¹Ÿå°±æ˜¯<code>newCapacity==0</code>ï¼Œæ‰€ä»¥å®ƒåé¢ç´§æ¥ç€å‡ºç°äº†ä¸¤ä¸ªåˆ¤æ–­ã€‚</p>
<blockquote>
<ol>
<li>å¦‚æœæ–°çš„å®¹é‡å°äºæœ€å°å®¹é‡ï¼Œé‚£ä¹ˆå°†æœ€å°å®¹é‡èµ‹ç»™è¿™ä¸ªæ–°å®¹é‡ï¼Œ<strong>å®Œæˆä¸€æ¬¡æ‰©å®¹ï¼Œæ­¤æ—¶æ•°ç»„çš„å®¹é‡ç”±0å˜ä¸º10.</strong></li>
<li>å¦‚æœ<code>newCapacity &gt; MAX_ARRAY_SIZE </code>,é‚£ä¹ˆ<code>newCpapcity</code>çš„å€¼ç”±æ–¹æ³•<code>hugeCapacity()</code>å†³å®šã€‚è¿™ä¸ªåé¢å†è¯´ï¼Œæˆ‘ä»¬ç»§ç»­å½“å‰çš„åˆ†æï¼Œåœ¨æ‰§è¡Œå®Œä¸Šé¢çš„åˆ¤æ–­è¯­å¥ä¹‹åï¼Œæœ€åå¯¹<code>elemantData</code>è¿›è¡Œé‡æ–°èµ‹å€¼ï¼Œæ ¸å¿ƒæ–¹æ³•<code>Arrays.copyOf(elementData, newCapacity)</code>,è¯¥æ–¹æ³•çš„ä½œç”¨æ˜¯å°†<code>newCapacity</code>çš„å€¼å¤åˆ¶ç»™<code>elementData</code>ã€‚ä¹‹å<code>elementData</code>é‡Œé¢å°†ä¼šå­˜åœ¨<strong>10ä¸ªnull</strong>å€¼.</li>
</ol>
</blockquote>
<p>å°±æ˜¯è¯´ï¼Œå½“æˆ‘ä»¬<strong>é¦–æ¬¡</strong>ä½¿ç”¨è¯¥é›†åˆçš„<strong>æ— å‚æ„é€ </strong>åˆå§‹åŒ–é›†åˆæ—¶ï¼Œå…¶å®å¹¶ä¸ä¼šè§¦å‘<strong>1.5å€çš„åº•å±‚æ‰©å®¹æœºåˆ¶</strong>ã€‚æ³¨æ„ï¼Œè¿™é‡Œä½¿ç”¨<code>copyOf()</code>æ–¹æ³•çš„ä½œç”¨ä¹Ÿæ˜¯ä¸ºäº†<strong>ä¿ç•™æ‰©å®¹ä¹‹å‰å·²ç»å­˜åœ¨é›†åˆä¸­çš„å…ƒç´ </strong>ï¼Œæ¢å¥è¯è¯´ï¼Œæ¯æ¬¡æ‰©å®¹å¹¶ä¸ä¼šå¯¼è‡´å·²å­˜åœ¨çš„å…ƒç´ ä¸¢å¤±ï¼Œè€Œæ˜¯åœ¨è¿™äº›å…ƒç´ ä¹‹åæ·»åŠ <code>N</code>ä¸ªå€¼ä¸º<code>null</code>çš„å…ƒç´ ç©ºé—´ã€‚æ¯”å¦‚è¿™æ ·:</p>
<pre data-lang="java" style="background-color:#2b303b;color:#c0c5ce;" class="language-java "><code class="language-java" data-lang="java"><span style="color:#65737e;">//nullå€¼å¾—ä½ç½®å°±æ˜¯æ‰©å®¹çš„å®¹é‡
</span><span>{</span><span style="color:#d08770;">1</span><span>,</span><span style="color:#d08770;">2</span><span>,</span><span style="color:#d08770;">3</span><span>,</span><span style="color:#d08770;">4</span><span>,</span><span style="color:#d08770;">5</span><span>,</span><span style="color:#d08770;">6</span><span>,</span><span style="color:#d08770;">7</span><span>,</span><span style="color:#d08770;">8</span><span>,</span><span style="color:#d08770;">9</span><span>,</span><span style="color:#d08770;">10</span><span>,</span><span style="color:#d08770;">null</span><span>,</span><span style="color:#d08770;">null</span><span>,</span><span style="color:#d08770;">null</span><span>,</span><span style="color:#d08770;">null</span><span>,</span><span style="color:#d08770;">null</span><span>}
</span></code></pre>
<p>å½“ä»¥ä¸Šæ‰©å®¹æ“ä½œå®Œæˆä¹‹åï¼Œæ‰§è¡Œä¼šè¿”å›åˆ°ä¹‹å‰çš„<code>add()</code>æ–¹æ³•ï¼š</p>
<pre data-lang="java" style="background-color:#2b303b;color:#c0c5ce;" class="language-java "><code class="language-java" data-lang="java"><span style="color:#b48ead;">public boolean </span><span style="color:#bf616a;">add</span><span>(</span><span style="color:#ebcb8b;">E</span><span> e) {
</span><span>    </span><span style="color:#bf616a;">ensureCapacityInternal</span><span>(size + </span><span style="color:#d08770;">1</span><span>);  </span><span style="color:#65737e;">// Increments modCount!!
</span><span>    elementData[size++] = e;
</span><span>    </span><span style="color:#b48ead;">return </span><span style="color:#d08770;">true</span><span>;
</span><span>}
</span></code></pre>
<p>æ­¤æ—¶çš„<code>elementData</code>å·²ç»ç”±æœ€åˆçš„ç©ºæ•°ç»„æ‰©å®¹ä¸ºå¤§å°ä¸º10çš„å®¹é‡ï¼Œå½“æ‰§è¡Œå®Œ<code>elementData[size++] = e;</code>ä¹‹åï¼Œæ–°çš„å®¹é‡ä¸­ç¬¬ä¸€ä¸ªä½ç½®ä¼šè¢«æ›¿æ¢ä¸ºå…ƒç´ <code>1</code>:</p>
<pre data-lang="java" style="background-color:#2b303b;color:#c0c5ce;" class="language-java "><code class="language-java" data-lang="java"><span>[</span><span style="color:#d08770;">1</span><span>,</span><span style="color:#d08770;">null</span><span>,</span><span style="color:#d08770;">null</span><span>,</span><span style="color:#d08770;">null</span><span>,</span><span style="color:#d08770;">null</span><span>,</span><span style="color:#d08770;">null</span><span>,</span><span style="color:#d08770;">null</span><span>,</span><span style="color:#d08770;">null</span><span>,</span><span style="color:#d08770;">null</span><span>,</span><span style="color:#d08770;">null</span><span>]
</span></code></pre>
<blockquote>
<p>æ³¨æ„ç†è§£<strong>minCapacity</strong>å’Œ<strong>elementData</strong>çš„å«ä¹‰ã€‚å‰è€…çš„æ„æ€æ—¶æˆ‘ä»¬ç”¨è¿™ä¸ªé›†åˆå­˜æ”¾æŸäº›å…ƒç´ <strong>æœ€å°‘éœ€è¦çš„ç©ºé—´</strong>ï¼Œè€Œåè€…è¡¨ç¤ºæ­¤æ—¶è¿™ä¸ªé›†åˆ<strong>æœ¬èº«æ‹¥æœ‰çš„ç©ºé—´</strong>ï¼Œæ‰€ä»¥ï¼Œæ‰©å®¹çš„ç›®çš„åœ¨äºæ‰©å¼ <strong>elementData</strong>çš„å¤§å°ï¼Œä»¥æ»¡è¶³å­˜æ”¾<strong>minCapacity</strong>æ‰€éœ€ã€‚</p>
</blockquote>
<p>ç°åœ¨æ¥çœ‹ä¸€ä¸‹ä¸Šé¢ç•™ä¸‹çš„**hugeCapacity(minCapacity)**æ–¹æ³•ï¼Œæºç å¦‚ä¸‹ï¼š</p>
<pre data-lang="java" style="background-color:#2b303b;color:#c0c5ce;" class="language-java "><code class="language-java" data-lang="java"><span style="color:#b48ead;">private static int </span><span style="color:#bf616a;">hugeCapacity</span><span>(</span><span style="color:#b48ead;">int</span><span> minCapacity) {
</span><span> </span><span style="color:#b48ead;">if </span><span>(minCapacity &lt; </span><span style="color:#d08770;">0</span><span>) </span><span style="color:#65737e;">// overflow
</span><span>     </span><span style="color:#b48ead;">throw new </span><span style="color:#ebcb8b;">OutOfMemoryError</span><span>();
</span><span> </span><span style="color:#b48ead;">return </span><span>(minCapacity &gt; </span><span style="color:#d08770;">MAX_ARRAY_SIZE</span><span>) ? </span><span style="color:#ebcb8b;">Integer</span><span>.</span><span style="color:#d08770;">MAX_VALUE </span><span>: </span><span style="color:#d08770;">MAX_ARRAY_SIZE</span><span>;
</span><span>}
</span><span style="color:#65737e;">//æ³¨æ„ï¼šä»¥ä¸‹æ˜¯MAX_ARRAY_SIZEçš„å¸¸é‡å®šä¹‰ã€‚
</span><span style="color:#b48ead;">private static final int </span><span style="color:#d08770;">MAX_ARRAY_SIZE </span><span>= </span><span style="color:#ebcb8b;">Integer</span><span>.</span><span style="color:#d08770;">MAX_VALUE </span><span>- </span><span style="color:#d08770;">8</span><span>;
</span><span style="color:#65737e;">//2147483647æ˜¯Integer.MAX_VALUE
</span></code></pre>
<p>è¿™ä¸ªæ–¹æ³•å…¶å®å°±æ˜¯å¯¹æ•°ç»„<strong>å¤§å°è¾¹ç•Œè¿›è¡Œä¸€ä¸ªåˆ¤æ–­å’Œé™åˆ¶</strong>ï¼Œè¦æ±‚æ•°ç»„å¤§å°åœ¨<code>0</code>åˆ°<code>MAX_VALUE</code>ä¹‹é—´ã€‚å¦‚æœ<code>&lt;0</code>ç›´æ¥æŠ›å‡ºä¸€ä¸ª<code>OutOfMemoryError</code>å¼‚å¸¸ï¼Œå¦åˆ™è¿”å›ä¸€ä¸ªå€¼ä½œä¸ºæ•°ç»„å®¹é‡çš„ä¸Šé™ï¼Œè¿™é‡Œç”¨äº†ä¸€ä¸ªä¸‰å…ƒè¡¨è¾¾å¼ä½œä¸ºè¿”å›è¯­å¥ã€‚</p>
<p>å¦‚æœ<code>æœ€å°å®¹é‡å¤§äºMAX_ARRAY_SIZEï¼Œ</code>åˆ™å°†<code>Integer.MAX_VALUE</code>çš„å€¼èµ‹ç»™å®ƒï¼Œå¦åˆ™è¿˜æ˜¯ç”¨<code>MAX_ARRAY_SIZEã€‚</code></p>
<p>å†çœ‹ä¸€ä¸‹<strong>ä¸ºä»€ä¹ˆè¿™é‡Œ****MAX_ARRAY_SIZE</strong>æ˜¯<strong>Integer.MAX_VALUE-8</strong>ï¼Œä¹Ÿå³æ˜¯**2147483647-8=2,147,483,639****è€Œä¸æ˜¯å‡å…¶ä»–æ•°å€¼ï¼Ÿ**å…³äºè¿™ä¸ªé—®é¢˜ï¼Œå…¶å®å†æºç çš„æ³¨é‡Šä¸­å°±å·²ç»å†™æ¸…æ¥šäº†ã€‚</p>
<p><img src="https://images.waer.ltd/img/20220322112254.png" alt="" loading="lazy" decoding="async" /></p>
<p>å¤§è‡´æ„æ€å°±æ˜¯å¦‚æœç›´æ¥ä½¿ç”¨<strong>Integer.MAX_VALUE</strong>çš„è¯ï¼Œåœ¨æŸäº›è™šæ‹Ÿæœºä¸­ï¼Œå¯èƒ½ä¼šå‡ºç°æº¢å‡ºçš„é—®é¢˜ã€‚ä¸è¿‡ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬è¿˜æ˜¯è®¤ä¸ºå®ƒçš„å€¼å¯ä»¥ç›´æ¥çœ‹ä½œæ˜¯ä¸<strong>Integer.MAX_VALUE</strong>ç›¸åŒã€‚ä»¥ä¸‹æ˜¯æ¥è‡ª<code>stackoverflow</code>çš„ä¸€ä¸ªè§£ç­”ï¼Œå¯ä»¥å‚è€ƒä¸€ä¸‹ã€‚</p>
<p><a class="" href="https://stackoverflow.com/questions/35756277/why-the-maximum-array-size-of-arraylist-is-integer-max-value-8">Why the maximum array size of ArrayList is Integer.MAX_VALUE - 8?</a></p>
<p><strong>æœ‰å‚æ„é€ çš„æ‰©å®¹åŸç†</strong></p>
<p>ä¸Šé¢åˆ†æäº†è°ƒç”¨<strong>æ— å‚æ„é€ å™¨</strong>åˆ›å»ºé›†åˆåï¼Œå®ƒåº•å±‚çš„æ‰©å®¹åŸç†ï¼Œå…¶å®åªè¦ç†è§£äº†ä¹‹åã€‚é‚£ä¹ˆå…³äº<strong>æœ‰å‚æ„é€ </strong>çš„æ‰©å®¹ï¼Œå°±å¾ˆå®¹æ˜“ç†è§£äº†ã€‚</p>
<p>ä¸‹é¢æ˜¯å®ƒçš„æœ‰å‚æ„é€ å™¨æºç ï¼Œå‰é¢ä¹Ÿæåˆ°è¿‡ã€‚</p>
<pre data-lang="java" style="background-color:#2b303b;color:#c0c5ce;" class="language-java "><code class="language-java" data-lang="java"><span style="color:#65737e;">/**
</span><span style="color:#65737e;">     * Constructs an empty list with the specified initial capacity.
</span><span style="color:#65737e;">     *
</span><span style="color:#65737e;">     * </span><span style="color:#b48ead;">@param  </span><span style="color:#bf616a;">initialCapacity</span><span style="color:#65737e;">  the initial capacity of the list
</span><span style="color:#65737e;">     * </span><span style="color:#b48ead;">@throws </span><span style="color:#65737e;">IllegalArgumentException if the specified initial capacity
</span><span style="color:#65737e;">     *         is negative
</span><span style="color:#65737e;">     */
</span><span style="color:#65737e;">public ArrayList(int initialCapacity) {
</span><span style="color:#65737e;">    if (initialCapacity &gt; 0) {
</span><span style="color:#65737e;">        this.elementData = new Object[initialCapacity];
</span><span style="color:#65737e;">    } else if (initialCapacity == 0) {
</span><span style="color:#65737e;">        this.elementData = EMPTY_ELEMENTDATA;
</span><span style="color:#65737e;">    } else {
</span><span style="color:#65737e;">        throw new IllegalArgumentException(&quot;Illegal Capacity: &quot;+initialCapacity);
</span><span style="color:#65737e;">    }
</span><span style="color:#65737e;">}
</span></code></pre>
<p>è¿™æ®µä»£ç å¾ˆå®¹æ˜“ç†è§£ï¼Œæˆ‘ä»¬åœ¨è°ƒç”¨è¯¥æ„é€ å™¨è¿›è¡Œåˆå§‹åŒ–æ—¶ä¼ å…¥ä¸€ä¸ªåˆå§‹å¤§å°<code>initialCapacity</code>ä½œä¸ºæ•°ç»„çš„<strong>åˆå§‹å®¹é‡</strong>ã€‚å¦‚æœè¯¥å®¹é‡<strong>å¤§äº0ï¼Œ<strong>æ­¤æ—¶<code>elementData</code>æ•°ç»„ä¼šç›´æ¥</strong>ç”¨è¯¥å€¼ä½œä¸ºæ•°ç»„çš„é•¿åº¦åˆ›å»ºä¸€ä¸ªæ–°çš„<code>Object</code>æ•°ç»„ï¼Œä»¥å®Œæˆåˆå§‹åŒ–</strong>ã€‚å¦åˆ™å¦‚æœä¼ å…¥çš„åˆå§‹å€¼ä¸º<code>0</code>ï¼Œä¼šå¯¹<code>elementData</code>è¿›è¡Œä¸€ä¸ªå¸¸é‡èµ‹å€¼æ“ä½œï¼Œå°†æ•°ç»„åˆå§‹åŒ–ä¸º<code>EMPTY_ELEMENTDATA</code>å¤§å°çš„æ•°ç»„ï¼Œè¯¥å¸¸é‡å®šä¹‰å¦‚ä¸‹ï¼š</p>
<pre data-lang="java" style="background-color:#2b303b;color:#c0c5ce;" class="language-java "><code class="language-java" data-lang="java"><span style="color:#b48ead;">private static final </span><span style="color:#ebcb8b;">Object</span><span style="color:#b48ead;">[] </span><span style="color:#d08770;">EMPTY_ELEMENTDATA </span><span>= {};
</span></code></pre>
<p>ä¹Ÿå°±æ˜¯åˆ›å»ºä¸€ä¸ªç©ºæ•°ç»„ã€‚å¦‚æœä¸åœ¨ä»¥ä¸Šä¸¤ç§æƒ…å†µä¹‹å¤–çš„ï¼Œç›´æ¥æŠ›ä¸€ä¸ª<strong>IllegalArgumentException</strong>å¼‚å¸¸ç»“æŸã€‚ä½†æ˜¯ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæ—¢ç„¶æˆ‘ä»¬å†³å®šè°ƒç”¨äº†è¯¥æ„é€ å™¨ï¼Œä¸€èˆ¬ä¸ä¼šç›´æ¥ç”©ä¸ª<code>0</code>è¿›å»ï¼Œè¿™æ ·åšçš„æ„ä¹‰ä¸å¤§ã€‚</p>
<p>åœ¨åˆå§‹åŒ–å®Œæˆåï¼Œè¿›å…¥æ·»åŠ æ–¹æ³•ï¼Œæ–¹æ³•ä¼šå…ˆå¯¹ç°æœ‰çš„æ•°ç»„å®¹é‡è¿›è¡Œæ£€æŸ¥ï¼Œå¦‚æœå‘ç°æ‰€<strong>éœ€æœ€å°å®¹é‡å¤§äºå½“å‰åˆå§‹åŒ–ä¼ å…¥çš„å®¹é‡</strong>ï¼Œåˆ™ä¼šå…ˆè¿›å…¥<code>grow()</code>æ–¹æ³•å®Œæˆæ‰©å®¹ï¼Œè¿™é‡Œæ‰©å®¹ä¸ä¼šè¿›å…¥ç¬¬ä¸€ä¸ª<code>if</code>åˆ¤æ–­ï¼Œå› ä¸ºåˆå§‹åŒ–ä¼ å…¥çš„<code>elementData</code><strong>å¿…ç„¶æ˜¯å¤§äº0çš„</strong>ï¼Œç¨‹åºä¼šç›´æ¥æ‰§è¡Œæºç ä¸­çš„<strong>int newCapacity = oldCapacity + (oldCapacity &gt;&gt; 1);<strong>è¿™è¡Œé€»è¾‘ï¼Œ<strong>ç›´æ¥é‡‡å–1.5å€æ‰©å®¹çš„æœºåˆ¶</strong>å¯¹æ•°ç»„è¿›è¡Œæ‰©å®¹åï¼Œå°†æ‰©å®¹åçš„æ•´ä¸ªæ•°ç»„ç©ºé—´ç›´æ¥å¤åˆ¶ä¸€ä»½ï¼Œè¯¥æ“ä½œä¼šåœ¨åŸæœ‰å…ƒç´ çš„åŸºç¡€ä¸Šè¿½åŠ æ‰©å®¹éƒ¨åˆ†çš„ç©ºé—´ï¼Œ<strong>è¯¥éƒ¨åˆ†çš„å€¼é»˜è®¤ä½¿ç”¨nullæ¥å¡«å……</strong>ï¼Œè¿™äº›å’Œå‰é¢åˆ†æ</strong>æ— å‚æ„é€ æ‰©å®¹</strong>æ—¶å€™æ˜¯ä¸€æ ·çš„ã€‚æ­¤æ—¶å†è¿”å›æ·»åŠ æ–¹æ³•å†…éƒ¨æ‰§è¡Œæ·»åŠ ï¼Œæ·»åŠ æˆåŠŸä¹‹åä¹‹å‰æ‰©å®¹çš„<code>null</code>éƒ¨åˆ†ä¼šè¢«åˆšæ·»åŠ çš„å…ƒç´ å–ä»£ï¼Œä»¥æ­¤ç±»æ¨ï¼Œç›´åˆ°ä¸‹ä¸€æ¬¡å®¹é‡ä¸å¤Ÿæ—¶ï¼Œåˆå†ä¸€æ¬¡è§¦å‘<code>1.5</code>bå€çš„æ‰©å®¹æœºåˆ¶ã€‚</p>
<pre data-lang="java" style="background-color:#2b303b;color:#c0c5ce;" class="language-java "><code class="language-java" data-lang="java"><span style="color:#b48ead;">private</span><span> void </span><span style="color:#bf616a;">grow</span><span>(</span><span style="color:#b48ead;">int</span><span> minCapacity) {
</span><span> </span><span style="color:#65737e;">// overflow-conscious code
</span><span> </span><span style="color:#b48ead;">int</span><span> oldCapacity = elementData.length;
</span><span> </span><span style="color:#b48ead;">int</span><span> newCapacity = oldCapacity + (oldCapacity &gt;&gt; </span><span style="color:#d08770;">1</span><span>);
</span><span> </span><span style="color:#b48ead;">if </span><span>(newCapacity - minCapacity &lt; </span><span style="color:#d08770;">0</span><span>)
</span><span>     newCapacity = minCapacity;
</span><span> </span><span style="color:#b48ead;">if </span><span>(newCapacity - </span><span style="color:#d08770;">MAX_ARRAY_SIZE </span><span>&gt; </span><span style="color:#d08770;">0</span><span>)
</span><span>     newCapacity = </span><span style="color:#bf616a;">hugeCapacity</span><span>(minCapacity);
</span><span> </span><span style="color:#65737e;">// minCapacity is usually close to size, so this is a win:
</span><span> elementData = </span><span style="color:#ebcb8b;">Arrays</span><span>.</span><span style="color:#bf616a;">copyOf</span><span>(elementData, newCapacity);
</span><span>}
</span></code></pre>
<p><strong>å®ä¾‹æ¼”ç¤º</strong></p>
<p>é€šè¿‡ä¸€ä¸ªå…·ä½“çš„ä¾‹å­ï¼Œæ¥è§£é‡Šå¸®åŠ©ç†è§£ä¸Šé¢æ‰€è¯´çš„æ‰©å®¹åŸç†(æ— å‚æ„é€ )ã€‚</p>
<ul>
<li><strong>æ— å‚æ„é€ å™¨</strong></li>
</ul>
<blockquote>
<p>å‡è®¾æˆ‘ä»¬è°ƒç”¨ äº†<code>ArrayList()</code>å¯¹é›†åˆ<code>list</code>è¿›è¡Œäº†åˆå§‹åŒ–å¹¶å°è¯•å‘å…¶ä¸­æ·»åŠ å…ƒç´ ï¼Œä¸‹é¢æ¨¡æ‹Ÿè¿™ä¸ªå¤§è‡´è¿‡ç¨‹ï¼š</p>
<ol>
<li>åˆå§‹åŒ–å®Œæˆï¼Œåˆ›å»ºä¸€ä¸ªç©ºçš„å¯¹è±¡æ•°ç»„<code>elementData[] = {}</code>ã€‚</li>
<li>è¿›å…¥<code>add()</code>æ–¹æ³•ï¼Œæ ¹æ®å½“å‰æ·»åŠ å…ƒç´ æ‰€éœ€ç©ºé—´å¯¹å·²æœ‰ç©ºé—´è¿›è¡Œåˆ¤æ–­ï¼Œæ˜¾ç„¶æˆ‘ä»¬æ·»åŠ ç¬¬ä¸€ä¸ªå…ƒç´ æ—¶ï¼Œ<code>minCapacity=1,</code>è€Œ<code>elementData=0ã€‚</code></li>
<li>æ­¤æ—¶ä¸å¿™ç€æ‰§è¡Œæ·»åŠ ï¼Œè€Œæ˜¯è°ƒç”¨<code>ensureCapacityInternal()</code>æ–¹æ³•ï¼š
<ol>
<li>è¯¥æ–¹æ³•å‘ç°ï¼Œåˆå§‹åŒ–çš„<code>elementData=DEFAULTCAPACITY_EMPTY_ELEMENTDATA</code>ï¼Œåˆ™æ‰§è¡Œä¸€ä¸ª<code>Math.max()</code>æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ç›´æ¥å°†<code>minCapacity</code>çš„å€¼æ”¹ä¸º<code>10</code>ã€‚æ­¤æ—¶æˆ‘ä»¬çš„<code>minCapacity=10</code>,è€Œ<code>elementData</code>è¿˜æ˜¯<code>0</code>ï¼›</li>
<li>è¿›å…¥**<code>ensureExplicitCapacity()</code>**æ–¹æ³•ï¼Œæ»¡è¶³åˆ¤æ–­æ¡ä»¶å‘ç°ï¼Œ<strong>æ‰€éœ€æœ€å°å®¹é‡&gt;å½“å‰å®¹é‡</strong>ï¼Œéœ€è¦æ‰©å®¹ï¼Œè§¦å‘<code>grow()</code>æ–¹æ³•ã€‚
<ol>
<li>æ£€æŸ¥å¹¶è®°å½•<code>elementData</code>çš„é•¿åº¦ï¼Œå‘ç°æ­¤æ—¶è¯¥å€¼ä¸º<code>0</code>ï¼Œ<strong>ç”±äº0çš„1.5å€è¿˜æ˜¯0ï¼Œæ­¤æ—¶æ‰©å®¹ç®—æ³•æ— æ„ä¹‰ä¸æ‰§è¡Œã€‚</strong></li>
<li>è¿›å…¥ç¬¬ä¸€ä¸ª<code>if</code>åˆ¤æ–­ï¼Œå‘ç°æ¡ä»¶æ»¡è¶³ï¼Œç›´æ¥å°†<code>minCapacity</code>çš„å€¼èµ‹ç»™ä¸€ä¸ªæ–°çš„å˜é‡<code>newCapacity=10</code></li>
<li>æ‰§è¡Œæ•°ç»„çš„<code>copyOf()</code>æ–¹æ³•ï¼Œå°†ä¼šå¼€è¾Ÿä¸€ä¸ªå®¹é‡ä¸º<code>10</code>çš„æ•°ç»„ã€‚</li>
<li>ç¨‹åºè·³å›<code>add()</code>æ–¹æ³•ï¼Œæ‰§è¡Œå…ƒç´ çš„æ·»åŠ ã€‚</li>
<li><code>add()</code>æ–¹æ³•æ‰§è¡Œç»“æŸã€‚</li>
</ol>
</li>
</ol>
</li>
</ol>
</blockquote>
<p><strong>ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœæˆ‘ä»¬è°ƒç”¨æ— å‚æ„é€ å™¨åˆå§‹åŒ–é›†åˆï¼Œé¦–æ¬¡æ‰©å®¹å¹¶ä¸ä¼šæŒ‰ç…§<code>1.5</code>å€çš„æœºåˆ¶æ¥ï¼Œè€Œæ˜¯ç›´æ¥ç»™ä½ å¼€ä¸€ä¸ªå¤§å°ä¸º<code>10</code>çš„æ•°ç»„ï¼Œåªæœ‰å½“è¿™<code>10</code>ä¸ªç©ºé—´å…¨éƒ¨ç”¨å®Œä¹‹åï¼Œä¹‹åçš„æ¯ä¸€æ¬¡æ‰©å®¹ï¼Œå°±éƒ½ä¼šé‡‡ç”¨<code>1.5</code>å€çš„æœºåˆ¶è¿›è¡Œæ‰©å®¹ï¼Œå› æ­¤é¦–æ¬¡è°ƒç”¨çš„æ–¹æ³•æ ˆæ˜¯æ¯”è¾ƒç»•çš„ï¼Œä½†æ˜¯ä»ç¬¬äºŒæ¬¡å¼€å§‹ï¼Œæˆ–è€…ä½¿ç”¨æœ‰å‚æ„é€ å™¨åˆå§‹åŒ–çš„æ—¶å€™å°±ä¼šå°‘ä¸€äº›åˆ¤æ–­ï¼Œç©ºé—´ä¸å¤Ÿï¼Œç›´æ¥å¼€å§‹<code>1.5</code>å€æ‰©å®¹æœºåˆ¶èµ°èµ·ã€‚</strong></p>
<h5 id="-4">1.5å€æ‰©å®¹æ€ä¹ˆç®—ï¼Ÿ</h5>
<blockquote>
<p>å‡è®¾å½“å‰å®¹é‡å€¼ä¸º<code>8</code>ï¼Œä¸‹ä¸€æ¬¡æ‰©å®¹çš„å€¼å°±æ˜¯<code>12</code>ï¼Œç®—æ³•è¿‡ç¨‹å¾ˆç®€å•ï¼š</p>
<p>12 = 8+8/2</p>
<p>= 8+4</p>
<p>=12</p>
<p>åªä¸è¿‡ï¼Œåœ¨æºä»£ç ä¸­ï¼Œç®—æ³•ä½¿ç”¨å³ç§»<code>&gt;&gt;</code>ä»£æ›¿é™¤æ³•ï¼Œè¦çŸ¥é“ï¼Œ<strong>ä½è¿ç®—çš„é€Ÿåº¦æ˜¯è¿œå¿«äºå››åˆ™è¿ç®—çš„</strong>ã€‚ç”±æ­¤ï¼Œå¦‚æœéœ€è¦å†æ¬¡æ‰©å®¹çš„è¯ï¼Œ<code>12</code>çš„å®¹é‡ä¼šæ‰©å®¹ä¸º<code>12+6 = 18</code>ã€‚</p>
</blockquote>
<hr />
<h4 id="vector"><code>Vector</code></h4>
<h5 id="-5">åŸºæœ¬ç»“æ„</h5>
<p><code>Vector</code>ç±»çš„å®šä¹‰ï¼Œå®ƒå®ç°è‡ª<code>List</code>æ¥å£ã€‚</p>
<pre data-lang="java" style="background-color:#2b303b;color:#c0c5ce;" class="language-java "><code class="language-java" data-lang="java"><span style="color:#b48ead;">public class </span><span style="color:#ebcb8b;">Vector</span><span style="color:#eff1f5;">&lt;</span><span style="color:#bf616a;">E</span><span style="color:#eff1f5;">&gt;
</span><span style="color:#eff1f5;">    </span><span style="color:#b48ead;">extends </span><span style="color:#a3be8c;">AbstractList</span><span style="color:#eff1f5;">&lt;</span><span style="color:#ebcb8b;">E</span><span style="color:#eff1f5;">&gt;
</span><span style="color:#eff1f5;">    </span><span style="color:#b48ead;">implements </span><span style="color:#a3be8c;">List</span><span style="color:#eff1f5;">&lt;</span><span style="color:#ebcb8b;">E</span><span style="color:#eff1f5;">&gt;, </span><span style="color:#a3be8c;">RandomAccess</span><span style="color:#eff1f5;">, </span><span style="color:#a3be8c;">Cloneable</span><span style="color:#eff1f5;">, </span><span style="color:#a3be8c;">java</span><span style="color:#eff1f5;">.</span><span style="color:#a3be8c;">io</span><span style="color:#eff1f5;">.</span><span style="color:#a3be8c;">Serializable
</span></code></pre>
<p>å®ƒçš„åº•å±‚å®ç°ä¹Ÿæ˜¯åŸºäºå¯¹è±¡æ•°ç»„ï¼Œå®ƒç”±<code>protected</code>ä¿®é¥°ç¬¦ä¿®é¥°ï¼š</p>
<pre data-lang="java" style="background-color:#2b303b;color:#c0c5ce;" class="language-java "><code class="language-java" data-lang="java"><span style="color:#b48ead;">protected </span><span style="color:#ebcb8b;">Object</span><span style="color:#b48ead;">[]</span><span> elementData;
</span></code></pre>
<p><code>Vector</code>æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå®ƒçš„æ“ä½œæ–¹æ³•éƒ½æœ‰<code>synchronized</code>ä¿®é¥°ï¼Œè¯¥å…³é”®å­—å¯ä»¥å®ç°çº¿ç¨‹åŒæ­¥å’Œäº’æ–¥ï¼Œæ‰€ä»¥ä»–æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚æ¯”å¦‚å…¶æºç ä¸­çš„<code>indexOf()</code>æ–¹æ³•ï¼Œå› æ­¤ï¼Œä¸€èˆ¬åœ¨å¼€å‘ä¸­ï¼Œå¦‚æœæœ‰çº¿ç¨‹å®‰å…¨çš„éœ€è¦ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨<code>Vector</code>ã€‚å½“ç„¶ï¼Œè¿™ä¹Ÿå¹¶éæ˜¯å¿…é¡»çš„ï¼Œå…³äºçº¿ç¨‹å®‰å…¨çš„é›†åˆæˆ–è€…è¯´å®ç°ï¼Œè¿˜æœ‰ä¸“é—¨çš„ç±»å»ç®¡ç†ï¼Œ<code>Vector</code>åœ¨<code>JDK1.0</code>ç‰ˆæœ¬ä¸­å°±æœ‰çš„ï¼Œç®—æ˜¯ä¸€ä¸ªè€å‰è¾ˆäº†ï¼Œå°½ç®¡å®ƒçº¿ç¨‹å®‰å…¨ï¼Œä½†ä¹Ÿä¸ä¸€å®šå°±æ˜¯æœ€ä½³çš„é€‰æ‹©ã€‚</p>
<pre data-lang="java" style="background-color:#2b303b;color:#c0c5ce;" class="language-java "><code class="language-java" data-lang="java"><span style="color:#b48ead;">public synchronized int </span><span style="color:#bf616a;">indexOf</span><span>(</span><span style="color:#ebcb8b;">Object</span><span> o, </span><span style="color:#b48ead;">int</span><span> index) {
</span><span>    </span><span style="color:#b48ead;">if </span><span>(o == </span><span style="color:#d08770;">null</span><span>) {
</span><span>        </span><span style="color:#b48ead;">for </span><span>(</span><span style="color:#b48ead;">int</span><span> i = index ; i &lt; elementCount ; i++)
</span><span>            </span><span style="color:#b48ead;">if </span><span>(elementData[i]==</span><span style="color:#d08770;">null</span><span>)
</span><span>                </span><span style="color:#b48ead;">return</span><span> i;
</span><span>    } </span><span style="color:#b48ead;">else </span><span>{
</span><span>        </span><span style="color:#b48ead;">for </span><span>(</span><span style="color:#b48ead;">int</span><span> i = index ; i &lt; elementCount ; i++)
</span><span>            </span><span style="color:#b48ead;">if </span><span>(o.</span><span style="color:#bf616a;">equals</span><span>(elementData[i]))
</span><span>                </span><span style="color:#b48ead;">return</span><span> i;
</span><span>    }
</span><span>    </span><span style="color:#b48ead;">return </span><span>-</span><span style="color:#d08770;">1</span><span>;
</span><span>}
</span></code></pre>
<h5 id="-6">æºç åˆ†æ</h5>
<h6 id="-7"><strong>æ‰©å®¹æœºåˆ¶</strong></h6>
<p><strong>é»˜è®¤10æ»¡åï¼ŒæŒ‰ç…§2å€æ‰©å®¹ã€‚å¦‚æœæŒ‡å®šå¤§å°ï¼Œåˆ™æ¯æ¬¡æŒ‰2å€æ‰©å®¹ã€‚</strong></p>
<p><strong>åˆ›å»ºä¸€ä¸ªæ— å‚çš„vectorä¹‹åï¼Œå®ƒä¼šé»˜è®¤ç›´æ¥ç»™ä½ ä¸€ä¸ªå¤§å°ä¸º10çš„ç©ºé—´ã€‚ç›´æˆªäº†å½“ã€‚</strong></p>
<pre data-lang="java" style="background-color:#2b303b;color:#c0c5ce;" class="language-java "><code class="language-java" data-lang="java"><span style="color:#b48ead;">public </span><span style="color:#bf616a;">Vector</span><span>() {
</span><span>    </span><span style="color:#bf616a;">this</span><span>(</span><span style="color:#d08770;">10</span><span>);
</span><span>}
</span></code></pre>
<p>æ¥ç€æ‰§è¡Œæ·»åŠ æ“ä½œï¼Œè·³è½¬åˆ°<code>add()</code>æ–¹æ³•(è¿™é‡Œå°±ä¸å†æè‡ªåŠ¨è£…ç®±çš„æ“ä½œäº†)ï¼Œæºç å¦‚ä¸‹,å’‹ä¸€çœ‹æ˜¯ä¸æ˜¯å’Œå‰é¢åˆ†æçš„<code>ArrayList</code>çš„æºç å¦‚å‡ºä¸€è¾™ï¼Ÿé™¤äº†ä¸€ä¸ª<code>modCount++</code>ä¹‹å¤–ï¼Œè¿˜æ˜¯ä¼šåœ¨æ·»åŠ å…ƒç´ ä¹‹å‰å…ˆæ‰§è¡Œä¸€ä¸ªåä¸º<code>ensureCapacityHelper</code>çš„æ–¹æ³•ï¼ŒåŸºäºå‰é¢<code>ArrayList</code>æºç çš„é˜…è¯»ç†è§£ï¼Œè¿™é‡Œä¸ç”¨å¤šæƒ³ä¹Ÿèƒ½çŒœåˆ°ï¼Œè¿™ä¸ªæ–¹æ³•çš„ä½œç”¨ï¼Œæ— éå°±æ˜¯å¯¹ç›®å‰çš„æ•°ç»„å®¹é‡è¿›è¡Œåˆ¤æ–­ï¼Œçœ‹çœ‹æ˜¯ä¸æ˜¯éœ€è¦æ‰©å®¹ã€‚</p>
<pre data-lang="java" style="background-color:#2b303b;color:#c0c5ce;" class="language-java "><code class="language-java" data-lang="java"><span style="color:#b48ead;">public synchronized boolean </span><span style="color:#bf616a;">add</span><span>(</span><span style="color:#ebcb8b;">E</span><span> e) {
</span><span>    modCount++;
</span><span>    </span><span style="color:#bf616a;">ensureCapacityHelper</span><span>(elementCount + </span><span style="color:#d08770;">1</span><span>);
</span><span>    elementData[elementCount++] = e;
</span><span>    </span><span style="color:#b48ead;">return </span><span style="color:#d08770;">true</span><span>;
</span><span>}
</span></code></pre>
<p>è¿›å…¥<code>ensureCapacityHelper</code>çš„æºç çœ‹çœ‹,å¯ä»¥çœ‹åˆ°è¿™å®ç°å’Œ<code>ArrayList</code>ä¸­çš„å®ç°å‡ ä¹ä¸€æ ·ï¼Œè¿˜æ˜¯åˆ¤æ–­æœ€å°æ‰€éœ€ç©ºé—´å’Œå½“å‰æ•°ç»„çš„å®¹é‡å…³ç³»ï¼Œæ˜¾ç„¶ï¼Œè¿™é‡Œ<code>elementData=10,</code>è€Œ<code>minCapacity=1</code>ï¼Œ<strong>ä¸æ»¡è¶³æ‰©å®¹çš„æ¡ä»¶</strong>ï¼Œå› æ­¤è¿™é‡Œä¸ä¼šè¿›å…¥<code>grow()</code>æ–¹æ³•ã€‚ç›´æ¥è¿”å›<code>add()</code>æ‰§è¡Œå…ƒç´ çš„æ·»åŠ ï¼Œä¸€æ¬¡æ·»åŠ æ‰§è¡Œç»“æŸã€‚</p>
<pre data-lang="java" style="background-color:#2b303b;color:#c0c5ce;" class="language-java "><code class="language-java" data-lang="java"><span style="color:#b48ead;">private</span><span> void </span><span style="color:#bf616a;">ensureCapacityHelper</span><span>(</span><span style="color:#b48ead;">int</span><span> minCapacity) {
</span><span>    </span><span style="color:#65737e;">// overflow-conscious code
</span><span>    </span><span style="color:#b48ead;">if </span><span>(minCapacity - elementData.length &gt; </span><span style="color:#d08770;">0</span><span>)
</span><span>        </span><span style="color:#bf616a;">grow</span><span>(minCapacity);
</span><span>}
</span></code></pre>
<p>ä¸‹é¢æˆ‘ä»¬å‡è®¾ï¼Œè¦æ·»åŠ ç¬¬<code>11</code>ä¸ªå…ƒç´ ï¼Œæ­¤æ—¶åŸæ¥çš„10ä¸ªç©ºé—´å·²ç»ä¸å¤Ÿï¼Œè‡ªç„¶ä¼šè§¦å‘æ‰©å®¹æœºåˆ¶ï¼Œä¸‹é¢æ˜¯è¯¥æ‰©å®¹æ–¹æ³•çš„å®ç°æºç ï¼š</p>
<pre data-lang="java" style="background-color:#2b303b;color:#c0c5ce;" class="language-java "><code class="language-java" data-lang="java"><span style="color:#65737e;">// æ‰©å®¹æ–¹æ³•
</span><span style="color:#b48ead;">private</span><span> void </span><span style="color:#bf616a;">grow</span><span>(</span><span style="color:#b48ead;">int</span><span> minCapacity) {
</span><span>    </span><span style="color:#65737e;">// overflow-conscious code
</span><span>    </span><span style="color:#b48ead;">int</span><span> oldCapacity = elementData.length;
</span><span>    </span><span style="color:#b48ead;">int</span><span> newCapacity = oldCapacity + ((capacityIncrement &gt; </span><span style="color:#d08770;">0</span><span>) ? capacityIncrement : oldCapacity);
</span><span>    </span><span style="color:#b48ead;">if </span><span>(newCapacity - minCapacity &lt; </span><span style="color:#d08770;">0</span><span>)
</span><span>        newCapacity = minCapacity;
</span><span>    </span><span style="color:#b48ead;">if </span><span>(newCapacity - </span><span style="color:#d08770;">MAX_ARRAY_SIZE </span><span>&gt; </span><span style="color:#d08770;">0</span><span>)
</span><span>        newCapacity = </span><span style="color:#bf616a;">hugeCapacity</span><span>(minCapacity);
</span><span>    elementData = </span><span style="color:#ebcb8b;">Arrays</span><span>.</span><span style="color:#bf616a;">copyOf</span><span>(elementData, newCapacity);
</span><span>}
</span><span style="color:#65737e;">// å…³äºcapacityIncrementçš„å®šä¹‰ï¼š
</span><span>   </span><span style="color:#65737e;">/**
</span><span style="color:#65737e;">     * The amount by which the capacity of the vector is automatically
</span><span style="color:#65737e;">     * incremented when its size becomes greater than its capacity.  If
</span><span style="color:#65737e;">     * the capacity increment is less than or equal to zero, the capacity
</span><span style="color:#65737e;">     * of the vector is doubled each time it needs to grow.
</span><span style="color:#65737e;">     *
</span><span style="color:#65737e;">     * </span><span style="color:#b48ead;">@serial
</span><span style="color:#65737e;">     */
</span><span style="color:#65737e;">    protected int capacityIncrement;
</span></code></pre>
<p>æ ¹æ®æºç äº†è§£åˆ°ï¼Œå®ƒä¼šå…ˆå°†<code>elementData</code>çš„é•¿åº¦æ”¾åˆ°ä¸€ä¸ªåä¸º<code>oldCapacity</code>çš„å˜é‡ä¸­å¹¶åˆ›å»ºä¸€ä¸ªæ–°çš„å®¹é‡<code>newCapacity</code>,è¯¥å˜é‡çš„å€¼å°±æ˜¯æ‰©å®¹çš„æ ¸å¿ƒåŸç†ï¼Œå…¶ä¸­<code> int newCapacity = oldCapacity + ((capacityIncrement &gt; 0) ? capacityIncrement : oldCapacity)</code>è¿™æ®µä¸‰å…ƒè¡¨è¾¾å¼ä¼šå…ˆåˆ¤æ–­<code>capacityIncrement</code>çš„å€¼æ˜¯å¦<code>&gt;0</code>,å¦‚æœæˆç«‹ï¼Œé‚£ä¹ˆ<code>capacityIncrement</code>çš„å€¼ä¿æŒä¸å˜ï¼Œé‚£ä¹ˆæ•´ä¸ªè¡¨è¾¾å¼å°±æ˜¯<code>newCapacity = oldCapacity+capacityIncrement</code>ã€‚</p>
<p>å¦åˆ™å°†ä¼šæ˜¯<code>newCapacity =oldCapacity+oldCapactity</code>,ä¹Ÿå°±<code>newCapacity </code>ä¼š<strong>å˜ä¸ºåŸæ¥ä¸¤å€çš„å®¹é‡ï¼Œ<strong>æœ€åä¾æ—§æ˜¯é‡‡ç”¨<code>copyOf()</code>æ–¹æ³•å°†æ‰©å®¹åçš„ç©ºé—´å¤åˆ¶åˆ°åŸç©ºé—´ï¼Œå®Œæˆæ‰©å®¹ã€‚å…³äºå…¶ä¸­ä¸¤ä¸ª<code>if</code>åˆ¤æ–­çš„é€»è¾‘å’Œä¹‹å‰å¯¹<code>ArrayList</code>çš„åˆ†ææ˜¯ç±»ä¼¼çš„ï¼Œä¸å†èµ˜è¿°ã€‚é€šè¿‡è¿™ä¸ªæºç ä¹Ÿå‘ç°äº†ï¼Œè¿™ä¸ª<code>2</code>å€æ‰©å®¹çš„ç®—æ³•ä¸­ï¼Œæœ‰ä¸€ä¸ªåä¸º<code>capacityIncrement</code>çš„</strong>å®¹é‡å¢é‡</strong>ï¼Œå…·ä½“ä½œç”¨é¢ä¼šåœ¨ä¸‹é¢æœ‰å‚æ„é€ å™¨ä¸­è¿›è¡Œåˆ†æã€‚</p>
<p><strong>æœ‰å‚æ„é€ å™¨æºç åˆ†æ</strong></p>
<p>è¯¥æ„é€ å™¨çš„æºç å¦‚ä¸‹ï¼Œæ„é€ å™¨æ˜¯æœ‰ä¸¤ä¸ªå‚æ•°çš„ï¼Œå…¶ä¸­ä¸€ä¸ªä¾¿æ˜¯ä¸Šé¢æåˆ°çš„å®¹é‡å¢é‡å‚æ•°<code>capacityIncrement</code>ã€‚</p>
<pre data-lang="java" style="background-color:#2b303b;color:#c0c5ce;" class="language-java "><code class="language-java" data-lang="java"><span style="color:#b48ead;">public </span><span style="color:#bf616a;">Vector</span><span>(</span><span style="color:#b48ead;">int</span><span> initialCapacity, </span><span style="color:#b48ead;">int</span><span> capacityIncrement) {
</span><span>    </span><span style="color:#bf616a;">super</span><span>();
</span><span>    </span><span style="color:#b48ead;">if </span><span>(initialCapacity &lt; </span><span style="color:#d08770;">0</span><span>)
</span><span>        </span><span style="color:#b48ead;">throw new </span><span style="color:#ebcb8b;">IllegalArgumentException</span><span>(&quot;</span><span style="color:#a3be8c;">Illegal Capacity: </span><span>&quot;+
</span><span>                                           initialCapacity);
</span><span>    </span><span style="color:#bf616a;">this</span><span>.elementData = </span><span style="color:#b48ead;">new </span><span style="color:#ebcb8b;">Object</span><span>[initialCapacity];
</span><span>    </span><span style="color:#bf616a;">this</span><span>.capacityIncrement = capacityIncrement;
</span><span>}
</span></code></pre>
<p>æ–¹æ³•ä½“é¦–å…ˆä¼šå…ˆè°ƒç”¨çˆ¶ç±»çš„æ— å‚æ„é€ ã€‚å¦‚æœæˆ‘ä»¬ä¸æŒ‡å®š<code>capacityIncrement</code>çš„å€¼ï¼Œå®ƒé»˜è®¤æ˜¯<code>0</code>ï¼Œä¹Ÿå°±æ˜¯<strong>æ— å¢é‡</strong>ï¼Œä¸€èˆ¬åœ¨è°ƒç”¨æ— å‚æ„é€ å™¨æ—¶å°±æ˜¯å±äºè¿™ç§æƒ…å†µï¼Œ**åœ¨æ²¡æœ‰æ˜ç¡®å®¹é‡å¢é‡æ—¶ï¼Œæ‰©å®¹ä¼šæŒ‰ç…§åŸå®¹é‡çš„2ä¸¤å€è¿›è¡Œï¼Œ**å¦‚æœæŒ‡å®šå…·ä½“çš„å€¼ï¼Œæˆ‘ä»¬åœ¨<code>grow()</code>æ–¹æ³•ä¸­çœ‹åˆ°ï¼Œ<code>  int newCapacity = oldCapacity + ((capacityIncrement &gt; 0) ? capacityIncrement : oldCapacity);</code>è¿™ä¸ªè¡¨è¾¾å¼å°†äº§ç”Ÿä¸€ä¸ªæ–°çš„å®¹é‡å€¼ï¼Œ<strong>è¯¥å€¼çš„å¤§å°ç”±åŸæ¥çš„å®¹é‡+æŒ‡å®šçš„å®¹é‡å¢é‡å†³å®š</strong>ã€‚é‚£ä¹ˆå¯èƒ½ä¼šå¼€å§‹ç–‘æƒ‘ï¼Œ æ—¢ç„¶è¯´äº†æ˜¯<code>2</code>å€æ‰©å®¹ï¼Œé‚£ä¹ˆåŠ ä¸€ä¸ªå®¹é‡å¢é‡ç®—æ€ä¹ˆå›äº‹ï¼Ÿ</p>
<p>å¦‚æœæŒ‡å®šäº†è¯¥å¢é‡çš„å€¼ï¼Œä¸å°±æ”¹å˜äº†2å€æ‰©å®¹çš„æœºåˆ¶äº†å—ï¼Ÿå…¶å®ä¸å®Œå…¨æ˜¯ï¼Œåœ¨<code>vector</code>æºç ä¸­ï¼Œå…¶å®å­˜åœ¨ä¸‰ä¸ªæ„é€ å™¨ï¼Œä¸Šé¢è¿™ä¸ªä¾¿æ˜¯å¯ä»¥æŒ‡å®šæ‰©å®¹å¢é‡çš„æ„é€ å™¨ï¼Œå¦‚æœä½ ä¸éœ€è¦æŒ‡å®šç¬¬äºŒä¸ªå‚æ•°ï¼Œé‚£ä¹ˆè¿˜å¯ä»¥çœ‹åˆ°ï¼Œå®ƒè¿˜æœ‰ä¸€ä¸ªæ™®é€šçš„å¸¦ä¸€ä¸ªå‚æ•°çš„æ„é€ ï¼Œæºç å¦‚ä¸‹ï¼š</p>
<pre data-lang="java" style="background-color:#2b303b;color:#c0c5ce;" class="language-java "><code class="language-java" data-lang="java"><span style="color:#b48ead;">public </span><span style="color:#bf616a;">Vector</span><span>(</span><span style="color:#b48ead;">int</span><span> initialCapacity) {
</span><span>    </span><span style="color:#bf616a;">this</span><span>(initialCapacity, </span><span style="color:#d08770;">0</span><span>);
</span><span>}
</span></code></pre>
<p>è¯¥æ„é€ å™¨å°½ç®¡åªéœ€è¦ä¸€ä¸ªå‚æ•°ï¼Œä½†å®ƒåœ¨åˆ›å»ºä¹‹åä¼šé»˜è®¤ç»™<code>capacityIncrement</code>èµ‹å€¼ä¸º0ï¼Œè¿™ä¹Ÿå°±æ˜¯ä¸ç®¡ä½ æ˜¯ç©ºå‚æ„é€ è¿˜æ˜¯å¸¦å‚æ„é€ å¯¹<code>Vector</code>è¿›è¡Œåˆå§‹åŒ–ï¼Œåœ¨æ‰©å®¹æ—¶éƒ½ä¼šç”¨åˆ°<code>capacityIncrement</code>è¿™æ ·ä¸€ä¸ªå‚æ•°ï¼Œè¿™ä¹Ÿæ˜¯æ‰©å®¹ç®—æ³•ä¸­ä¸‰å…ƒè¡¨è¾¾å¼çš„æ„ä¹‰ï¼Œ<strong>ä½ å¯ä»¥ä¸å†™ï¼Œä½†æˆ‘å¿…é¡»å¾—ç”¨</strong>ï¼Œæ‰€ä»¥æ‰ä¼šæœ‰é»˜è®¤çš„<code>0</code>,è¿™æ˜¯ä¸å†²çªçš„ã€‚</p>
<pre data-lang="java" style="background-color:#2b303b;color:#c0c5ce;" class="language-java "><code class="language-java" data-lang="java"><span style="color:#65737e;">/*æ— å‚æ„é€ */
</span><span style="color:#ebcb8b;">Vector</span><span> vector = </span><span style="color:#b48ead;">new </span><span style="color:#ebcb8b;">Vector</span><span>();
</span><span style="color:#65737e;">/*æŒ‡å®šä¸€ä¸ªå‚æ•°ï¼šé»˜è®¤ä¸ºé›†åˆçš„åˆå§‹å¤§å°*/
</span><span style="color:#ebcb8b;">Vector</span><span> vector2 = </span><span style="color:#b48ead;">new </span><span style="color:#ebcb8b;">Vector</span><span>(</span><span style="color:#d08770;">6</span><span>);
</span><span style="color:#65737e;">/*æŒ‡å®šä¸¤ä¸ªå‚æ•°ï¼šä¾æ¬¡æ—¶é›†åˆå¤§å°å’Œæ‰©å®¹æ—¶çš„å®¹é‡å¢é‡*/
</span><span style="color:#ebcb8b;">Vector</span><span> vector3= </span><span style="color:#b48ead;">new </span><span style="color:#ebcb8b;">Vector</span><span>(</span><span style="color:#d08770;">6</span><span>,</span><span style="color:#d08770;">3</span><span>);
</span></code></pre>
<hr />
<h4 id="linkedlist"><code>LinkedList</code></h4>
<h5 id="-8">åŸºæœ¬ç»“æ„</h5>
<ul>
<li><code>LinkedList</code>åº•å±‚å®ç°é‡‡ç”¨äº†<strong>åŒå‘é“¾è¡¨</strong>å’Œ<strong>åŒç«¯é˜Ÿåˆ—</strong>ã€‚</li>
<li>å¯ä»¥æ·»åŠ ä»»æ„å…ƒç´ ä¸”å…ƒç´ å¯ä»¥é‡å¤(å› ä¸ºå®ç°è‡ªListæ¥å£)ï¼ŒåŒæ—¶åŒ…æ‹¬<code>null</code>ã€‚</li>
<li>éçº¿ç¨‹å®‰å…¨çš„é›†åˆï¼Œæ²¡æœ‰å®ç°åŒæ­¥ã€‚</li>
<li>åœ¨å…¶ä¸­ç»´æŠ¤çš„ä¸¤ä¸ªå±æ€§<code>first</code>å’Œ<code>last</code>åˆ†åˆ«æŒ‡å‘é¦–å°¾èŠ‚ç‚¹ï¼Œ<code>prev</code>æŒ‡å‘å‰é©±èŠ‚ç‚¹ï¼Œ<code>next</code>æŒ‡å‘åç»§èŠ‚ç‚¹ã€‚</li>
<li>å› æ­¤<code>LinkedList</code>çš„å…ƒç´ <strong>åˆ é™¤å’Œæ·»åŠ çš„æ“ä½œæ•ˆç‡ç›¸å¯¹è¾ƒé«˜</strong>ã€‚</li>
</ul>
<h5 id="-9">æºç åˆ†æ</h5>
<p>[å¾…æ›´æ–°â€¦â€¦]</p>
<h4 id="-10">å¦‚ä½•é€‰æ‹©</h4>
<blockquote>
<p>å¦‚ä½•é€‰æ‹©ä½¿ç”¨<code>ArrayList</code>å’Œ<code>LinkedList</code>?æ ¹æ®æˆ‘ä»¬å®é™…çš„ä½¿ç”¨åœºæ™¯æˆ–è€…éœ€æ±‚</p>
</blockquote>
<ul>
<li>å¦‚æœæ¶‰åŠæ”¹æŸ¥æ“ä½œæ¯”è¾ƒå¤šï¼Œå»ºè®®<code>ArrayList</code>ã€‚</li>
<li>å¦‚æœå¢åˆ æ“ä½œæ¯”è¾ƒå¤šï¼Œå»ºè®®<code>LinkedList</code>ã€‚</li>
<li>ä¸€èˆ¬æ¥è¯´ï¼Œåœ¨ç¨‹åºä¸­<code>80%~90%</code>éƒ½æ˜¯æŸ¥è¯¢æ“ä½œï¼Œå› æ­¤å¤§éƒ¨åˆ†æƒ…å†µä¸‹ä¼šé€‰æ‹©ä½¿ç”¨<code>ArrayList</code>ã€‚</li>
<li>å½“ç„¶ï¼Œé€‰æ‹©å“ªä¸€ä¸ªå¹¶éä¸€æˆä¸å˜ï¼Œåœ¨å®é™…çš„é¡¹ç›®ä¸­ï¼Œç”šè‡³å¯èƒ½å‡ºç°<code>ArrayList</code>å’Œ<code>LinkedList</code>åŒæ—¶ä½¿ç”¨çš„æƒ…å†µï¼Œä¹Ÿæ˜¯æ­£å¸¸çš„ï¼Œæ‰€ä»¥è¦æ±‚æœ€å¥½éƒ½ä¼šä½¿ç”¨ã€‚</li>
</ul>
<hr />
<h4 id="set"><code>Set</code>æ¥å£</h4>
<p>ä¸‹é¢ä¸»è¦è®²è§£<code>Set</code>å­æ¥å£ä¸‹çš„ä¸»è¦å®ç°ç±»ã€‚</p>
<p><strong>å¸¸ç”¨æ–¹æ³•å’Œå®ç°</strong></p>
<p><img src="https://images.waer.ltd/img/Set.png" alt="" loading="lazy" decoding="async" /></p>
<p><strong>Setçš„åŸºæœ¬ä»‹ç»</strong></p>
<ul>
<li>
<p>æ— åº(å…ƒç´ çš„æ·»åŠ ä¸å–å‡ºçš„é¡ºåºä¸ä¸€è‡´)ï¼Œæ— ç´¢å¼•ã€‚</p>
<blockquote>
<p>æ³¨æ„ç†è§£è¿™é‡Œçš„æ— åºçš„å«ä¹‰ï¼Œå¹¶ä¸æ˜¯è¯´ï¼Œæ¯ä¸€æ¬¡å–å‡ºçš„é¡ºåºéƒ½æ˜¯éšæœºçš„ï¼Œè€Œæ˜¯æŒ‡å½“æ‰§è¡Œäº†ä¸€æ¬¡å–å‡ºä¹‹åï¼Œä»Šåçš„æ¯ä¸€æ¬¡ç›¸åŒçš„æ“ä½œï¼Œå®ƒå–å‡ºçš„å…ƒç´ é¡ºåºéƒ½ä¸ç¬¬ä¸€æ¬¡ç›¸åŒï¼Œä½†<strong>è¿™ä¸ªé¡ºåºåˆå’Œæ·»åŠ è¿›å»çš„é¡ºåºä¸ä¿æŒä¸€è‡´</strong>ã€‚</p>
</blockquote>
</li>
<li>
<p>ä¸å…è®¸é‡å¤å…ƒç´ ã€‚</p>
</li>
<li>
<p>è¿˜æœ‰ä¸€ç‚¹ï¼Œç”±äºå®ƒæ˜¯<code>Collection</code>çš„å­æ¥å£ï¼Œè‡ªç„¶ä¹Ÿæ”¯æŒå…¶çˆ¶æ¥å£ä¸­çš„ç‰¹æ€§ï¼Œæ¯”å¦‚è¿­ä»£å¯¹è±¡ï¼Œå¢å¼ºforç­‰ç­‰ã€‚</p>
</li>
</ul>
<h4 id="hashset"><code>HashSet</code></h4>
<h5 id="-11">åŸºæœ¬ç»“æ„</h5>
<blockquote>
<p><code>HashSet</code>ä½œä¸º<code>Set</code>å…¸å‹çš„å®ç°ç±»ä¹‹ä¸€ï¼Œæ‹¥æœ‰<code>Set</code>çš„å…¨éƒ¨å±æ€§ï¼Œè¿™é‡Œä¸å†èµ˜è¿°ã€‚</p>
</blockquote>
<h5 id="-12">æºç è§£è¯»</h5>
<h6 id="-13">åˆå§‹åŒ–ä¸åŸºæœ¬åŸç†</h6>
<p>æˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹<code>HashSet</code>çš„åŸºæœ¬ç”¨æ³•ï¼Œå…¶å®ï¼Œ<code>HashSet</code>åœ¨å®ç°ä¸Šï¼Œå°±æ˜¯ä¸€ä¸ª<code>HashMap</code>,è¿™ä¸€ç‚¹å¯ä»¥ä»å®ƒçš„æ„é€ å™¨è¯´èµ·ã€‚</p>
<pre data-lang="java" style="background-color:#2b303b;color:#c0c5ce;" class="language-java "><code class="language-java" data-lang="java"><span> </span><span style="color:#ebcb8b;">Set</span><span> hashSet = </span><span style="color:#b48ead;">new </span><span style="color:#ebcb8b;">HashSet</span><span>();
</span></code></pre>
<p>ä»¥ä¸‹æ˜¯<code>HashSet</code>çš„æ— å‚æ„é€ å™¨æºç ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œå½“æˆ‘ä»¬åˆ›å»ºä¸€ä¸ª<code>HashSet</code>å¯¹è±¡æ—¶ï¼Œå®ƒåœ¨åº•å±‚ç›´æ¥<code>new</code>äº†ä¸€ä¸ª<code>HashMap</code>ï¼Œè¿™åˆä¸å¾—ä¸è¯´ä¸€ä¸‹<code>HashMap</code>çš„åº•å±‚ï¼Œå®ƒæ˜¯ç”±<strong>æ•°ç»„+é“¾è¡¨+çº¢é»‘æ ‘</strong>æ„æˆï¼Œæ‰€ä»¥ç›¸å¯¹æ¥è¯´æ˜¯æ¯”è¾ƒå¤æ‚çš„ã€‚</p>
<p><img src="https://images.waer.ltd/img/20220323200228.png" alt="" loading="lazy" decoding="async" /></p>
<pre data-lang="java" style="background-color:#2b303b;color:#c0c5ce;" class="language-java "><code class="language-java" data-lang="java"><span style="color:#b48ead;">public </span><span style="color:#bf616a;">HashSet</span><span>() {
</span><span>    map = </span><span style="color:#b48ead;">new </span><span style="color:#ebcb8b;">HashMap</span><span>&lt;&gt;();
</span><span>}
</span></code></pre>
<p>æ¢å¥è¯è¯´ï¼Œè¦åˆ†æ<code>HashSet</code>çš„æºç ï¼Œå…¶å®å°±æ˜¯åˆ†æ<code>HashMap</code>çš„åŸç†ã€‚<code>HashSet</code>ä¸€ä¸ªæ˜æ˜¾çš„ç‰¹ç‚¹å°±æ˜¯ä¸èƒ½æ·»åŠ é‡å¤çš„å…ƒç´ ï¼Œä½†è¿™é‡Œçš„<strong>é‡å¤</strong>ä¹Ÿè®¸ä¸æ˜¯ä½ æƒ³è±¡ä¸­çš„é‚£ä¹ˆç®€å•ã€‚</p>
<p>ä¸‹é¢å¼€å§‹åˆ†æä¸€ä¸‹å…¶ä¸­çš„æ·»åŠ å…ƒç´ çš„<code>add()</code>æ–¹æ³•åœ¨åº•å±‚æ˜¯å¦‚ä½•å®ç°çš„ã€‚</p>
<blockquote>
<ul>
<li><strong>æ·»åŠ ä¸€ä¸ªå…ƒç´ æ—¶ï¼Œä¼šå…ˆå¾—åˆ°ä¸€ä¸ª<code>hash</code>å€¼ï¼Œæ ¹æ®è¯¥å€¼è½¬æˆä¸€ä¸ªç´¢å¼•å€¼ã€‚</strong></li>
<li><strong>æ‰¾åˆ°å­˜å‚¨æ•°æ®è¡¨<code>table</code>ï¼Œæ£€æŸ¥è¯¥ç´¢å¼•æ˜¯å¦å·²åœ¨<code>table</code>ä¸­å­˜åœ¨æœ‰å…ƒç´ </strong>ï¼š
<ul>
<li><strong>å¦‚æœæ²¡æœ‰ï¼Œç›´æ¥å°†è¯¥å…ƒç´ åŠ å…¥ã€‚</strong></li>
<li><strong>å¦‚æœæœ‰ï¼Œä¼šè°ƒç”¨<code>equals</code>æ–¹æ³•è¿›è¡Œæ¯”è¾ƒæ“ä½œï¼Œå¦‚æœæ¯”è¾ƒç»“æœä¸º<code>true</code>,æ·»åŠ å¤±è´¥ï¼Œå¦åˆ™ï¼Œå°†ä¼šåœ¨æœ«å°¾æ·»åŠ å…ƒç´ ã€‚</strong></li>
<li><strong>åœ¨<code>Java8</code>ä¸­ï¼Œå¦‚æœä¸€æ¡é“¾è¡¨çš„å…ƒç´ ä¸ªæ•°è¾¾åˆ°<code>TREEIFY_THRESHOLD</code>ä¸”<code>table</code>çš„å¤§å°<code>&gt;=</code>MIN_TREEIFY_CAPACITY,å°±ä¼šè§¦å‘æ ‘åŒ–æœºåˆ¶ï¼Œå³ä¼šç”±å•é“¾è¡¨ç»“æ„è½¬æ¢ä¸ºä¸€æ£µçº¢é»‘æ ‘ã€‚</strong></li>
</ul>
</li>
</ul>
</blockquote>
<p>ä¸ºä¾‹æ›´å¥½çš„ç†è§£å®ƒçš„æ‰§è¡Œè¿‡ç¨‹å’ŒåŸç†ï¼Œæˆ‘ä»¬æŒ‰ç…§ä¸‹é¢è¿™å‡ è¡Œä»£ç æ¥è®²è§£:</p>
<pre data-lang="java" style="background-color:#2b303b;color:#c0c5ce;" class="language-java "><code class="language-java" data-lang="java"><span style="color:#ebcb8b;">HashSet</span><span> hashSet = </span><span style="color:#b48ead;">new </span><span style="color:#ebcb8b;">HashSet</span><span>();
</span><span>hashSet.</span><span style="color:#bf616a;">add</span><span>(&quot;</span><span style="color:#a3be8c;">Java</span><span>&quot;);
</span><span>hashSet.</span><span style="color:#bf616a;">add</span><span>(&quot;</span><span style="color:#a3be8c;">C++</span><span>&quot;);
</span><span>hashSet.</span><span style="color:#bf616a;">add</span><span>(&quot;</span><span style="color:#a3be8c;">Java</span><span>&quot;);
</span><span style="color:#ebcb8b;">System</span><span>.out.</span><span style="color:#bf616a;">println</span><span>(&quot;</span><span style="color:#a3be8c;">hashSet=</span><span>&quot;+hashSet);
</span></code></pre>
<p>ä»£ç é€»è¾‘å¾ˆç®€å•ï¼Œå°±æ˜¯å‘<code>HashSet</code>ä¸­æ·»åŠ ä¸‰ä¸ªå…ƒç´ ï¼Œå…¶ä¸­æœ‰<strong>ä¸¤ä¸ªå…ƒç´ æ˜¯é‡å¤</strong>çš„ï¼Œè¿™æ˜¯ä¸ºäº†ç†è§£å®ƒåº•å±‚æ˜¯å¦‚ä½•åˆ¤æ–­å…ƒç´ é‡å¤çš„ã€‚</p>
<p>æ‰§è¡Œä»£ç ï¼Œé¦–å…ˆä¼šè¿›å…¥<code>HashSet</code>çš„æ„é€ å™¨ï¼Œç›´æ¥åˆ›å»ºä¸€ä¸ªå€¼ä¸ºç©ºçš„<code>HashMap</code>ï¼Œè¿™ç‚¹åœ¨ä¸Šé¢å·²ç»è¯´è¿‡ã€‚è¿›å…¥<code>add()</code>æ–¹æ³•ï¼Œå®ƒçš„å®ç°æºç å¦‚ä¸‹ï¼š</p>
<pre data-lang="java" style="background-color:#2b303b;color:#c0c5ce;" class="language-java "><code class="language-java" data-lang="java"><span style="color:#65737e;">//HashSetä¸­addæ–¹æ³•çš„æºç å®ç°
</span><span style="color:#b48ead;">public boolean </span><span style="color:#bf616a;">add</span><span>(</span><span style="color:#ebcb8b;">E</span><span> e) {
</span><span>    </span><span style="color:#b48ead;">return</span><span> map.</span><span style="color:#bf616a;">put</span><span>(e, </span><span style="color:#d08770;">PRESENT</span><span>)==</span><span style="color:#d08770;">null</span><span>;
</span><span>}
</span></code></pre>
<p>æ–¹æ³•å¾ˆç®€å•ï¼Œç›´æ¥è°ƒç”¨äº†<code>map</code>çš„<code>put()</code>æ–¹æ³•,æ³¨æ„åˆ°ï¼Œè¿™ä¸ªæ–¹æ³•é™¤äº†æˆ‘ä»¬éœ€è¦æ·»åŠ çš„å…ƒç´ <code>e</code>ä¹‹å¤–ï¼Œå®ƒè¿˜æœ‰ä¸€ä¸ªåä¸º<code>PRESENT</code>çš„å¸¸é‡å‚æ•°ï¼Œå…³äºè¿™ä¸ªå‚æ•°çš„ç†è§£ï¼Œæºç ä¸­æ˜¯è¿™æ ·ä»‹ç»çš„ï¼š</p>
<pre data-lang="java" style="background-color:#2b303b;color:#c0c5ce;" class="language-java "><code class="language-java" data-lang="java"><span style="color:#65737e;">// Dummy value to associate with an Object in the backing Map
</span><span style="color:#b48ead;">private static final </span><span style="color:#ebcb8b;">Object </span><span style="color:#d08770;">PRESENT </span><span>= </span><span style="color:#b48ead;">new </span><span style="color:#ebcb8b;">Object</span><span>();
</span></code></pre>
<p><code>PRESENT</code>å…¶å®æ˜¯ä¸€ä¸ª<code>static final</code>ä¿®é¥°çš„å¯¹è±¡ï¼Œåœ¨ä¸Šé¢çš„æ–¹æ³•ä¸­ä½œä¸º<code>put(k,v)</code>ä¸­<code>value</code>çš„å ä½ï¼Œå¹¶æ²¡æœ‰å…¶ä»–å®é™…çš„ä½œç”¨ã€‚è¿™é‡Œä¸å¿…æ·±ç©¶ã€‚ä¸çŸ¥é“æœ‰æ²¡æœ‰æ³¨æ„åˆ°ï¼Œ<code>add</code>æ–¹æ³•ä¸­å°†<code>map.put(e,PRESENT)==null</code>ä½œä¸ºè¿”å›å€¼ï¼Œä¸ºä»€ä¹ˆè¿™é‡Œä¼šæ˜¯<code>null</code>å‘¢ï¼Ÿè¿™å’Œ<code>HashMap</code>åº•å±‚å®ç°æœ‰å…³ç³»ï¼Œæˆ‘ä»¬å…ˆç»§ç»­å¾€ä¸‹ï¼Œåé¢è‡ªç„¶å°±ä¼šæ˜ç™½äº†ã€‚ä¸‹é¢è¿›å…¥<code>put</code>æ–¹æ³•å†…éƒ¨çœ‹çœ‹ã€‚</p>
<pre data-lang="java" style="background-color:#2b303b;color:#c0c5ce;" class="language-java "><code class="language-java" data-lang="java"><span style="color:#65737e;">//HashSetä¸­map.put(e,PERSENT)æ–¹æ³•æºç 
</span><span style="color:#b48ead;">public </span><span style="color:#ebcb8b;">V </span><span style="color:#bf616a;">put</span><span>(</span><span style="color:#ebcb8b;">K</span><span> key, </span><span style="color:#ebcb8b;">V</span><span> value) {
</span><span>    </span><span style="color:#b48ead;">return </span><span style="color:#bf616a;">putVal</span><span>(</span><span style="color:#bf616a;">hash</span><span>(key), key, value, </span><span style="color:#d08770;">false</span><span>, </span><span style="color:#d08770;">true</span><span>);
</span><span>}
</span></code></pre>
<p>æ–¹æ³•ä¸­æœ‰ä¸€ä¸ª<code>putVal</code>çš„æ–¹æ³•ï¼Œå¯ä»¥çœ‹åˆ°å…¶ä¸­çš„ç¬¬ä¸€ä¸ªå‚æ•°<code>hash(key)</code>è¡¨ç¤ºé€šè¿‡è¿™ä¸ªæ–¹æ³•è·å–<code>key</code>çš„<code>hash</code>å€¼ã€‚è¿™é‡Œçš„<code>key</code>ä¹Ÿå°±æ˜¯æˆ‘ä»¬ä¼ å…¥çš„å¾…æ·»åŠ çš„å…ƒç´ ï¼Œè¿›å…¥è¯¥æ–¹æ³•ï¼šæœç„¶ï¼Œ<code>hash</code>æ–¹æ³•çš„ä½œç”¨å°±æ˜¯è®¡ç®—<code>key</code>çš„<code>hashå€¼</code>ï¼Œç®—æ³•éƒ½åœ¨è¿™æ¡ä¸‰å…ƒè¡¨è¾¾å¼å½“ä¸­äº†ï¼Œå¯ä»¥ç®€å•çœ‹ä¸€ä¸‹ã€‚</p>
<pre data-lang="java" style="background-color:#2b303b;color:#c0c5ce;" class="language-java "><code class="language-java" data-lang="java"><span style="color:#65737e;">//HashMapä¸­çš„hash()æ–¹æ³•å®ç°
</span><span style="color:#b48ead;">static final int </span><span style="color:#bf616a;">hash</span><span>(</span><span style="color:#ebcb8b;">Object</span><span> key) {
</span><span>    </span><span style="color:#b48ead;">int</span><span> h;
</span><span>    </span><span style="color:#b48ead;">return </span><span>(key == </span><span style="color:#d08770;">null</span><span>) ? </span><span style="color:#d08770;">0 </span><span>: (h = key.</span><span style="color:#bf616a;">hashCode</span><span>()) ^ (h &gt;&gt;&gt; </span><span style="color:#d08770;">16</span><span>);
</span><span>}
</span></code></pre>
<p>æ ¸å¿ƒç®—æ³•<code>(key == null) ? 0 : (h = key.hashCode()) ^ (h &gt;&gt;&gt; 16)</code>ï¼Œæ„æ€å°±æ˜¯å¦‚æœä¼ å…¥çš„<code>key</code>ä¸º<code>null</code>,é‚£ä¹ˆç›´æ¥è¿”å›0ï¼Œä¹Ÿå°±æ˜¯ä¸æ‰§è¡Œä»»ä½•å®é™…æ“ä½œã€‚<strong>å¦åˆ™ä¼šä½¿ç”¨<code>hashCode()</code>æ–¹æ³•è·å–<code>key</code>çš„å“ˆå¸Œç å’Œæ— ç¬¦å·å³ç§»16ä½ä¹‹åçš„å€¼è¿›è¡Œä¸€ä¸ªå¼‚æˆ–æ“ä½œ</strong>ï¼Œå°†è¯¥å¼‚æˆ–çš„ç»“æœè¿”å›ä½œä¸º<code>key</code>æœ€ç»ˆçš„<code>hash</code>å€¼ã€‚è¿™æ ·ä½œä¸»è¦æ˜¯ä¸ºäº†ä¿è¯<strong>é«˜16ä½å’Œä½16æœªçš„ç‰¹å¾ï¼Œå‡å°‘ç¢°æ’ï¼Œå‡ä½<code>hash</code>å†²çªçš„å‡ ç‡</strong>ã€‚</p>
<p>æ³¨æ„ï¼Œ<code>hash</code>å’Œ<code>hashCode</code>å¹¶ä¸æ˜¯ä¸€å›äº‹ã€‚</p>
<blockquote>
<p>è¿™é‡Œçš„<code>hash</code>ä»…ä»…æ˜¯ç”¨æ¥åœ¨<code>HashMap</code>ä¸­è®¡ç®—<code>key</code>å¯¹åº”çš„æ•£åˆ—ç ã€‚å®ƒçš„ç®—æ³•ä¸­ç”¨åˆ°äº†<code>hashCode()</code>è¿™ä¸ªæ–¹æ³•ï¼Œ<code>hashCode</code>æ˜¯åœ¨<code>Objct</code>ä¸­å®šä¹‰çš„ï¼Œç”¨æ¥è·å–æ¯ä¸ªå…ƒç´ å¯¹åº”çš„æ•£åˆ—å€¼ï¼Œ<strong>åº•å±‚ä½¿ç”¨çš„Cè¯­è¨€ä½œä¸ºå®ç°</strong>,å±äº<code>native</code>æ–¹æ³•ã€‚æ¢å¥è¯è¯´ï¼Œä½¿ç”¨<code>hashCode()</code>æ–¹æ³•å¯ä»¥è®¡ç®—<code>Java</code>ä¸­æ¯ä¸€ä¸ªå…ƒç´ çš„ä¸€ä¸ªå“ˆå¸Œå€¼ã€‚è€Œ<code>hash()</code>æ–¹æ³•åœ¨è¿™é‡Œçš„ä½œå°±ç›¸å¯¹å±€é™ï¼Œä½¿ç”¨çš„ç®—æ³•ä¹Ÿç›¸å¯¹ç®€å•å¾ˆå¤šï¼Œå…·ä½“çš„å…³äº<code>hashå’ŒhashCode()</code>çš„å†…å®¹ï¼Œå¯ä»¥è‡ªå·±ç ”ç©¶ï¼Œè¿™é‡Œä¸ä½œå±•å¼€ã€‚</p>
</blockquote>
<p>ç†è§£äº†<code>hash</code>çš„è®¡ç®—æ–¹å¼ä¹‹åï¼Œç»§ç»­å¾€åçœ‹ï¼Œåœ¨è·å–åˆ°<code>key</code>çš„<code>hash</code>ï¼Œæ–¹æ³•ä¼šè¿”å›è¿›å…¥åˆ°<code>putVal()</code>æ–¹æ³•ä¸­ï¼Œè¿™æ˜¯æ•´ä¸ªæ·»åŠ æ“ä½œçš„åº•å±‚å®ç°çš„æ ¸å¿ƒæºç ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªéš¾ç‚¹ã€‚</p>
<pre data-lang="java" style="background-color:#2b303b;color:#c0c5ce;" class="language-java "><code class="language-java" data-lang="java"><span style="color:#b48ead;">final </span><span style="color:#ebcb8b;">V </span><span style="color:#bf616a;">putVal</span><span>(</span><span style="color:#b48ead;">int</span><span> hash, </span><span style="color:#ebcb8b;">K</span><span> key, </span><span style="color:#ebcb8b;">V</span><span> value, </span><span style="color:#b48ead;">boolean</span><span> onlyIfAbsent,
</span><span>               </span><span style="color:#b48ead;">boolean</span><span> evict) {
</span><span>    </span><span style="color:#ebcb8b;">Node</span><span>&lt;</span><span style="color:#ebcb8b;">K</span><span>,</span><span style="color:#ebcb8b;">V</span><span>&gt;</span><span style="color:#b48ead;">[]</span><span> tab; </span><span style="color:#ebcb8b;">Node</span><span>&lt;</span><span style="color:#ebcb8b;">K</span><span>,</span><span style="color:#ebcb8b;">V</span><span>&gt; p; </span><span style="color:#b48ead;">int</span><span> n, i;
</span><span>    </span><span style="color:#b48ead;">if </span><span>((tab = table) == </span><span style="color:#d08770;">null </span><span>|| (n = tab.length) == </span><span style="color:#d08770;">0</span><span>)
</span><span>        n = (tab = </span><span style="color:#bf616a;">resize</span><span>()).length;
</span><span>    </span><span style="color:#b48ead;">if </span><span>((p = tab[i = (n - </span><span style="color:#d08770;">1</span><span>) &amp; hash]) == </span><span style="color:#d08770;">null</span><span>)
</span><span>        tab[i] = </span><span style="color:#bf616a;">newNode</span><span>(hash, key, value, </span><span style="color:#d08770;">null</span><span>);
</span><span>    </span><span style="color:#b48ead;">else </span><span>{
</span><span>        </span><span style="color:#ebcb8b;">Node</span><span>&lt;</span><span style="color:#ebcb8b;">K</span><span>,</span><span style="color:#ebcb8b;">V</span><span>&gt; e; </span><span style="color:#ebcb8b;">K</span><span> k;
</span><span>        </span><span style="color:#b48ead;">if </span><span>(p.hash == hash &amp;&amp;((k = p.key) == key || (key != </span><span style="color:#d08770;">null </span><span>&amp;&amp; key.</span><span style="color:#bf616a;">equals</span><span>(k))))
</span><span>            e = p;
</span><span>        </span><span style="color:#b48ead;">else if </span><span>(p instanceof </span><span style="color:#ebcb8b;">TreeNode</span><span>)
</span><span>            e = ((</span><span style="color:#ebcb8b;">TreeNode</span><span>&lt;</span><span style="color:#ebcb8b;">K</span><span>,</span><span style="color:#ebcb8b;">V</span><span>&gt;)p).</span><span style="color:#bf616a;">putTreeVal</span><span>(</span><span style="color:#bf616a;">this</span><span>, tab, hash, key, value);
</span><span>        </span><span style="color:#b48ead;">else </span><span>{
</span><span>            </span><span style="color:#b48ead;">for </span><span>(</span><span style="color:#b48ead;">int</span><span> binCount = </span><span style="color:#d08770;">0</span><span>; ; ++binCount) {
</span><span>                </span><span style="color:#b48ead;">if </span><span>((e = p.next) == </span><span style="color:#d08770;">null</span><span>) {
</span><span>                    p.next = </span><span style="color:#bf616a;">newNode</span><span>(hash, key, value, </span><span style="color:#d08770;">null</span><span>);
</span><span>                    </span><span style="color:#b48ead;">if </span><span>(binCount &gt;= </span><span style="color:#d08770;">TREEIFY_THRESHOLD </span><span>- </span><span style="color:#d08770;">1</span><span>) </span><span style="color:#65737e;">// -1 for 1st
</span><span>                        </span><span style="color:#bf616a;">treeifyBin</span><span>(tab, hash);
</span><span>                    </span><span style="color:#b48ead;">break</span><span>;
</span><span>                }
</span><span>                </span><span style="color:#b48ead;">if </span><span>(e.hash == hash &amp;&amp;((k = e.key) == key || (key != </span><span style="color:#d08770;">null </span><span>&amp;&amp; key.</span><span style="color:#bf616a;">equals</span><span>(k))))
</span><span>                    </span><span style="color:#b48ead;">break</span><span>;
</span><span>                p = e;
</span><span>            }
</span><span>        }
</span><span>        </span><span style="color:#b48ead;">if </span><span>(e != </span><span style="color:#d08770;">null</span><span>) { </span><span style="color:#65737e;">// existing mapping for key
</span><span>            </span><span style="color:#ebcb8b;">V</span><span> oldValue = e.value;
</span><span>            </span><span style="color:#b48ead;">if </span><span>(!onlyIfAbsent || oldValue == </span><span style="color:#d08770;">null</span><span>)
</span><span>                e.value = value;
</span><span>            </span><span style="color:#bf616a;">afterNodeAccess</span><span>(e);
</span><span>            </span><span style="color:#b48ead;">return</span><span> oldValue;
</span><span>        }
</span><span>    }
</span><span>    ++modCount;
</span><span>    </span><span style="color:#b48ead;">if </span><span>(++size &gt; threshold)
</span><span>        </span><span style="color:#bf616a;">resize</span><span>();
</span><span>    </span><span style="color:#bf616a;">afterNodeInsertion</span><span>(evict);
</span><span>    </span><span style="color:#b48ead;">return </span><span style="color:#d08770;">null</span><span>;
</span><span>}
</span></code></pre>
<p>åœ¨æ–¹æ³•ä½“çš„å¼€å§‹ï¼Œå®šä¹‰äº†å‡ ä¸ªå±€éƒ¨å˜é‡ï¼Œä»¥å¤‡åé¢ä½¿ç”¨(åºŸè¯)ã€‚ç»§ç»­çœ‹ä¸‹é¢çš„ä»£ç ï¼Œè¿™æ˜¯æ–¹æ³•ä½“çš„ç¬¬ä¸€ä¸ªifåˆ¤æ–­ï¼Œä¸»è¦çš„ä½œç”¨æ˜¯åˆ¤æ–­å¹¶åˆ›å»ºä¸€ä¸ª<code>table</code>ï¼Œæ³¨æ„ï¼Œè¿™é‡Œçš„<code>table</code>æ˜¯ä¸€ä¸ªæ•°ç»„+é“¾è¡¨å½¢å¼çš„ç»“æ„ï¼Œä¹Ÿå°±æ˜¯æ•°ç»„æ¯ä¸€ä¸ªç´¢å¼•å‡ºçš„å…ƒç´ éƒ½æ˜¯ä¸€æ¡å•é“¾è¡¨çš„å½¢å¼ã€‚è¿™ä¸€ç‚¹å‰é¢æœ‰æåˆ°ã€‚å…·ä½“çš„é€»è¾‘æ˜¯ï¼Œ</p>
<pre data-lang="java" style="background-color:#2b303b;color:#c0c5ce;" class="language-java "><code class="language-java" data-lang="java"><span style="color:#b48ead;">if </span><span>((tab = table) == </span><span style="color:#d08770;">null </span><span>|| (n = tab.length) == </span><span style="color:#d08770;">0</span><span>){
</span><span>     n = (tab = </span><span style="color:#bf616a;">resize</span><span>()).length;
</span><span>}
</span></code></pre>
<p>é¦–å…ˆï¼Œå¯¹äº<code>if</code>ä¸­çš„<code>(tab = table) == null </code>æ¡ä»¶ï¼Œç¨‹åºå…ˆå°†<code>table</code>èµ‹å€¼ç»™<code>tab</code>å˜é‡ï¼Œåˆ¤æ–­é›†åˆä¸­æ˜¯å¦å·²ç»å­˜åœ¨<code>table</code>æ•°æ®ï¼Œæˆ–è€…è¯´è¯¥æ•°ç»„çš„é•¿åº¦æ˜¯å¦ä¸º<code>0</code>ã€‚å¦‚æœä¸Šè¿°æ¡ä»¶æœ‰ä¸€ä¸ªæˆç«‹ï¼Œåˆ™è¡¨ç¤º<strong>è¿™æ˜¯ç¬¬ä¸€æ¬¡å‘é›†åˆä¸­æ·»åŠ å…ƒç´ </strong>ï¼Œ<code>hashMap</code>ä¼šè‡ªåŠ¨è°ƒç”¨<code>resize()</code>æ–¹æ³•å¯¹<code>table[]</code>è¿›è¡Œé¦–æ¬¡æ‰©å®¹ï¼Œä»¥ç”¨æ¥å­˜æ”¾æ¥ä¸‹æ¥çš„å…ƒç´ ï¼Œæ‰€ä»¥ï¼Œæ˜ç™½äº†è¿™ä¸ªåˆ¤æ–­çš„ä½œç”¨ï¼Œä¹Ÿå°±ä¸éš¾æ¨æµ‹ï¼Œä¸ºä»€ä¹ˆè¿™æ¡<code>if</code>åˆ¤æ–­è¯­å¥ä¼šæ”¾åœ¨æ–¹æ³•çš„å¼€å§‹äº†ï¼Œä¹Ÿå¯ä»¥æ¨æµ‹ï¼Œåªè¦ä¸æ˜¯é¦–æ¬¡æ·»åŠ å…ƒç´ ï¼Œå°±ä¸å†ä¼šè¿›å…¥è¯¥åˆ¤æ–­ï¼Œç›´æ¥èµ°åé¢çš„é€»è¾‘ã€‚é‚£ä¹ˆç°åœ¨çš„å…³æ³¨ç‚¹å°±è¯¥è½¬ç§»åˆ°è¿™ä¸ª<code>resize()</code>æ–¹æ³•ä¸­ï¼Œçœ‹ä¸€ä¸‹å®ƒçš„æºç ï¼š</p>
<pre data-lang="java" style="background-color:#2b303b;color:#c0c5ce;" class="language-java "><code class="language-java" data-lang="java"><span style="color:#b48ead;">final </span><span style="color:#ebcb8b;">Node</span><span>&lt;</span><span style="color:#ebcb8b;">K</span><span>,</span><span style="color:#ebcb8b;">V</span><span>&gt;</span><span style="color:#b48ead;">[] </span><span style="color:#bf616a;">resize</span><span>() {
</span><span>    </span><span style="color:#ebcb8b;">Node</span><span>&lt;</span><span style="color:#ebcb8b;">K</span><span>,</span><span style="color:#ebcb8b;">V</span><span>&gt;</span><span style="color:#b48ead;">[]</span><span> oldTab = table;
</span><span>    </span><span style="color:#b48ead;">int</span><span> oldCap = (oldTab == </span><span style="color:#d08770;">null</span><span>) ? </span><span style="color:#d08770;">0 </span><span>: oldTab.length;
</span><span>    </span><span style="color:#b48ead;">int</span><span> oldThr = threshold;
</span><span>    </span><span style="color:#b48ead;">int</span><span> newCap, newThr = </span><span style="color:#d08770;">0</span><span>;
</span><span>    </span><span style="color:#b48ead;">if </span><span>(oldCap &gt; </span><span style="color:#d08770;">0</span><span>) {
</span><span>        </span><span style="color:#b48ead;">if </span><span>(oldCap &gt;= </span><span style="color:#d08770;">MAXIMUM_CAPACITY</span><span>) {
</span><span>            threshold = </span><span style="color:#ebcb8b;">Integer</span><span>.</span><span style="color:#d08770;">MAX_VALUE</span><span>;
</span><span>            </span><span style="color:#b48ead;">return</span><span> oldTab;
</span><span>        }
</span><span>        </span><span style="color:#b48ead;">else if </span><span>((newCap = oldCap &lt;&lt; </span><span style="color:#d08770;">1</span><span>) &lt; </span><span style="color:#d08770;">MAXIMUM_CAPACITY </span><span>&amp;&amp;
</span><span>                 oldCap &gt;= </span><span style="color:#d08770;">DEFAULT_INITIAL_CAPACITY</span><span>)
</span><span>            newThr = oldThr &lt;&lt; </span><span style="color:#d08770;">1</span><span>; </span><span style="color:#65737e;">// double threshold
</span><span>    }
</span><span>    </span><span style="color:#b48ead;">else if </span><span>(oldThr &gt; </span><span style="color:#d08770;">0</span><span>) </span><span style="color:#65737e;">// initial capacity was placed in threshold
</span><span>        newCap = oldThr;
</span><span>    </span><span style="color:#b48ead;">else </span><span>{               </span><span style="color:#65737e;">// zero initial threshold signifies using defaults
</span><span>        newCap = </span><span style="color:#d08770;">DEFAULT_INITIAL_CAPACITY</span><span>;
</span><span>        newThr = (</span><span style="color:#b48ead;">int</span><span>)(</span><span style="color:#d08770;">DEFAULT_LOAD_FACTOR </span><span>* </span><span style="color:#d08770;">DEFAULT_INITIAL_CAPACITY</span><span>);
</span><span>    }
</span><span>    </span><span style="color:#b48ead;">if </span><span>(newThr == </span><span style="color:#d08770;">0</span><span>) {
</span><span>        </span><span style="color:#b48ead;">float</span><span> ft = (</span><span style="color:#b48ead;">float</span><span>)newCap * loadFactor;
</span><span>        newThr = (newCap &lt; </span><span style="color:#d08770;">MAXIMUM_CAPACITY </span><span>&amp;&amp; ft &lt; (</span><span style="color:#b48ead;">float</span><span>)</span><span style="color:#d08770;">MAXIMUM_CAPACITY </span><span>?
</span><span>                  (</span><span style="color:#b48ead;">int</span><span>)ft : </span><span style="color:#ebcb8b;">Integer</span><span>.</span><span style="color:#d08770;">MAX_VALUE</span><span>);
</span><span>    }
</span><span>    threshold = newThr;
</span><span>    @</span><span style="color:#bf616a;">SuppressWarnings</span><span>({&quot;</span><span style="color:#a3be8c;">rawtypes</span><span>&quot;,&quot;</span><span style="color:#a3be8c;">unchecked</span><span>&quot;})
</span><span>    </span><span style="color:#ebcb8b;">Node</span><span>&lt;</span><span style="color:#ebcb8b;">K</span><span>,</span><span style="color:#ebcb8b;">V</span><span>&gt;</span><span style="color:#b48ead;">[]</span><span> newTab = (</span><span style="color:#ebcb8b;">Node</span><span>&lt;</span><span style="color:#ebcb8b;">K</span><span>,</span><span style="color:#ebcb8b;">V</span><span>&gt;</span><span style="color:#b48ead;">[]</span><span>)</span><span style="color:#b48ead;">new </span><span style="color:#ebcb8b;">Node</span><span>[newCap];
</span><span>    table = newTab;
</span><span>    </span><span style="color:#b48ead;">if </span><span>(oldTab != </span><span style="color:#d08770;">null</span><span>) {
</span><span>        </span><span style="color:#b48ead;">for </span><span>(</span><span style="color:#b48ead;">int</span><span> j = </span><span style="color:#d08770;">0</span><span>; j &lt; oldCap; ++j) {
</span><span>            </span><span style="color:#ebcb8b;">Node</span><span>&lt;</span><span style="color:#ebcb8b;">K</span><span>,</span><span style="color:#ebcb8b;">V</span><span>&gt; e;
</span><span>            </span><span style="color:#b48ead;">if </span><span>((e = oldTab[j]) != </span><span style="color:#d08770;">null</span><span>) {
</span><span>                oldTab[j] = </span><span style="color:#d08770;">null</span><span>;
</span><span>                </span><span style="color:#b48ead;">if </span><span>(e.next == </span><span style="color:#d08770;">null</span><span>)
</span><span>                    newTab[e.hash &amp; (newCap - </span><span style="color:#d08770;">1</span><span>)] = e;
</span><span>                </span><span style="color:#b48ead;">else if </span><span>(e instanceof </span><span style="color:#ebcb8b;">TreeNode</span><span>)
</span><span>                    ((</span><span style="color:#ebcb8b;">TreeNode</span><span>&lt;</span><span style="color:#ebcb8b;">K</span><span>,</span><span style="color:#ebcb8b;">V</span><span>&gt;)e).</span><span style="color:#bf616a;">split</span><span>(</span><span style="color:#bf616a;">this</span><span>, newTab, j, oldCap);
</span><span>                </span><span style="color:#b48ead;">else </span><span>{ </span><span style="color:#65737e;">// preserve order
</span><span>                    </span><span style="color:#ebcb8b;">Node</span><span>&lt;</span><span style="color:#ebcb8b;">K</span><span>,</span><span style="color:#ebcb8b;">V</span><span>&gt; loHead = </span><span style="color:#d08770;">null</span><span>, loTail = </span><span style="color:#d08770;">null</span><span>;
</span><span>                    </span><span style="color:#ebcb8b;">Node</span><span>&lt;</span><span style="color:#ebcb8b;">K</span><span>,</span><span style="color:#ebcb8b;">V</span><span>&gt; hiHead = </span><span style="color:#d08770;">null</span><span>, hiTail = </span><span style="color:#d08770;">null</span><span>;
</span><span>                    </span><span style="color:#ebcb8b;">Node</span><span>&lt;</span><span style="color:#ebcb8b;">K</span><span>,</span><span style="color:#ebcb8b;">V</span><span>&gt; next;
</span><span>                    </span><span style="color:#b48ead;">do </span><span>{
</span><span>                        next = e.next;
</span><span>                        </span><span style="color:#b48ead;">if </span><span>((e.hash &amp; oldCap) == </span><span style="color:#d08770;">0</span><span>) {
</span><span>                            </span><span style="color:#b48ead;">if </span><span>(loTail == </span><span style="color:#d08770;">null</span><span>)
</span><span>                                loHead = e;
</span><span>                            </span><span style="color:#b48ead;">else
</span><span>                                loTail.next = e;
</span><span>                            loTail = e;
</span><span>                        }
</span><span>                        </span><span style="color:#b48ead;">else </span><span>{
</span><span>                            </span><span style="color:#b48ead;">if </span><span>(hiTail == </span><span style="color:#d08770;">null</span><span>)
</span><span>                                hiHead = e;
</span><span>                            </span><span style="color:#b48ead;">else
</span><span>                                hiTail.next = e;
</span><span>                            hiTail = e;
</span><span>                        }
</span><span>                    } </span><span style="color:#b48ead;">while </span><span>((e = next) != </span><span style="color:#d08770;">null</span><span>);
</span><span>                    </span><span style="color:#b48ead;">if </span><span>(loTail != </span><span style="color:#d08770;">null</span><span>) {
</span><span>                        loTail.next = </span><span style="color:#d08770;">null</span><span>;
</span><span>                        newTab[j] = loHead;
</span><span>                    }
</span><span>                    </span><span style="color:#b48ead;">if </span><span>(hiTail != </span><span style="color:#d08770;">null</span><span>) {
</span><span>                        hiTail.next = </span><span style="color:#d08770;">null</span><span>;
</span><span>                        newTab[j + oldCap] = hiHead;
</span><span>                    }
</span><span>                }
</span><span>            }
</span><span>        }
</span><span>    }
</span><span>    </span><span style="color:#b48ead;">return</span><span> newTab;
</span><span>}
</span></code></pre>
<p>é‚£å°±çœ‹ä¸‹å®ƒçš„æ‰©å®¹åŸç†å§ã€‚é¦–å…ˆå‘¢ï¼Œå¦‚å‰é¢è¯´æ‰€ï¼Œå®ƒå¼€å§‹å°±åˆ›å»ºäº†ä¸€ä¸ª<code>table[]</code>ã€‚å°†è¯¥æ•°ç»„çš„å¼•ç”¨èµ‹ç»™<code>oldTab</code>,</p>
<pre data-lang="java" style="background-color:#2b303b;color:#c0c5ce;" class="language-java "><code class="language-java" data-lang="java"><span> </span><span style="color:#ebcb8b;">Node</span><span>&lt;</span><span style="color:#ebcb8b;">K</span><span>,</span><span style="color:#ebcb8b;">V</span><span>&gt;</span><span style="color:#b48ead;">[]</span><span> oldTab = table;
</span></code></pre>
<p>æ³¨æ„è¿™é‡Œè¿™ä¸ªæ•°ç»„é¦–æ¬¡å®šä¹‰å¹¶éåœ¨è¿™ä¸ªæ–¹æ³•ä¸­ï¼Œè€Œæ˜¯åœ¨<code>HashMap</code>æºç ä¸­æœ‰åšçš„ä¸€ä¸ªå®šä¹‰ï¼Œ<strong>å®ƒä¹Ÿæ˜¯ä¸å¯è¢«åºåˆ—åŒ–çš„</strong>ã€‚æ¥ç€ä¼šå…ˆåˆ¤æ–­è¯¥<code>table</code>æ˜¯å¦æ˜¯é¦–æ¬¡åˆ›å»ºï¼Œå¦‚æœæ˜¯ï¼Œç›´æ¥åˆå§‹åŒ–ä¸º0ï¼Œå¦åˆ™å°±æ˜¯<code>oldTab</code>çš„å¤§å°ï¼Œä¸ºä»€ä¹ˆä¼šè¿™ä¹ˆè¯´å‘¢ï¼Œå› ä¸ºè¿™ä¸ª<code>resize()</code>æ–¹æ³•å¯ä¸åªæ˜¯æ‰§è¡Œè¿™ä¸€æ¬¡ï¼Œåœ¨<code>putVal()</code>æ–¹æ³•çš„åç»­çš„é€»è¾‘ä¸­è¿˜ä¼šç”¨åˆ°ï¼Œä¹Ÿå°±æ˜¯ä¼šå‡ºç°å†æ¬¡æ‰©å®¹çš„æƒ…å†µï¼Œé‚£ä¹ˆå­˜åœ¨ä¸€ä¸ª<code>oldTab</code>çš„å€¼ä¹Ÿå°±ä¸éš¾ç†è§£äº†å§ã€‚</p>
<p>å¦‚æœ<code>oldCap&gt;0</code>ï¼Œè¿›ä¸€æ­¥åˆ¤æ–­å®ƒæ˜¯å¦<code>&gt;=</code>æœ€å¤§å®¹é‡<code>MAXNUM_CAPACITY</code>,å…³äº<code>MAXNUM_CAPACITY</code>çš„å®šä¹‰å¦‚ä¸‹</p>
<pre data-lang="java" style="background-color:#2b303b;color:#c0c5ce;" class="language-java "><code class="language-java" data-lang="java"><span style="color:#65737e;">//MAXIMUM_CAPACITYå®šä¹‰
</span><span style="color:#b48ead;">static final int </span><span style="color:#d08770;">MAXIMUM_CAPACITY </span><span>= </span><span style="color:#d08770;">1 </span><span>&lt;&lt; </span><span style="color:#d08770;">30</span><span>;
</span></code></pre>
<p>å¦‚æœè¯¥æ¡ä»¶æˆç«‹ï¼Œä¼šç»™<code>threshod</code>é‡æ–°èµ‹ä¸€ä¸ªæ–°çš„å®¹é‡å€¼ï¼Œå³<code>Integer</code>çš„ä¸Šé™ï¼Œåä¹‹è¿›å…¥ä¸‹ä¸€ä¸ªåˆ¤æ–­<code> ((newCap = oldCap &lt;&lt; 1) &lt; MAXIMUM_CAPACITY &amp;&amp;oldCap &gt;= DEFAULT_INITIAL_CAPACITY)</code>,å°†<code>oldCap</code>å·¦ç§»1ä½,ä¹Ÿå°±æ˜¯ä¸¤å€çš„<code>oldCap</code>èµ‹ç»™ä¸€ä¸ªæ–°çš„å˜é‡<code>newCap</code>,å¦‚æœè¯¥å€¼å°äº<code>MAXNUM_CAPACITY</code>å¹¶ä¸”åŸæ¥çš„å®¹é‡<code>oldCap</code>å¤§äºç­‰äºåˆå§‹é»˜è®¤å®¹é‡å€¼<code>DEFAULT_INITIAL_CAPACITY</code>çš„è¯ï¼Œå°±å°†æ–°çš„<code>newThr</code>æ‰©ä¸ºåŸæ¥(<code>oldThr</code>)çš„ä¸¤å€å¤§å°ã€‚</p>
<pre data-lang="java" style="background-color:#2b303b;color:#c0c5ce;" class="language-java "><code class="language-java" data-lang="java"><span style="color:#65737e;">//DEFAULT_INITIAL_CAPACITYå®šä¹‰
</span><span style="color:#b48ead;">static final int </span><span style="color:#d08770;">DEFAULT_INITIAL_CAPACITY </span><span>= </span><span style="color:#d08770;">1 </span><span>&lt;&lt; </span><span style="color:#d08770;">4</span><span>; </span><span style="color:#65737e;">// aka 16
</span><span style="color:#65737e;">//1&lt;&lt;4ç­‰ä»·äº1X2^4=2x2x2x2=16
</span></code></pre>
<blockquote>
<p><strong>è¿™é‡Œå…ˆå¯¹ä¸Šé¢æºç ä¸­æ¶‰åŠåˆ°çš„å‡ ä¸ªå˜é‡ç®€å•è¯´æ˜ä¸€ä¸‹</strong>ï¼Œ<strong>ä¸ç„¶é¢‘ç¹çš„<code>=</code>èµ‹å€¼æ“ä½œä¸€æ³¢åˆä¸€æ³¢ï¼Œå¯èƒ½ä¼šç»™æ•´æ‡µåœˆã€‚</strong></p>
<ol>
<li><code>oldCap</code>:æ•°ç»„åŸå…ˆ(å‡†å¤‡æ‰©å®¹ä¹‹å‰)çš„å®¹é‡ã€‚</li>
<li><code>oldThr</code>ï¼šå…¶å®å°±æ˜¯<code>threshold</code>çš„ä¸€ä¸ªæš‚å­˜å±€éƒ¨å˜é‡ï¼Œç”¨æ¥æš‚å­˜<code>threshold</code>çš„å€¼ã€‚</li>
<li><code>threshold</code>ï¼šè¿™æ˜¯ä¸€ä¸ªå®šä¹‰åœ¨<code>HashMap</code>çš„çš„å…¨å±€å˜é‡(<strong>å¯ä»¥è¿™ä¹ˆè¯´ï¼Œå®é™…ä¸Š<code>Java</code>ä¸­æ²¡æœ‰å…¨å±€å˜é‡è¿™ç§æ¦‚å¿µ</strong>),å®ƒç”¨æ¥å­˜æ”¾<code>table[]</code>çš„ä¸€ä¸ªå®¹é‡å€¼ï¼Œæˆ–è€…è¯´<strong>é˜ˆå€¼</strong>ã€‚æ‰€ä»¥æœ€ç»ˆå†³å®šæ˜¯å¦éœ€è¦æ‰©å®¹å–å†³äºè¿™ä¸ªå…¨å±€å˜é‡æ¥åˆ¤æ–­ã€‚</li>
<li><code>newCap</code>:åŒç†äº<code>oldCap</code>ã€‚</li>
</ol>
</blockquote>
<p>ç»§ç»­å›åˆ°æœ€å¤–å±‚<code>if</code>åˆ¤æ–­çš„<code>else if</code>é€»è¾‘ä¸­ï¼Œè¿™é‡Œå…ˆæ˜¯å¯¹<code>newThr</code>æ˜¯å¦å¤§äº0ä½œäº†åˆ¤æ–­ï¼Œå¦‚æœ<code>&gt;0</code>æˆç«‹ï¼Œé‚£ä¹ˆæ–°çš„å®¹é‡<code>newCap</code>çš„å€¼æ²¿ç”¨<code>oldThr</code>,å¦åˆ™å°†ä¼šæ‰§è¡Œä¸‹é¢è¿™æ®µä»£ç ,<code>newCap</code>çš„å€¼é»˜è®¤è®¾ç½®ä¸º<code>DEFAULT_INITIAL_CAPACITY</code>ä¹Ÿå°±æ˜¯<code>16</code>,å¹¶ä¸”<code>newThr</code>çš„å€¼æ›´æ–°ä¸º<code>(int)(DEFAULT_LOAD_FACTOR * DEFAULT_INITIAL_CAPACITY);</code>ã€‚è¿™é‡Œå‚ä¸<code>*</code>è¿ç®—çš„é™¤äº†åˆå§‹é»˜è®¤å®¹é‡<code>DEFAULT_INITIAL_CAPACITY</code>å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªé‡è¦çš„å¸¸é‡å‚æ•°<code>DEFAULT_LOAD_FACTOR</code>ï¼Œæˆ‘ä»¬ç§°ä¸º<strong>è´Ÿè½½å› å­</strong>ï¼Œæ¢å¥è¯è¯´ï¼Œè¿™ä¸ªå› å­çš„å€¼å†³å®šäº†ä½ æ¯æ¬¡æ‰©å®¹çš„å…·ä½“å¤§å°ã€‚å®ƒæ˜¯é»˜è®¤å€¼ä¸º<code>0.75</code>,ä¹Ÿå°±æ˜¯è¯´å½“æˆ‘ä»¬æ•°ç»„å ç”¨é‡è¾¾åˆ°æœ¬èº«å®¹é‡çš„75%æ—¶ï¼Œå°±ä¼šè§¦å‘é¦–æ¬¡æ‰©å®¹(<code>resize</code>)æ“ä½œã€‚å½“ç„¶ï¼Œæœ€åè¿˜è¿›è¡Œäº†å¼ºåˆ¶ç±»å‹è½¬æ¢ä¸º<code>int</code>ã€‚</p>
<p>æ‰€ä»¥ä¸éš¾ç†è§£ï¼Œå¦‚æœæˆ‘ä»¬æ˜¯é¦–æ¬¡ä½¿ç”¨<code>HashMap</code>è¿›è¡Œ<code>put</code>æ“ä½œï¼Œæ–¹æ³•ä¼šç›´æ¥è¿›å…¥è¿™ä¸€æ­¥è¿›è¡Œåˆå§‹åŒ–ã€‚</p>
<pre data-lang="java" style="background-color:#2b303b;color:#c0c5ce;" class="language-java "><code class="language-java" data-lang="java"><span style="color:#b48ead;">else </span><span>{</span><span style="color:#65737e;">// zero initial threshold signifies using defaults
</span><span>    newCap = </span><span style="color:#d08770;">DEFAULT_INITIAL_CAPACITY</span><span>;
</span><span>    newThr = (</span><span style="color:#b48ead;">int</span><span>)(</span><span style="color:#d08770;">DEFAULT_LOAD_FACTOR </span><span>* </span><span style="color:#d08770;">DEFAULT_INITIAL_CAPACITY</span><span>);
</span><span>}
</span></code></pre>
<blockquote>
<p>å…·ä½“ä¸€ç‚¹è¯´ï¼Œå½“é˜ˆå€¼è¾¾åˆ°<code>16*0.75</code>æ—¶ï¼Œä¹Ÿå³æ˜¯16å¤§å°çš„å®¹é‡ç”¨æ‰äº†12ä¸ªå¤§å°æ—¶å°±ä¼šè§¦å‘é¦–æ¬¡<code>resize</code>ã€‚</p>
</blockquote>
<p>è¿™ä¸ª<strong>è´Ÿè½½å› å­</strong>ä¸æ˜¯å›ºå®šä¸å˜çš„ï¼Œè€Œä¸”æœ‰ä¸€ç‚¹éœ€è¦è¯´æ˜çš„æ˜¯ï¼Œè¿™ä¸ª<code>resize()</code>æ–¹æ³•ä¸­ï¼Œ<strong>è´Ÿè½½å› å­æ˜¯å¯ä»¥æ‰‹åŠ¨ä¼ å…¥çš„</strong>ï¼Œè¿™ä¸€ç‚¹åœ¨<code>HashMap</code>çš„å¦ä¸€ä¸ªæ„é€ æ–¹æ³•ä¸­æœ‰ä½“ç°ï¼Œå½“ç„¶ï¼Œè¿™ä¸ªåé¢å†è¯´ã€‚è¿™é‡Œä¸»è¦è®²çš„è¿˜æ˜¯æ— å‚æ„é€ å™¨çš„æ‰§è¡ŒåŸç†ï¼Œä½ éœ€è¦ç†è§£<code>resize()</code>æ–¹æ³•çš„ä¸¤ä¸ªä¸»è¦ä½œç”¨ï¼Œç¬¬ä¸€ä¸ªå°±æ˜¯ä¸Šé¢å·´æ‹‰å·´æ‹‰è¿™ä¸€å †ï¼Œ<strong>ä¸»è¦æ˜¯ç”¨æ¥å¯¹æ•°ç»„è¿›è¡Œåˆå§‹åŒ–å·¥ä½œ</strong>(å½“ç„¶ï¼Œä½ ä¹Ÿå¯ä»¥ç†è§£ä¸ºé¦–æ¬¡æ‰©å®¹ï¼Œè¿™åªæ˜¯ä¸€ç§è¯´æ³•è€Œå·²ï¼Œä¸€èˆ¬æˆ‘ä»¬ä¼šå°†é¦–æ¬¡æ‰©å®¹ç§°ä¸ºåˆå§‹åŒ–ï¼Œå› ä¸ºå…¶å®<strong>æ‰©å®¹çš„æ¦‚å¿µæ˜¯å»ºç«‹åœ¨å·²æœ‰å®¹é‡çš„åŸºç¡€ä¸Šçš„</strong>)ï¼Œè€Œæ­¤åå†è°ƒç”¨<code>resize()</code>å°±æ‰§è¡Œçš„æ˜¯æ‰©å®¹å·¥ä½œäº†ï¼Œä½†å®ƒçš„æ‰©å®¹å·¥ä½œå¯æ²¡æœ‰åˆå§‹åŒ–è¿™ä¹ˆç®€å•ã€‚</p>
<p>ä½†ä¸ºäº†èƒ½æ›´æ¸…æ™°çš„ç†è§£ï¼Œæˆ‘ä»¬è¿˜æ˜¯ç»§ç»­é¦–æ¬¡<code>put</code>æ“ä½œçš„ä¸»çº¿è¿›è¡Œåˆ†æã€‚æ¥ç€ä¸Šé¢è¯´ï¼Œåˆå§‹åŒ–ç»“æŸä¹‹åï¼Œä¼šå¾—åˆ°ä¸€ä¸ªåˆå§‹çš„é˜ˆå€¼<code>newThr=16</code>,å¹¶å°†è¯¥é˜ˆå€¼é‡æ–°èµ‹ç»™å…¨å±€<code>threshold</code>ä¿å­˜ã€‚è®¡ç®—å‡º<code>table[]</code>çš„ä¸€ä¸ªåˆå§‹å¤§å°ä¹‹åï¼Œåˆ©ç”¨è¯¥å€¼ç›´æ¥åˆ›å»ºä¸€ä¸ªå¤§å°ä¸º<code>newCap</code>çš„æ–°çš„<code>newTab</code>ç»™<code>table</code>è¿”å›ï¼Œæœ‰äº†è¿™ä¸ª<code>table</code>ï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨é‡Œé¢å­˜æ”¾å…ƒç´ äº†ï¼Œæ¯”å¦‚å­˜æ”¾ä¸€ä¸ªå­—ç¬¦ä¸²<code>Java</code>ã€‚</p>
<pre data-lang="java" style="background-color:#2b303b;color:#c0c5ce;" class="language-java "><code class="language-java" data-lang="java"><span>threshold = newThr;
</span><span>@</span><span style="color:#bf616a;">SuppressWarnings</span><span>({&quot;</span><span style="color:#a3be8c;">rawtypes</span><span>&quot;,&quot;</span><span style="color:#a3be8c;">unchecked</span><span>&quot;})
</span><span style="color:#ebcb8b;">Node</span><span>&lt;</span><span style="color:#ebcb8b;">K</span><span>,</span><span style="color:#ebcb8b;">V</span><span>&gt;</span><span style="color:#b48ead;">[]</span><span> newTab = (</span><span style="color:#ebcb8b;">Node</span><span>&lt;</span><span style="color:#ebcb8b;">K</span><span>,</span><span style="color:#ebcb8b;">V</span><span>&gt;</span><span style="color:#b48ead;">[]</span><span>)</span><span style="color:#b48ead;">new </span><span style="color:#ebcb8b;">Node</span><span>[newCap];
</span><span>table = newTab;
</span></code></pre>
<p>ä½†å…‰æ˜¯åˆå§‹åŒ–ä¸€ä¸ª16å¤§å°çš„<code>table</code>æ˜¯è¿œè¿œä¸å¤Ÿçš„ã€‚æˆ‘ä»¬çŸ¥é“ï¼Œæ—¢ç„¶æ˜¯æ•°ç»„é‡Œé¢å­˜æ”¾å…ƒç´ ï¼Œæ˜¯éœ€è¦ä¸€ä¸ªç´¢å¼•çš„ï¼Œæ ¹æ®è¿™ä¸ªç´¢å¼•å»æ‰¾åˆ°ä¸€ä¸ªå¯¹åº”çš„ä½ç½®ï¼Œå†å°†è¯¥å…ƒç´ è¦†ç›–ä¸Šå»ï¼Œå®Œæˆå…ƒç´ çš„æ·»åŠ ã€‚</p>
<p>æ‰€ä»¥æˆ‘ä»¬å…ˆå›åˆ°ä¸Šä¸€ä¸ªæ–¹æ³•<code>putVal()</code>æ–¹æ³•ï¼šæ¥ç€ä¸Šé¢åˆ‡å…¥è¿›æ¥çš„<code>resize()</code>æ–¹æ³•ä¹‹åè®²è§£ã€‚</p>
<pre data-lang="java" style="background-color:#2b303b;color:#c0c5ce;" class="language-java "><code class="language-java" data-lang="java"><span style="color:#b48ead;">if </span><span>((tab = table) == </span><span style="color:#d08770;">null </span><span>|| (n = tab.length) == </span><span style="color:#d08770;">0</span><span>)
</span><span>    n = (tab = </span><span style="color:#bf616a;">resize</span><span>()).length;
</span></code></pre>
<blockquote>
<p>ä¸Šé¢è¿™ä¸¤è¡Œä»£ç ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬ä¸Šé¢åˆšåˆšè®²å®Œçš„åˆå§‹åŒ–æ“ä½œçš„éƒ¨åˆ†ã€‚</p>
</blockquote>
<p>çœ‹ä¸€ä¸‹ï¼Œåœ¨å¯¹<code>table</code>è¿›è¡Œäº†åˆå§‹åŒ–ï¼Œå¹¶è®¡ç®—å¾—åˆ°<code>key</code>çš„<code>hash</code>ä¹‹åï¼Œåç»­çš„ä»£ç é€»è¾‘åˆ†è§£ï¼š</p>
<pre data-lang="java" style="background-color:#2b303b;color:#c0c5ce;" class="language-java "><code class="language-java" data-lang="java"><span style="color:#b48ead;">if </span><span>((p = tab[i = (n - </span><span style="color:#d08770;">1</span><span>) &amp; hash]) == </span><span style="color:#d08770;">null</span><span>)
</span><span>    tab[i] = </span><span style="color:#bf616a;">newNode</span><span>(hash, key, value, </span><span style="color:#d08770;">null</span><span>);
</span></code></pre>
<p>è¿™é‡Œå°±æ˜¯æ ¹æ®<code>hash</code>å€¼è®¡ç®—ä¸€ä¸ªç´¢å¼•<code>i</code>ã€‚æ–¹æ³•æ˜¯<code>(n-1) &amp; hash</code>,åœ¨è·å¾—ç´¢å¼•ä¹‹åï¼Œæ£€æŸ¥è¯¥ç´¢å¼•ä½ç½®çš„å€¼<code>tab[i]</code>èµ‹ç»™å˜é‡<code>p</code>å¹¶åˆ¤æ–­æ˜¯å¦ä¸º<code>null</code>ï¼Œå¦‚æœä¸º<code>null</code>è¡¨ç¤ºæ²¡æœ‰è¢«ä½¿ç”¨ï¼Œåé¢ä¸€å¥<code>tab[i] = newNode(hash, key, value, null);</code>ç›´æ¥å°†å…ƒç´ <code>key</code>å­˜è¿›å»,å½“ç„¶ï¼Œå­˜å…¥çš„å…ƒç´ é™¤äº†æˆ‘ä»¬è‡ªå·±ä¼ å…¥çš„æ•°æ®ä¹‹å¤–ï¼Œè¿˜æœ‰è®¡ç®—å‡ºæ¥çš„<code>hash</code>å’Œä¸€ä¸ª<code>value</code>ï¼Œä¼ å…¥<code>hash</code>ä¸»è¦æ˜¯ä¸ºäº†<strong>ä¸‹ä¸€æ¬¡è®¡ç®—ï¼Œç”¨æ¥ç¡®å®šä¸‹æ¬¡ä¼ å…¥çš„å€¼æ˜¯å¦ä¸ºé‡å¤å…ƒç´ ã€‚<strong>è‡³äºå…¶ä¸­è¿˜æœ‰ä¸€ä¸ªå€¼ä¸º<code>null</code>çš„å€¼ï¼Œè¡¨ç¤º</strong>é“¾è¡¨çš„ä¸‹ä¸€ä¸ªç»“ç‚¹æŒ‡å‘</strong>ï¼Œå½“ç„¶ï¼Œè¿™é‡Œæ˜¯é¦–æ¬¡<code>put</code>ï¼Œæ‰€ä»¥<code>next</code>æ˜¯ä¸å­˜åœ¨çš„ï¼Œä¹Ÿå°±æ˜¯<code>null</code>ã€‚å½“ä¸Šé¢è¿™æ®µä»£ç æ‰§è¡Œå®Œæ¯•ä¹‹åï¼Œå…ƒç´ å°±è¢«æˆåŠŸæ·»åŠ åˆ°<code>table</code>ä¸­äº†ã€‚</p>
<p><img src="C:/Users/22170/AppData/Roaming/Typora/typora-user-images/image-20220325162444469.png" alt="image-20220325162444469" loading="lazy" decoding="async" /></p>
<blockquote>
<p>é€šè¿‡<code>debug</code>å¯ä»¥çœ‹åˆ°,<code>key</code>è®¡ç®—å‡ºçš„<code>hash=2301537</code>.é‚£ä¹ˆè¿™ä¸ªç´¢å¼•å°±å¯ä»¥æ ¹æ®<code>(16-1)&amp;2301537</code>è®¡ç®—å‡ºæ¥ï¼Œå®ƒçš„å€¼æ˜¯ä¸º<code>1</code>çš„ï¼Œä¹Ÿå°±æ˜¯æ•°ç»„ä¸­ç¬¬äºŒä¸ªä½ç½®çš„ç´¢å¼•ã€‚</p>
</blockquote>
<p><img src="C:/Users/22170/AppData/Roaming/Typora/typora-user-images/image-20220325162819682.png" alt="image-20220325162819682" loading="lazy" decoding="async" /></p>
<p>å…ƒç´ æ·»åŠ ä¹‹åï¼Œç¨‹åºé€»è¾‘ä¼šç›´æ¥æ‰§è¡Œåˆ°ä¸‹é¢çš„ä»£ç </p>
<pre data-lang="java" style="background-color:#2b303b;color:#c0c5ce;" class="language-java "><code class="language-java" data-lang="java"><span>++modCount;
</span><span style="color:#b48ead;">if </span><span>(++size &gt; threshold)
</span><span>    </span><span style="color:#bf616a;">resize</span><span>();
</span><span style="color:#bf616a;">afterNodeInsertion</span><span>(evict);
</span><span style="color:#b48ead;">return </span><span style="color:#d08770;">null</span><span>;
</span></code></pre>
<p>å…¶ä¸­çš„<code>++modCount</code>æˆ‘åœ¨<code>ArrayList</code>æºç åˆ†æçš„æ–‡ç« ä¸­å·²ç»æè¿‡ï¼Œä»–ä»¬çš„ä½œç”¨æ˜¯ä¸€æ ·çš„ã€‚åˆ¤æ–­<code>if (++size &gt; threshold)</code>ï¼Œå¦‚æœæ·»åŠ å…ƒç´ ä¹‹åçš„æ•°ç»„å®¹é‡<code>&gt;</code>ç›®å‰çš„é˜ˆå€¼<code>threshold</code>ï¼Œä¼šè§¦å‘<code>resize()</code>ã€‚å…³äº<code>afterNodeInsertion(evict);</code>æ–¹æ³•ï¼Œæ˜¯<code>HashMap</code>ç•™ç»™å®ƒçš„å­ç±»å»å®ç°çš„ä¸€ä¸ªæ–¹æ³•ï¼Œæ‰€ä»¥å®ƒæ˜¯ä¸ªç©ºçš„æ–¹æ³•ã€‚ç±»ä¼¼çš„æ–¹æ³•è¿˜æœ‰ï¼š</p>
<pre data-lang="java" style="background-color:#2b303b;color:#c0c5ce;" class="language-java "><code class="language-java" data-lang="java"><span style="color:#65737e;">// Callbacks to allow LinkedHashMap post-actions
</span><span>void </span><span style="color:#bf616a;">afterNodeAccess</span><span>(</span><span style="color:#ebcb8b;">Node</span><span>&lt;</span><span style="color:#ebcb8b;">K</span><span>,</span><span style="color:#ebcb8b;">V</span><span>&gt; p) { }
</span><span>void </span><span style="color:#bf616a;">afterNodeInsertion</span><span>(</span><span style="color:#b48ead;">boolean</span><span> evict) { }
</span><span>void </span><span style="color:#bf616a;">afterNodeRemoval</span><span>(</span><span style="color:#ebcb8b;">Node</span><span>&lt;</span><span style="color:#ebcb8b;">K</span><span>,</span><span style="color:#ebcb8b;">V</span><span>&gt; p) { }
</span></code></pre>
<p>æ¥ç€<code>putVal()</code>æ–¹æ³•æœ€åè¿”å›ä¸€ä¸ª<code>null</code>ä½œä¸ºæ–¹æ³•çš„ç»“æŸã€‚<strong>æ‰€ä»¥è¿˜è®°å¾—å‰é¢ç•™çš„ä¸€ä¸ªé—®é¢˜å—</strong>ï¼Ÿåœ¨<code>HashSet</code>æºç ä¸­çš„<code>add()</code>æ–¹æ³•çš„æ–¹æ³•ä½“é‡Œé¢ï¼Œå®ƒçš„è¿”å›å€¼æ˜¯åˆ¤æ–­æ˜¯å¦ä¸º<code>null</code>,å†çœ‹ä¸€ä¸‹å§è¿˜æ˜¯ã€‚</p>
<pre data-lang="java" style="background-color:#2b303b;color:#c0c5ce;" class="language-java "><code class="language-java" data-lang="java"><span style="color:#b48ead;">public boolean </span><span style="color:#bf616a;">add</span><span>(</span><span style="color:#ebcb8b;">E</span><span> e) {
</span><span>    </span><span style="color:#b48ead;">return</span><span> map.</span><span style="color:#bf616a;">put</span><span>(e, </span><span style="color:#d08770;">PRESENT</span><span>)==</span><span style="color:#d08770;">null</span><span>;
</span><span>}
</span></code></pre>
<p>è¡¨ç¤ºæ‰§è¡Œ<code>HashSet</code>ä¸­çš„<code>add()</code>æ–¹æ³•æ·»åŠ ä¸€ä¸ªå…ƒç´ ï¼Œå®ƒåº•å±‚å®é™…ä¸Šè°ƒç”¨äº†<code>HashMap</code>ä¸­çš„<code>put()</code>æ–¹æ³•å»å®ç°ï¼Œèƒ½å¦æ·»åŠ æˆåŠŸçš„ä¾æ®å°±æ˜¯è¯¥<code>put()</code>æ–¹æ³•æ˜¯å¦è¿”å›<code>null</code>,å¦‚æœæ˜¯ï¼Œ<code>HashSet</code>çš„<code>add()</code>æ–¹æ³•å°±è¿”å›ä¸€ä¸ª<code>true</code>,æœ€ç»ˆè¡¨ç¤ºç€æˆ‘ä»¬åˆ©ç”¨<code>HashSet</code>æˆåŠŸçš„æ·»åŠ äº†ä¸€ä¸ªå…ƒç´ ã€‚å¦åˆ™ï¼Œæ·»åŠ å¤±è´¥ï¼ï¼</p>
<hr />
<h6 id="-14">å»é‡åŸç†</h6>
<blockquote>
<p>åœ¨ç†è§£äº†<code>HashMap</code>åº•å±‚<code>table[]</code>çš„åˆå§‹åŒ–é€»è¾‘ä¹‹åï¼Œå½“æˆ‘ä»¬å‘å…¶ä¸­<code>put()</code>ç¬¬äºŒä¸ªå…ƒç´ æ—¶ï¼Œå®ƒçš„åº•å±‚æ˜¯å¦‚ä½•åˆ¤æ–­å…ƒç´ æ˜¯å¦é‡å¤çš„å‘¢ï¼Ÿä¸‹é¢å°±ä»¥è¿™ä¸ªé—®é¢˜ä¸ºä¸»çº¿å¼€å§‹åˆ†æã€‚</p>
</blockquote>
<p>ç”±äºåŒæ ·æ˜¯æ·»åŠ çš„æ“ä½œï¼Œå‰é¢çš„çš„å‡ ä¸ªæ­¥éª¤å°±ä¸å†èµ˜è¿°ï¼Œæ¯”å¦‚åº•å±‚è°ƒç”¨<code>map.put()</code>ï¼Œç„¶åæ˜¯<code>hash</code>çš„è®¡ç®—ã€‚ç›´æ¥è¿›å…¥<code>putVal()</code>æ–¹æ³•å¼€å§‹çœ‹ã€‚è¿™é‡Œå†è´´ä¸€éå®ƒçš„æºç ï¼š</p>
<pre data-lang="java" style="background-color:#2b303b;color:#c0c5ce;" class="language-java "><code class="language-java" data-lang="java"><span style="color:#b48ead;">final </span><span style="color:#ebcb8b;">V </span><span style="color:#bf616a;">putVal</span><span>(</span><span style="color:#b48ead;">int</span><span> hash, </span><span style="color:#ebcb8b;">K</span><span> key, </span><span style="color:#ebcb8b;">V</span><span> value, </span><span style="color:#b48ead;">boolean</span><span> onlyIfAbsent,</span><span style="color:#b48ead;">boolean</span><span> evict) {
</span><span>    </span><span style="color:#ebcb8b;">Node</span><span>&lt;</span><span style="color:#ebcb8b;">K</span><span>,</span><span style="color:#ebcb8b;">V</span><span>&gt;</span><span style="color:#b48ead;">[]</span><span> tab; </span><span style="color:#ebcb8b;">Node</span><span>&lt;</span><span style="color:#ebcb8b;">K</span><span>,</span><span style="color:#ebcb8b;">V</span><span>&gt; p; </span><span style="color:#b48ead;">int</span><span> n, i;
</span><span>    </span><span style="color:#b48ead;">if </span><span>((tab = table) == </span><span style="color:#d08770;">null </span><span>|| (n = tab.length) == </span><span style="color:#d08770;">0</span><span>)
</span><span>        n = (tab = </span><span style="color:#bf616a;">resize</span><span>()).length;
</span><span>    </span><span style="color:#b48ead;">if </span><span>((p = tab[i = (n - </span><span style="color:#d08770;">1</span><span>) &amp; hash]) == </span><span style="color:#d08770;">null</span><span>)
</span><span>        tab[i] = </span><span style="color:#bf616a;">newNode</span><span>(hash, key, value, </span><span style="color:#d08770;">null</span><span>);
</span><span>    </span><span style="color:#b48ead;">else </span><span>{
</span><span>        </span><span style="color:#ebcb8b;">Node</span><span>&lt;</span><span style="color:#ebcb8b;">K</span><span>,</span><span style="color:#ebcb8b;">V</span><span>&gt; e; </span><span style="color:#ebcb8b;">K</span><span> k;
</span><span>        </span><span style="color:#b48ead;">if </span><span>(p.hash == hash &amp;&amp;
</span><span>            ((k = p.key) == key || (key != </span><span style="color:#d08770;">null </span><span>&amp;&amp; key.</span><span style="color:#bf616a;">equals</span><span>(k))))
</span><span>            e = p;
</span><span>        </span><span style="color:#b48ead;">else if </span><span>(p instanceof </span><span style="color:#ebcb8b;">TreeNode</span><span>)
</span><span>            e = ((</span><span style="color:#ebcb8b;">TreeNode</span><span>&lt;</span><span style="color:#ebcb8b;">K</span><span>,</span><span style="color:#ebcb8b;">V</span><span>&gt;)p).</span><span style="color:#bf616a;">putTreeVal</span><span>(</span><span style="color:#bf616a;">this</span><span>, tab, hash, key, value);
</span><span>        </span><span style="color:#b48ead;">else </span><span>{
</span><span>            </span><span style="color:#b48ead;">for </span><span>(</span><span style="color:#b48ead;">int</span><span> binCount = </span><span style="color:#d08770;">0</span><span>; ; ++binCount) {
</span><span>                </span><span style="color:#b48ead;">if </span><span>((e = p.next) == </span><span style="color:#d08770;">null</span><span>) {
</span><span>                    p.next = </span><span style="color:#bf616a;">newNode</span><span>(hash, key, value, </span><span style="color:#d08770;">null</span><span>);
</span><span>                    </span><span style="color:#b48ead;">if </span><span>(binCount &gt;= </span><span style="color:#d08770;">TREEIFY_THRESHOLD </span><span>- </span><span style="color:#d08770;">1</span><span>) </span><span style="color:#65737e;">// -1 for 1st
</span><span>                        </span><span style="color:#bf616a;">treeifyBin</span><span>(tab, hash);
</span><span>                    </span><span style="color:#b48ead;">break</span><span>;
</span><span>                }
</span><span>                </span><span style="color:#b48ead;">if </span><span>(e.hash == hash &amp;&amp;
</span><span>                    ((k = e.key) == key || (key != </span><span style="color:#d08770;">null </span><span>&amp;&amp; key.</span><span style="color:#bf616a;">equals</span><span>(k))))
</span><span>                    </span><span style="color:#b48ead;">break</span><span>;
</span><span>                p = e;
</span><span>            }
</span><span>        }
</span><span>        </span><span style="color:#b48ead;">if </span><span>(e != </span><span style="color:#d08770;">null</span><span>) { </span><span style="color:#65737e;">// existing mapping for key
</span><span>            </span><span style="color:#ebcb8b;">V</span><span> oldValue = e.value;
</span><span>            </span><span style="color:#b48ead;">if </span><span>(!onlyIfAbsent || oldValue == </span><span style="color:#d08770;">null</span><span>)
</span><span>                e.value = value;
</span><span>            </span><span style="color:#bf616a;">afterNodeAccess</span><span>(e);
</span><span>            </span><span style="color:#b48ead;">return</span><span> oldValue;
</span><span>        }
</span><span>    }
</span><span>    ++modCount;
</span><span>    </span><span style="color:#b48ead;">if </span><span>(++size &gt; threshold)
</span><span>        </span><span style="color:#bf616a;">resize</span><span>();
</span><span>    </span><span style="color:#bf616a;">afterNodeInsertion</span><span>(evict);
</span><span>    </span><span style="color:#b48ead;">return </span><span style="color:#d08770;">null</span><span>;
</span><span>}
</span></code></pre>
<p>é‰´äºå‰é¢æˆ‘ä»¬åœ¨æ·»åŠ ç¬¬ä¸€ä¸ªå…ƒç´ <code>Java</code>çš„æ—¶å€™ï¼Œå·²ç»å®Œæˆäº†<code>table[]</code>çš„åˆå§‹åŒ–å·¥ä½œï¼Œæ‰€ä»¥ä¸‹é¢è¿™æ®µä»£ç ä¸ä¼šå†æ‰§è¡Œ;</p>
<pre data-lang="java" style="background-color:#2b303b;color:#c0c5ce;" class="language-java "><code class="language-java" data-lang="java"><span style="color:#b48ead;">if </span><span>((tab = table) == </span><span style="color:#d08770;">null </span><span>|| (n = tab.length) == </span><span style="color:#d08770;">0</span><span>) n = (tab = </span><span style="color:#bf616a;">resize</span><span>()).length;
</span></code></pre>
<p>è€Œæ˜¯ç›´æ¥å¸¦ç€å‰é¢è®¡ç®—å¾—æ¥å¾—<code>Hash</code>é€šè¿‡ä¸ä¹‹å‰åŒæ ·ç®—æ³•è®¡ç®—å‡ºå…ƒç´ <code>C++</code>(å‡è®¾è¿™æ˜¯æˆ‘ä»¬ç¬¬äºŒä¸ªæ·»åŠ çš„å…ƒç´ )åœ¨æ•°ç»„ä¸­çš„ç´¢å¼•ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<pre data-lang="java" style="background-color:#2b303b;color:#c0c5ce;" class="language-java "><code class="language-java" data-lang="java"><span style="color:#b48ead;">if </span><span>((p = tab[i = (n - </span><span style="color:#d08770;">1</span><span>) &amp; hash]) == </span><span style="color:#d08770;">null</span><span>) tab[i] = </span><span style="color:#bf616a;">newNode</span><span>(hash, key, value, </span><span style="color:#d08770;">null</span><span>);
</span></code></pre>
<blockquote>
<p>æ³¨æ„å“ˆï¼Œè¿™é‡Œçš„<code>n</code>åœ¨åˆå§‹åŒ–çš„æ—¶å€™å·²ç»è®¡ç®—å‡ºæ¥ï¼Œè¿˜æ˜¯ç­‰äº16çš„ï¼Œæ”¹å˜çš„æ˜¯<code>hash</code>å€¼ï¼Œå‡è®¾ä¸º<code>65762</code>ã€‚é‚£ä¹ˆæ ¹æ®ä¸Šè¿°ç®—æ³•è®¡ç®—å¾—åˆ°å®ƒçš„ç´¢å¼•ä¸º<code>15&amp;65762=2</code>ã€‚</p>
</blockquote>
<p>å¥½äº†ï¼Œæ—¢ç„¶ç´¢å¼•ä¹Ÿæœ‰äº†ï¼Œå¹¶ä¸”æˆ‘ä»¬æ·»åŠ çš„è¿™ä¸ªå…ƒç´ å’Œç¬¬ä¸€ä¸ªå…ƒç´ <code>Java</code>æ˜æ˜¾æ˜¯ä¸ç›¸ç­‰çš„ï¼Œæ‰€ä»¥ä¸ä¼šè¿›å…¥åˆ°<code>else if</code>åˆ¤æ–­ä¸­ï¼Œå› ä¸º<code>if</code>å·²ç»æˆç«‹ï¼Œåé¢çš„é€»è¾‘å°±æ˜¯å°†è¯¥å…ƒç´ å€¼ç›´æ¥æ·»åŠ åˆ°æ•°ç»„ä¸­ç´¢å¼•ä¸º<code>2</code>çš„ä½ç½®ï¼Œå½“ç„¶ï¼Œå…ƒç´ ä¹Ÿæ˜¯ä¸€ä¸ª<code>Node&lt;k,v&gt;</code>ç±»å‹ã€‚æ³¨æ„ï¼Œè¿™é‡Œå­˜å…¥å‚æ•°ä¸­çš„æœ€åä¸€ä¸ªå€¼ä¾æ—§è¿˜æ˜¯<code>null</code>ï¼Œå› ä¸ºå‰åä¸¤ä¸ªå…ƒç´ å¹¶æ²¡æœ‰å­˜æ”¾åœ¨åŒä¸€æ¡é“¾è¡¨ä¸Šï¼Œè‡ªç„¶ä¸ä¼šå‡ºç°åœ¨å°¾éƒ¨æŒ‚è½½çš„æƒ…å†µã€‚</p>
<blockquote>
<p>ä¸‹é¢å°†ä¼šè¿›è¡Œç¬¬ä¸‰ä¸ªå…ƒç´ çš„æ·»åŠ ï¼Œå‡è®¾æˆ‘ä»¬æ·»åŠ çš„å…ƒç´ æ˜¯<code>Java</code>,æ˜¯çš„ï¼Œå’Œ<strong>é¦–æ¬¡æ·»åŠ çš„å…ƒç´ æ˜¯ç›¸åŒçš„</strong>ï¼Œçœ‹ä¸€ä¸‹åº•å±‚å°†ä¼šå¦‚ä½•å¤„ç†ã€‚</p>
</blockquote>
<p>åŒæ ·æˆ‘ä»¬ç›´æ¥è·³åˆ°<code>putVal()</code>æ–¹æ³•ä¸­ã€‚ç¨‹åºé¦–å…ˆä¼šè¿›å…¥åˆ°ç¬¬äºŒä¸ª<code>if</code>åˆ¤æ–­é‡Œï¼Œå¼€å§‹è®¡ç®—ç´¢å¼•å¹¶ä½œåˆ¤æ–­ï¼Œä¹Ÿå°±æ˜¯ä¸‹é¢è¿™æ®µä»£ç ï¼š</p>
<pre data-lang="java" style="background-color:#2b303b;color:#c0c5ce;" class="language-java "><code class="language-java" data-lang="java"><span style="color:#b48ead;">if </span><span>((p = tab[i = (n - </span><span style="color:#d08770;">1</span><span>) &amp; hash]) == </span><span style="color:#d08770;">null</span><span>)
</span><span>    tab[i] = </span><span style="color:#bf616a;">newNode</span><span>(hash, key, value, </span><span style="color:#d08770;">null</span><span>);
</span></code></pre>
<p>æ³¨æ„äº†ï¼Œç”±äºé¦–æ¬¡è®¡ç®—å¾—å‡º<code>Java</code>å¯¹åº”çš„ç´¢å¼•ä¸º<code>2</code>,é‚£ä¹ˆè¿™æ¬¡çš„ç»“æœä¹Ÿæ˜¯ç›¸åŒçš„å€¼ï¼Œæ‰€ä»¥<code>if</code>ä¸­çš„æ¡ä»¶æ˜¾ç„¶ä¸å¯èƒ½æˆç«‹ï¼Œå› ä¸ºç´¢å¼•ä¸º<code>2</code>çš„ä½ç½®å·²ç»è¢«å ç”¨ï¼Œè‡ªç„¶ä¸ä¼šä¸º<code>null</code>ã€‚æ‰€ä»¥ç¨‹åºå°†ä¼šè¿›å…¥ä¸‹é¢çš„é€»è¾‘ä¸­ï¼š</p>
<pre data-lang="java" style="background-color:#2b303b;color:#c0c5ce;" class="language-java "><code class="language-java" data-lang="java"><span style="color:#b48ead;">else </span><span>{
</span><span>    </span><span style="color:#ebcb8b;">Node</span><span>&lt;</span><span style="color:#ebcb8b;">K</span><span>,</span><span style="color:#ebcb8b;">V</span><span>&gt; e; </span><span style="color:#ebcb8b;">K</span><span> k;
</span><span>    </span><span style="color:#b48ead;">if </span><span>(p.hash == hash &amp;&amp;
</span><span>        ((k = p.key) == key || (key != </span><span style="color:#d08770;">null </span><span>&amp;&amp; key.</span><span style="color:#bf616a;">equals</span><span>(k))))
</span><span>        e = p;
</span><span>    </span><span style="color:#b48ead;">else if </span><span>(p instanceof </span><span style="color:#ebcb8b;">TreeNode</span><span>)
</span><span>        e = ((</span><span style="color:#ebcb8b;">TreeNode</span><span>&lt;</span><span style="color:#ebcb8b;">K</span><span>,</span><span style="color:#ebcb8b;">V</span><span>&gt;)p).</span><span style="color:#bf616a;">putTreeVal</span><span>(</span><span style="color:#bf616a;">this</span><span>, tab, hash, key, value);
</span><span>    </span><span style="color:#b48ead;">else </span><span>{
</span><span>        </span><span style="color:#b48ead;">for </span><span>(</span><span style="color:#b48ead;">int</span><span> binCount = </span><span style="color:#d08770;">0</span><span>; ; ++binCount) {
</span><span>            </span><span style="color:#b48ead;">if </span><span>((e = p.next) == </span><span style="color:#d08770;">null</span><span>) {
</span><span>                p.next = </span><span style="color:#bf616a;">newNode</span><span>(hash, key, value, </span><span style="color:#d08770;">null</span><span>);
</span><span>                </span><span style="color:#b48ead;">if </span><span>(binCount &gt;= </span><span style="color:#d08770;">TREEIFY_THRESHOLD </span><span>- </span><span style="color:#d08770;">1</span><span>) </span><span style="color:#65737e;">// -1 for 1st
</span><span>                    </span><span style="color:#bf616a;">treeifyBin</span><span>(tab, hash);
</span><span>                </span><span style="color:#b48ead;">break</span><span>;
</span><span>            }
</span><span>            </span><span style="color:#b48ead;">if </span><span>(e.hash == hash &amp;&amp;
</span><span>                ((k = e.key) == key || (key != </span><span style="color:#d08770;">null </span><span>&amp;&amp; key.</span><span style="color:#bf616a;">equals</span><span>(k))))
</span><span>                </span><span style="color:#b48ead;">break</span><span>;
</span><span>            p = e;
</span><span>        }
</span><span>    }
</span><span>    </span><span style="color:#b48ead;">if </span><span>(e != </span><span style="color:#d08770;">null</span><span>) { </span><span style="color:#65737e;">// existing mapping for key
</span><span>        </span><span style="color:#ebcb8b;">V</span><span> oldValue = e.value;
</span><span>        </span><span style="color:#b48ead;">if </span><span>(!onlyIfAbsent || oldValue == </span><span style="color:#d08770;">null</span><span>)
</span><span>            e.value = value;
</span><span>        </span><span style="color:#bf616a;">afterNodeAccess</span><span>(e);
</span><span>        </span><span style="color:#b48ead;">return</span><span> oldValue;
</span><span>    }
</span><span>}
</span></code></pre>
<p>åˆæ˜¯ä¸€å †<code>if else if</code>å¥—å¨ƒæ“ä½œã€‚æŒ‰ç…§å®ƒçš„é¡ºåºï¼Œæˆ‘ä»¬å…ˆåˆ†æç¬¬ä¸€ä¸ª<code>if</code>çš„é€»è¾‘ï¼š</p>
<pre data-lang="java" style="background-color:#2b303b;color:#c0c5ce;" class="language-java "><code class="language-java" data-lang="java"><span style="color:#b48ead;">if </span><span>(p.hash == hash &amp;&amp;((k = p.key) == key || (key != </span><span style="color:#d08770;">null </span><span>&amp;&amp; key.</span><span style="color:#bf616a;">equals</span><span>(k))))
</span><span>    e = p;
</span></code></pre>
<p>é‰´äº<code>()</code>ä¸­æ¶‰åŠåˆ°äº†ä¸‰å¤„é€»è¾‘è¿ç®—ï¼Œæ–¹ä¾¿ç†è§£ï¼Œæˆ‘ä»¬å°†å®ƒé€å±‚è¿›è¡Œæ‹†åˆ†è®²è§£ã€‚</p>
<pre data-lang="java" style="background-color:#2b303b;color:#c0c5ce;" class="language-java "><code class="language-java" data-lang="java"><span>(k = p.key) == key || (key != </span><span style="color:#d08770;">null </span><span>&amp;&amp; key.</span><span style="color:#bf616a;">equals</span><span>(k))
</span></code></pre>
<p>é¦–å…ˆçœ‹<code>||</code>çš„å·¦è¾¹<code>(k=p.key)==key</code>:æ„æ€æ˜¯å…ˆå°†<code>p</code>ä¸­çš„<code>key</code>å€¼èµ‹ç»™å˜é‡<code>k</code>,å†ä¸<code>key</code>è¿›è¡Œä¸€ä¸ªæ¯”è¾ƒï¼Œåˆ¤æ–­æ˜¯å¦ä¸ºåŒä¸€ä¸ª<code>key</code>å€¼(å¯¹è±¡)ï¼Œæ³¨æ„äº†ï¼Œè¿™é‡Œçš„ä¸¤ä¸ª<code>key</code>çš„æ„æ€ï¼Œå‰ä¸€ä¸ª<code>key</code>(ä¹Ÿå°±æ˜¯<code>k</code>)**ä»£è¡¨çš„æ˜¯æ•°ç»„ä¹‹å‰å·²ç»å­˜åœ¨æ•°ç»„ä¸­çš„å…ƒç´ ï¼Œ**è€Œåä¸€ä¸ª<code>key</code><strong>å°±æ˜¯å½“å‰ä¼ å…¥çš„å…ƒç´ </strong>ï¼Œå…·ä½“çš„ä¹Ÿå°±æ˜¯æŒ‡æˆ‘ä»¬ç¬¬ä¸€æ¬¡å­˜å…¥çš„<code>Java</code>å’Œæœ¬æ¬¡å­˜å…¥çš„<code>Java</code>ã€‚</p>
<p>å†çœ‹<code>||</code>å³è¾¹<code>(key != null &amp;&amp; key.equals(k)</code>,è¿™æ˜¯ä¸€ä¸ª<code>&amp;&amp;</code>æ“ä½œ,éœ€è¦æ“ä½œç¬¦ä¸¤è¾¹çš„æ¡ä»¶åŒæ—¶æˆç«‹ï¼Œæ•´ä¸ªæ¡ä»¶æ‰ä¼šæˆç«‹ã€‚é¦–å…ˆåˆ¤æ–­å­˜å…¥çš„<code>key</code>æ˜¯å¦ä¸º<code>null</code>ï¼Œå†åˆ¤æ–­<code>key</code>å’Œ<code>k</code>æ˜¯å¦ä¸ºç›¸åŒï¼ˆæ³¨æ„è¿™é‡Œç”¨äº†<code>equals()</code>æ–¹æ³•,è¯¥æ–¹æ³•å¯è¢«é‡å†™ï¼‰ï¼Œåˆ¤æ–­æ˜¯å¦ä¸ºç›¸åŒçš„å†…å®¹ã€‚å›åˆ°å¤–å±‚çš„<code>p.hash==hash</code>è¿™ä¸ªåˆ¤æ–­ï¼Œå°±æ˜¯å°†å·²æœ‰ç´¢å¼•å¤„å¯¹åº”çš„å…ƒç´ (å…ƒç´ æ˜¯å­˜åœ¨<code>Node</code>ä¸Šçš„)çš„<code>hash</code>å€¼å–å‡ºä¸å½“å‰å…ƒç´ çš„<code>Hash</code>è¿›è¡Œæ¯”è¾ƒã€‚</p>
<p>æ‰€ä»¥å½’çº³èµ·æ¥ä¹Ÿå°±æ˜¯å½“äºŒè€…<code>hash</code>ç›¸åŒå¹¶ä¸”<code>key</code>ä¹Ÿç›¸åŒ(åŒä¸€ä¸ªå¯¹è±¡)çš„æƒ…å†µä¸‹ï¼Œæ‰§è¡Œ<code>e=p</code>èµ‹å€¼æ“ä½œï¼Œå°†åŸä½ç½®çš„å€¼è¿›è¡Œè¦†ç›–ã€‚</p>
<p>å¦‚æœä¸Šé¢çš„æ¡ä»¶ä¸æˆç«‹ï¼Œä¼šåˆ¤æ–­<code>p</code>æ˜¯å¦æ˜¯çº¢é»‘æ ‘ï¼Œå¦‚æœæ˜¯ï¼Œå°±è°ƒç”¨å¯¹åº”çš„æ·»åŠ æ–¹æ³•<code>putTreeVal()</code>è¿›è¡Œæ·»åŠ ï¼Œä¹Ÿå°±æ˜¯ä¸‹é¢çš„ä»£ç ã€‚è¿™é‡Œçš„ <code>instanceof</code>å…³é”®å­—ç”¨æ¥åˆ¤æ–­ä¸€ä¸ªå¯¹è±¡æ˜¯å¦ä¸ºä¸€ä¸ªç±»çš„å®ä¾‹ã€‚å¦å¤–ï¼Œ<code>putTreeVal()</code>æ–¹æ³•å†…éƒ¨æ¶‰åŠåˆ°å¤§é‡çº¢é»‘æ ‘çš„ä»£ç ï¼Œç›¸å¯¹å¤æ‚å¾ˆå¤šï¼Œå¦‚æœè·³è¿›å»çš„è¯ï¼Œä¼°è®¡ä¸€æ—¶åŠä¼šå‡ºä¸æ¥ï¼Œæ‰€ä»¥è¿™é‡Œæš‚æ—¶ä¸ä½œæ¢ç©¶ï¼Œä¼šå¦å¤–åˆ†å¼€æ¥å­¦ä¹ ï¼Œè¿˜æ˜¯å›´ç»•ç€ä¸»çº¿ç»§ç»­åˆ†æã€‚</p>
<pre data-lang="java" style="background-color:#2b303b;color:#c0c5ce;" class="language-java "><code class="language-java" data-lang="java"><span style="color:#b48ead;">else if </span><span>(p instanceof </span><span style="color:#ebcb8b;">TreeNode</span><span>)
</span><span>    e = ((</span><span style="color:#ebcb8b;">TreeNode</span><span>&lt;</span><span style="color:#ebcb8b;">K</span><span>,</span><span style="color:#ebcb8b;">V</span><span>&gt;)p).</span><span style="color:#bf616a;">putTreeVal</span><span>(</span><span style="color:#bf616a;">this</span><span>, tab, hash, key, value);
</span></code></pre>
<p>å¦åˆ™ï¼Œè¿›å…¥<code>else</code>é€»è¾‘ä¸­ï¼š</p>
<pre data-lang="java" style="background-color:#2b303b;color:#c0c5ce;" class="language-java "><code class="language-java" data-lang="java"><span style="color:#b48ead;">else </span><span>{
</span><span>    </span><span style="color:#b48ead;">for </span><span>(</span><span style="color:#b48ead;">int</span><span> binCount = </span><span style="color:#d08770;">0</span><span>; ; ++binCount) {
</span><span>        </span><span style="color:#b48ead;">if </span><span>((e = p.next) == </span><span style="color:#d08770;">null</span><span>) {
</span><span>            p.next = </span><span style="color:#bf616a;">newNode</span><span>(hash, key, value, </span><span style="color:#d08770;">null</span><span>);
</span><span>            </span><span style="color:#b48ead;">if </span><span>(binCount &gt;= </span><span style="color:#d08770;">TREEIFY_THRESHOLD </span><span>- </span><span style="color:#d08770;">1</span><span>) </span><span style="color:#65737e;">// -1 for 1st
</span><span>                </span><span style="color:#bf616a;">treeifyBin</span><span>(tab, hash);
</span><span>            </span><span style="color:#b48ead;">break</span><span>;
</span><span>        }
</span><span>        </span><span style="color:#b48ead;">if </span><span>(e.hash == hash &amp;&amp;
</span><span>            ((k = e.key) == key || (key != </span><span style="color:#d08770;">null </span><span>&amp;&amp; key.</span><span style="color:#bf616a;">equals</span><span>(k))))
</span><span>            </span><span style="color:#b48ead;">break</span><span>;
</span><span>        p = e;
</span><span>    }
</span><span>}
</span></code></pre>
<p>å¼€å±€ä¸€ä¸ª<code>for</code>ï¼Œç›®çš„æ˜ç¡®ï¼Œ<strong>æ—¢ç„¶ä¸Šé¢ä¸¤ç§æƒ…å†µéƒ½ä¸æˆç«‹ï¼Œé‚£ä¹ˆè¯´æ˜è¯¥å…ƒç´ å¯èƒ½ä¼šåœ¨æŸä¸€æ¡é“¾è¡¨èŠ‚ç‚¹ä¸Šå‡ºç°</strong>ï¼Œæ¯”å¦‚ä¸‹é¢è¿™æ ·ï¼š</p>
<pre data-lang="java" style="background-color:#2b303b;color:#c0c5ce;" class="language-java "><code class="language-java" data-lang="java"><span style="color:#bf616a;">Java</span><span style="color:#b48ead;">-&gt;</span><span style="color:#ebcb8b;">C</span><span>++-&gt;</span><span style="color:#bf616a;">Javascript</span><span style="color:#b48ead;">-&gt;</span><span style="color:#ebcb8b;">Java
</span></code></pre>
<p>æ‰€ä»¥æˆ‘ä»¬éœ€è¦ä»¥éå†çš„æ–¹å¼å»æ£€æŸ¥é“¾è¡¨ä¸Šçš„æ¯ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå¾ªç¯å†…éƒ¨ï¼Œé€šè¿‡<code>p</code>å’Œ<code>e</code>ä¸¤ä¸ªæŒ‡é’ˆä¸åœçš„å¾ªç¯æ¯”è¾ƒã€‚</p>
<p>å¦‚æœè¿‡ç¨‹ä¸­å‘ç°æœ‰ä¸€ä¸ªå’Œå½“å‰å…ƒç´ é‡å¤çš„å…ƒç´ ï¼Œå¾ªç¯ä¼šç«‹å³ç»“æŸï¼Œå…ƒç´ æ·»åŠ å¤±è´¥ï¼Œå¦åˆ™å°±å°†å½“å‰å…ƒç´ ç›´æ¥æŒ‚åˆ°èŠ‚ç‚¹åé¢ï¼Œå®Œæˆæ·»åŠ ã€‚æ³¨æ„å…¶ä¸­è¿™æ®µä»£ç :</p>
<pre data-lang="java" style="background-color:#2b303b;color:#c0c5ce;" class="language-java "><code class="language-java" data-lang="java"><span style="color:#b48ead;">if </span><span>(binCount &gt;= </span><span style="color:#d08770;">TREEIFY_THRESHOLD </span><span>- </span><span style="color:#d08770;">1</span><span>) </span><span style="color:#65737e;">// -1 for 1st
</span><span>    </span><span style="color:#bf616a;">treeifyBin</span><span>(tab, hash);
</span><span style="color:#65737e;">//TREEIFY_THRESHOLDçš„å®šä¹‰
</span><span style="color:#b48ead;">static final int </span><span style="color:#d08770;">TREEIFY_THRESHOLD </span><span>= </span><span style="color:#d08770;">8</span><span>;
</span></code></pre>
<p>è¿™æ˜¯åœ¨è¿›è¡Œ<strong>æ·»åŠ ä¹‹åå¯¹å½“å‰è¿™æ¡é“¾è¡¨è¿›è¡Œä¸€ä¸ªåˆ¤æ–­</strong>ï¼Œå¦‚æœé•¿åº¦<code>&gt;=(TREEIFY_THRESHOLD=8)-1</code>çš„è¯ï¼Œä¼šè°ƒç”¨<code>treeifBin()</code>æ–¹æ³•å¯¹å½“å‰é“¾è¡¨è¿›è¡Œæ ‘åŒ–(è½¬çº¢é»‘æ ‘)ï¼Œä½†æ˜¯æ³¨æ„ï¼Œå…‰æ˜¯è¿™ä¸ªæ¡ä»¶æ»¡è¶³è¿˜ä¸è¶³ä»¥å¼€å§‹æ ‘åŒ–ï¼Œåœ¨è¿™ä¸ªæ–¹æ³•çš„å®ç°ä¸­ï¼Œè¿˜æ·»åŠ äº†å…¶ä»–çš„æ·»åŠ ç”¨æ¥åˆ¤æ–­ï¼Œ<code>treeifBin()</code>æºç ï¼š</p>
<pre data-lang="java" style="background-color:#2b303b;color:#c0c5ce;" class="language-java "><code class="language-java" data-lang="java"><span style="color:#b48ead;">final</span><span> void </span><span style="color:#bf616a;">treeifyBin</span><span>(</span><span style="color:#ebcb8b;">Node</span><span>&lt;</span><span style="color:#ebcb8b;">K</span><span>,</span><span style="color:#ebcb8b;">V</span><span>&gt;</span><span style="color:#b48ead;">[]</span><span> tab, </span><span style="color:#b48ead;">int</span><span> hash) {
</span><span>    </span><span style="color:#b48ead;">int</span><span> n, index; </span><span style="color:#ebcb8b;">Node</span><span>&lt;</span><span style="color:#ebcb8b;">K</span><span>,</span><span style="color:#ebcb8b;">V</span><span>&gt; e;
</span><span>    </span><span style="color:#b48ead;">if </span><span>(tab == </span><span style="color:#d08770;">null </span><span>|| (n = tab.length) &lt; </span><span style="color:#d08770;">MIN_TREEIFY_CAPACITY</span><span>)
</span><span>        </span><span style="color:#bf616a;">resize</span><span>();
</span><span>    </span><span style="color:#b48ead;">else if </span><span>((e = tab[index = (n - </span><span style="color:#d08770;">1</span><span>) &amp; hash]) != </span><span style="color:#d08770;">null</span><span>) {
</span><span>        </span><span style="color:#ebcb8b;">TreeNode</span><span>&lt;</span><span style="color:#ebcb8b;">K</span><span>,</span><span style="color:#ebcb8b;">V</span><span>&gt; hd = </span><span style="color:#d08770;">null</span><span>, tl = </span><span style="color:#d08770;">null</span><span>;
</span><span>        </span><span style="color:#b48ead;">do </span><span>{
</span><span>            </span><span style="color:#ebcb8b;">TreeNode</span><span>&lt;</span><span style="color:#ebcb8b;">K</span><span>,</span><span style="color:#ebcb8b;">V</span><span>&gt; p = </span><span style="color:#bf616a;">replacementTreeNode</span><span>(e, </span><span style="color:#d08770;">null</span><span>);
</span><span>            </span><span style="color:#b48ead;">if </span><span>(tl == </span><span style="color:#d08770;">null</span><span>)
</span><span>                hd = p;
</span><span>            </span><span style="color:#b48ead;">else </span><span>{
</span><span>                p.prev = tl;
</span><span>                tl.next = p;
</span><span>            }
</span><span>            tl = p;
</span><span>        } </span><span style="color:#b48ead;">while </span><span>((e = e.next) != </span><span style="color:#d08770;">null</span><span>);
</span><span>        </span><span style="color:#b48ead;">if </span><span>((tab[index] = hd) != </span><span style="color:#d08770;">null</span><span>)
</span><span>            hd.</span><span style="color:#bf616a;">treeify</span><span>(tab);
</span><span>    }
</span><span>}
</span></code></pre>
<p>å°±æ˜¯è¯´ï¼Œå°±ç®—å‰é¢çš„æ¡ä»¶(<code>&gt;=8</code>)å·²ç»æˆç«‹ï¼Œè¿™é‡Œè¿˜ä¼šè¿›è¡Œä¸€ä¸ªåˆ¤æ–­ï¼Œå…·ä½“é€»è¾‘å¦‚ä¸‹ï¼š</p>
<pre data-lang="java" style="background-color:#2b303b;color:#c0c5ce;" class="language-java "><code class="language-java" data-lang="java"><span style="color:#b48ead;">if </span><span>(tab == </span><span style="color:#d08770;">null </span><span>|| (n = tab.length) &lt; </span><span style="color:#d08770;">MIN_TREEIFY_CAPACITY</span><span>)
</span><span>    </span><span style="color:#bf616a;">resize</span><span>();
</span></code></pre>
<p>å®ƒè¿˜ä¼šåˆ¤æ–­å½“å‰è¿™ä¸ª<code>table</code>çš„å¤§å°æ˜¯å¦<code>&lt;MIN_TREEIFY_CAPACITY</code>ä¹Ÿå°±æ˜¯æ˜¯å¦<code>&lt;64</code>ã€‚å¦‚æœè¿™ä¸ªæ¡ä»¶æˆç«‹ï¼Œé‚£ä¹ˆä¼šå…ˆå¯¹æ•°ç»„è¿›è¡Œä¸€ä¸ª<code>resize()</code>æ‰©å®¹æ“ä½œï¼Œè€Œä¸æ˜¯ç›´æ¥è½¬çº¢é»‘æ ‘ã€‚æœ€åå¦‚æœæ·»åŠ å¤±è´¥ï¼Œä¼šè¿”å›ä¸€ä¸ªä¹‹å‰å…ƒç´ çš„<code>value</code>å€¼ã€‚</p>
<pre data-lang="java" style="background-color:#2b303b;color:#c0c5ce;" class="language-java "><code class="language-java" data-lang="java"><span style="color:#b48ead;">if </span><span>(e != </span><span style="color:#d08770;">null</span><span>) { </span><span style="color:#65737e;">// existing mapping for key
</span><span>    </span><span style="color:#ebcb8b;">V</span><span> oldValue = e.value;
</span><span>    </span><span style="color:#b48ead;">if </span><span>(!onlyIfAbsent || oldValue == </span><span style="color:#d08770;">null</span><span>)
</span><span>        e.value = value;
</span><span>    </span><span style="color:#bf616a;">afterNodeAccess</span><span>(e);
</span><span>    </span><span style="color:#b48ead;">return</span><span> oldValue;
</span><span>	}
</span><span style="background-color:#bf616a;color:#2b303b;">}</span><span>
</span></code></pre>
<h6 id="-15">æ‰©å®¹åŸç†</h6>
<p>å‰é¢å¯¹æ•´ä¸ªæµç¨‹æœ‰äº†å¤§è‡´çš„äº†è§£ä¹‹åï¼Œä¸‹é¢ä¸»è¦é’ˆå¯¹å®ƒçš„<strong>æ‰©å®¹åŸç†</strong>è¿›è¡Œä¸€ä¸ªç®€å•çš„æ€»ç»“ã€‚</p>
<p>å…³äºæ‰©å®¹çš„åŸç†ï¼Œå…ˆè¯´ç»“è®ºï¼š</p>
<ul>
<li>
<p><code>HashSet</code>åº•å±‚æ˜¯<code>HashMap</code>ï¼Œé¦–æ¬¡æ·»åŠ æ—¶ï¼Œ<code>table</code>æ•°ç»„çš„å®¹é‡æ‰©ä¸º16ï¼Œåˆå§‹ä¸´ç•Œå€¼ä¸º12:</p>
<blockquote>
<p>threshold(é˜ˆå€¼) = table.size()(tableæ•°ç»„å¤§å°) * loadFactor(åŠ è½½å› å­)</p>
<p>=16*0.75</p>
<p>=12</p>
</blockquote>
</li>
<li>
<p>å¦‚æœ<code>table</code>æ•°ç»„ä½¿ç”¨çš„éƒ¨åˆ†è¾¾åˆ°äº†é˜ˆå€¼ï¼Œå°±ä¼šè§¦å‘æ‰©å®¹ï¼Œå…·ä½“çš„æ‰©å®¹ä¸º<code>16*2=32</code>,ä¹Ÿå°±æ˜¯<strong>ä¼šæŒ‰ç…§ä¸¤å€çš„æ‰©å®¹</strong>æ–¹å¼è¿›è¡Œï¼ŒåŸºäºè¿™ä¸ªå®¹é‡å†æ¬¡è®¡ç®—æ–°çš„æ‰©å®¹é˜ˆå€¼:<code>32*0.75=24</code>,ä¹Ÿå°±æ˜¯å¦‚æœæœ¬æ¬¡æ‰©å®¹åçš„å®¹é‡(32)ä½¿ç”¨è¾¾åˆ°24ä¹‹åï¼Œå°±ä¼šå†æ¬¡è§¦å‘ä¸‹ä¸€æ¬¡çš„2å€æ‰©å®¹æœºåˆ¶ï¼Œä»¥æ­¤ç±»æ¨ã€‚</p>
</li>
</ul>
<p><strong>ç®€å•æ¥è¯´ï¼Œä»¥ä¸Šå°±æ˜¯<code>HashSet(æœ¬è´¨HashMap)</code>çš„æ‰©å®¹åŸç†ï¼Œå…·ä½“çš„ï¼Œçœ‹ä¸‹é¢æºç åˆ†æã€‚</strong></p>
<blockquote>
<p>åœ¨resize()æ–¹æ³•ä¸­æœ‰è¿™æ ·ä¸€æ®µä»£ç </p>
</blockquote>
<pre data-lang="java" style="background-color:#2b303b;color:#c0c5ce;" class="language-java "><code class="language-java" data-lang="java"><span style="color:#b48ead;">else if </span><span>((newCap = oldCap &lt;&lt; </span><span style="color:#d08770;">1</span><span>) &lt; </span><span style="color:#d08770;">MAXIMUM_CAPACITY </span><span>&amp;&amp;
</span><span>         oldCap &gt;= </span><span style="color:#d08770;">DEFAULT_INITIAL_CAPACITY</span><span>)
</span><span>    newThr = oldThr &lt;&lt; </span><span style="color:#d08770;">1</span><span>; </span><span style="color:#65737e;">// double threshold
</span></code></pre>
<p>å¯ä»¥çœ‹åˆ°ï¼Œæ–°çš„å®¹é‡æ˜¯åœ¨åŸæœ‰å®¹é‡çš„åŸºç¡€ä½œäº†ä¸€ä¸ªå·¦ç§»çš„æ“ä½œï¼Œä¹Ÿå°±æ˜¯å’Œä¹˜2æ˜¯ç­‰æ•ˆçš„ï¼Œä½†ç”¨ä½è¿ç®—æ•ˆç‡ä¼šå¿«å¾ˆå¤šã€‚</p>
<blockquote>
<p>è¿™æ˜¯åœ¨pustVal()æºç çš„éƒ¨åˆ†ä»£ç ï¼š</p>
</blockquote>
<pre data-lang="java" style="background-color:#2b303b;color:#c0c5ce;" class="language-java "><code class="language-java" data-lang="java"><span>++modCount;
</span><span style="color:#b48ead;">if </span><span>(++size &gt; threshold)
</span><span>    </span><span style="color:#bf616a;">resize</span><span>();
</span><span style="color:#bf616a;">afterNodeInsertion</span><span>(evict);
</span><span style="color:#b48ead;">return </span><span style="color:#d08770;">null</span><span>;
</span></code></pre>
<blockquote>
<p>resize();å°±æ˜¯è§¦å‘æ‰©å®¹æ—¶è°ƒç”¨çš„æ‰©å®¹æ–¹æ³•ã€‚å…·ä½“çš„æºç å‰é¢æœ‰è®²è¿‡ï¼Œä¸å†èµ˜è¿°ã€‚</p>
</blockquote>
<p>åœ¨Java8ä¸­ï¼Œå¦‚æœä¸€æ¡é“¾è¡¨çš„å…ƒç´ ä¸ªæ•°è¾¾åˆ°<code> TREEIFY_THRESHOLD</code>ä¸”æ­¤æ—¶<code>table</code>çš„å¤§å°&gt;=<code>MIN_TREEIFY_CAPACITY</code></p>
<p>æ—¶å°±ä¼šè§¦å‘é“¾è¡¨è½¬çº¢é»‘æ ‘çš„æ“ä½œã€‚æé«˜æ€§èƒ½ã€‚</p>
<blockquote>
<p>ä¸Šé¢æ¶‰åŠåˆ°çš„ä¸¤ä¸ªå¸¸é‡åœ¨æºä»£ç ä¸­çš„å®šä¹‰å¦‚ä¸‹ï¼š</p>
</blockquote>
<pre data-lang="java" style="background-color:#2b303b;color:#c0c5ce;" class="language-java "><code class="language-java" data-lang="java"><span style="color:#b48ead;">static final int </span><span style="color:#d08770;">TREEIFY_THRESHOLD </span><span>= </span><span style="color:#d08770;">8</span><span>;
</span><span style="color:#b48ead;">static final int </span><span style="color:#d08770;">MIN_TREEIFY_CAPACITY </span><span>= </span><span style="color:#d08770;">64</span><span>;
</span></code></pre>
<p>è½¬çº¢é»‘æ ‘çš„æ–¹æ³•æºç å¦‚ä¸‹ï¼Œè¿™é‡Œåªéœ€è¦çœ‹çœ‹å¤§è‡´çš„æ‰§è¡Œé€»è¾‘å°±å¥½ï¼Œå…³äºçº¢é»‘æ ‘å…·ä½“çš„å®ç°ï¼Œä¸æ˜¯æœ¬ç« çš„ä¸»è¦å†…å®¹ã€‚</p>
<pre data-lang="java" style="background-color:#2b303b;color:#c0c5ce;" class="language-java "><code class="language-java" data-lang="java"><span style="color:#b48ead;">final</span><span> void </span><span style="color:#bf616a;">treeifyBin</span><span>(</span><span style="color:#ebcb8b;">Node</span><span>&lt;</span><span style="color:#ebcb8b;">K</span><span>,</span><span style="color:#ebcb8b;">V</span><span>&gt;</span><span style="color:#b48ead;">[]</span><span> tab, </span><span style="color:#b48ead;">int</span><span> hash) {
</span><span>    </span><span style="color:#b48ead;">int</span><span> n, index; </span><span style="color:#ebcb8b;">Node</span><span>&lt;</span><span style="color:#ebcb8b;">K</span><span>,</span><span style="color:#ebcb8b;">V</span><span>&gt; e;
</span><span>    </span><span style="color:#b48ead;">if </span><span>(tab == </span><span style="color:#d08770;">null </span><span>|| (n = tab.length) &lt; </span><span style="color:#d08770;">MIN_TREEIFY_CAPACITY</span><span>)
</span><span>        </span><span style="color:#bf616a;">resize</span><span>();
</span><span>    </span><span style="color:#b48ead;">else if </span><span>((e = tab[index = (n - </span><span style="color:#d08770;">1</span><span>) &amp; hash]) != </span><span style="color:#d08770;">null</span><span>) {
</span><span>        </span><span style="color:#ebcb8b;">TreeNode</span><span>&lt;</span><span style="color:#ebcb8b;">K</span><span>,</span><span style="color:#ebcb8b;">V</span><span>&gt; hd = </span><span style="color:#d08770;">null</span><span>, tl = </span><span style="color:#d08770;">null</span><span>;
</span><span>        </span><span style="color:#b48ead;">do </span><span>{
</span><span>            </span><span style="color:#ebcb8b;">TreeNode</span><span>&lt;</span><span style="color:#ebcb8b;">K</span><span>,</span><span style="color:#ebcb8b;">V</span><span>&gt; p = </span><span style="color:#bf616a;">replacementTreeNode</span><span>(e, </span><span style="color:#d08770;">null</span><span>);
</span><span>            </span><span style="color:#b48ead;">if </span><span>(tl == </span><span style="color:#d08770;">null</span><span>)
</span><span>                hd = p;
</span><span>            </span><span style="color:#b48ead;">else </span><span>{
</span><span>                p.prev = tl;
</span><span>                tl.next = p;
</span><span>            }
</span><span>            tl = p;
</span><span>        } </span><span style="color:#b48ead;">while </span><span>((e = e.next) != </span><span style="color:#d08770;">null</span><span>);
</span><span>        </span><span style="color:#b48ead;">if </span><span>((tab[index] = hd) != </span><span style="color:#d08770;">null</span><span>)
</span><span>            hd.</span><span style="color:#bf616a;">treeify</span><span>(tab);
</span><span>    }
</span><span>}
</span></code></pre>
<p><strong>æ³¨æ„å¦‚æœåªæ˜¯æ»¡è¶³é“¾è¡¨é•¿åº¦è¾¾åˆ°8çš„æ¡ä»¶æ—¶ï¼Œå®ƒè¿˜æ˜¯ä¼šé‡‡ç”¨<code>resize()</code>æ–¹æ³•å¯¹æ•°ç»„æ‰©å®¹ï¼Œè€Œä¸æ˜¯ç›´æ¥è½¬çº¢é»‘æ ‘ã€‚</strong></p>
<p><strong>æ³¨æ„äº†ï¼ï¼</strong></p>
<blockquote>
<p>ä¸Šé¢æåˆ°çš„è§¦å‘æ•°ç»„æ‰©å®¹çš„æ¡ä»¶ä¸­ï¼Œ<code>size</code>çš„å¤§å°å¤§äºè´Ÿè½½å› å­æ‰ä¼šè§¦å‘ï¼Œè¿™é‡Œçš„<code>size</code>æŒ‡<code>çš„æ˜¯æ•°ç»„å’Œé“¾è¡¨ä¸­å…ƒç´ çš„å’Œ</code>ï¼Œä¹Ÿå°±æ˜¯åªè¦æˆ‘ä»¬å‘å…¶ä¸­æ·»åŠ ä¸€ä¸ªå…ƒç´ ï¼Œä¸è®ºè¿™ä¸ªå…ƒç´ æ˜¯å­˜åœ¨æ•°ç»„ç¬¬ä¸€ä¸ªä½ç½®ï¼Œè¿˜æ˜¯å­˜åœ¨é“¾è¡¨ä¸­æŸä¸ªä½ç½®ï¼Œ<code>sizeéƒ½ä¼šè‡ªå¢1</code>ï¼Œè¿™æ˜¯ä¸€ä¸ªæ¯”è¾ƒå®¹æ˜“æé”™çš„åœ°æ–¹ï¼Œ<strong>ä¸è¦è®¤ä¸ºsizeå°±æ˜¯æŒ‡æ•°ç»„çš„é•¿åº¦ï¼Œè¿™æ˜¯é”™è¯¯çš„ã€‚</strong></p>
</blockquote>
<hr />
<p><strong>ä¸ºä»€ä¹ˆä¸ç›´æ¥ä½¿ç”¨<code>hash</code>æ¥è®¡ç®—ç´¢å¼•ï¼Œè€Œæ˜¯è¦è¿›è¡Œå–æ¨¡è¿ç®—ï¼Ÿ</strong></p>
<blockquote>
<p>å¦‚æœå°†å“ˆå¸Œç æ˜ å°„åˆ°æ•°ç»„ä¸­çš„ä¸€ä¸ªç´¢å¼•ã€‚å¯èƒ½ä¼šå› ä¸º<code>hash</code>å€¼è¿‡å¤§è€Œå› æ­¤å¯¼è‡´ç´¢å¼•è¶…å‡ºèŒƒå›´ã€‚æ‰€ä»¥ä¸€ä¸ªæœ€ç®€å•çš„æ–¹æ³•æ˜¯å¯¹å“ˆå¸Œç å’Œæ•°ç»„çš„é•¿åº¦è¿›è¡Œæ¨¡è¿ç®—ï¼Œå¦‚<code>hash(key) % n</code>ã€‚å¦‚æ­¤å¯ä»¥<strong>ç¡®ä¿ç´¢å¼•iæ€»æ˜¯åœ¨0å’Œnä¹‹é—´ã€‚</strong></p>
</blockquote>
<p>ä½†æ˜¯Javaåœ¨å®ç°çš„æ—¶å€™ï¼Œç”¨çš„å¹¶ä¸æ˜¯ä¸Šé¢è¯´çš„ç®—æ³•ï¼Œè€Œæ˜¯å°†<strong>æ•°ç»„çš„é•¿åº¦nå‡å»1ä¹‹åå†ä¸<code>hash</code>ä½œ<code>&amp;</code>è¿ç®—å¾—åˆ°</strong>ï¼Œå®ç°ä»£ç å¦‚ä¸‹:</p>
<pre data-lang="java" style="background-color:#2b303b;color:#c0c5ce;" class="language-java "><code class="language-java" data-lang="java"><span>i = (n - </span><span style="color:#d08770;">1</span><span>) &amp; hash;
</span></code></pre>
<hr />
<h4 id="-16">LinkedHashSet</h4>
<h5 id="-17">æ¦‚è¿°</h5>
<ul>
<li><code>LinkedHashSet</code>æ˜¯<code>Set</code>æ¥å£çš„ä¸€ä¸ªå®ç°å­ç±»ï¼Œä¹Ÿæ˜¯<code>HashSet</code>çš„å­ç±»ã€‚</li>
<li><code>LinkedHashSet</code>çš„åº•å±‚æ˜¯ä¸€ä¸ª<code>LinkedHashMap</code>ï¼Œåº•å±‚ç»´æŠ¤äº†ä¸€ä¸ª<strong>æ•°ç»„+åŒå‘é“¾è¡¨</strong>ã€‚</li>
<li><code>LinkedHashSet</code>æ ¹æ®å…ƒç´ çš„<code>hashCode</code>å€¼æ¥å†³å®šå…ƒç´ çš„å­˜å‚¨ä½ç½®ï¼ŒåŒæ—¶<strong>ä½¿ç”¨é“¾è¡¨æ¥ç»´æŠ¤å…ƒç´ çš„æ¬¡åº</strong>ï¼Œè¿™å°±ä½¿å¾—å…ƒç´ çœ‹èµ·æ¥æ˜¯ä»¥æ’å…¥çš„é¡ºåºä¿å­˜çš„ã€‚</li>
<li>å…¶æ¬¡ï¼Œ<code>LinkedHashSet</code>ä¹Ÿ<strong>ä¸å…è®¸æ·»åŠ é‡å¤å…ƒç´ </strong>ã€‚</li>
</ul>
<p><img src="https://images.waer.ltd/img/LinkedHashSet.png" alt="" loading="lazy" decoding="async" /></p>
<p>åœ¨<code>LinkedHashSet</code>ä¸­ç»´æŠ¤äº†ä¸€ä¸ª<code>hash</code>è¡¨å’ŒåŒå‘é“¾è¡¨ï¼Œæ¯ä¸€ä¸ªèŠ‚ç‚¹æœ‰<code>pre</code>å’Œ<code>next</code>å±æ€§ï¼Œè¿™æ ·å¯ä»¥å½¢æˆåŒå‘é“¾è¡¨ã€‚åœ¨æ·»åŠ å…ƒç´ æ—¶ï¼Œå…ˆæ±‚<code>hash</code>å€¼ï¼Œå†æ±‚ç´¢å¼•ï¼Œç¡®å®šè¯¥å…ƒç´ åœ¨å“ˆå¸Œè¡¨ä¸­çš„ä½ç½®ï¼Œç„¶åå°†æ·»åŠ çš„å…ƒç´ åŠ å…¥åˆ°åŒå‘é“¾è¡¨ï¼ˆå¦‚æœå·²ç»å­˜åœ¨ï¼Œä¸æ·»åŠ (åŸç†å’Œ<code>hashsetç±»ä¼¼</code>)ï¼‰ã€‚</p>
<h5 id="-18">æºç è§£è¯»</h5>
<ul>
<li>é€šè¿‡ä¸‹é¢çš„ç¤ºä¾‹æ¥é…åˆè®²è§£ï¼š</li>
</ul>
<pre data-lang="java" style="background-color:#2b303b;color:#c0c5ce;" class="language-java "><code class="language-java" data-lang="java"><span style="color:#ebcb8b;">Set</span><span> set = </span><span style="color:#b48ead;">new </span><span style="color:#ebcb8b;">LinkedHashSet</span><span>();
</span><span>set.</span><span style="color:#bf616a;">add</span><span>(&quot;</span><span style="color:#a3be8c;">A</span><span>&quot;);
</span><span>set.</span><span style="color:#bf616a;">add</span><span>(</span><span style="color:#d08770;">120</span><span>);
</span><span>set.</span><span style="color:#bf616a;">add</span><span>(</span><span style="color:#d08770;">120</span><span>);
</span><span>set.</span><span style="color:#bf616a;">add</span><span>(</span><span style="color:#b48ead;">new </span><span style="color:#ebcb8b;">User</span><span>(&quot;</span><span style="color:#a3be8c;">æ</span><span>&quot;,</span><span style="color:#d08770;">1001</span><span>));
</span><span>set.</span><span style="color:#bf616a;">add</span><span>(</span><span style="color:#d08770;">123</span><span>);
</span><span>set.</span><span style="color:#bf616a;">add</span><span>(</span><span style="color:#b48ead;">new </span><span style="color:#ebcb8b;">String</span><span>(&quot;</span><span style="color:#a3be8c;">hello</span><span>&quot;));
</span><span style="color:#ebcb8b;">System</span><span>.out.</span><span style="color:#bf616a;">println</span><span>(set);
</span></code></pre>
<p>å¦‚æœæ–­ç‚¹çš„æ–¹å¼ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œ<code>LinkedHashSet</code>çš„ä¸€ä¸ªåŸºæœ¬ç»“æ„å¦‚ä¸‹ï¼š</p>
<p><img src="https://images.waer.ltd/img/20220426085807.png" alt="" loading="lazy" decoding="async" /></p>
<p>é€šè¿‡ä¸Šå›¾å¯ä»¥å‘ç°ï¼Œå…¶ä¸­å­˜åœ¨ä¸€ä¸ª<code>tail</code>å’Œ<code>head</code>çš„å±æ€§ï¼Œè¿™æ˜¯å…¸å‹çš„åŒå‘é“¾è¡¨ä¸­æ‰ä¼šç”¨åˆ°çš„ä¸¤ä¸ªå¼•ç”¨ï¼Œæˆ–è€…æŒ‡é’ˆ(c/c++)ï¼Œ<strong>ä»£è¡¨åŒå‘é“¾è¡¨çš„å¤´å°¾æŒ‡é’ˆ</strong>ã€‚å³è¿›ä¸€æ­¥éªŒè¯äº†å‰é¢æåˆ°çš„<code>LinkedHashSet</code>çš„æ˜¯ä¸€ä¸ª<code>HashTable</code>å’ŒåŒå‘é“¾è¡¨çš„ç»„åˆã€‚</p>
<p>å…¶ä¸­çš„<code>table</code>ç±»å‹å…¶å®æ˜¯ä¸€ä¸ª<code>HashMap$Node[]</code>ç±»å‹ï¼Œè€Œæ¯ä¸€ä¸ªèŠ‚ç‚¹åˆæ˜¯ç»´æŠ¤çš„<code>LinkedHashMap$Entry[]</code>ç±»å‹ã€‚</p>
<p><img src="https://images.waer.ltd/img/20220426090925.png" alt="" loading="lazy" decoding="async" /></p>
<p>ä¸ºä»€ä¹ˆæ•°ç»„ä¸º<code>HashMap$Node[]æ•°ç»„ç±»å‹</code>è€Œå­˜æ”¾çš„å…ƒç´ å´æ˜¯<code>LinkedHashMap$Entry[]</code>ç±»å‹ï¼Ÿ</p>
<blockquote>
<p>è¯´æ˜<code>LinkedHashMap$Entry[]</code>è‚¯å®šç»§<strong>æ‰¿æˆ–è€…å®ç°</strong>äº†<code>HashMap$Node[]</code>çš„ï¼Œå³é€šè¿‡<strong>æ•°ç»„å¤šæ€</strong>çš„æ–¹å¼å®ç°ã€‚æ³¨æ„è¿™é‡Œçš„<code>$</code>ç¬¦å·æ ‡è¯†$ä¹‹åçš„ç±»ä½œä¸º<code>$</code>ä¹‹å‰çš„ä¸€ä¸ªé™æ€å†…éƒ¨ç±»ï¼Œä¹Ÿå³è¡¨ç¤ºåœ¨<code>LinkedHashMap$Entry</code>ä¸­ï¼Œ<code>Entry</code>æ˜¯<code>LinkedHashMap</code>çš„ä¸€ä¸ª<strong>é™æ€å†…éƒ¨ç±»ã€‚</strong></p>
</blockquote>
<p>åœ¨<code>LinkdeHashMap</code>ä¸­æˆ‘ä»¬å¯ä»¥æ‰¾åˆ°å¯¹åº”çš„æºç éªŒè¯ã€‚</p>
<pre data-lang="java" style="background-color:#2b303b;color:#c0c5ce;" class="language-java "><code class="language-java" data-lang="java"><span style="color:#b48ead;">static class </span><span style="color:#ebcb8b;">Entry</span><span style="color:#eff1f5;">&lt;</span><span style="color:#bf616a;">K</span><span style="color:#eff1f5;">,</span><span style="color:#bf616a;">V</span><span style="color:#eff1f5;">&gt; </span><span style="color:#b48ead;">extends </span><span style="color:#a3be8c;">HashMap</span><span style="color:#eff1f5;">.</span><span style="color:#a3be8c;">Node</span><span style="color:#eff1f5;">&lt;</span><span style="color:#ebcb8b;">K</span><span style="color:#eff1f5;">,</span><span style="color:#ebcb8b;">V</span><span style="color:#eff1f5;">&gt; {
</span><span style="color:#eff1f5;">    </span><span style="color:#ebcb8b;">Entry</span><span style="color:#eff1f5;">&lt;</span><span style="color:#ebcb8b;">K</span><span style="color:#eff1f5;">,</span><span style="color:#ebcb8b;">V</span><span style="color:#eff1f5;">&gt; before, after;
</span><span style="color:#eff1f5;">    </span><span style="color:#8fa1b3;">Entry</span><span style="color:#eff1f5;">(</span><span style="color:#b48ead;">int </span><span style="color:#bf616a;">hash</span><span style="color:#eff1f5;">, </span><span style="color:#ebcb8b;">K </span><span style="color:#bf616a;">key</span><span style="color:#eff1f5;">, </span><span style="color:#ebcb8b;">V </span><span style="color:#bf616a;">value</span><span style="color:#eff1f5;">, </span><span style="color:#ebcb8b;">Node</span><span style="color:#eff1f5;">&lt;</span><span style="color:#ebcb8b;">K</span><span style="color:#eff1f5;">,</span><span style="color:#ebcb8b;">V</span><span style="color:#eff1f5;">&gt; </span><span style="color:#bf616a;">next</span><span style="color:#eff1f5;">) {
</span><span style="color:#eff1f5;">        </span><span style="color:#bf616a;">super</span><span style="color:#eff1f5;">(hash, key, value, next);
</span><span style="color:#eff1f5;">    }
</span><span style="color:#eff1f5;">}
</span></code></pre>
<p>ä»ä¸Šè¿°çš„æºç ä¸­ä¸ä»…è¯´æ˜<code>Entry</code>æ˜¯<code>LinkedHashMap</code>çš„å†…éƒ¨ç±»ï¼Œä¹Ÿè¯´æ˜<code>LinkedHashMap$Entry[]</code>ç»§æ‰¿äº†<code>HashMap$Node[]</code>ã€‚</p>
<p>å…¶ä¸­æœ‰ä¸¤ä¸ª<code>Entry&lt;K,V&gt;</code>ç±»å‹çš„å±æ€§ï¼š<code>before</code>å’Œ<code>after</code>ï¼Œå¯ä»¥ç†è§£ä¸ºä¸¤ä¸ªå¼•ç”¨ï¼Œä¸»è¦ç”¨æ¥å®Œæˆå„èŠ‚ç‚¹ä¹‹é—´çš„è¿æ¥ã€‚</p>
<p>åŒæ ·ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡æŸ¥çœ‹<code>HashMap</code>çš„æºç ï¼ŒéªŒè¯ä¸Šé¢çš„è¯´æ³•ï¼š<code>Node</code>åŒæ ·ä½œä¸ºå…¶ä¸€ä¸ªé™æ€çš„å†…éƒ¨ç±»å®ç°ã€‚å¹¶ä¸”è¯¥ç±»è¿˜å®ç°äº†å…¶çˆ¶æ¥å£<code>Map</code>ä¸­çš„<code>Entry&lt;K,V&gt;</code>ã€‚</p>
<pre data-lang="java" style="background-color:#2b303b;color:#c0c5ce;" class="language-java "><code class="language-java" data-lang="java"><span style="color:#b48ead;">static class </span><span style="color:#ebcb8b;">Node</span><span style="color:#eff1f5;">&lt;</span><span style="color:#bf616a;">K</span><span style="color:#eff1f5;">,</span><span style="color:#bf616a;">V</span><span style="color:#eff1f5;">&gt; </span><span style="color:#b48ead;">implements </span><span style="color:#a3be8c;">Map</span><span style="color:#eff1f5;">.</span><span style="color:#a3be8c;">Entry</span><span style="color:#eff1f5;">&lt;</span><span style="color:#ebcb8b;">K</span><span style="color:#eff1f5;">,</span><span style="color:#ebcb8b;">V</span><span style="color:#eff1f5;">&gt; {
</span><span style="color:#eff1f5;">    </span><span style="color:#b48ead;">final int </span><span style="color:#eff1f5;">hash;
</span><span style="color:#eff1f5;">    </span><span style="color:#b48ead;">final </span><span style="color:#ebcb8b;">K </span><span style="color:#eff1f5;">key;
</span><span style="color:#eff1f5;">    </span><span style="color:#ebcb8b;">V </span><span style="color:#eff1f5;">value;
</span><span style="color:#eff1f5;">    </span><span style="color:#ebcb8b;">Node</span><span style="color:#eff1f5;">&lt;</span><span style="color:#ebcb8b;">K</span><span style="color:#eff1f5;">,</span><span style="color:#ebcb8b;">V</span><span style="color:#eff1f5;">&gt; next;
</span><span style="color:#eff1f5;">
</span><span style="color:#eff1f5;">    </span><span style="color:#8fa1b3;">Node</span><span style="color:#eff1f5;">(</span><span style="color:#b48ead;">int </span><span style="color:#bf616a;">hash</span><span style="color:#eff1f5;">, </span><span style="color:#ebcb8b;">K </span><span style="color:#bf616a;">key</span><span style="color:#eff1f5;">, </span><span style="color:#ebcb8b;">V </span><span style="color:#bf616a;">value</span><span style="color:#eff1f5;">, </span><span style="color:#ebcb8b;">Node</span><span style="color:#eff1f5;">&lt;</span><span style="color:#ebcb8b;">K</span><span style="color:#eff1f5;">,</span><span style="color:#ebcb8b;">V</span><span style="color:#eff1f5;">&gt; </span><span style="color:#bf616a;">next</span><span style="color:#eff1f5;">) {
</span><span style="color:#eff1f5;">        </span><span style="color:#bf616a;">this</span><span style="color:#eff1f5;">.hash </span><span>=</span><span style="color:#eff1f5;"> hash;
</span><span style="color:#eff1f5;">        </span><span style="color:#bf616a;">this</span><span style="color:#eff1f5;">.key </span><span>=</span><span style="color:#eff1f5;"> key;
</span><span style="color:#eff1f5;">        </span><span style="color:#bf616a;">this</span><span style="color:#eff1f5;">.value </span><span>=</span><span style="color:#eff1f5;"> value;
</span><span style="color:#eff1f5;">        </span><span style="color:#bf616a;">this</span><span style="color:#eff1f5;">.next </span><span>=</span><span style="color:#eff1f5;"> next;
</span><span style="color:#eff1f5;">    }
</span></code></pre>
<p><img src="https://images.waer.ltd/img/20220426092722.png" alt="" loading="lazy" decoding="async" /></p>
<p>åœ¨å­˜å‚¨å…ƒç´ æ—¶ï¼Œæ¯ä¸€ä¸ªå…ƒç´ ä¸­ä¾ç„¶æ˜¯ä½¿ç”¨çš„<code>key</code>æ¥å­˜å‚¨ï¼Œè€Œ<code>value</code>åªæ˜¯ä¸€ä¸ª<code>object</code>ç±»å‹çš„å ä½ç¬¦ï¼Œè¿™é‡Œæ²¡æœ‰å®é™…çš„æ„ä¹‰ã€‚å› ä¸ºåœ¨<code>LinkedHashSet</code>ä¸­ï¼Œæˆ‘ä»¬<strong>ä¸éœ€è¦æ˜¾å¼çš„å»åƒMapä¸­å­˜ä¸€ä¸ª<code>K,V</code>å½¢å¼çš„å€¼ã€‚</strong></p>
<ul>
<li>å½“æˆ‘ä»¬æ·»åŠ ä¸€ä¸ªé‡å¤å…ƒç´ æ—¶ï¼Œ<code>LinkedHashSet</code>ä¼šç›´æ¥è°ƒç”¨çˆ¶ç±»<code>HashSet</code>ä¸­çš„æ¯”è¾ƒæ–¹æ³•ï¼Œå¯¹é‡å¤å…ƒç´ è¿›è¡Œä¸€ä¸ªåˆ¤æ–­å¹¶å»é‡ï¼Œå…¶å®è¿™é‡Œçš„åŸç†å’Œä¹‹å‰è®²çš„<code>HashSet</code>åŸç†æ˜¯ä¸€æ ·çš„ï¼Œå½“æ·»åŠ å…ƒç´ æ˜¯ï¼Œ<code>LinkedHashSet</code>è¿˜æ˜¯ä¼šç›´æ¥è°ƒç”¨çˆ¶ç±»<code>HashSet</code>ä¸­çš„<code>add()</code>æ–¹æ³•(è¯¥æ–¹æ³•æœ¬è´¨è¿˜æ˜¯è°ƒç”¨<code>HashMap</code>ä¸­çš„<code>put()</code>æ–¹æ³•)ï¼Œæ¥ç€æ˜¯<code>putVal()</code>å…³äºè¿™ä¸¤ä¸ªæ–¹æ³•çš„æºç åœ¨å‰é¢è®²<code>HashSet</code>æºç çš„æ—¶å€™å°±å·²ç»è®²è¿‡ï¼Œè¿™é‡Œä¸å†èµ˜è¿°ã€‚æ‰€ä»¥è¯´ï¼Œç»ç®¡æ˜¯ä¸åŒçš„ç»“æ„å®ç°ï¼Œä½†åœ¨å…ƒç´ åˆ¤é‡çš„åŸç†ä¸Šå…¶å®ä½¿ç”¨çš„è¿˜æ˜¯åŒä¸€ä¸ªé€»è¾‘ã€‚</li>
</ul>
<p><strong>è¯´ç™½äº†ï¼ŒLinkedHashSetæœ¬è´¨ä¸Šå¤§éƒ¨åˆ†è¿˜æ˜¯HashMap</strong></p>
<ul>
<li>
<p><code>LinkedHashset</code>åº•å±‚ç»´æŠ¤äº†ä¸€ä¸ª<code>LinkedHashMap</code>ç»“æ„ï¼Œè¿™ä¸€ç‚¹å¯ä»¥ç±»æ¯”äº<code>HashSet</code>åº•å±‚ç»´æŠ¤ä¸€ä¸ª<code>HashMap</code>æ¥è¿›è¡Œå¯¹æ¯”è®°å¿†ã€‚è€Œå‰é¢æˆ‘ä»¬å·²ç»çŸ¥é“ï¼Œ<code>LinkedHashMap</code>å…¶å®å°±æ˜¯<code>HashMap</code>çš„ä¸€ä¸ªå­ç±»ã€‚</p>
</li>
<li>
<p>å¯¹äº<code>LinkedHashSet</code>æˆ‘ä»¬åœ¨ç†è§£äº†å‰é¢<code>HashSet</code>æºç çš„åŸºç¡€ä¸Šï¼Œåªéœ€è¦ç†è§£å®ƒåº•å±‚çš„ä¸€ä¸ªå®ç°ç»“æ„å³å¯ï¼Œä¹Ÿå°±æ˜¯æ•°ç»„+åŒå‘é“¾è¡¨çš„ç»“æ„ï¼Œå›åˆ°ä¸€å¼€å§‹çš„å“ªä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å‘seté›†åˆä¸­æ·»åŠ äº†ï¼š</p>
</li>
</ul>
<blockquote>
<p>â€œAâ€ï¼Œ120, User,123</p>
</blockquote>
<p>ä¹‹åï¼Œé€šè¿‡æ–­ç‚¹çš„æ–¹å¼å¯ä»¥çœ‹åˆ°ä»–ä»¬ä¹‹é—´çš„ä¸€ä¸ªæŒ‡å‘å…³ç³»å¦‚ä¸‹</p>
<p><img src="https://images.waer.ltd/img/20220426100922.png" alt="" loading="lazy" decoding="async" /></p>
<blockquote>
<p>ä¸Šå›¾å±•ç¤ºäº†å†…éƒ¨å…ƒç´ èŠ‚ç‚¹ä¸­<code>after</code>å’Œ<code>before</code>çš„å¼•ç”¨å…³ç³»ã€‚ä»”ç»†è§‚å¯Ÿæ¯ä¸€ä¸ª<code>LinkedHashMap$Entry</code>åéƒ½ä¼šè·Ÿä¸€ä¸ª<code>@number</code>çš„æ ‡è¯†ï¼Œ**è¿™æ˜¯ç”¨æ¥æ ‡è¯†è¯¥ä½ç½®å…ƒç´ çš„ä¸€ä¸ªå”¯ä¸€æ ‡è®°ï¼Œæˆ–è€…ä½ ä¹Ÿå¯ä»¥ç†è§£ä¸ºè¯¥å…ƒç´ åœ¨è¯¥ç»“æ„ä¸­çš„ä¸€ä¸ªåœ°å€ã€‚**å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨è¯¥æ ‡è¯†æ¥å”¯ä¸€æ€§çš„ä»£è¡¨ä¸€å…ƒç´ å€¼ï¼Œæ³¨æ„å…¶ä¸­æ¯ä¸€å„<code>after</code>æˆ–è€…<code>before</code>çš„æŒ‡å‘å…³ç³»ï¼Œå…·ä½“åœ¨åé¢æˆ‘å›ç”»ä¸ªå›¾å¸®åŠ©ç†è§£ã€‚</p>
</blockquote>
<ul>
<li>å†è·³å‡ºå…ƒç´ å†…éƒ¨<code>Entry</code>ï¼Œæˆ‘ä»¬çœ‹åˆ°åœ¨<code>table</code>ä¸­æœ‰ä¸¤ä¸ªåä¸º<code>head</code>å’Œ<code>tail</code>çš„å¼•ç”¨å±æ€§ã€‚ç”¨æ¥æ ‡è¯†è¯¥åŒå‘é“¾è¡¨çš„å¤´å°¾èŠ‚ç‚¹ã€‚</li>
</ul>
<p><img src="https://images.waer.ltd/img/20220426101903.png" alt="" loading="lazy" decoding="async" /></p>
<p>å°†ä¸Šé¢çš„é€»è¾‘ä»¥å›¾ç‰‡çš„å½¢å¼å±•ç¤ºå‡ºæ¥å¤§æ¦‚å°±æ˜¯ä¸‹é¢è¿™æ ·ï¼š</p>
<p><img src="https://images.waer.ltd/img/LinkedHashSet.jpg" alt="" loading="lazy" decoding="async" /></p>
<p>ç®€å•æ‹ä¸€ä¸‹ï¼š</p>
<blockquote>
<ul>
<li>æ¯å‘<code>LinkedHashSet</code>ä¸­æ·»åŠ ä¸€ä¸ªå…ƒç´ ï¼Œé¦–å…ˆä¼šæ ¹æ®è¯¥å…ƒç´ è®¡ç®—ä¸€ä¸ª<code>hash</code>å€¼ï¼Œç”¨æ¥ç¡®å®šå®ƒåœ¨ä¸Šé¢å›¾ä¸­<code>table</code>æ•°ç»„ä¸­çš„ç´¢å¼•ä½ç½®ã€‚</li>
<li>é€šè¿‡ä¸Šé¢çš„æ­¥éª¤æ·»åŠ å¤šä¸ªå…ƒç´ ä¹‹åï¼Œå…ƒç´ å†…éƒ¨æ˜¯ä¸€ä¸ª<code>Entry[]</code>ç±»å‹çš„ç»“æ„ï¼Œå…¶ä¸­æ¯ä¸€ä¸ªå…ƒç´ éƒ½æœ‰ä¸€ä¸ª<code>after</code>å’Œ<code>before</code>å±æ€§ï¼Œç”¨<strong>æ¥æŒ‡å‘å®ƒçš„å‰ä¸€ä¸ªå…ƒç´ å’Œåä¸€ä¸ªå…ƒç´ çš„ä½ç½®ã€‚</strong></li>
<li>å†é€šè¿‡ä¸¤ä¸ªå±æ€§<code>head</code>å’Œ<code>tail</code>æ¥æŒ‡å‘æ•´ä¸ªé“¾è¡¨çš„å¤´å’Œå°¾ï¼Œä»è€Œæ„æˆä¸€ä¸ª<strong>å®Œæ•´çš„å«æœ‰å¤´å°¾æŒ‡é’ˆ(å¼•ç”¨)çš„åŒå‘é“¾è¡¨ã€‚</strong></li>
<li>å°†è¯¥é“¾è¡¨å…·è±¡åŒ–å‡ºæ¥å¯ä»¥å¤§è‡´è¡¨ç¤ºä¸ºå›¾ä¸­å³è¾¹éƒ¨åˆ†ã€‚æ¢å¥è¯è¯´ï¼Œè¿™é‡Œçš„<code>after</code>å’Œ<code>before</code>å…¶å®å°±ç›¸å½“äºå¹³æ—¶å¸¸ç”¨çš„<code>pre</code>å’Œ<code>next</code>æŒ‡é’ˆï¼Œå³å‰é©±åç»§æŒ‡é’ˆï¼Œåªä¸è¿‡å‘½åä¸åŒè€Œå·²ï¼Œæ²¡ä»€ä¹ˆé«˜æ·±è«æµ‹çš„ã€‚</li>
<li>æ³¨æ„ï¼Œå’Œå‰é¢<code>HashSet</code>çš„æ•°ç»„+å•é“¾è¡¨çš„ç»“æ„ç±»ä¼¼ï¼Œæ¯ä¸€ä¸ªç´¢å¼•ä½éƒ½å¯ä»¥æ˜¯ä¸€æ¡å®Œæ•´çš„åŒå‘é“¾è¡¨ï¼Œå°±åƒå›¾ä¸­ç´¢å¼•ä¸º7çš„ä½ç½®ä¸€æ ·ï¼Œè€Œä¸æ˜¯æ¯ä¸ªç´¢å¼•ä¸ºåªèƒ½æœ‰ä¸€ä¸ªé“¾è¡¨èŠ‚ç‚¹ï¼Œè¿™å–å†³äºå…ƒç´ è®¡ç®—å‡ºæ¥çš„<code>hash</code>ã€‚</li>
<li>æ­£æ˜¯ç”±äºåŒå‘é“¾è¡¨çš„ç‰¹æ€§ï¼Œä½¿å¾—æˆ‘ä»¬æ·»åŠ çš„å…ƒç´ é¡ºåºæ˜¯ç›¸å¯¹æœ‰åºçš„ï¼Œ<strong>ä¹Ÿå°±æ˜¯æ·»åŠ çš„é¡ºåºå’Œæ‰“å°å‡ºæ¥çš„é¡ºåºæ˜¯ä¸€æ ·çš„ã€‚</strong></li>
</ul>
</blockquote>
<p><strong>å…³äºæ‰©å®¹</strong></p>
<p>é¦–å…ˆï¼Œ<code>LinkedHashSet</code>å¦‚æœä½¿ç”¨æ— å‚æ•°æ„é€ å™¨åˆå§‹åŒ–ï¼Œé‚£ä¹ˆå®ƒé»˜è®¤ä¼šå¼€è¾Ÿä¸€ä¸ª<code>16</code>å¤§å°çš„ç©ºé—´ï¼Œè´Ÿè½½å› å­ä¾æ—§æ˜¯<code>0.74</code>ï¼Œé¦–æ¬¡æ‰©å®¹çš„é˜ˆå€¼ä¸º<code>12</code>ã€‚è¿™äº›æ•°å€¼æ˜¯ä¸æ˜¯å¾ˆçœ¼ç†Ÿï¼Ÿå¦‚æœä½ çœ‹äº†å‰é¢<code>HashSet</code>çš„æºç åˆ†æçš„è¯ã€‚</p>
<pre data-lang="java" style="background-color:#2b303b;color:#c0c5ce;" class="language-java "><code class="language-java" data-lang="java"><span style="color:#b48ead;">public </span><span style="color:#bf616a;">LinkedHashSet</span><span>() {
</span><span>    </span><span style="color:#bf616a;">super</span><span>(</span><span style="color:#d08770;">16</span><span>, </span><span style="color:#d08770;">.75</span><span style="color:#b48ead;">f</span><span>, </span><span style="color:#d08770;">true</span><span>);
</span><span>}
</span></code></pre>
<p>è™½ç„¶è®²çš„æ˜¯<code>LinkdeHashSet</code>ï¼Œä½†æœ¬è´¨ä¸Šåˆ†æçš„è¿˜æ˜¯<code>HashSet</code>ï¼Œå†æœ¬è´¨å°±æ˜¯<code>LinkedHashMap</code>ï¼Œå†ç»§ç»­å¥—å¨ƒä½ ä¼šå‘ç°ï¼Œ<strong>å°±æ˜¯è®²çš„<code>HashMap</code>ï¼Œå¯è§è¿™å®¶ä¼™æ‰æ˜¯ä¸»è§’ã€‚</strong></p>
<hr />
<p>æœªå®Œå¾…ç»­â€¦â€¦</p>

        </div>
      </div>
      <div class="prompt" id="terminal"><input
    type="text"
    id="setter"
    onkeydown="writeit(this, event);moveIt(this.value.length, event)"
    onchange="writeit(this, event)"
    onkeyup="writeit(this, event)"
    onkeypress="writeit(this, event);"
    >
<label for="setter" id="writer"> </label><b class="cursor" id="cursor"></b></div>
    </main>
  </body>

</html>
