<!DOCTYPE html>
<html lang="zh" data-theme="light" dir="ltr">
  <head>
    <title>å…³äºæ¥å£é™æµçš„ä¸€æ¬¡ç®€å•å®è·µ - æ…•äºˆåšå®¢</title>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
    <meta name="description" content="ç®€å•æ˜¯æ•ˆç‡çš„çµé­‚"/>

    <meta property="og:title" content="æ…•äºˆåšå®¢ -&nbsp;å…³äºæ¥å£é™æµçš„ä¸€æ¬¡ç®€å•å®è·µ" />
    <meta property="og:type" content="website"/><meta property="og:url" content="https:&#x2F;&#x2F;ilikexff.cn&#x2F;guan-yu-jie-kou-xian-liu-de-yi-ci-jian-dan-shi-jian&#x2F;"/><meta property="og:description" content="ç®€å•æ˜¯æ•ˆç‡çš„çµé­‚"/>


    <meta name="twitter:card" content="summary">


    <link rel="stylesheet" href="https://ilikexff.cn/spectre/spectre.css">
    <link rel="stylesheet" href="https://ilikexff.cn/theme.css"><link rel="stylesheet" href="https://ilikexff.cn/custom.css">
    

        
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.css" integrity="sha384-Xi8rHCmBmhbuyyhbI88391ZKP2dmfnOl4rT9ZfRI7mLTdk1wblIUnrIq35nqwEvC" crossorigin="anonymous">

    <!-- The loading of KaTeX is deferred to speed up page rendering -->
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.js" integrity="sha384-X/XCfMm41VSsqRNQgDerQczD69XqmjOOOwYQvr/uuC+j4OPoNhVgjdGFwhvN02Ja" crossorigin="anonymous"></script>

    <!-- To automatically render math in text elements, include the auto-render extension: -->
    <script>
        function doRenderMath() {
            renderMathInElement(document.body, {
                delimiters: [
                {left: "$$", right: "$$", display: true},
                {left: "$", right: "$", display: false},
                {left: "\\(", right: "\\)", display: false},
                {left: "\\begin{equation}", right: "\\end{equation}", display: true},
                {left: "\\begin{align}", right: "\\end{align}", display: true},
                {left: "\\begin{alignat}", right: "\\end{alignat}", display: true},
                {left: "\\begin{gather}", right: "\\end{gather}", display: true},
                {left: "\\begin{CD}", right: "\\end{CD}", display: true},
                {left: "\\[", right: "\\]", display: true}
                ]
            });
        }
    </script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/contrib/auto-render.min.js" integrity="sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR" crossorigin="anonymous"
        onload="doRenderMath()"></script>

      </head>
  <body id="top" class="sticky-footer"><div id="page-wrapper">
<header id="header" class="section">
  <section class="container grid-xl">
    <nav class="navbar">
      <section class="navbar-section">
        
<a class="site-logo" href="https:&#x2F;&#x2F;ilikexff.cn">
  
  <div class="col-mx-auto">
    <figure style="margin: 8px">
      <img class="img-responsive"
           style="max-height: 45px"
           alt="frontmatter image"
           src="https://ilikexff.cn/./logo.svg">
    </figure>
  </div>
  
</a>

      </section><!-- ./home button -->

      <section class="navbar-center hide-md"></section>

      <section class="navbar-section">
        <nav class="dropmenu animated hide-md">

<ul><li>
        <a href="https://ilikexff.cn/tags">æ ‡ç­¾</a>
    </li><li>
        <a href="https://ilikexff.cn/categories">åˆ†ç±»</a>
    </li><li>
        <a href="https://ilikexff.cn/about">å…³äº</a>
    </li></ul>


          </nav>
      </section><!-- ./desktop-menu -->
    </nav>
  </section><!-- ./container -->
</header>


<div class="mobile-menu">
  <div class="button_container" id="toggle" onclick="openOverlay()">
    <span class="top"></span>
    <span class="middle"></span>
    <span class="bottom"></span>
  </div>
</div><!--./mobile-menu-->


<section id="start"><section id="body-wrapper" class="section">
          <section class="container grid-xl">
<div id="breadcrumbs" itemtype="http://schema.org/BreadcrumbList" class="hide-sm">
  
    
    <span><a href="https:&#x2F;&#x2F;ilikexff.cn&#x2F;">Home</a></span>
  
    <span><a href="https:&#x2F;&#x2F;ilikexff.cn&#x2F;guan-yu-jie-kou-xian-liu-de-yi-ci-jian-dan-shi-jian&#x2F;">å…³äºæ¥å£é™æµçš„ä¸€æ¬¡ç®€å•å®è·µ</a></span>
</div>
<div class="columns">
              <div id="item" class="column col-8 col-md-12 extra-spacing">
<div class="card">
  

    <div class="card-header">
      <div class="card-title" style="margin-top: .25rem;"><div>
          <h1 class="post-title">å…³äºæ¥å£é™æµçš„ä¸€æ¬¡ç®€å•å®è·µ</h1>
          
    <div class="post-meta" style="display: inline-flex">
        <span class="blog-date" style="display: inline-flex;">
          <i class="gg-calendar" style="margin-right: 5px;"></i><time datetime="2023.06.15">
          2023.06.15
          </time></span><span class="post-author" style="margin-left: 5px; display: inline-flex;">
          - 
    æ…•äºˆ
        </span></div>

        </div></div>
    </div><!--./card-header-->

    <div class="card-body">
      
        <h2 id="1-xie-zhe-pian-wen-zhang-de-lai-you">1.å†™è¿™ç¯‡æ–‡ç« çš„æ¥ç”±<a class="zola-anchor" href="#1-xie-zhe-pian-wen-zhang-de-lai-you" aria-label="Anchor link for: 1-xie-zhe-pian-wen-zhang-de-lai-you">ğŸ”—</a></h2>
<p>æœ‰ä¸€æ®µæ—¶é—´é‡Œï¼Œåšå®¢æ€»æ˜¯ä¸‰å¤©ä¸¤å¤´è¢«æ‰“ï¼Œå…¶ä¸­å°±é‡åˆ°äº†æ¶æ„åˆ·æ¥å£çš„æ‰‹æ®µï¼Œå¯¹æ–¹æ˜æ˜¾ä½¿ç”¨çš„ä»£ç IPï¼Œç”±äºåšå®¢å¹¶æ²¡æœ‰åšè¿™æ–¹é¢çš„æªæ–½ï¼ŒåŠ ä¸Šè¢«å¤§é‡ç›—åˆ·çš„æ¥å£åˆšå¥½æ˜¯æ•°æ®é‡æœ€å¤§çš„ä¸€ç¯‡æ–‡ç« æ•°æ®ï¼Œæ‰€ä»¥ä¸å‡ºæ„å¤–çš„ï¼Œåšå®¢æ²¡å¤šä¹…å°±å´©äº†ã€‚æœåŠ¡å™¨çŠ¶æ€ä¹Ÿæ˜¯å„ç§å¼‚å¸¸ã€‚æ‰€ä»¥åƒä¸€å ‘é•¿ä¸€æ™ºå§ç®—æ˜¯ï¼Œæˆ‘ä¹Ÿæ²¡æƒ³åˆ°<strong>é¢å¯¹</strong>ä¸€ä¸ªä¸ªäººå°ç ´ç«™ï¼Œ<strong>å¯¹é¢</strong>ä¹Ÿæ˜¯é¥¥ä¸æ‹©é£Ÿâ€¦.çœŸ<strong>å¤§é»‘å®¢</strong>å•Šå…„å¼Ÿä»¬ï¼ï¼ï¼</p>
<p><img src="https://images.waer.ltd/img/ERROR.jpg" alt="ERROR" /></p>
<hr />
<h2 id="2-jie-kou-xian-liu-de-chang-jian-shou-duan">2.æ¥å£é™æµçš„å¸¸è§æ‰‹æ®µ<a class="zola-anchor" href="#2-jie-kou-xian-liu-de-chang-jian-shou-duan" aria-label="Anchor link for: 2-jie-kou-xian-liu-de-chang-jian-shou-duan">ğŸ”—</a></h2>
<p>â€‹	ç°åœ¨æ¥è¯´ï¼Œåšé™æµçš„å„ç§æ–¹æ¡ˆå…¶å®å·²ç»ç›¸å¯¹å¾ˆæˆç†Ÿäº†ï¼Œè¿™é‡Œä¹Ÿæ˜¯å¤§è‡´åˆ—ä¸¾äº†å‡ ç§å¸¸ç”¨çš„è§£å†³æ–¹æ¡ˆï¼Œä½†ä¸ä¼šå…¨éƒ¨éƒ½ç»†è¯´ã€‚</p>
<p>æ¯•ç«Ÿå¾ˆå¤šéƒ½è¿˜æ˜¯è‡ªå·±æ²¡æœ‰å®é™…ä½¿ç”¨è¿‡çš„ï¼Œå…‰æç†è®ºæ˜¯æ²¡ä»€ä¹ˆæ„ä¹‰çš„ï¼Œæ‰€ä»¥åç»­æœ‰æ—¶é—´æ‰“ç®—ä¸€ä¸ªä¸ªæªå‡ºæ¥ç»†æï¼Œèµ·ç å¾—åˆ°ç”¨è¿‡äº†å†å†™ç¯‡æ–‡ç« æ€»ç»“ä¸€ä¸‹å§ã€‚</p>
<blockquote>
<p>Javaä¸­å¸¸ç”¨çš„é™æµè§£å†³æ–¹æ¡ˆ:</p>
</blockquote>
<ul>
<li><strong>è®¡æ•°å™¨</strong></li>
<li>æ»‘åŠ¨çª—å£</li>
<li>æ¼æ¡¶</li>
<li>ä»¤ç‰Œæ¡¶</li>
<li><code>Redis+Lua</code>åˆ†å¸ƒå¼é™æµ</li>
</ul>
<p>ç”±äºæˆ‘åšå®¢é‡‡ç”¨çš„å°±æ˜¯è®¡æ•°å™¨æ–¹æ¡ˆï¼Œæ‰€ä»¥è¿™é‡Œä¸»è¦è®°å½•ä¸€ä¸‹æ•´ä¸ªå¤§è‡´çš„é™æµåŸç†ä»¥åŠå®è·µè¿‡ç¨‹ã€‚</p>
<p>ä¸Šé¢å‡ ç§æ–¹æ¡ˆä¸­ï¼Œè®¡æ•°å™¨ç®—æ˜¯æœ€ç®€å•çš„é™æµç®—æ³•äº†ã€‚åŸç†å°±æ˜¯åœ¨æŒ‡å®šçš„æ—¶é—´é—´éš”å†…ï¼Œå¯¹æ¥å£çš„è¯·æ±‚æ¬¡æ•°è¿›è¡Œé™åˆ¶ï¼Œå…·ä½“åˆ°æˆ‘çš„åšå®¢ä¸ºä¾‹ï¼Œæˆ‘æ˜¯é’ˆå¯¹æ¯ä¸ª<code>IP</code>è¿›è¡Œçš„è¯·æ±‚é™åˆ¶ï¼Œå¯¹è¯·æ±‚è¿›è¡Œè®¡æ•°ï¼Œåˆ¤æ–­è¯·æ±‚æ•°é‡ä¸é˜ˆå€¼çš„æƒ…å†µï¼Œå†³å®šæ˜¯å¦éœ€è¦é™æµï¼Œæ¯ä¸ª<code>IP</code>è§¦å‘é™æµä¹‹åä¼šæœ‰ä¸€å®šçš„æ—¶é—´å‘¨æœŸï¼Œè®¡æ•°å™¨åˆ°æ—¶æ¸…é›¶å³å¯ã€‚</p>
<p>è¿™å°±æ˜¯è®¡æ•°å™¨é™æµåŸºæœ¬çš„åŸç†ã€‚å…·ä½“çš„å®ç°ä¸Šï¼Œæˆ‘é€‰ç”¨äº†<code>Redis</code>ä½œä¸ºäº†è®¡æ•°é™æµçš„ä¸­é—´ä»¶ï¼Œæ‰€ä»¥ä¹Ÿå¯ä»¥ç†è§£ä¸ºï¼Œè¿™æ˜¯<code>Redis+</code>è®¡æ•°å™¨çš„ä¸€ç§å®ç°æ–¹å¼ã€‚å…·ä½“æ‰§è¡Œçš„é€»è¾‘å¦‚ä¸‹:</p>
<blockquote>
<ul>
<li>è®¾ç½®å¥½è®¡æ•°å™¨<code>count</code>ï¼Œæ¯è¿‡ä¸€æ¬¡è¯·æ±‚è®¡æ•°å™¨å°±<code>+1</code>ï¼ŒåŒæ—¶è®°å½•å¯¹åº”çš„è¯·æ±‚<code>IP</code>ï¼›</li>
<li>å½“ä¸‹ä¸€ä¸ªè¯·æ±‚åˆ°æ¥ä¹‹é™…ï¼Œé¦–å…ˆé€šè¿‡<code>IP</code>åˆ¤æ–­å¯¹åº”çš„è®¡æ•°å™¨æ˜¯å¦è¾¾åˆ°äº†é™æµçš„é¢‘æ¬¡ï¼Œä»¥åŠæœ¬æ¬¡è¯·æ±‚æ˜¯å¦è¿˜åœ¨è®¾å®šçš„è¯·æ±‚å‘¨æœŸå†…ï¼›</li>
<li>å¦‚æœè¯·æ±‚å·²è§¦å‘é™æµé˜ˆå€¼ï¼Œåˆ™é’ˆå¯¹è¯¥<code>IP</code>å¼€å¯é™æµï¼Œåé¢çš„æ‰€æœ‰è¯·æ±‚å‡ç›´æ¥æ‹’ç»ã€‚</li>
<li>å½“è¢«é™æµ<code>IP</code>è¾¾åˆ°æ—¶é—´å‘¨æœŸæ»¡ä¹‹åï¼Œå°†<code>count</code>é‡ç½®ï¼Œè®¡æ•°å™¨è¿›å…¥ä¸‹ä¸€è½®çš„å°±ç»ªçŠ¶æ€ã€‚</li>
</ul>
</blockquote>
<p>åŸç†ä¹Ÿæ˜¯è›®ç®€å•çš„ï¼Œæˆ‘ä¹Ÿæ˜¯è›®å–œæ¬¢è¿™ç§æ–¹å¼çš„(<strong>åºŠè¨€åºŠè¯­</strong>ğŸ˜€ï¼‰ã€‚ä¸‹é¢å¼€å§‹å…·ä½“çš„å®æ“éƒ¨åˆ†ã€‚</p>
<hr />
<h2 id="3-ji-shu-qi-xian-liu-shi-jian">3.è®¡æ•°å™¨é™æµå®è·µ<a class="zola-anchor" href="#3-ji-shu-qi-xian-liu-shi-jian" aria-label="Anchor link for: 3-ji-shu-qi-xian-liu-shi-jian">ğŸ”—</a></h2>
<p>é¦–å…ˆç¡®å®šå®ç°çš„å…·ä½“æ–¹æ¡ˆï¼Œä¸Šé¢è¯´äº†ï¼Œæˆ‘è¿™é‡Œç”¨çš„æ˜¯<code>Redis</code>ä½œä¸ºé™æµè®¡æ•°å™¨çš„è®°å½•ä»¥åŠé™æµçŠ¶æ€çš„é‡ç½®ç­‰æ“ä½œã€‚å…·ä½“é™æµçš„é€»è¾‘ç›´æ¥å†™ä»¥<code>Java</code>å¸¦ä»£ç å†™åœ¨äº†é¡¹ç›®ä¸šåŠ¡ä¸­ã€‚</p>
<p>ç‰¹åˆ«çš„ï¼Œç”±äºæ˜¯é€šè¿‡<code>IP</code>æ¥é™æµçš„ï¼Œæ‰€ä»¥è¿™é‡Œéœ€è¦ç”¨å¤§çš„å‡ ä¸ªå¤„ç†<code>IP</code>åœ°å€çš„å·¥å…·ç±»å°±å…ˆè´´å‡ºæ¥ã€‚</p>
<blockquote>
<p>ä¸ªäººä¹ æƒ¯ï¼Œæˆ‘è´´ä»£ç ä¼šå°†æ‰€æœ‰<code>import</code>çš„åŒ…éƒ½ä¸€èµ·è´´è¿›æ¥ï¼Œè¿™æ ·æ˜¯æ–¹ä¾¿åç»­å›é¡¾æˆ–è€…å­¦ä¹ çš„æ—¶å€™å¤„ç†ä¸€äº›åŒ…çš„é—®é¢˜ï¼Œä¹‹å‰å°±é‡åˆ°è¿‡å¾ˆå¤šç±»ä¼¼çš„é—®é¢˜(å¯èƒ½å¯¹å°ç™½ä¸å¤ªå‹å¥½)ï¼Œä»£ç æ˜¯æœ‰äº†ï¼Œç»“æœåœ¨å¯¼åŒ…çš„æ—¶å€™è¦ä¹ˆæ˜¯å¯¹ç”¨åˆ°çš„å“ªäº›åŒ…ä¸æ˜æ‰€ä»¥ï¼Œè¦ä¹ˆæ˜¯åŒåçš„åŒ…è¿‡å¤šï¼Œä¸çŸ¥é“æ€ä¹ˆé€‰æ‹©ã€‚</p>
</blockquote>
<h3 id="3-1-ipgong-ju-lei">3.1 IPå·¥å…·ç±»<a class="zola-anchor" href="#3-1-ipgong-ju-lei" aria-label="Anchor link for: 3-1-ipgong-ju-lei">ğŸ”—</a></h3>
<pre data-lang="java" style="background-color:#002b36;color:#839496;" class="language-java "><code class="language-java" data-lang="java"><span style="color:#cb4b16;">import </span><span style="color:#859900;">eu</span><span>.</span><span style="color:#859900;">bitwalker</span><span>.</span><span style="color:#859900;">useragentutils</span><span>.</span><span style="color:#859900;">UserAgent</span><span>;
</span><span style="color:#cb4b16;">import </span><span style="color:#859900;">lombok</span><span>.</span><span style="color:#859900;">extern</span><span>.</span><span style="color:#859900;">slf4j</span><span>.</span><span style="color:#859900;">Slf4j</span><span>;
</span><span style="color:#cb4b16;">import </span><span style="color:#859900;">org</span><span>.</span><span style="color:#859900;">apache</span><span>.</span><span style="color:#859900;">commons</span><span>.</span><span style="color:#859900;">lang3</span><span>.</span><span style="color:#859900;">StringUtils</span><span>;
</span><span style="color:#cb4b16;">import </span><span style="color:#859900;">org</span><span>.</span><span style="color:#859900;">lionsoul</span><span>.</span><span style="color:#859900;">ip2region</span><span>.</span><span style="color:#859900;">DataBlock</span><span>;
</span><span style="color:#cb4b16;">import </span><span style="color:#859900;">org</span><span>.</span><span style="color:#859900;">lionsoul</span><span>.</span><span style="color:#859900;">ip2region</span><span>.</span><span style="color:#859900;">DbConfig</span><span>;
</span><span style="color:#cb4b16;">import </span><span style="color:#859900;">org</span><span>.</span><span style="color:#859900;">lionsoul</span><span>.</span><span style="color:#859900;">ip2region</span><span>.</span><span style="color:#859900;">DbSearcher</span><span>;
</span><span style="color:#cb4b16;">import </span><span style="color:#859900;">org</span><span>.</span><span style="color:#859900;">lionsoul</span><span>.</span><span style="color:#859900;">ip2region</span><span>.</span><span style="color:#859900;">Util</span><span>;
</span><span style="color:#cb4b16;">import </span><span style="color:#859900;">org</span><span>.</span><span style="color:#859900;">springframework</span><span>.</span><span style="color:#859900;">core</span><span>.</span><span style="color:#859900;">io</span><span>.</span><span style="color:#859900;">ClassPathResource</span><span>;
</span><span style="color:#cb4b16;">import </span><span style="color:#859900;">org</span><span>.</span><span style="color:#859900;">springframework</span><span>.</span><span style="color:#859900;">stereotype</span><span>.</span><span style="color:#859900;">Component</span><span>;
</span><span style="color:#cb4b16;">import </span><span style="color:#859900;">org</span><span>.</span><span style="color:#859900;">springframework</span><span>.</span><span style="color:#859900;">util</span><span>.</span><span style="color:#859900;">FileCopyUtils</span><span>;
</span><span style="color:#cb4b16;">import </span><span style="color:#859900;">javax</span><span>.</span><span style="color:#859900;">annotation</span><span>.</span><span style="color:#859900;">PostConstruct</span><span>;
</span><span style="color:#cb4b16;">import </span><span style="color:#859900;">javax</span><span>.</span><span style="color:#859900;">servlet</span><span>.</span><span style="color:#859900;">http</span><span>.</span><span style="color:#859900;">HttpServletRequest</span><span>;
</span><span style="color:#cb4b16;">import </span><span style="color:#859900;">java</span><span>.</span><span style="color:#859900;">io</span><span>.</span><span style="color:#859900;">InputStream</span><span>;
</span><span style="color:#cb4b16;">import </span><span style="color:#859900;">java</span><span>.</span><span style="color:#859900;">lang</span><span>.</span><span style="color:#859900;">reflect</span><span>.</span><span style="color:#859900;">Method</span><span>;
</span><span style="color:#cb4b16;">import </span><span style="color:#859900;">java</span><span>.</span><span style="color:#859900;">net</span><span>.</span><span style="color:#859900;">InetAddress</span><span>;
</span><span style="color:#cb4b16;">import </span><span style="color:#859900;">java</span><span>.</span><span style="color:#859900;">net</span><span>.</span><span style="color:#859900;">UnknownHostException</span><span>;
</span><span>
</span><span>
</span><span>@</span><span style="color:#268bd2;">Slf4j
</span><span>@</span><span style="color:#268bd2;">Component
</span><span style="color:#93a1a1;">public </span><span style="color:#268bd2;">class </span><span style="color:#b58900;">IpUtils </span><span style="color:#657b83;">{
</span><span>    
</span><span>    
</span><span>    </span><span style="color:#586e75;">/**
</span><span style="color:#586e75;">     * è·å–ipåœ°å€
</span><span style="color:#586e75;">     */
</span><span style="color:#586e75;">    public static String getIpAddress(HttpServletRequest request) {
</span><span style="color:#586e75;">        String ipAddress = request.getHeader(&quot;X-Real-IP&quot;);
</span><span style="color:#586e75;">        if (ipAddress == null || ipAddress.length() == 0 || &quot;unknown&quot;.equalsIgnoreCase(ipAddress)) {
</span><span style="color:#586e75;">            ipAddress = request.getHeader(&quot;x-forwarded-for&quot;);
</span><span style="color:#586e75;">        }
</span><span style="color:#586e75;">        if (ipAddress == null || ipAddress.length() == 0 || &quot;unknown&quot;.equalsIgnoreCase(ipAddress)) {
</span><span style="color:#586e75;">            ipAddress = request.getHeader(&quot;Proxy-Client-IP&quot;);
</span><span style="color:#586e75;">        }
</span><span style="color:#586e75;">        if (ipAddress == null || ipAddress.length() == 0 || &quot;unknown&quot;.equalsIgnoreCase(ipAddress)) {
</span><span style="color:#586e75;">            ipAddress = request.getHeader(&quot;WL-Proxy-Client-IP&quot;);
</span><span style="color:#586e75;">        }
</span><span style="color:#586e75;">        if (ipAddress == null || ipAddress.length() == 0 || &quot;unknown&quot;.equalsIgnoreCase(ipAddress)) {
</span><span style="color:#586e75;">            ipAddress = request.getHeader(&quot;HTTP_CLIENT_IP&quot;);
</span><span style="color:#586e75;">        }
</span><span style="color:#586e75;">        if (ipAddress == null || ipAddress.length() == 0 || &quot;unknown&quot;.equalsIgnoreCase(ipAddress)) {
</span><span style="color:#586e75;">            ipAddress = request.getHeader(&quot;HTTP_X_FORWARDED_FOR&quot;);
</span><span style="color:#586e75;">        }
</span><span style="color:#586e75;">        if (ipAddress == null || ipAddress.length() == 0 || &quot;unknown&quot;.equalsIgnoreCase(ipAddress)) {
</span><span style="color:#586e75;">            ipAddress = request.getRemoteAddr();
</span><span style="color:#586e75;">            if (&quot;127.0.0.1&quot;.equals(ipAddress) || &quot;0:0:0:0:0:0:0:1&quot;.equals(ipAddress)) {
</span><span style="color:#586e75;">                //æ ¹æ®ç½‘å¡å–æœ¬æœºé…ç½®çš„IP
</span><span style="color:#586e75;">                InetAddress inet = null;
</span><span style="color:#586e75;">                try {
</span><span style="color:#586e75;">                    inet = InetAddress.getLocalHost();
</span><span style="color:#586e75;">                } catch (UnknownHostException e) {
</span><span style="color:#586e75;">                    log.error(&quot;getIpAddress exception:&quot;, e);
</span><span style="color:#586e75;">                }
</span><span style="color:#586e75;">                assert inet != null;
</span><span style="color:#586e75;">                ipAddress = inet.getHostAddress();
</span><span style="color:#586e75;">            }
</span><span style="color:#586e75;">        }
</span><span style="color:#586e75;">        return StringUtils.substringBefore(ipAddress, &quot;,&quot;);
</span><span style="color:#586e75;">    }
</span><span style="color:#586e75;">
</span><span style="color:#586e75;">    private static DbSearcher searcher;
</span><span style="color:#586e75;">    private static Method method;
</span><span style="color:#586e75;">
</span><span style="color:#586e75;">    /**
</span><span style="color:#586e75;">     * åœ¨æœåŠ¡å¯åŠ¨æ—¶åŠ è½½ ip2region.db åˆ°å†…å­˜ä¸­
</span><span style="color:#586e75;">     */
</span><span style="color:#586e75;">    @PostConstruct
</span><span style="color:#586e75;">    private void initIp2regionResource() throws Exception {
</span><span style="color:#586e75;">        InputStream inputStream = new ClassPathResource(&quot;/ip/ip2region.db&quot;).getInputStream();
</span><span style="color:#586e75;">        //å°† ip2region.db è½¬ä¸º ByteArray
</span><span style="color:#586e75;">        byte[] dbBinStr = FileCopyUtils.copyToByteArray(inputStream);
</span><span style="color:#586e75;">        DbConfig dbConfig = new DbConfig();
</span><span style="color:#586e75;">        searcher = new DbSearcher(dbConfig, dbBinStr);
</span><span style="color:#586e75;">        //äºŒè¿›åˆ¶æ–¹å¼åˆå§‹åŒ– DBSearcherï¼Œéœ€è¦ä½¿ç”¨åŸºäºå†…å­˜çš„æŸ¥æ‰¾ç®—æ³• memorySearch
</span><span style="color:#586e75;">        method = searcher.getClass().getMethod(&quot;memorySearch&quot;, String.class);
</span><span style="color:#586e75;">    }
</span><span style="color:#586e75;">
</span><span style="color:#586e75;">    /**
</span><span style="color:#586e75;">     * è·å–ipåœ°å€çš„å½’å±åœ°
</span><span style="color:#586e75;">     */
</span><span>    </span><span style="color:#93a1a1;">public static </span><span style="color:#859900;">String </span><span style="color:#b58900;">getIpSource</span><span style="color:#657b83;">(</span><span style="color:#859900;">String </span><span style="color:#268bd2;">ipAddress</span><span style="color:#657b83;">) {
</span><span>        </span><span style="color:#859900;">if </span><span style="color:#657b83;">(</span><span>ipAddress </span><span style="color:#657b83;">== </span><span style="color:#b58900;">null </span><span style="color:#859900;">|| !Util</span><span>.</span><span style="color:#b58900;">isIpAddress</span><span style="color:#657b83;">(</span><span>ipAddress</span><span style="color:#657b83;">)) {
</span><span>            log.</span><span style="color:#b58900;">error</span><span style="color:#657b83;">(</span><span>&quot;</span><span style="color:#2aa198;">Error: Invalid ip address</span><span>&quot;</span><span style="color:#657b83;">)</span><span>;
</span><span>            </span><span style="color:#859900;">return </span><span>&quot;&quot;;
</span><span>        </span><span style="color:#657b83;">}
</span><span>        </span><span style="color:#859900;">try </span><span style="color:#657b83;">{
</span><span>            </span><span style="color:#859900;">DataBlock</span><span> dataBlock </span><span style="color:#657b83;">= (</span><span style="color:#859900;">DataBlock</span><span style="color:#657b83;">)</span><span> method.</span><span style="color:#b58900;">invoke</span><span style="color:#657b83;">(</span><span>searcher, ipAddress</span><span style="color:#657b83;">)</span><span>;
</span><span>            </span><span style="color:#859900;">String</span><span> ipInfo </span><span style="color:#657b83;">=</span><span> dataBlock.</span><span style="color:#b58900;">getRegion</span><span style="color:#657b83;">()</span><span>;
</span><span>            </span><span style="color:#859900;">if </span><span style="color:#657b83;">(</span><span style="color:#859900;">!StringUtils</span><span>.</span><span style="color:#b58900;">isEmpty</span><span style="color:#657b83;">(</span><span>ipInfo</span><span style="color:#657b83;">)) {
</span><span>                ipInfo </span><span style="color:#657b83;">=</span><span> ipInfo.</span><span style="color:#b58900;">replace</span><span style="color:#657b83;">(</span><span>&quot;</span><span style="color:#2aa198;">|0</span><span>&quot;, &quot;&quot;</span><span style="color:#657b83;">)</span><span>;
</span><span>                ipInfo </span><span style="color:#657b83;">=</span><span> ipInfo.</span><span style="color:#b58900;">replace</span><span style="color:#657b83;">(</span><span>&quot;</span><span style="color:#2aa198;">0|</span><span>&quot;, &quot;&quot;</span><span style="color:#657b83;">)</span><span>;
</span><span>                </span><span style="color:#859900;">return</span><span> ipInfo;
</span><span>            </span><span style="color:#657b83;">}
</span><span>        </span><span style="color:#657b83;">} </span><span style="color:#859900;">catch </span><span style="color:#657b83;">(</span><span style="color:#859900;">Exception </span><span style="color:#268bd2;">e</span><span style="color:#657b83;">) {
</span><span>            log.</span><span style="color:#b58900;">error</span><span style="color:#657b83;">(</span><span>&quot;</span><span style="color:#2aa198;">getCityInfo exception:</span><span>&quot;, e</span><span style="color:#657b83;">)</span><span>;
</span><span>        </span><span style="color:#657b83;">}
</span><span>        </span><span style="color:#859900;">return </span><span>&quot;&quot;;
</span><span>    </span><span style="color:#657b83;">}
</span><span>
</span><span>    </span><span style="color:#93a1a1;">public static </span><span style="color:#859900;">String </span><span style="color:#b58900;">getIpProvince</span><span style="color:#657b83;">(</span><span style="color:#859900;">String </span><span style="color:#268bd2;">ipSource</span><span style="color:#657b83;">) {
</span><span>        </span><span style="color:#859900;">String</span><span style="color:#93a1a1;">[]</span><span> strings </span><span style="color:#657b83;">=</span><span> ipSource.</span><span style="color:#b58900;">split</span><span style="color:#657b83;">(</span><span>&quot;</span><span style="color:#dc322f;">\\</span><span style="color:#2aa198;">|</span><span>&quot;</span><span style="color:#657b83;">)</span><span>;
</span><span>        </span><span style="color:#859900;">if </span><span style="color:#657b83;">(</span><span>strings[</span><span style="color:#6c71c4;">1</span><span>].</span><span style="color:#b58900;">endsWith</span><span style="color:#657b83;">(</span><span>&quot;</span><span style="color:#2aa198;">çœ</span><span>&quot;</span><span style="color:#657b83;">)) {
</span><span>            </span><span style="color:#859900;">return StringUtils</span><span>.</span><span style="color:#b58900;">substringBefore</span><span style="color:#657b83;">(</span><span>strings[</span><span style="color:#6c71c4;">1</span><span>], &quot;</span><span style="color:#2aa198;">çœ</span><span>&quot;</span><span style="color:#657b83;">)</span><span>;
</span><span>        </span><span style="color:#657b83;">}
</span><span>        </span><span style="color:#859900;">return</span><span> strings[</span><span style="color:#6c71c4;">1</span><span>];
</span><span>    </span><span style="color:#657b83;">}
</span><span>
</span><span>    </span><span style="color:#586e75;">/**
</span><span style="color:#586e75;">     * è·å–è®¿é—®è®¾å¤‡
</span><span style="color:#586e75;">     */
</span><span style="color:#586e75;">    public static UserAgent getUserAgent(HttpServletRequest request) {
</span><span style="color:#586e75;">        return UserAgent.parseUserAgentString(request.getHeader(&quot;User-Agent&quot;));
</span><span style="color:#586e75;">    }
</span><span style="color:#586e75;">}
</span></code></pre>
<hr />
<h3 id="3-2-ding-yi-xian-liu-zhu-jie">3.2 å®šä¹‰é™æµæ³¨è§£<a class="zola-anchor" href="#3-2-ding-yi-xian-liu-zhu-jie" aria-label="Anchor link for: 3-2-ding-yi-xian-liu-zhu-jie">ğŸ”—</a></h3>
<p>ä¸ºäº†ä½¿ç”¨æ–¹ä¾¿ï¼Œæˆ‘è¿™é‡Œé€‰æ‹©äº†æ³¨è§£çš„æ–¹å¼ï¼Œè¿™æ ·åœ¨ä½¿ç”¨çš„æ—¶å€™åªéœ€è¦åœ¨éœ€è¦è¿›è¡Œé™æµçš„è¯·æ±‚<code>Controller</code>ä¸Šæ·»åŠ ä¸€ä¸ªæ³¨è§£å³å¯ã€‚å°±åƒè¿™æ ·:</p>
<p><img src="https://images.waer.ltd/img/image-20221229211158557.png" alt="image-20221229211158557" /></p>
<blockquote>
<p>è‡ªå®šä¹‰çš„é™æµæ³¨è§£å…¶å®å¾ˆç®€å•ï¼Œä¸»è¦åŒ…å«é™æµçš„Keyï¼Œé™æµå‘¨æœŸä»¥åŠè¯·æ±‚è®¡æ•°å™¨ã€‚å½“ç„¶ï¼Œè¿™äº›æ•°æ®éƒ½æ˜¯å®Œå…¨å¯ä»¥è‡ªå®šä¹‰çš„ï¼Œå¹¶æ²¡æœ‰ä»€ä¹ˆçº¦å®šä¿—æˆï¼Œå…·ä½“å·¥å…·è‡ªå·±çš„ä¸šåŠ¡éœ€è¦å†³å®šå°±å¥½ã€‚</p>
</blockquote>
<pre data-lang="java" style="background-color:#002b36;color:#839496;" class="language-java "><code class="language-java" data-lang="java"><span style="color:#cb4b16;">import </span><span style="color:#859900;">java</span><span>.</span><span style="color:#859900;">lang</span><span>.</span><span style="color:#859900;">annotation</span><span>.</span><span style="color:#cb4b16;">*</span><span>;
</span><span style="color:#586e75;">/**
</span><span style="color:#586e75;"> * </span><span style="color:#859900;">@author</span><span style="color:#586e75;">: å…«å°ºå¦–å‰‘
</span><span style="color:#586e75;"> * @date: 2022/10/19 12:34
</span><span style="color:#586e75;"> * @email: ilikexff@gmail.com
</span><span style="color:#586e75;"> * @blog: https://www.waer.ltd
</span><span style="color:#586e75;"> * @Description: è‡ªå®šä¹‰æ³¨è§£:æ¥å£é™æµ
</span><span style="color:#586e75;"> */
</span><span>@</span><span style="color:#268bd2;">Documented
</span><span>@</span><span style="color:#268bd2;">Retention</span><span style="color:#657b83;">(</span><span style="color:#859900;">RetentionPolicy</span><span>.</span><span style="color:#cb4b16;">RUNTIME</span><span style="color:#657b83;">)
</span><span>@</span><span style="color:#268bd2;">Target</span><span style="color:#657b83;">(</span><span style="color:#859900;">ElementType</span><span>.</span><span style="color:#cb4b16;">METHOD</span><span style="color:#657b83;">)
</span><span style="color:#93a1a1;">public </span><span style="color:#268bd2;">@interface </span><span style="color:#b58900;">RateLimit </span><span style="color:#657b83;">{
</span><span>    </span><span style="color:#586e75;">/**
</span><span style="color:#586e75;">     * é™æµçš„key
</span><span style="color:#586e75;">     */
</span><span style="color:#586e75;">    String key() default &quot;limit&quot;;
</span><span style="color:#586e75;">
</span><span style="color:#586e75;">    /**
</span><span style="color:#586e75;">     * å‘¨æœŸï¼šå•ä½ç§’
</span><span style="color:#586e75;">     * </span><span style="color:#859900;">@return
</span><span style="color:#586e75;">     */
</span><span style="color:#586e75;">    int cycles() default 5;
</span><span style="color:#586e75;">
</span><span style="color:#586e75;">    /**
</span><span style="color:#586e75;">     * è¯·æ±‚æ¬¡æ•°
</span><span style="color:#586e75;">     * </span><span style="color:#859900;">@return
</span><span style="color:#586e75;">     */
</span><span style="color:#586e75;">    int count() default 1;
</span><span style="color:#586e75;">}
</span></code></pre>
<hr />
<h3 id="3-3-zi-ding-yi-lan-jie-qi">3.3 è‡ªå®šä¹‰æ‹¦æˆªå™¨<a class="zola-anchor" href="#3-3-zi-ding-yi-lan-jie-qi" aria-label="Anchor link for: 3-3-zi-ding-yi-lan-jie-qi">ğŸ”—</a></h3>
<blockquote>
<p>è¿™é‡Œä½¿ç”¨åˆ°äº†æ‹¦æˆªå™¨ï¼Œä¸»è¦ä½œç”¨å°±æ˜¯æ‹¦æˆªå¤„ç†æ‰€æœ‰çš„è¯·æ±‚è¿›è¡Œæ‹¦æˆªï¼Œä¸»è¦ç”¨åˆ°çš„<code>preHandle</code>æ–¹æ³•ã€‚æ‰€æœ‰çš„é™æµé€»è¾‘éƒ½åœ¨è¿™é‡Œå®ç°ã€‚æ‰€ä»¥è¿™éƒ¨åˆ†æŒºé‡è¦çš„ã€‚</p>
</blockquote>
<pre data-lang="java" style="background-color:#002b36;color:#839496;" class="language-java "><code class="language-java" data-lang="java"><span style="color:#586e75;">/**
</span><span style="color:#586e75;"> * </span><span style="color:#859900;">@author</span><span style="color:#586e75;">: å…«å°ºå¦–å‰‘
</span><span style="color:#586e75;"> * @date: 2022/10/19 12:38
</span><span style="color:#586e75;"> * @email: ilikexff@gmail.com
</span><span style="color:#586e75;"> * @blog: https://www.waer.ltd
</span><span style="color:#586e75;"> * @Description: æ‹¦æˆªå™¨:å¤„ç†æ¥å£é™æµ
</span><span style="color:#586e75;"> */
</span><span>@</span><span style="color:#268bd2;">Component
</span><span style="color:#93a1a1;">public </span><span style="color:#268bd2;">class </span><span style="color:#b58900;">RateLimitInterceptor </span><span style="color:#859900;">implements </span><span style="color:#268bd2;">HandlerInterceptor </span><span style="color:#657b83;">{
</span><span>    @</span><span style="color:#268bd2;">Resource
</span><span>    </span><span style="color:#93a1a1;">private </span><span style="color:#859900;">RedisTemplate</span><span>&lt;</span><span style="color:#859900;">String</span><span>,</span><span style="color:#859900;">Integer</span><span>&gt; redisTemplate;
</span><span>    @</span><span style="color:#268bd2;">Autowired
</span><span>    </span><span style="color:#93a1a1;">private </span><span style="color:#859900;">EmailUtils </span><span>emailUtils;
</span><span>    @</span><span style="color:#268bd2;">Override
</span><span>    </span><span style="color:#93a1a1;">public </span><span style="color:#268bd2;">boolean </span><span style="color:#b58900;">preHandle</span><span style="color:#657b83;">(</span><span style="color:#859900;">HttpServletRequest </span><span style="color:#268bd2;">request</span><span>, </span><span style="color:#859900;">HttpServletResponse </span><span style="color:#268bd2;">response</span><span>, </span><span style="color:#859900;">Object </span><span style="color:#268bd2;">handler</span><span style="color:#657b83;">) </span><span style="color:#859900;">throws Exception </span><span style="color:#657b83;">{
</span><span>        </span><span style="color:#586e75;">// å¦‚æœè¯·æ±‚çš„æ˜¯æ–¹æ³•ï¼Œåˆ™éœ€è¦åšæ ¡éªŒ
</span><span>        </span><span style="color:#859900;">if </span><span style="color:#657b83;">(</span><span>handler </span><span style="color:#859900;">instanceof HandlerMethod</span><span style="color:#657b83;">) {
</span><span>            </span><span style="color:#859900;">HandlerMethod</span><span> handlerMethod </span><span style="color:#657b83;">= (</span><span style="color:#859900;">HandlerMethod</span><span style="color:#657b83;">)</span><span> handler;
</span><span>            </span><span style="color:#586e75;">// è·å–ç›®æ ‡æ–¹æ³•ä¸Šæ˜¯å¦æœ‰æŒ‡å®šæ³¨è§£
</span><span>            </span><span style="color:#859900;">RateLimit</span><span> rateLimit </span><span style="color:#657b83;">=</span><span> handlerMethod.</span><span style="color:#b58900;">getMethodAnnotation</span><span style="color:#657b83;">(</span><span style="color:#859900;">RateLimit</span><span>.</span><span style="color:#d33682;">class</span><span style="color:#657b83;">)</span><span>;
</span><span>            </span><span style="color:#859900;">if </span><span style="color:#657b83;">(</span><span>rateLimit </span><span style="color:#657b83;">== </span><span style="color:#b58900;">null</span><span style="color:#657b83;">) {
</span><span>                </span><span style="color:#586e75;">//è¯´æ˜ç›®æ ‡æ–¹æ³•ä¸Šæ²¡æœ‰ RateLimit æ³¨è§£
</span><span>                </span><span style="color:#859900;">return </span><span style="color:#b58900;">true</span><span>;
</span><span>            </span><span style="color:#657b83;">}
</span><span>            </span><span style="color:#586e75;">// è¯´æ˜ç›®æ ‡æ–¹æ³•ä¸Šæœ‰ RateLimit æ³¨è§£ï¼Œæ‰€ä»¥éœ€è¦æ ¡éªŒè¿™ä¸ªè¯·æ±‚æ˜¯ä¸æ˜¯åœ¨åˆ·æ¥å£
</span><span>            </span><span style="color:#586e75;">// è·å–è¯·æ±‚IPåœ°å€
</span><span>            </span><span style="color:#859900;">String</span><span> ip </span><span style="color:#657b83;">= </span><span style="color:#859900;">IpUtils</span><span>.</span><span style="color:#b58900;">getIpAddress</span><span style="color:#657b83;">(</span><span>request</span><span style="color:#657b83;">)</span><span>;
</span><span>            </span><span style="color:#586e75;">// è¯·æ±‚urlè·¯å¾„
</span><span>            </span><span style="color:#859900;">String</span><span> uri </span><span style="color:#657b83;">=</span><span> request.</span><span style="color:#b58900;">getRequestURI</span><span style="color:#657b83;">()</span><span>;
</span><span>            </span><span style="color:#586e75;">//å­˜åˆ°redisä¸­çš„key
</span><span>            </span><span style="color:#859900;">String</span><span> key </span><span style="color:#657b83;">= </span><span>&quot;</span><span style="color:#2aa198;">RateLimit:</span><span>&quot; </span><span style="color:#657b83;">+</span><span> ip </span><span style="color:#657b83;">+ </span><span>&quot;</span><span style="color:#2aa198;">:</span><span>&quot; </span><span style="color:#657b83;">+</span><span> uri;
</span><span>            </span><span style="color:#586e75;">// ç¼“å­˜ä¸­å­˜åœ¨keyï¼Œåœ¨é™å®šè®¿é—®å‘¨æœŸå†…å·²ç»è°ƒç”¨è¿‡å½“å‰æ¥å£
</span><span>            </span><span style="color:#859900;">if </span><span style="color:#657b83;">(</span><span>redisTemplate.</span><span style="color:#b58900;">hasKey</span><span style="color:#657b83;">(</span><span>key</span><span style="color:#657b83;">)) {
</span><span>                </span><span style="color:#586e75;">// è®¿é—®æ¬¡æ•°è‡ªå¢1
</span><span>                redisTemplate.</span><span style="color:#b58900;">opsForValue</span><span style="color:#657b83;">()</span><span>.</span><span style="color:#b58900;">increment</span><span style="color:#657b83;">(</span><span>key, </span><span style="color:#6c71c4;">1</span><span style="color:#657b83;">)</span><span>;
</span><span>                </span><span style="color:#859900;">Integer</span><span> count </span><span style="color:#657b83;">=</span><span> redisTemplate.</span><span style="color:#b58900;">opsForValue</span><span style="color:#657b83;">()</span><span>.</span><span style="color:#b58900;">get</span><span style="color:#657b83;">(</span><span>key</span><span style="color:#657b83;">)</span><span>;
</span><span>                </span><span style="color:#586e75;">// è¶…å‡ºè®¿é—®æ¬¡æ•°é™åˆ¶
</span><span>                </span><span style="color:#859900;">if </span><span style="color:#657b83;">(</span><span>count </span><span style="color:#657b83;">&gt;</span><span> rateLimit.</span><span style="color:#b58900;">count</span><span style="color:#657b83;">()) {
</span><span>                    </span><span style="color:#859900;">String</span><span> from </span><span style="color:#657b83;">= </span><span style="color:#859900;">IpUtils</span><span>.</span><span style="color:#b58900;">getIpSource</span><span style="color:#657b83;">(</span><span>ip</span><span style="color:#657b83;">)</span><span>;
</span><span>                    </span><span style="color:#859900;">EmailDTO</span><span> emailDTO </span><span style="color:#657b83;">= </span><span style="color:#b58900;">SendEmailForRateLimit</span><span style="color:#657b83;">(</span><span>ip,uri,from</span><span style="color:#657b83;">)</span><span>;
</span><span>                    </span><span style="color:#859900;">CompletableFuture</span><span>.</span><span style="color:#b58900;">supplyAsync</span><span style="color:#657b83;">(()</span><span style="color:#268bd2;">-&gt;</span><span style="color:#657b83;">{
</span><span>                        </span><span style="color:#859900;">return</span><span> count</span><span style="color:#657b83;">==</span><span style="color:#6c71c4;">50 </span><span style="color:#859900;">? </span><span style="color:#b58900;">true </span><span style="color:#859900;">: </span><span style="color:#b58900;">false</span><span>;
</span><span>                    </span><span style="color:#657b83;">})</span><span>.</span><span style="color:#b58900;">thenApplyAsync</span><span style="color:#657b83;">(</span><span style="color:#268bd2;">num-&gt;</span><span style="color:#859900;">CompletableFuture</span><span>.</span><span style="color:#b58900;">supplyAsync</span><span style="color:#657b83;">(() </span><span style="color:#268bd2;">-&gt; </span><span style="color:#657b83;">{
</span><span>                        </span><span style="color:#586e75;">//System.out.println(&quot;num:&quot; + num);
</span><span>                        </span><span style="color:#859900;">if</span><span style="color:#657b83;">(</span><span>num</span><span style="color:#657b83;">) {
</span><span>                            emailUtils.</span><span style="color:#b58900;">sendHtmlMail</span><span style="color:#657b83;">(</span><span>emailDTO</span><span style="color:#657b83;">)</span><span>;
</span><span>                        </span><span style="color:#657b83;">}
</span><span>                        </span><span style="color:#859900;">return </span><span>&quot;</span><span style="color:#2aa198;">é‚®ä»¶å‘é€å®Œæˆ</span><span>&quot;;
</span><span>                    </span><span style="color:#657b83;">}))</span><span>;
</span><span>                    </span><span style="color:#859900;">throw  new BizException</span><span style="color:#657b83;">(</span><span style="color:#859900;">StatusCodeEnum</span><span>.</span><span style="color:#cb4b16;">RATE_LIMIT_REQUEST</span><span style="color:#657b83;">)</span><span>;
</span><span>                </span><span style="color:#657b83;">}
</span><span>                </span><span style="color:#586e75;">// æœªè¶…å‡ºè®¿é—®æ¬¡æ•°é™åˆ¶ï¼Œä¸è¿›è¡Œä»»ä½•æ“ä½œï¼Œè¿”å›true
</span><span>            </span><span style="color:#657b83;">} </span><span style="color:#859900;">else </span><span style="color:#657b83;">{
</span><span>                </span><span style="color:#586e75;">// ç¬¬ä¸€æ¬¡è®¾ç½®æ•°æ®,è¿‡æœŸæ—¶é—´ä¸ºæ³¨è§£ç¡®å®šçš„è®¿é—®å‘¨æœŸ
</span><span>                redisTemplate.</span><span style="color:#b58900;">opsForValue</span><span style="color:#657b83;">()</span><span>.</span><span style="color:#b58900;">set</span><span style="color:#657b83;">(</span><span>key, </span><span style="color:#6c71c4;">1</span><span>, rateLimit.</span><span style="color:#b58900;">cycles</span><span style="color:#657b83;">()</span><span>, </span><span style="color:#859900;">TimeUnit</span><span>.</span><span style="color:#cb4b16;">SECONDS</span><span style="color:#657b83;">)</span><span>;
</span><span>            </span><span style="color:#657b83;">}
</span><span>            </span><span style="color:#859900;">return </span><span style="color:#b58900;">true</span><span>;
</span><span>        </span><span style="color:#657b83;">}
</span><span>        </span><span style="color:#586e75;">//å¦‚æœè¯·æ±‚çš„ä¸æ˜¯æ–¹æ³•ï¼Œç›´æ¥æ”¾è¡Œ
</span><span>        </span><span style="color:#859900;">return </span><span style="color:#b58900;">true</span><span>;
</span><span>    </span><span style="color:#657b83;">}
</span></code></pre>
<blockquote>
<p>ä»£ç ä¸­å·²ç»å†™äº†è¯¦ç»†çš„æ³¨é‡Šï¼Œæ‰€ä»¥å°±ä¸å†å…·ä½“å±•å¼€ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå…¶ä¸­æ¶‰åŠåˆ°é‚®ä»¶å‘é€çš„éƒ¨åˆ†æ˜¯æˆ‘è‡ªå·±å¢åŠ çš„ä¸€ä¸ªå®‰å…¨æé†’çš„éƒ¨åˆ†é€»è¾‘ï¼Œæ‰€ä»¥è¿™éƒ¨åˆ†å¯ä»¥å¿½ç•¥æ‰ï¼Œä¸ç®—åœ¨é™æµé€»è¾‘ä¸­ä¹Ÿæ˜¯æ²¡æœ‰ä»»ä½•æ¯›ç—…çš„ã€‚</p>
</blockquote>
<hr />
<h2 id="4-shi-ji-shi-yong-zhi-hou-de-xiao-guo">4.å®é™…ä½¿ç”¨ä¹‹åçš„æ•ˆæœ<a class="zola-anchor" href="#4-shi-ji-shi-yong-zhi-hou-de-xiao-guo" aria-label="Anchor link for: 4-shi-ji-shi-yong-zhi-hou-de-xiao-guo">ğŸ”—</a></h2>
<p>åˆ°è¿™ä¸€æ­¥ï¼Œæ‰€æœ‰çš„å·¥ä½œéƒ½å®Œæˆäº†ï¼Œå‰é¢ä¹Ÿæåˆ°è¿‡ä½¿ç”¨æ˜¯éå¸¸ç®€å•çš„ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨è¦è¿›è¡Œé™æµçš„è¯·æ±‚æ–¹æ³•ä¸ŠåŠ ä¸Šæ³¨è§£<code>@RateLimit(cycles = 125,count = 3)</code>å³å¯ï¼Œè‡³äºæ‹¬å·å†…çš„é™æµå‚æ•°ï¼Œé‚£å°±æ ¹æ®è‡ªå·±çš„éœ€æ±‚è®¾ç½®äº†ï¼Œæ¯”å¦‚æˆ‘è¿™é‡Œå†™çš„å°±æ˜¯125ç§’å†…åŒä¸€ä¸ªIPåªèƒ½è¿›è¡Œ3æ¬¡è¯·æ±‚ï¼Œå¦åˆ™å°±ä¼šè§¦å‘é™æµï¼Œè¯·æ±‚æ‹’ç»ã€‚</p>
<p><strong>æ­£å¸¸è¯·æ±‚</strong></p>
<p><img src="https://images.waer.ltd/img/image-20221229214108308.png" alt="image-20221229214108308" /></p>
<p><strong>è¯·æ±‚é™æµ</strong></p>
<p><img src="https://images.waer.ltd/img/image-20221229214200435.png" alt="image-20221229214200435" /></p>
<p><strong>Redisä¸­è®°å½•çš„æ•°æ®</strong></p>
<p><img src="https://images.waer.ltd/img/image-20221229214335152.png" alt="image-20221229214335152" /></p>
<blockquote>
<p>æ³¨æ„ï¼Œé™æµè§¦å‘çš„æç¤ºä¿¡æ¯å»ºè®®è‡ªå·±å†™ä¸€ä¸ªï¼Œæˆ‘æ‰¿è®¤ï¼Œæˆ‘è‡ªå·±è¿™ä¸ªæç¤ºç¡®å®ä¸å¤ªå‹å¥½ï¼Œè¿™ä¸»è¦æ˜¯å½“æ—¶è¢«å¯¹é¢æé‚£ä¹ˆä¸€å‡ºï¼Œå°±å¾ˆæ°”äººï¼Œæ‰€ä»¥åœ¨è¯­è¨€æç¤ºä¸Šå°±æœ‰äº›ä¸å¤Ÿå‹å¥½ï¼Œå¦‚æœéœ€è¦è‡ªå®šä¹‰ï¼Œåªéœ€è¦ä¿®æ”¹ä¸‹é¢çš„å¸¸é‡æ•°æ®å°±å¯ã€‚</p>
</blockquote>
<p><img src="https://images.waer.ltd/img/image-20221229212951790.png" alt="image-20221229212951790" /></p>
<hr />
<h2 id="5-guan-yu-ji-shu-qi-xian-liu-fang-an-de-yi-xie-zong-jie">5.å…³äºè®¡æ•°å™¨é™æµæ–¹æ¡ˆçš„ä¸€äº›æ€»ç»“<a class="zola-anchor" href="#5-guan-yu-ji-shu-qi-xian-liu-fang-an-de-yi-xie-zong-jie" aria-label="Anchor link for: 5-guan-yu-ji-shu-qi-xian-liu-fang-an-de-yi-xie-zong-jie">ğŸ”—</a></h2>
<p>é€šè¿‡ä¸Šé¢ä¸€æ³¢æ¹¿æ»‘æ“ä½œï¼Œæˆ‘ä»¬å·²ç»ä»¥é€šè¿‡è®¡æ•°å™¨è¿™ç§æ–¹å¼å…·ä½“åº”ç”¨åˆ°äº†å®é™…çš„é¡¹ç›®ä¸­ï¼Œä½†è¿™å¹¶ä¸æ˜¯æ•…äº‹çš„ç»“æŸï¼Œæ¯ä¸€ç§æ–¹æ³•éƒ½æœ‰å®ƒç‹¬åˆ°çš„ä¼˜åŠ¿ï¼Œè‡ªç„¶ä¹Ÿä¼šæœ‰è‡ªå·±çš„ä¸è¶³ï¼Œå¯¹äºè®¡æ•°å™¨å®ç°çš„é™æµæ–¹æ¡ˆï¼Œå…¶å®è¿˜æ˜¯æœ‰ä¸å°‘é—®é¢˜çš„ã€‚</p>
<p>è€ƒè™‘ä¸‹é¢è¿™ç§æƒ…å†µ:</p>
<blockquote>
<p>â€‹	å‡è®¾å¯¹äºæŸä¸€äº›æ¥å£çš„éœ€æ±‚æ˜¯æ¯åˆ†é’Ÿå…è®¸çš„è¯·æ±‚ä¸Šé™æ˜¯100æ¬¡ï¼Œå¦‚æœæŸç”¨æˆ·åœ¨æœ€åé‚£ç¬¬59ç§’æœ€åå‡ æ¯«ç§’ç¬é—´ç›´æ¥ç»™ä½ æ¥100ä¸ªè¯·æ±‚ï¼Œå½“è¿™ä¸€ç§’ç»“æŸä¹‹åï¼Œè®¡æ•°å™¨å®Œæˆæ¸…é›¶å·¥ä½œï¼Œæ­¤æ—¶è¯¥ç”¨æˆ·åœ¨ä¸‹ä¸€ç§’çš„æ—¶å€™åˆç»™ä½ æ•´100ä¸ªè¯·æ±‚è¿‡æ¥ï¼Œå•ªä¸€ä¸‹å°±è¿‡æ¥äº†ï¼Œå¾ˆå¿«å•Šï¼Œé‚£ä¹ˆ1ç§’å†…è¿™ä¸ªå¾ˆçš®çš„ç”¨æˆ·å°±å‘é€äº†2å€çš„è¯·æ±‚ï¼Œæ˜¾ç„¶åœ¨è¿™ä¸ªæƒ…å†µä¸‹ï¼Œä¸€åˆ‡ä¹Ÿéƒ½æ˜¯ç¬¦åˆè®¡æ•°å™¨é™æµåŸç†çš„ã€‚</p>
<p>â€‹	è¿™å°±æ˜¯è¯¥æ–¹æ³•çš„ç¼ºé™·(<strong>ä¸èƒ½å¾ˆå¥½çš„å¤„ç†æ—¶é—´å•ä½çš„è¾¹ç•Œ</strong>)ï¼Œè¿™ç§æƒ…å†µçš„å­˜åœ¨ï¼Œå¯èƒ½ä¼šå¯¼è‡´ç³»ç»Ÿä¸€ä¸å°å¿ƒå°±æ‰¿å—äº†å¤ªå¤šï¼Œç”šè‡³å‡»ç©¿ç³»ç»Ÿï¼Œæ‰€ä»¥è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆè¿˜æœ‰å…¶ä»–å‡ ç§æ–¹æ¡ˆçš„åŸå› ä¹‹ä¸€ã€‚</p>
</blockquote>
<p>è‡³æ­¤å°±å®Œæˆäº†ä¸€æ¬¡æ¥å£é™æµçš„æ“ä½œå®è·µã€‚æœ€åï¼Œ<strong>çº¸ä¸Šå¾—æ¥ç»ˆè§‰æµ…å•Šå“¥</strong>ï¼</p>

      
    </div><!--./card-body-->

    <div class="card-footer">
      <div class="columns">
        <div class="column col-9 col-sm-7">
          <div class="taxonomies text-left">
            

    
          </div>
        </div><!--./col-6-->
        
        </div><!--./columns-->
    </div><!--./card-footer-->
</div><!--./card-->
</div>
              <div id="sidebar" class="column col-4 col-md-12">
                <div class="sidebar-content">
                  
                  
<div class="sidebar-widget">
  <div class="tile">
    <div class="tile-icon">
      <figure class="avatar avatar-xl">
        <img src="https://ilikexff.cn/avatar.png" alt="author avatar image">
      </figure>
    </div>
    <div class="tile-content">
      <p class="tile-title" style="font-weight: 600;">æ…•äºˆ</p>
      <p class="tile-subtitle">çƒ­çˆ±ç¼–ç¨‹ï¼Œä¸“æ³¨äºæŠ€æœ¯åˆ†äº«å’Œå­¦ä¹ </p>
    </div>
</div><!--./tile-->
</div>

                  
                  
<div class="sidebar-widget">
  æ¬¢è¿æ¥åˆ°<strong>æ…•äºˆåšå®¢</strong>ï¼è¿™é‡Œåˆ†äº«æŠ€æœ¯æ–‡ç« å’Œç¼–ç¨‹å¿ƒå¾—ã€‚
</div><!-- end text widget -->

                  

                  </div><!--./sidebar-content-->
              </div>
            </div>
            
          </section>
        </section></section>
<section class="container grid-xl">
<ul class="pagination paginator">
  
  
</ul>
</section>
</div><!-- ./page-wrapper -->

    
<div class="mobile-container">
        <div class="overlay" id="overlay">
            <div style="padding: 1rem;">
              
<a class="site-logo" href="https:&#x2F;&#x2F;ilikexff.cn">
  
  <div class="col-mx-auto">
    <figure style="margin: 8px">
      <img class="img-responsive"
           style="max-height: 45px"
           alt="frontmatter image"
           src="https://ilikexff.cn/./logo.svg">
    </figure>
  </div>
  
</a>

            </div>
            <nav class="overlay-menu">
              

<ul class="tree treemenu treemenu-root"><li class="tree-empty">
      <span class="toggler"></span>
      <a href="https://ilikexff.cn/tags">æ ‡ç­¾</a>
    </li><li class="tree-empty">
      <span class="toggler"></span>
      <a href="https://ilikexff.cn/categories">åˆ†ç±»</a>
    </li><li class="tree-empty">
      <span class="toggler"></span>
      <a href="https://ilikexff.cn/about">å…³äº</a>
    </li></ul>


              </nav>
        </div>
    </div>

<script type="text/javascript">
  var overlay = document.getElementById('overlay');
  var toggle = document.getElementById('toggle');

  function openOverlay(){
      // Open overlay
      if (overlay.classList.contains("open")) {
          overlay.classList.remove("open");
      }
      else {
          overlay.classList.add("open");
      }

      // Button transition
      if (toggle.classList.contains("active")) {
          toggle.classList.remove("active");
      }
      else {
          toggle.classList.add("active");
      }
    }
</script>

<section id="footer" class="bg-gray">
  <div class="container grid-xl">
    


    <div class="columns">
      
      <div class="column col-6 col-lg-12 col-mx-auto" style="text-align: center;">
        ç®€å•æ˜¯æ•ˆç‡çš„çµé­‚ | é»”ICPå¤‡2021010295å·
      </div>
      
      <div class="column col-6 col-lg-12 col-mx-auto" style="text-align: center;">
        Made by <a href="https://github.com/gicrisf/">gicrisf</a> -
        <strong>Zhuia</strong>&nbsp;<a href="https://github.com/gicrisf/zhuia">source code</a>
        is licensed under <a href="http://opensource.org/licenses/mit-license.php" target="_blank">MIT</a>.
      </div>
    </div>
  </div>
</section>
</body>
</html>
